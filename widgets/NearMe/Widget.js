// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/NearMe/utils":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/_base/array","dojo/_base/lang"],function(V,W,t,O){return V([W],{map:null,postCreate:function(){},getLayerDetailsFromMap:function(Z,P,F){var x={},d;this.map&&this.map.webMapResponse&&this.map.webMapResponse.itemInfo&&this.map.webMapResponse.itemInfo.itemData&&this.map.webMapResponse.itemInfo.itemData.operationalLayers&&t.forEach(this.map.webMapResponse.itemInfo.itemData.operationalLayers,O.hitch(this,
function(e){e.layerObject&&("ArcGISMapServiceLayer"===e.layerType||"ArcGISTiledMapServiceLayer"===e.layerType?(d=F&&F.substring(0,F.lastIndexOf("_")),d&&e.id!==d||(x.isMapServer=!0,x.id=e.id+"_"+P,e.visibility&&0<=e.layerObject.visibleLayers.indexOf(parseInt(P,10))?x.visibility=!0:x.visibility=!1,Z.substring(0,Z.length-1).replace(/.*?:\/\//g,"")===e.url.replace(/.*?:\/\//g,"")&&(t.forEach(e.resourceInfo.layers,O.hitch(this,function(l){l.id===parseInt(P,10)&&(x.title=l.name)})),t.forEach(e.layers,
O.hitch(this,function(l){l.id===parseInt(P,10)&&(l.name&&(x.title=l.name),x.popupInfo=l.popupInfo,l.layerDefinition&&(l.layerDefinition.definitionExpression&&(x.definitionExpression=l.layerDefinition.definitionExpression),l.layerDefinition.drawingInfo&&l.layerDefinition.drawingInfo.renderer&&(x.renderer=l.layerDefinition.drawingInfo.renderer)))}))))):F&&e.id!==F||e.url.replace(/.*?:\/\//g,"")!==(Z+P).replace(/.*?:\/\//g,"")||F&&e.id!==F||(x.isMapServer=!1,x.title=e.title,x.visibility=e.visibility,
x.popupInfo=e.popupInfo,x.id=e.id,e.layerDefinition&&(e.layerDefinition.definitionExpression&&(x.definitionExpression=e.layerDefinition.definitionExpression),e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer&&(x.renderer=e.layerDefinition.drawingInfo.renderer))))}));return x}})})},"widgets/NearMe/search":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/Evented dojo/_base/lang dojo/_base/array esri/dijit/Search esri/tasks/locator esri/layers/FeatureLayer esri/dijit/PopupTemplate jimu/utils dojo/dom-construct jimu/LayerInfos/LayerInfos ./searchSourceUtils dojo/when dojo/Deferred dojo/promise/all dojo/on dojo/keys".split(" "),
function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,H,v){return V([W,t],{config:null,map:null,searchOptions:null,layerInfosObj:null,_urlParams:{},constructor:function(G){O.mixin(this,G)},postCreate:function(){this._urlParams={}},startup:function(){this.inherited(arguments);n.getInstance(this.map,this.map.itemInfo).then(O.hitch(this,function(G){this.layerInfosObj=G;this.own(this.layerInfosObj.on("layerInfosFilterChanged",O.hitch(this,this.onLayerInfosFilterChanged)));q.setMap(this.map);q.setLayerInfosObj(this.layerInfosObj);
q.setAppConfig(this.appConfig);k(q.getConfigInfo(this.config.searchSourceSettings)).then(O.hitch(this,function(Q){this.config.searchSourceSettings||(this.config.searchSourceSettings=Q);return I(this._convertConfig(Q)).then(function(T){return Z.filter(T,function(M){return M})})})).then(O.hitch(this,function(Q){this.domNode&&this._init(Q)}))}))},_convertConfig:function(G){return Z.map(G.sources,O.hitch(this,function(Q){var T=new w;if(Q&&Q.url&&"locator"===Q.type){var M={locator:new F(Q.url||""),outFields:["*"],
singleLineFieldName:Q.singleLineFieldName||"",name:e.stripHTML(Q.name||""),placeholder:e.stripHTML(Q.placeholder||""),countryCode:Q.countryCode||"",maxSuggestions:Q.maxSuggestions,maxResults:Q.maxResults||6,zoomScale:Q.zoomScale||5E4,useMapExtent:!!Q.searchInCurrentMapExtent};Q.enableLocalSearch&&(M.localSearchOptions={minScale:Q.localSearchMinScale,distance:Q.localSearchDistance});T.resolve(M)}else Q&&Q.url&&"query"===Q.type?(M=new x(Q.url||null,{outFields:["*"]}),this.own(H(M,"load",O.hitch(this,
function(R){var C=R.layer;var a=null;Q.searchFields&&0<Q.searchFields.length?a=Q.searchFields:(a=[],Z.forEach(C.fields,function(da){"esriFieldTypeOID"!==da.type&&da.name!==C.objectIdField&&"esriFieldTypeGeometry"!==da.type&&a.push(da.name)}));var B={featureLayer:C,outFields:["*"],searchFields:a,displayField:Q.displayField||"",exactMatch:!!Q.exactMatch,name:e.stripHTML(Q.name||""),placeholder:e.stripHTML(Q.placeholder||""),maxSuggestions:Q.maxSuggestions||6,maxResults:Q.maxResults||6,zoomScale:Q.zoomScale||
5E4,infoTemplate:void 0,useMapExtent:!!Q.searchInCurrentMapExtent,_featureLayerId:Q.layerId};this._getInfoTemplate(C,Q).then(O.hitch(this,function(da){B.infoTemplate=da;T.resolve(B)}),O.hitch(this,function(){T.resolve(B)}));B._featureLayerId&&(R=this.layerInfosObj.getLayerInfoById(B._featureLayerId),C.setDefinitionExpression(R.getFilter()));T.resolve(B)}))),this.own(H(M,"error",function(){T.resolve(null)}))):T.resolve(null);return T}))},_getInfoTemplate:function(G,Q){var T=new w,M=this.layerInfosObj.getLayerInfoById(Q.layerId),
R;if(M)T=M.loadInfoTemplate();else{var C=[];Z.filter(G.fields,function(a){var B=a.name.toLowerCase();0>B.indexOf("shape")&&0>B.indexOf("objectid")&&0>B.indexOf("globalid")&&0>B.indexOf("perimeter")&&C.push(a.name)});(G=e.getDefaultPopupInfo(G,Q.name+": {"+Q.displayField+"}",C))&&(R=new d(G));T.resolve(R)}return T},_init:function(G){var Q=1===G.length?0:"all";G={map:this.map,addLayersFromMap:!1,autoNavigate:!1,autoComplete:!0,minCharacters:0,searchDelay:100,enableInfoWindow:!0,enableHighlight:this.config.searchSourceSettings.showInfoWindowOnSelect,
showInfoWindowOnSelect:this.config.searchSourceSettings.showInfoWindowOnSelect,allPlaceholder:e.stripHTML(this.config.searchSourceSettings.allPlaceholder),sources:G,activeSourceIndex:Q};O.mixin(G,this.searchOptions);this._urlParams=this._getUrlParams();this.search=new P(G,l.create("div",{"class":"searchControl"}));l.place(this.search.domNode,this.domNode);this.own(this.search.on("load",O.hitch(this,this._load)));this.own(this.search.on("select-result",O.hitch(this,this._selectResult)));this.own(this.search.on("clear-search",
O.hitch(this,this._clear)));this.own(this.search.on("search-results",O.hitch(this,this._results)));this.own(this.search.on("suggest-results",O.hitch(this,this._results)));this.own(H(this.search.inputNode,"keyup",O.hitch(this,function(T){T.keyCode===v.ENTER&&this.emit("init-attribute-search")})));this.own(H(this.search.submitNode,"click",O.hitch(this,function(){this.emit("init-attribute-search")})));this.search.startup()},_getUrlParams:function(){var G=e.urlToObject(document.location.href);G.query=
G.query||{};return G.query},setSearchText:function(G){this.search.set("value",G)},getSearchText:function(){return this.search.get("value")},getActiveSource:function(){return this.search.activeSource},clearSearchText:function(){this.search&&this.search.clear()},_setSearchString:function(){this._urlParams.find&&(this.search.set("value",this._urlParams.find),setTimeout(O.hitch(this,function(){this.search.search()}),1E3))},onLayerInfosFilterChanged:function(G){Z.some(G,O.hitch(this,function(Q){this.search&&
this.search.sources&&0<this.search.sources.length&&Z.forEach(this.search.sources,function(T){T._featureLayerId===Q.id&&T.featureLayer.setDefinitionExpression(Q.getFilter())})}))},_load:function(G){this.emit("search-loaded",G);this._setSearchString()},_results:function(G){this.emit("search-results",G)},_clear:function(G){this.emit("clear-search",G)},_showPopupByFeatures:function(G,Q,T){G=null;this.config.showInfoWindowOnSelect?(this.map.infoWindow.setFeatures(Q),G="point"===Q[0].geometry.type?Q[0].geometry:
(G=Q[0].geometry&&Q[0].geometry.getExtent())&&G.getCenter(),G&&this.map.infoWindow.show(G,{closetFirst:!0})):(this.map.infoWindow.setFeatures(Q),this.map.infoWindow.updateHighlight(this.map,Q[0]),this.map.infoWindow.showHighlight());T.source._panToScale?e.featureAction.panTo(this.map,Q):T.source._zoomScaleOfConfigSource?this._zoomToScale(T.source.zoomScale,Q):(Q=e.toFeatureSet(Q),e.zoomToFeatureSet(this.map,Q))},_loadInfoTemplateAndShowPopup:function(G,Q,T){if(G){var M=this.map.getLayer(G.id);G.isPopupEnabled()&&
M&&this._showPopupByFeatures(G,[Q],T)}},_selectResult:function(G){var Q=G.result.feature,T=function(R,C){return Z.filter(R.graphics,function(a){return a.attributes[R.objectIdField]===C})},M=this.layerInfosObj.getLayerInfoById(G.source._featureLayerId);M&&M.getLayerObject().then(O.hitch(this,function(R){(R=T(R,Q.attributes[R.objectIdField]))&&0<R.length&&this._loadInfoTemplateAndShowPopup(M,R[0],G)}));this.search.blur();this.emit("select-result",G)}})})},"esri/dijit/Search":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Evented dojo/Deferred dojo/keys dojo/on dojo/query dojo/uacss dojo/regexp dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/date/locale dojo/i18n!../nls/jsapi dojo/text!./Search/templates/Search.html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_FocusMixin dijit/a11yclick dijit/focus ../lang ../InfoTemplate ../kernel ../SpatialReference ../graphic ../promiseList ../symbols/PictureMarkerSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/TextSymbol ../symbols/Font ../geometry/Point ../geometry/Extent ../geometry/normalizeUtils ../geometry/scaleUtils ../tasks/locator ../tasks/query ../Color ../styles/basic".split(" "),
function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,H,v,G,Q,T,M,R,C,a,B,da,la,ma,pa,N,oa,na,J,y,A,ea,ta,qa,wa,Ba,b,f,D){function r(g,K){return O.map(O.filter(g.trim().split(" "),function(U){return!!U.trim()}),function(U){return{onFields:K,searchTerm:U,searchType:"prefix"}})}function X(g,K){g=g&&g.indexes;if(!g||!K||!K.length)return!1;g=O.filter(g,function(U){return"FullText"===U.indexType});return O.some(g,function(U){var Y=U.fields&&O.map(U.fields.split(","),function(ia){return ia.trim().toLowerCase()})||[];
return O.every(K,function(ia){return Y.includes(ia.toLowerCase())})})}function ba(g){return!!(g&&g.advancedQueryCapabilities&&g.advancedQueryCapabilities.supportsFullTextSearch)}function ra(g,K){g&&K&&(g._layer=K,g._sourceLayer=K)}W=W([Q,T,M,Z],{declaredClass:"esri.dijit.Search",templateString:G,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,constructor:function(g,K){this.css={searchGroup:"searchGroup",searchInput:"searchInput",searchInputGroup:"searchInputGroup",searchBtn:"searchBtn",searchSubmit:"searchSubmit",
searchIcon:"searchIcon esri-icon-search",searchButtonText:"searchButtonText",searchToggle:"searchToggle",searchToggleIcon:"searchIcon esri-icon-down-arrow",searchMenu:"searchMenu",searchMenuHeader:"menuHeader",searchClear:"searchClear",searchClearIcon:"searchIcon esri-icon-close searchClose",searchSpinner:"searchIcon esri-icon-loading-indicator searchSpinner",searchSourceName:"sourceName",suggestionsMenu:"suggestionsMenu",sourcesMenu:"sourcesMenu",activeSource:"active",hasValue:"hasValue",hasButtonMode:"hasButtonMode",
hasMultipleSources:"hasMultipleSources",showSuggestions:"showSuggestions",showSources:"showSources",showNoResults:"showNoResults",searchLoading:"searchLoading",latLonHeader:"searchLatLongHeader",searchMoreResults:"moreResults",searchMoreResultsList:"resultsList",searchMoreResultsHeader:"moreHeader",searchMoreResultsItem:"moreItem",searchMoreResultsListHeader:"popupHeader",searchShowMoreResults:"showMoreResults",searchNoResultsMenu:"noResultsMenu",searchNoResultsBody:"noResultsBody",searchNoResultsHeader:"noResultsHeader",
searchNoValueIcon:"noValueIcon esri-icon-notice-triangle",searchNoValueText:"noValueText",searchNoResultsText:"noResultsText",searchExpandContainer:"searchExpandContainer",searchAnimateContainer:"searchAnimate",searchExpanded:"searchExpanded",searchCollapsed:"searchCollapsed",searchClearFloat:"searchClearFloat"};this._allIndex="all";this._objectIdIdentifier="_objectId";this._deferreds=[];this._sourceNames=[];this.defaultSource={locator:new Ba("//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),
singleLineFieldName:"SingleLine",outFields:["Addr_type","Match_addr","StAddr","City"],name:v.widgets.Search.main.esriLocatorName,localSearchOptions:{minScale:3E5,distance:5E4},placeholder:v.widgets.Search.main.placeholder,highlightSymbol:(new N(V.toUrl("./Search/images/search-pointer.png"),36,36)).setOffset(9,18)};this.options={map:null,theme:"arcgisSearch",visible:!0,value:"",allPlaceholder:"",sources:[this.defaultSource],activeSourceIndex:0,suggestionDelay:350,enableSourcesMenu:!0,enableSuggestionsMenu:!0,
enableInfoWindow:!0,showInfoWindowOnSelect:!0,enableSuggestions:!0,enableButtonMode:!1,autoNavigate:!0,autoSelect:!0,addLayersFromMap:!1,zoomScale:1E3,graphicsLayer:null,enableHighlight:!0,highlightGraphic:null,enableLabel:!1,labelSymbol:(new y).setColor(new f([181,56,46,.9])).setFont(new A("14px",A.STYLE_NORMAL,A.VARIANT_NORMAL,A.WEIGHT_BOLD,"Arial")),labelGraphic:null,infoTemplate:new B(v.widgets.Search.main.searchResult,'\x3cdiv class\x3d"${searchTheme}"\x3e\x3cdiv id\x3d"${searchMoreResultsId}" class\x3d"${searchMoreResults}"\x3e\x3cdiv class\x3d"${searchMoreResultsItem}"\x3e${searchResult}\x3c/div\x3e\x3cdiv\x3e${searchMoreResultsHtml}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'),
searchResults:null,suggestResults:null,selectedResult:null,magicKey:null,selectedFeatureId:null,expanded:!1,maxLength:128,maxResults:6,maxSuggestions:6,locationToAddressDistance:1500,minCharacters:3,enableSearchingAll:!0};g=t.mixin({},this.options,g);this.set(g);this._updateActiveSource();this._i18n=v;this._defaultSR=new la(4326);this.domNode=K},startup:function(){this.inherited(arguments);this.sources||(this.sources=[]);this._mapLoaded().then(t.hitch(this,this._init))},postCreate:function(){var g=
this;this.inherited(arguments);this._moreResultsId=this.id+"_more_results";this.own(x(this.submitNode,R,t.hitch(this,this._searchButton)));this.own(x(this.sourcesBtnNode,R,t.hitch(this,this._toggleSourcesMenu)));this.own(x(this.inputNode,R,t.hitch(this,this._inputClick)));this.own(x(this.clearNode,R,t.hitch(this,this._clearButton)));this.own(x(this.formNode,"submit",t.hitch(this,function(K){K.preventDefault();this._cancelSuggest();this.search()})));this.own(x(this.inputNode,"keyup",t.hitch(this,function(K){this._inputKey(K)})));
this.own(x(this.sourcesBtnNode,"keyup",t.hitch(this,function(K){this._sourceBtnKey(K)})));this.own(x(this.suggestionsNode,"li:click, li:keyup",function(K){g._suggestionsEvent(K,this)}));this.own(x(this.sourcesNode,"li:click, li:keyup",function(K){g._sourcesEvent(K,this)}));this.own(x(this.inputNode,"input, paste",t.hitch(this,function(){this._suggestDelay()})));this.map&&this.map.infoWindow&&this.map.infoWindow.domNode&&this.enableInfoWindow&&(this.own(x(this.map.infoWindow.domNode,"#"+this._moreResultsId+
"_show:click",t.hitch(this,function(K){this._showMoreResultsClick(K)}))),this.own(x(this.map.infoWindow.domNode,"#"+this._moreResultsId+"_list li a:click",t.hitch(this,function(K){this._moreResultsClick(K)}))),this.own(x(this.map.infoWindow.domNode,"#"+this._moreResultsId+" [data-switch-coordinates]:click",t.hitch(this,function(K){this._switchCoordinatesClick(K)}))));this.value&&this._checkStatus();this._hideMenus();this._updateVisible();this._insertSources(this.sources);this._setPlaceholder(this.activeSourceIndex);
this._updateButtonMode(this.enableButtonMode);this.toggle(this.expanded)},destroy:function(){this.clear();I.empty(this.domNode);this.inherited(arguments)},clear:function(){this.clearGraphics();q.get(this.inputNode,"value")&&q.set(this.inputNode,"value","");this._changeAttrValue("value","");this.set("searchResults",null);this.set("suggestResults",null);this.set("selectedResult",null);this.set("magicKey",null);this.set("selectedFeatureId",null);k.remove(this.containerNode,this.css.hasValue);q.set(this.clearNode,
"title","");this._hideMenus();this._closePopup();this._hideLoading();this.emit("clear-search")},show:function(){w.set(this.domNode,"display","block")},hide:function(){w.set(this.domNode,"display","none")},expand:function(){this.enableButtonMode&&(k.add(this.containerNode,this.css.searchExpanded),k.remove(this.containerNode,this.css.searchCollapsed),this._hideMenus(),this.set("expanded",!0))},collapse:function(){this.enableButtonMode&&(k.remove(this.containerNode,this.css.searchExpanded),k.add(this.containerNode,
this.css.searchCollapsed),this._hideMenus(),this.set("expanded",!1))},toggle:function(g){this.enableButtonMode&&("undefined"===typeof g&&(g=!this.expanded),g?this.expand():this.collapse())},search:function(g){var K=new P;this._mapLoaded().then(t.hitch(this,function(){this._searchDeferred(g).then(t.hitch(this,function(U){var Y=U.results;this.set("searchResults",Y);0===U.numResults&&(this._noResults(U.value),this._showNoResultsMenu());this._hideLoading();this.emit("search-results",U);this._selectFirstResult(Y,
U.activeSourceIndex);K.resolve(Y)}),t.hitch(this,function(U){K.reject(U)}))}));return K.promise},suggest:function(g){var K=new P;this._mapLoaded().then(t.hitch(this,function(){this._suggestDeferred(g).then(t.hitch(this,function(U){if(U){var Y=U.results;this.set("suggestResults",Y);this._insertSuggestions(Y,U.value);this.emit("suggest-results",U);K.resolve(Y)}}),t.hitch(this,function(U){K.reject(U)}))}));return K.promise},select:function(g){var K=this._getDefaultSymbol(g),U=this.labelSymbol,Y=this.sources,
ia=this.activeSourceIndex,va=this.enableHighlight,m=this.enableLabel,E=this.autoNavigate,S=this.showInfoWindowOnSelect,ha=this.enableInfoWindow,ka=this.infoTemplate,xa=g.feature?new ma(g.feature.toJson()):null,Aa=xa?g.feature._sourceLayer:null;ra(xa,Aa);if(ia===this._allIndex){var Ea=this._getSourceIndexOfResult(g);if(null!==Ea){var Ca=Y[Ea];ia=Ea}}else Ca=Y[ia];Ca&&(Ca.hasOwnProperty("highlightSymbol")&&(K=Ca.highlightSymbol),Ca.hasOwnProperty("labelSymbol")&&(U=Ca.labelSymbol),Ca.hasOwnProperty("enableHighlight")&&
(va=Ca.enableHighlight),Ca.hasOwnProperty("enableLabel")&&(m=Ca.enableLabel),Ca.hasOwnProperty("autoNavigate")&&(E=Ca.autoNavigate),Ca.hasOwnProperty("showInfoWindowOnSelect")&&(S=Ca.showInfoWindowOnSelect),Ca.hasOwnProperty("enableInfoWindow")&&(ha=Ca.enableInfoWindow),Ca.hasOwnProperty("infoTemplate")?ka=Ca.infoTemplate:Ca.featureLayer&&Ca.featureLayer.infoTemplate&&(ka=Ca.featureLayer.infoTemplate));this._hideMenus();this._hideLoading();if(xa){Y=this.highlightGraphic;var Ka=this.graphicsLayer;
Ea=this.labelGraphic;var Oa=t.mixin({},xa.attributes,{searchTheme:this.theme,searchResult:this._searchResultHTML(g),searchMoreResults:this.css.searchMoreResults,searchMoreResultsItem:this.css.searchMoreResultsItem,searchMoreResultsId:this._moreResultsId,searchMoreResultsHtml:this._moreResultsHTML(g)}),Va=null;ha&&(Va=ka);Ea?(Ea.setGeometry(xa.geometry),Ea.setAttributes(Oa),Ea.setSymbol(U),U&&"textsymbol"===U.type&&Ea.symbol.setText(g.name)):(Ea=new ma(xa.geometry,U,Oa),ra(Ea,Aa),U&&"textsymbol"===
U.type&&Ea.symbol.setText(g.name),m&&(Ka?Ka.add(Ea):this.map&&this.map.graphics&&this.map.graphics.add(Ea)));Y?(Y.setGeometry(xa.geometry),Y.setAttributes(Oa),Y.setInfoTemplate(Va),Y.setSymbol(K)):(Y=new ma(xa.geometry,K,Oa,Va),ra(Y,Aa),va&&(Ka?Ka.add(Y):this.map&&this.map.graphics&&this.map.graphics.add(Y)));Y&&Y.symbol&&"textsymbol"===Y.symbol.type&&Y.symbol.setText(g.name);this.map&&this.map.infoWindow&&ha&&S&&(this.map.infoWindow.setFeatures([Y]),K=this._getPointFromGeometry(Y.geometry),this.map.infoWindow.show(K));
this.map&&E&&g&&g.hasOwnProperty("extent")&&"function"===typeof this.map.setExtent&&this.map.setExtent(g.extent,!0);this.set("highlightGraphic",Y);this.set("labelGraphic",Ea)}this.set("selectedResult",g);this.emit("select-result",{result:g,source:Ca,sourceIndex:ia})},focus:function(){C.focus(this.inputNode)},blur:function(){this.inputNode.blur();C.curNode&&C.curNode.blur()},clearGraphics:function(){var g=this.highlightGraphic,K=this.graphicsLayer,U=this.labelGraphic;g&&(K?K.remove(g):this.map&&this.map.graphics&&
this.map.graphics.remove(g));U&&(K?K.remove(U):this.map&&this.map.graphics&&this.map.graphics.remove(U));this.set("labelGraphic",null);this.set("highlightGraphic",null)},_mapLoaded:function(){var g=new P;if(this.map)if(this.map.loaded)g.resolve();else x.once(this.map,"load",t.hitch(this,function(){g.resolve()}));else g.resolve();return g.promise},_init:function(){this._getMapLayers().then(t.hitch(this,function(){this.set("loaded",!0);this.emit("load")}))},_clearButton:function(){this.clear();C.focus(this.inputNode)},
_error:function(g){return Error(this.declaredClass+" "+g)},_searchDeferred:function(g){var K=new P,U=this.value,Y=this.activeSourceIndex;g&&g.hasOwnProperty("index")&&(Y=g.index);this._showLoading();this._hideMenus();this._closePopup();this.clearGraphics();var ia={magicKey:this.magicKey,text:U};g?"string"===typeof g?(ia.text=g,g=this._searchQueries(ia)):g="object"===typeof g&&g.hasOwnProperty("magicKey")?this._searchQueries(g):"object"===typeof g&&g.hasOwnProperty("geometry")?this._searchQueries({geometry:g}):
"object"===typeof g&&g.hasOwnProperty(this._objectIdIdentifier)?this._searchQueries(g):"object"===typeof g&&"point"===g.type?this._searchQueries({point:g}):g instanceof Array&&2===g.length?this._searchQueries({latlon:g}):this._searchQueries(ia):g=this._searchQueries(ia);g.always(t.hitch(this,function(va){va=this._formatResults(va,Y,U);K.resolve(va)}));return K.promise},_suggestDeferred:function(g){var K=new P;this._deferreds.push(K);g||(g=this.value);var U=this.activeSourceIndex;this._suggestQueries({text:g}).always(t.hitch(this,
function(Y){var ia;if(Y)for(var va=0;va<Y.length;va++)Y[va]&&(ia=!0);ia?(Y=this._formatResults(Y,U,g),K.resolve(Y)):K.resolve()}));return K.promise},_getDefaultSymbol:function(g){var K;this.map&&(K=this.map.getBasemap());K||(K="topo");if(g&&g.feature&&g.feature.geometry)var U=g.feature.geometry.type;"polyline"===U?U="line":"circle"===U||"extent"===U?U="polygon":"multipoint"===U&&(U="point");if(U){if(g=D.getSchemes({theme:"default",basemap:K,geometryType:U}))var Y=g.primaryScheme;if(Y){Y.color&&Y.hasOwnProperty("opacity")&&
(Y.color.a=Y.opacity);var ia=Y;g=Y.color;Y=Y.size;switch(U){case "point":var va=new oa;va.setColor(g);va.setSize(null!==Y?Y:ia.size);U=new na;U.setColor(ia.outline.color);U.setWidth(ia.outline.width);va.setOutline(U);break;case "line":va=new na;va.setColor(g);va.setWidth(null!==Y?Y:ia.width);break;case "polygon":va=new J,va.setColor(g),U=new na,U.setColor(ia.outline.color),U.setWidth(ia.outline.width),va.setOutline(U)}ia=va}}return ia},_selectFirstResult:function(g,K){if(this.autoSelect&&g){var U;
K===this._allIndex?U=this._getFirstResult(g):g[K]&&g[K][0]&&(U=g[K][0]);U&&this.select(U)}},_getSourceIndexOfResult:function(g){var K=this.searchResults;if(K)for(var U in K)if(K[U]&&K[U].length)for(var Y=0;Y<K[U].length;Y++)if(K[U][Y]===g)return parseInt(U,10);return null},_getFirstResult:function(g){if(g)for(var K in g)if(g[K]&&g[K][0])return g[K][0];return!1},_onFocus:function(){this.map&&"function"===typeof this.map.disableKeyboardNavigation&&this.map.disableKeyboardNavigation();this.emit("focus");
this.inherited(arguments)},_onBlur:function(){this._hideMenus();this.map&&"function"===typeof this.map.enableKeyboardNavigation&&this.map.enableKeyboardNavigation();this.enableButtonMode&&this.loaded&&this.collapse();this.emit("blur");this.inherited(arguments)},_getMapLayers:function(){var g=new P;if(this.addLayersFromMap&&this.map){var K=[],U=this.map.graphicsLayerIds;if(U&&U.length){for(var Y=0;Y<U.length;Y++){var ia=this.map.getLayer(U[Y]);ia&&K.push(this._featureLayerLoaded(ia))}pa(K).always(t.hitch(this,
function(va){for(var m,E=this.sources,S=0;S<va.length;S++)va[S]&&va[S].loaded&&"Feature Layer"===va[S].type&&(E.push({featureLayer:va[S],enableSuggestions:!0}),m=!0);m&&this.set("sources",E);g.resolve()}))}else g.resolve()}else g.resolve();return g.promise},_switchCoordinatesClick:function(g){g.preventDefault();if(g=q.get(g.target,"data-switch-coordinates"))this._cancelSuggest(),this.set("value",g),this.search()},_moreResultsClick:function(g){g.preventDefault();var K=g.target;g=parseInt(q.get(K,"data-source-index"),
10);K=parseInt(q.get(K,"data-index"),10);var U=this.searchResults;U&&U[g]&&(g=U[g][K])&&this.select(g)},_showMoreResultsClick:function(g){g.preventDefault();if(g=n.byId(this._moreResultsId)){k.toggle(g,this.css.searchShowMoreResults);var K=n.byId(this._moreResultsId+"_show");K&&(k.contains(g,this.css.searchShowMoreResults)?q.set(K,"textContent",v.widgets.Search.main.hideMoreResults):q.set(K,"textContent",v.widgets.Search.main.showMoreResults))}},_featureLayerLoaded:function(g){var K=new P;if(g.loaded)K.resolve(g);
else if(g.loadError)K.reject(this._error("Layer failed to load."));else{var U=x.once(g,"load",t.hitch(this,function(){Y.remove();K.resolve(g)}));var Y=x.once(g,"error",t.hitch(this,function(){U.remove();K.reject(this._error("Layer could not be loaded."))}))}return K.promise},_getObjectSize:function(g){var K=0,U;for(U in g)g.hasOwnProperty(U)&&K++;return K},_sourcesEvent:function(g,K){var U=q.get(K,"data-index"),Y=d("li",this.sourcesNode);K=O.indexOf(Y,K);U!==this._allIndex&&(U=parseInt(U,10));"click"===
g.type||g.keyCode===F.ENTER?(this.set("activeSourceIndex",U),C.focus(this.inputNode),this._hideSourcesMenu()):g.keyCode===F.UP_ARROW?(g.stopPropagation(),g.preventDefault(),g=K-1,0>g?C.focus(this.sourcesBtnNode):C.focus(Y[g])):g.keyCode===F.DOWN_ARROW?(g.stopPropagation(),g.preventDefault(),g=K+1,g>=Y.length?C.focus(this.sourcesBtnNode):C.focus(Y[g])):g.keyCode===F.ESCAPE&&(this._hideSourcesMenu(),C.focus(this.inputNode))},_suggestionsEvent:function(g,K){var U=q.get(K,"data-source-index"),Y=parseInt(q.get(K,
"data-index"),10),ia=d("li",this.suggestionsNode),va=this.sources;K=O.indexOf(ia,K);U!==this._allIndex&&(U=parseInt(U,10));var m;this._clearQueryTimeout();"click"===g.type||g.keyCode===F.ENTER?((ia=this.suggestResults)&&ia[U]&&ia[U][Y]&&(m=ia[U][Y]),m&&(m.index=U,va[U].featureLayer?(U=va[U].featureLayer.objectIdField,m[this._objectIdIdentifier]=m.feature.attributes[U],this.set("value",this._getSuggestionName(m)),this.set("selectedFeatureId",m.feature.attributes[U])):m.magicKey&&m.text&&(this.set("value",
m.text),this.set("magicKey",m.magicKey)),this.search(m),C.focus(this.inputNode))):g.keyCode===F.BACKSPACE||g.keyCode===F.DELETE?C.focus(this.inputNode):g.keyCode===F.UP_ARROW?(g.stopPropagation(),g.preventDefault(),m=K-1,0>m?C.focus(this.inputNode):C.focus(ia[m])):g.keyCode===F.DOWN_ARROW?(g.stopPropagation(),g.preventDefault(),m=K+1,m>=ia.length?C.focus(this.inputNode):C.focus(ia[m])):g.keyCode===F.ESCAPE&&(this._hideMenus(),C.focus(this.inputNode))},_getResultName:function(g){var K;g.hasOwnProperty("name")&&
null!==g.name&&(K=g.name.toString());K||(K=v.widgets.Search.main.untitledResult);return K},_getSuggestionName:function(g){var K;g.hasOwnProperty("name")&&null!==g.name&&(K=g.name.toString());g=g.text||K;g||(g=v.widgets.Search.main.untitledResult);return g},_searchResultHTML:function(g){var K="";if(g.feature&&g.feature.attributes&&g.feature.attributes.Addr_type&&"LatLong"===g.feature.attributes.Addr_type){var U=g.name.split(" ");if(2===U.length){var Y=U[0];var ia=U[1]}ia&&Y?(g=parseFloat(Y),ia=parseFloat(ia),
U=ia+", "+g,K+='\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e',K+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+v.widgets.Search.main.lonlat+"\x3c/div\x3e",K=K+(g+", "+ia)+'\x3c/div\x3e\x3cdiv class\x3d"'+(this.css.searchMoreResultsItem+'"\x3e'),g===ia||90<g||-90>g||180<ia||-180>ia||(K+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+v.widgets.Search.main.reverseLonLatHeader+"\x3c/div\x3e",K+='\x3ca data-switch-coordinates\x3d"'+U+'" tabindex\x3d"0" href\x3d"#"\x3e'+U+"\x3c/a\x3e\x3c/div\x3e")):
K=g.name}else K=g.name;return K},_moreResultsHTML:function(g){var K="",U="",Y=this.searchResults,ia=this.sources,va=0;if(Y){U+='\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e';U+='\x3ca href\x3d"#" id\x3d"'+this._moreResultsId+'_show"\x3e'+v.widgets.Search.main.showMoreResults+"\x3c/a\x3e";U=U+'\x3c/div\x3e\x3cdiv class\x3d"'+(this.css.searchMoreResultsList+'"\x3e');U+='\x3cdiv id\x3d"'+this._moreResultsId+'_list"\x3e';for(var m in Y)if(Y[m]){var E=Y[m].length;if(E){var S=1===E&&Y[m][0]===
g;if(1<this._getObjectSize(Y)&&!S){var ha=this._getSourceName(m);U+='\x3cdiv class\x3d"'+this.css.searchMoreResultsListHeader+'"\x3e'+ha+"\x3c/div\x3e"}if(E&&!S){U+="\x3cul\x3e";ha=ia[m].maxResults||this.maxResults;for(S=0;S<E&&S<ha;++S)if(Y[m][S]!==g){var ka=this._getResultName(Y[m][S]);U+='\x3cli\x3e\x3ca tabindex\x3d"0" data-index\x3d"'+S+'" data-source-index\x3d"'+m+'" href\x3d"#"\x3e'+ka+"\x3c/a\x3e\x3c/li\x3e";va++}U+="\x3c/ul\x3e"}}}U+="\x3c/div\x3e\x3c/div\x3e"}va&&(K+=U);return K},_validField:function(g,
K){return g.getField(K)},_validFields:function(g,K){if(g&&K&&K.length){for(var U=0;U<K.length;U++)if(!this._validField(g,K[U]))return!1;return!0}return!1},_getCodedName:function(g,K){if(g&&g.length)for(var U=0,Y=g.length;U<Y;U++){var ia=g[U];if(ia.code===K)return ia.name}},_getCodedValue:function(g,K,U){if(g&&g.length)for(var Y=0,ia=g.length;Y<ia;Y++){var va=g[Y],m=va.name,E=K;U||(m=m.toLowerCase(),E=E.toLowerCase());if(m===E)return va.code}return!1},_whereClause:function(g,K,U,Y,ia){var va=null;
if(g){var m="",E=this.reHostedFS.test(K.url);E&&this._containsNonLatinCharacter(g)&&(m="N");if(U&&U.length)for(var S=0,ha=U.length;S<ha;S++){var ka="";ka=g.replace(/'/g,"''");var xa=U[S],Aa=K.getField(xa),Ea=K.getDomain(xa);Ea&&"codedValue"===Ea.type&&(ka=this._getCodedValue(Ea.codedValues,ka,Y));!1!==ka&&(Aa=Aa.type,"esriFieldTypeString"===Aa||"esriFieldTypeDate"===Aa?Y&&"search"===ia?ka=xa+" \x3d "+m+"'"+ka+"'":(xa=E?xa:"LOWER("+xa+")",ka=(E?ka:ka.toLowerCase())+"%",ka=xa+" LIKE "+m+"'"+ka+"'"):
"esriFieldTypeOID"===Aa||"esriFieldTypeSmallInteger"===Aa||"esriFieldTypeInteger"===Aa||"esriFieldTypeSingle"===Aa||"esriFieldTypeDouble"===Aa?(ka=parseFloat(ka),ka=isNaN(ka)?!1:xa+" \x3d "+ka):ka=xa+" \x3d "+ka,ka&&(va=va?va+" or ":"",va+=ka))}}return va},_suggest:function(g){g||(g={index:this.activeSourceIndex,text:this.value});var K=new P,U=g.index,Y=this.sources[U],ia=this.enableSuggestions;Y.hasOwnProperty("enableSuggestions")&&(ia=Y.enableSuggestions);var va=0;if(g.hasOwnProperty("text")&&g.text){var m=
t.trim(g.text);va=g.text.length}g=Y.minCharacters||this.minCharacters;if(ia&&m&&va>=g&&this._supportsPagination(Y)){var E="";Y.prefix&&(E+=Y.prefix);E+=m;Y.suffix&&(E+=Y.suffix);var S=this._defaultSR;this.map&&(S=this.map.spatialReference);ia={};Y.locator?(Y.categories&&(ia.categories=Y.categories),Y.locator.outSpatialReference=S,this.map&&Y.localSearchOptions&&Y.localSearchOptions.hasOwnProperty("distance")&&Y.localSearchOptions.hasOwnProperty("minScale")&&(va=this._getScale(),!Y.localSearchOptions.minScale||
va&&va<=parseFloat(Y.localSearchOptions.minScale))&&(ia.location=this.map.extent.getCenter(),ia.distance=Y.localSearchOptions.distance),ia.text=E,Y.useMapExtent&&this.map&&this.map.extent&&(ia.searchExtent=this.map.extent),Y.searchExtent&&(ia.searchExtent=Y.searchExtent),ia.maxSuggestions=Y.maxSuggestions||this.maxSuggestions,Y.sourceCountry&&(ia.countryCode=Y.sourceCountry),Y.countryCode&&(ia.countryCode=Y.countryCode),Y.locator.suggestLocations(ia).then(t.hitch(this,function(ha){K.resolve(ha)}),
t.hitch(this,function(ha){ha||(ha=this._error("Locator suggestLocations could not be performed."));K.reject(ha)}))):Y.featureLayer?this._featureLayerLoaded(Y.featureLayer).then(t.hitch(this,function(){var ha=this._getDisplayField(Y),ka=Y.searchFields||[ha],xa=[];Y.suggestionTemplate?Y.suggestionTemplate.replace(/(?:\$\{([^}]+)\})/g,function(Ka,Oa){xa.push(Oa)}):xa=[ha];-1===O.indexOf(xa,Y.featureLayer.objectIdField)&&xa.push(Y.featureLayer.objectIdField);ha=this._validField(Y.featureLayer,ha);var Aa=
this._validFields(Y.featureLayer,xa),Ea=this._validFields(Y.featureLayer,ka);if(ha&&Aa&&Ea){ha=new b;Y.hasOwnProperty("suggestQueryParams")&&t.mixin(ha,Y.suggestQueryParams);ha.outSpatialReference=S;ha.returnGeometry=!1;ha.num=Y.maxSuggestions||this.maxSuggestions;ha.outFields=xa;Y.useMapExtent&&this.map&&this.map.extent&&(ha.geometry=this.map.extent);Y.searchExtent&&(ha.geometry=Y.searchExtent);ba(Y.featureLayer)&&X(Y.featureLayer,ka)&&!Y.exactMatch&&E?ha.fullText=r(E,ka):ha.where=this._whereClause(E,
Y.featureLayer,ka,Y.exactMatch,"suggest");if(ha.fullText||ha.where)var Ca=!0;Ca?Y.featureLayer.queryFeatures(ha,t.hitch(this,function(Ka){var Oa;(Ka=Ka.features)&&(Oa=this._hydrateResults(Ka,U,!0));K.resolve(Oa)}),t.hitch(this,function(Ka){Ka||(Ka=this._error("FeatureLayer queryFeatures errored with suggestions"));K.reject(Ka)})):K.resolve()}else K.reject(this._error("Invalid FeatureLayer field"))})):K.reject(this._error("Invalid source"))}else K.resolve();return K.promise},_supportsPagination:function(g){var K;
g.locator?K=!0:g.featureLayer&&g.featureLayer.advancedQueryCapabilities&&g.featureLayer.advancedQueryCapabilities.supportsPagination&&(K=!0);return K},_suggestQueries:function(g){var K=this.sources,U=this.activeSourceIndex,Y=[];if(U===this._allIndex)for(U=0;U<K.length;U++){var ia=g;ia.index=U;ia=this._suggest(ia);Y.push(ia)}else g.index=U,ia=this._suggest(g),Y.push(ia);return pa(Y)},_getPointFromGeometry:function(g){switch(g.type){case "extent":var K=g.getCenter();break;case "multipoint":K=g.getPoint(0);
break;case "point":K=g;break;case "polygon":K=g.getCentroid();break;case "polyline":K=g.getPoint(0,0)}return K},_searchQueries:function(g){g.hasOwnProperty("index")||(g.index=this.activeSourceIndex);var K=[];if(g.index===this._allIndex)for(var U=this.sources,Y=0;Y<U.length;Y++){var ia=g;ia.index=Y;ia=this._search(ia);K.push(ia)}else g=this._search(g),K.push(g);return pa(K)},_searchButton:function(){this.enableButtonMode&&!this.expanded?(this.expand(),C.focus(this.inputNode)):(this._cancelSuggest(),
this.search())},_search:function(g){g||(g={text:this.value,magicKey:null,geometry:null,point:null,index:this.activeSourceIndex,latlon:null});this.selectedFeatureId&&(g.text=null,g[this._objectIdIdentifier]=this.selectedFeatureId);var K,U=new P,Y=g.index,ia=this.sources[Y],va;g.hasOwnProperty("text")&&g.text&&(va=t.trim(g.text));if(ia){var m="";ia.prefix&&!g.magicKey&&(m+=ia.prefix);m+=va;ia.suffix&&!g.magicKey&&(m+=ia.suffix);var E=this._defaultSR;this.map&&(E=this.map.spatialReference);if(ia.locator)if(g.hasOwnProperty("text")&&
va){var S={};ia.categories&&(S.categories=ia.categories);ia.locationType&&(S.locationType=ia.locationType);E&&(ia.locator.outSpatialReference=E);if(this.map&&ia.localSearchOptions&&ia.localSearchOptions.hasOwnProperty("distance")&&ia.localSearchOptions.hasOwnProperty("minScale")){var ha=this._getScale();if(!ia.localSearchOptions.minScale||ha&&ha<=parseFloat(ia.localSearchOptions.minScale))S.location=this.map.extent.getCenter(),S.distance=ia.localSearchOptions.distance}S.address={};S.maxLocations=
ia.maxResults||this.maxResults;ia.useMapExtent&&this.map&&this.map.extent&&(S.searchExtent=this.map.extent);ia.searchExtent&&(S.searchExtent=ia.searchExtent);ia.sourceCountry&&(S.countryCode=ia.sourceCountry);ia.countryCode&&(S.countryCode=ia.countryCode);g.magicKey&&(S.magicKey=g.magicKey);ia.singleLineFieldName?S.address[ia.singleLineFieldName]=m:S.address["Single Line Input"]=m;ia.outFields&&(S.outFields=ia.outFields);ia.locator.addressToLocations(S).then(t.hitch(this,function(ka){ka=this._hydrateResults(ka,
Y,!1);U.resolve(ka)}),t.hitch(this,function(ka){ka||(ka=this._error("Locator addressToLocations could not be performed"));U.reject(ka)}))}else g.geometry?(K=this._getPointFromGeometry(g.geometry.geometry))?this._reverseGeocodePoint(Y,K).then(function(ka){U.resolve(ka)},function(ka){U.reject(ka)}):U.reject(this._error("Invalid point to reverse geocode")):g.point?this._reverseGeocodePoint(Y,g.point).then(function(ka){U.resolve(ka)},function(ka){U.reject(ka)}):g.latlon?(S=new ea(g.latlon,this._defaultSR),
this._reverseGeocodePoint(Y,S).then(function(ka){U.resolve(ka)},function(ka){U.reject(ka)})):g.hasOwnProperty("text")&&!va?U.resolve([]):U.reject(this._error("Invalid query type for Locator"));else ia.featureLayer?this._featureLayerLoaded(ia.featureLayer).then(t.hitch(this,function(){var ka=this._getDisplayField(ia),xa=ia.searchFields||[ka];ka=this._validField(ia.featureLayer,ka);var Aa=this._validFields(ia.featureLayer,xa);if(ka&&Aa){ka=new b;ia.hasOwnProperty("searchQueryParams")&&t.mixin(ka,ia.searchQueryParams);
E&&(ka.outSpatialReference=E,Aa=this.map&&this.map.getMaxResolution()||1/wa.getUnitValueForSR(E))&&(ka.maxAllowableOffset=Aa);ka.returnGeometry=!0;ia.outFields&&(ka.outFields=ia.outFields);if(!g.hasOwnProperty(this._objectIdIdentifier)){this._supportsPagination(ia)&&(ka.num=ia.maxResults||this.maxResults);ia.useMapExtent&&this.map&&this.map.extent&&(ka.geometry=this.map.extent);ia.searchExtent&&(ka.geometry=ia.searchExtent);var Ea=ia.exactMatch}g.hasOwnProperty("text")&&va?(ba(ia.featureLayer)&&X(ia.featureLayer,
xa)&&!Ea&&m?ka.fullText=r(m,xa):ka.where=this._whereClause(m,ia.featureLayer,xa,Ea,"search"),xa=ka.fullText||ka.where?!0:!1):g.hasOwnProperty(this._objectIdIdentifier)?(ka.objectIds=[g[this._objectIdIdentifier]],xa=!0):g.geometry?(ka.geometry=g.geometry,xa=!0):g.point?(ka.geometry=g.point,xa=!0):g.latlon?(K=new ea(g.latlon,this._defaultSR),ka.geometry=K,xa=!0):(g.hasOwnProperty("text")&&!va?U.resolve([]):U.reject(this._error("Invalid query type for FeatureLayer")),xa=!1);xa?ia.featureLayer.queryFeatures(ka,
t.hitch(this,function(Ca){Ca=Ca.features;var Ka;Ca&&(Ka=this._hydrateResults(Ca,Y,!1));U.resolve(Ka)}),t.hitch(this,function(Ca){Ca||(Ca=this._error("FeatureLayer queryFeatures could not be performed"));U.reject(Ca)})):U.resolve()}else U.reject(this._error("Invalid FeatureLayer field"))})):U.reject(this._error("Invalid source"))}else U.reject(this._error("Source is undefined"));return U.promise},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_formatResults:function(g,
K,U){U={activeSourceIndex:K,value:U,numResults:0,numErrors:0,errors:null,results:null};var Y={},ia={};if(g)if(K===this._allIndex)for(K=0;K<g.length;K++)g[K]&&(g[K]instanceof Error?(Y[K]=g[K],U.numErrors++):(ia[K]=g[K],U.numResults+=g[K].length));else g[0]&&(g[0]instanceof Error?(Y[K]=g[0],U.numErrors++):(ia[K]=g[0],U.numResults+=g[0].length));U.numErrors&&(U.errors=Y);U.numResults&&(U.results=ia);return U},_reverseGeocodePoint:function(g,K){var U=new P,Y=this.sources[g];if(K&&Y){var ia=Y.locationToAddressDistance||
this.locationToAddressDistance;Y.locator.outSpatialReference=this._defaultSR;this.map&&(Y.locator.outSpatialReference=this.map.spatialReference);Y.locator.locationToAddress(K,ia,t.hitch(this,function(va){va=this._hydrateResults([va],g,!1);U.resolve(va)}),t.hitch(this,function(va){va||(va=this._error("Locator locationToAddress could not be performed"));U.reject(va)}))}else U.reject(this._error("No point or source defined for reverse geocoding"));return U.promise},_cancelDeferreds:function(){if(this._deferreds&&
this._deferreds.length)for(var g=0;g<this._deferreds.length;g++)this._deferreds[g].cancel(this.declaredClass+" cancelling request");this._deferreds=[]},_sourceBtnKey:function(g){if(g){var K=d("li",this.sourcesNode);g.keyCode===F.UP_ARROW?(g.stopPropagation(),g.preventDefault(),this._showSourcesMenu(),(g=K.length)&&C.focus(K[g-1])):g.keyCode===F.DOWN_ARROW&&(g.stopPropagation(),g.preventDefault(),this._showSourcesMenu(),K[0]&&C.focus(K[0]))}},_inputKey:function(g){if(g){var K=d("li",this.suggestionsNode),
U=this.suggestResults;if(g.keyCode===F.TAB||g.keyCode===F.ESCAPE)this._cancelSuggest(),this._hideMenus();else if(g.keyCode===F.UP_ARROW)g.stopPropagation(),g.preventDefault(),this._cancelSuggest(),U&&this._showSuggestionsMenu(),(g=K.length)&&C.focus(K[g-1]);else if(g.keyCode===F.DOWN_ARROW)g.stopPropagation(),g.preventDefault(),this._cancelSuggest(),U&&this._showSuggestionsMenu(),K[0]&&C.focus(K[0]);else{if(g.ctrlKey||g.metaKey||g.keyCode===F.copyKey||g.keyCode===F.LEFT_ARROW||g.keyCode===F.RIGHT_ARROW||
g.keyCode===F.ENTER)return g;this._suggestDelay()}}},_cancelSuggest:function(){this._cancelDeferreds();this._clearQueryTimeout()},_suggestDelay:function(){this._cancelSuggest();this._changeValue();this._queryTimer=setTimeout(t.hitch(this,function(){this.suggest()}),this.suggestionDelay)},_changeValue:function(){this.set("magicKey",null);this.set("selectedFeatureId",null);this._changeAttrValue("value",this.inputNode.value);this._checkStatus()},_inputClick:function(){this._hideSourcesMenu();this._hideNoResultsMenu()},
_getSourceName:function(g){return this._sourceNames[g]},_loadSources:function(g){g=O.filter(g,function(K){return!!K.featureLayer});g=O.map(g,function(K){return this._featureLayerLoaded(K.featureLayer)},this);return pa(g)},_createSourceNameMap:function(g){return this._loadSources(g).then(t.hitch(this,function(){var K=O.map(g,function(U){return U.name||U.featureLayer&&U.featureLayer.name||v.widgets.Search.main.untitledSource});this._preventDuplicateSourceNames(g,K);return K}))},_getDuplicateSourceNameIndexes:function(g){var K=
{},U=[];O.forEach(g,function(Y,ia){K.hasOwnProperty(Y)?(-1===U.indexOf(K[Y])&&U.push(K[Y]),U.push(ia)):g.lastIndexOf(Y)!==ia&&(K[Y]=ia)});return U},_preventDuplicateSourceNames:function(g,K){if(K&&1<K.length){var U=this._getDuplicateSourceNameIndexes(K);O.forEach(U,function(Y){K[Y]+=this._getFieldsString(g[Y])},this)}},_getFieldsString:function(g){var K="",U=g.featureLayer;if(U){g=g.searchFields||[this._getDisplayField(g)];for(var Y=0;Y<g.length;Y++){K=0===Y?K+": ":K+", ";var ia=g[Y],va=U.getFieldLabel(ia);
K+=va||ia}}return K},_splitResult:function(g,K){K=l.escapeString(K);return g.replace(new RegExp("(^|)("+K+")(|$)","ig"),"$1|$2|$3").split("|")},_insertSuggestions:function(g,K){if(this.enableSuggestionsMenu&&this.suggestionsNode){this._hideSourcesMenu();this._hideNoResultsMenu();var U=this.sources;if(g){var Y=I.create("div");for(var ia in g)if(g[ia]&&g[ia].length){var va=this._getSourceName(ia);1<U.length&&this.activeSourceIndex===this._allIndex&&I.create("div",{className:this.css.searchMenuHeader,
textContent:va},Y);va=I.create("ul",{role:"menu"},Y);for(var m=U[ia].maxSuggestions||this.maxSuggestions,E=0;E<g[ia].length&&E<m;++E){var S=I.create("li",{"data-index":E,"data-source-index":ia,role:"menuitem",tabindex:0},va),ha=this._getSuggestionName(g[ia][E]);ha=this._splitResult(ha,K);for(var ka=ha.length,xa=0;xa<ka;xa++){var Aa=ha[xa];Aa.toLowerCase()===K.toLowerCase()?I.create("strong",{textContent:Aa},S):(Aa=document.createTextNode(Aa),I.place(Aa,S))}}}}Y?(I.place(Y,this.suggestionsNode,"only"),
this._showSuggestionsMenu()):(I.empty(this.suggestionsNode),this._hideSuggestionsMenu())}},_insertSources:function(g){if(this.enableSourcesMenu&&g&&1<g.length){var K,U=this.activeSourceIndex,Y=I.create("ul",{role:"menu"});if(this.enableSearchingAll){var ia="";U===this._allIndex&&(ia="active");I.create("li",{"data-index":this._allIndex,role:"menuitem",className:ia,tabIndex:0,textContent:v.widgets.Search.main.all},Y)}for(K=0;K<g.length;K++){ia="";K===U&&(ia=this.css.activeSource);var va=this._getSourceName(K);
I.create("li",{"data-index":K,role:"menuitem",className:ia,tabIndex:0,textContent:va},Y)}k.add(this.containerNode,this.css.hasMultipleSources);I.place(Y,this.sourcesNode,"only")}else k.remove(this.containerNode,this.css.hasMultipleSources),I.empty(this.sourcesNode)},_showLoading:function(){k.add(this.containerNode,this.css.searchLoading)},_hideLoading:function(){k.remove(this.containerNode,this.css.searchLoading)},_checkStatus:function(){this.value?(k.add(this.containerNode,this.css.hasValue),q.set(this.clearNode,
"title",v.widgets.Search.main.clearButtonTitle)):this.clear()},_closePopup:function(){this.enableInfoWindow&&this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_noResults:function(g){var K;g&&(K=t.trim(g));var U=I.create("div",{className:this.css.searchNoResultsBody});g&&K?(I.create("div",{className:this.css.searchNoResultsHeader,textContent:v.widgets.Search.main.noResults},U),I.create("div",{className:this.css.searchNoResultsText,textContent:a.substitute({value:'"'+g+'"'},v.widgets.Search.main.noResultsFound)},
U)):(g=I.create("div",{},U),I.create("span",{"aria-hidden":"true",className:this.css.searchNoValueIcon},g),I.create("span",{className:this.css.searchNoValueText,textContent:v.widgets.Search.main.emptyValue},g));I.place(U,this.noResultsMenuNode,"only")},_hideMenus:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();this._hideNoResultsMenu()},_hideNoResultsMenu:function(){k.remove(this.containerNode,this.css.showNoResults)},_showNoResultsMenu:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();
k.add(this.containerNode,this.css.showNoResults)},_hideSourcesMenu:function(){k.remove(this.containerNode,this.css.showSources)},_hideSuggestionsMenu:function(){k.remove(this.containerNode,this.css.showSuggestions)},_showSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();k.add(this.containerNode,this.css.showSources)},_showSuggestionsMenu:function(){this._hideSourcesMenu();this._hideNoResultsMenu();k.add(this.containerNode,this.css.showSuggestions)},_toggleSourcesMenu:function(){this._hideSuggestionsMenu();
this._hideNoResultsMenu();k.toggle(this.containerNode,this.css.showSources)},_getFirstStringField:function(g){if(g&&(g=g.fields)&&g.length)for(var K=0;K<g.length;K++){var U=g[K];if("esriFieldTypeString"===U.type)return U.name}return""},_getDisplayField:function(g){return g.displayField||g.featureLayer.displayField||this._getFirstStringField(g.featureLayer)},_validLocation:function(g){return g&&"number"===typeof g.x&&"number"===typeof g.y},_validExtent:function(g){return g&&"number"===typeof g.xmin&&
"number"===typeof g.ymin&&"number"===typeof g.xmax&&"number"===typeof g.ymax},_hydrateResult:function(g,K,U){var Y={},ia=this._defaultSR;K=this.sources[K];this.map&&(ia=this.map.spatialReference);if(g.hasOwnProperty("text")&&g.hasOwnProperty("magicKey"))return g;if(g.hasOwnProperty("geometry")){var va=new ma(g.toJson());Y.feature=va;(va=Y.feature.geometry)&&va.setSpatialReference(ia)}else if(g.hasOwnProperty("location")&&this._validLocation(g.location)){var m=new ea(g.location.x,g.location.y,ia);
va={};g.hasOwnProperty("attributes")&&(va=g.attributes);g.hasOwnProperty("address")&&"object"===typeof g.address&&t.mixin(va,g.address);g.hasOwnProperty("score")&&(va.score=g.score);Y.feature=new ma(m,null,va,null)}!Y.feature&&U&&(va={},g.hasOwnProperty("attributes")&&(va=g.attributes),g.hasOwnProperty("score")&&(va.score=g.score),Y.feature=new ma(null,null,va,null));if(Y.feature){if(g.hasOwnProperty("extent")&&this._validExtent(g.extent))Y.extent=new ta(g.extent),Y.extent.setSpatialReference(ia);
else if(Y.feature&&Y.feature.geometry)switch(Y.feature.geometry.type){case "extent":Y.extent=Y.feature.geometry;break;case "multipoint":Y.extent=qa.getDenormalizedExtent(Y.feature.geometry);break;case "polygon":Y.extent=qa.getDenormalizedExtent(Y.feature.geometry);break;case "polyline":Y.extent=qa.getDenormalizedExtent(Y.feature.geometry);break;case "point":this.map?(ia=this.zoomScale,K&&K.zoomScale&&(ia=K.zoomScale),this._getScale()>ia?Y.extent=wa.getExtentForScale(this.map,ia).centerAt(Y.feature.geometry):
Y.extent=this.map.extent.centerAt(Y.feature.geometry)):Y.extent=new ta({xmin:Y.feature.geometry.x-.25,ymin:Y.feature.geometry.y-.25,xmax:Y.feature.geometry.x+.25,ymax:Y.feature.geometry.y+.25,spatialReference:this._defaultSR})}else Y.extent=null;Y.name="";K.featureLayer?K.suggestionTemplate&&U?Y.name=a.substitute(g.attributes,K.suggestionTemplate):K.searchTemplate?Y.name=a.substitute(g.attributes,K.searchTemplate):(va=this._getDisplayField(K),U=K.featureLayer.getField(va),ia=K.featureLayer.getDomain(va),
va&&g.hasOwnProperty("attributes")&&g.attributes.hasOwnProperty(va)&&(g=g.attributes[va],ia&&"codedValue"===ia.type?Y.name=this._getCodedName(ia.codedValues,g):U&&"esriFieldTypeDate"===U.type&&!isNaN(g)?Y.name=H.format(new Date(g)):Y.name=g)):g.address&&K.searchTemplate?Y.name=a.substitute(g.address,K.searchTemplate):g.hasOwnProperty("name")?Y.name=g.name:g.hasOwnProperty("attributes")&&"object"===typeof g.attributes&&g.attributes.LongLabel?Y.name=g.attributes.LongLabel:g.hasOwnProperty("attributes")&&
"object"===typeof g.attributes&&g.attributes.Match_addr?(Y.name=g.attributes.Match_addr,g.attributes.Addr_type&&"POI"===g.attributes.Addr_type&&g.attributes.StAddr&&g.attributes.City?Y.name+=" - "+g.attributes.StAddr+", "+g.attributes.City:g.attributes.Addr_type&&"POI"===g.attributes.Addr_type&&g.attributes.City&&(Y.name+=" - "+g.attributes.City)):g.hasOwnProperty("address")&&"string"===typeof g.address?Y.name=g.address:g.hasOwnProperty("address")&&"object"===typeof g.address&&g.address.hasOwnProperty("Address")?
g.address.hasOwnProperty("Match_addr")?Y.name=g.address.Match_addr:g.address.hasOwnProperty("Address")&&(Y.name=g.address.Address):Y.feature&&Y.feature.geometry&&(Y.name=Y.feature.geometry.x+","+Y.feature.geometry.y);K.featureLayer&&Y.feature&&ra(Y.feature,K.featureLayer);return Y}},_getScale:function(){var g;this.map&&"function"===typeof this.map.getScale&&(g=this.map.getScale());return g},_hydrateResults:function(g,K,U){var Y=[],ia=0;if(g&&g.length)for(ia;ia<g.length;ia++){var va=this._hydrateResult(g[ia],
K,U);va&&Y.push(va)}return Y},_containsNonLatinCharacter:function(g){for(var K=0;K<g.length;K++)if(255<g.charCodeAt(K))return!0;return!1},_setPlaceholder:function(g){var K="",U=this.sources[g];g===this._allIndex?K=this.allPlaceholder||v.widgets.Search.main.allPlaceholder:U&&U.placeholder&&(K=U.placeholder);var Y=v.widgets.Search.main.all;U&&(Y=this._getSourceName(g));q.set(this.sourceNameNode,"textContent",Y);q.set(this.inputNode,"placeholder",K);q.set(this.inputNode,"title",K)},_updateActiveSource:function(){var g=
this.sources,K=this.activeSourceIndex,U;g&&g[K]&&(U=g[K]);U?this.set("activeSource",U):this.set("activeSource",null)},_updateVisible:function(){this.visible?this.show():this.hide()},_updateButtonMode:function(g){g?(k.toggle(this.containerNode,this.css.searchExpanded,this.expanded),k.toggle(this.containerNode,this.css.searchCollapsed,!this.expanded),k.add(this.containerNode,this.css.hasButtonMode)):(k.remove(this.containerNode,this.css.searchExpanded),k.remove(this.containerNode,this.css.searchCollapsed),
k.remove(this.containerNode,this.css.hasButtonMode))},_setDefaultActiveSourceIndex:function(g){g&&1===g.length||!this.enableSearchingAll?this.set("activeSourceIndex",0):this.set("activeSourceIndex",this._allIndex)},_setEnableSourcesMenuAttr:function(g){this._set("enableSourcesMenu",g);this._created&&this._insertSources(this.sources)},_setEnableSearchingAllAttr:function(g){this._set("enableSearchingAll",g);this._created&&(this._setDefaultActiveSourceIndex(this.sources),this._hideMenus(),this._insertSources(this.sources))},
_setSourcesAttr:function(g){this._createSourceNameMap(g).then(t.hitch(this,function(K){this._sourceNames=K;this._created&&(this._setDefaultActiveSourceIndex(g),this._hideMenus(),this._insertSources(g))}));this._set("sources",g)},_setAllPlaceholderAttr:function(g){this._set("allPlaceholder",g);this._created&&this._setPlaceholder(this.activeSourceIndex)},_setActiveSourceIndexAttr:function(g){this._set("activeSourceIndex",g);this._updateActiveSource();this._created&&(this._setPlaceholder(g),this._hideMenus(),
this._insertSources(this.sources))},_setMaxLengthAttr:function(g){this._set("maxLength",g);this._created&&q.set(this.inputNode,"maxLength",g)},_setValueAttr:function(g){this.set("magicKey",null);this.set("selectedFeatureId",null);this._set("value",g);this._created&&(q.set(this.inputNode,"value",g),this._checkStatus())},_setVisibleAttr:function(g){this._set("visible",g);this._created&&this._updateVisible()},_setEnableButtonModeAttr:function(g){this._set("enableButtonMode",g);this._created&&this._updateButtonMode(g)},
_setThemeAttr:function(g){this._created&&(k.remove(this.domNode,this.theme),k.add(this.domNode,g));this._set("theme",g)}});e("extend-esri")&&t.setObject("dijit.Search",W,da);return W})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(V,W,t,O,Z,P,F,x,d,e,l){V=V(e,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],
"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(n){this._geocodeHandler=W.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=W.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=W.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(n){this.outSpatialReference=n},_geocodeHandler:function(n,
q,k,w,I){try{var H=n.candidates;q=[];var v,G=H.length,Q=n.spatialReference,T;for(v=0;v<G;v++){var M=H[v];if(T=M.location)T.spatialReference=Q;q[v]=new l(M)}this._successHandler([q],"onAddressToLocationsComplete",k,I)}catch(R){this._errorHandler(R,w,I)}},_geocodeAddressesHandler:function(n,q,k,w,I){try{var H=n.locations;q=[];var v,G=H.length,Q=n.spatialReference,T;for(v=0;v<G;v++){if(T=H[v].location)T.spatialReference=Q;q[v]=new l(H[v])}this._successHandler([q],"onAddressesToLocationsComplete",k,I)}catch(M){this._errorHandler(M,
w,I)}},addressToLocations:function(n,q,k,w,I){var H;if(n.address){w=k;k=q;q=n.outFields;I=n.searchExtent;var v=n.countryCode;var G=n.magicKey;var Q=n.distance;var T=n.categories;n.location&&this.normalization&&(H=n.location.normalize());var M=n.locationType;var R=n.maxLocations;var C=n.forStorage;n=n.address}I&&(I=I.shiftCentralMeridian());var a=this.outSpatialReference;n=this._encode(W.mixin({},this._url.query,n,{f:"json",outSR:a&&Z.toJson(a.toJson()),outFields:q&&q.join(",")||null,searchExtent:I&&
Z.toJson(I.toJson()),category:T&&T.join(",")||null,countryCode:v||null,magicKey:G||null,distance:Q||null,location:H||null,locationType:M||null,maxLocations:R||null,forStorage:C||null}));var B=this._geocodeHandler,da=this._errorHandler,la=new O(d._dfdCanceller);la._pendingDfd=x({url:this._url.path+"/findAddressCandidates",content:n,callbackParamName:"callback",load:function(ma,pa){B(ma,pa,k,w,la)},error:function(ma){da(ma,w,la)}});return la},suggestLocations:function(n){var q=new O(d._dfdCanceller);
n.hasOwnProperty("location")&&this.normalization&&(n.location=n.location.normalize());n.searchExtent&&(n.searchExtent=n.searchExtent.shiftCentralMeridian());n=this._encode(W.mixin({},this._url.query,{f:"json",text:n.text,maxSuggestions:n.maxSuggestions,searchExtent:n.searchExtent&&Z.toJson(n.searchExtent.toJson()),category:n.categories&&n.categories.join(",")||null,countryCode:n.countryCode||null,location:n.location||null,distance:n.distance||null},{f:"json"}));n=x({url:this._url.path+"/suggest",
content:n,callbackParamName:"callback"});q._pendingDfd=n;n.then(W.hitch(this,function(k){k=k.suggestions||[];this.onSuggestLocationsComplete(k);q.resolve(k)}),W.hitch(this,function(k){this._errorHandler(k);q.reject(k)}));return q},addressesToLocations:function(n,q,k){var w=this.outSpatialReference,I=[],H=n.categories,v=n.locationType,G=n.countryCode;t.forEach(n.addresses,function(R,C){I.push({attributes:R})});n=this._encode(W.mixin({},this._url.query,{category:H&&H.join(",")||null,locationType:v||
null,sourceCountry:G||null},{addresses:Z.toJson({records:I})},{f:"json",outSR:w&&Z.toJson(w.toJson())}));var Q=this._geocodeAddressesHandler,T=this._errorHandler,M=new O(d._dfdCanceller);M._pendingDfd=x({url:this._url.path+"/geocodeAddresses",content:n,callbackParamName:"callback",load:function(R,C){Q(R,C,q,k,M)},error:function(R){T(R,k,M)}});return M},_reverseGeocodeHandler:function(n,q,k,w,I){try{var H=new l({address:n.address,location:n.location,score:100});this._successHandler([H],"onLocationToAddressComplete",
k,I)}catch(v){this._errorHandler(v,w,I)}},locationToAddress:function(n,q,k,w){n&&this.normalization&&(n=n.normalize());var I=this.outSpatialReference;n=this._encode(W.mixin({},this._url.query,{outSR:I&&Z.toJson(I.toJson()),location:n&&Z.toJson(n.toJson()),distance:q,f:"json"}));var H=this._reverseGeocodeHandler,v=this._errorHandler,G=new O(d._dfdCanceller);G._pendingDfd=x({url:this._url.path+"/reverseGeocode",content:n,callbackParamName:"callback",load:function(Q,T){H(Q,T,k,w,G)},error:function(Q){v(Q,
w,G)}});return G},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});P("extend-esri")&&W.setObject("tasks.Locator",V,F);return V})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(V,W,t,O,Z){V=V(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(P){W.mixin(this,P);this.location=
new Z(this.location)}});t("extend-esri")&&W.setObject("tasks.AddressCandidate",V,O);return V})},"esri/styles/basic":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/has","../kernel","../Color"],function(V,W,t,O,Z){function P(l,n){if(l){var q={};q.color=new Z(l.color);q.opacity=l.opacity||1;switch(n){case "point":q.outline={color:new Z(l.outline.color),width:l.outline.width};q.size=l.size;break;case "line":q.width=l.width;break;case "polygon":q.outline={color:new Z(l.outline.color),width:l.outline.width}}}return q}
function F(l){if("esriGeometryPoint"===l||"esriGeometryMultipoint"===l)l="point";else if("esriGeometryPolyline"===l)l="line";else if("esriGeometryPolygon"===l||"esriGeometryMultiPatch"===l)l="polygon";return l}var x={"default":{name:"default",label:"Default",description:"Default theme for basic visualization of features.",basemapGroups:{light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),
dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},pointSchemes:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,.25],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:1},size:8},{color:[255,255,255,1],outline:{color:[51,51,51,.25],width:1},size:8}]},dark:{primary:{color:[255,255,255,1],outline:{color:[92,92,92,.25],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:1},size:8},
{color:[26,26,26,1],outline:{color:[178,178,178,.25],width:1},size:8}]}},lineSchemes:{light:{primary:{color:[77,77,77,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[255,255,255,1],width:2}]},dark:{primary:{color:[255,255,255,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[26,26,26,1],width:2}]}},polygonSchemes:{light:{primary:{color:[227,139,79,1],outline:{color:[255,255,255,.25],width:1},opacity:.8},secondary:[{color:[128,128,128,1],outline:{color:[255,255,255,.25],width:1},
opacity:.8},{color:[255,255,255,1],outline:{color:[128,128,128,.25],width:1},opacity:.8}]},dark:{primary:{color:[227,139,79,1],outline:{color:[92,92,92,.25],width:1},opacity:.8},secondary:[{color:[178,178,178,1],outline:{color:[92,92,92,.25],width:1},opacity:.8},{color:[26,26,26,1],outline:{color:[128,128,128,.25],width:1},opacity:.8}]}}}},d={};(function(){var l,n,q;for(l in x){var k=x[l];var w=k.basemapGroups;var I=d[l]={basemaps:[].concat(w.light).concat(w.dark),point:{},line:{},polygon:{}};for(n in w){var H=
w[n];for(q=0;q<H.length;q++){var v=H[q];k.pointSchemes&&(I.point[v]=k.pointSchemes[n]);k.lineSchemes&&(I.line[v]=k.lineSchemes[n]);k.polygonSchemes&&(I.polygon[v]=k.polygonSchemes[n])}}}})();var e={getAvailableThemes:function(l){var n=[],q;for(q in x){var k=x[q];var w=d[q];l&&-1===V.indexOf(w.basemaps,l)||n.push({name:k.name,label:k.label,description:k.description,basemaps:w.basemaps.slice(0)})}return n},getSchemes:function(l){var n=l.theme,q=l.basemap,k=F(l.geometryType);l=d[n];var w;(l=(l=l&&l[k])&&
l[q])&&(w={primaryScheme:P(l.primary,k),secondarySchemes:V.map(l.secondary,function(I){return P(I,k)})});return w},cloneScheme:function(l){if(l){var n=W.mixin({},l);n.color&&(n.color=new Z(n.color));n.outline&&(n.outline={color:n.outline.color&&new Z(n.outline.color),width:n.outline.width})}return n}};t("extend-esri")&&W.setObject("styles.basic",e,O);return e})},"widgets/NearMe/searchSourceUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/when dojo/promise/all jimu/portalUtils esri/lang esri/request".split(" "),
function(V,W,t,O,Z,P,F,x){return{map:null,layerInfosObj:null,appConfig:null,_esriLocatorRegExp:/geocode(.){0,3}\.arcgis.com\/arcgis\/rest\/services\/World\/GeocodeServer/g,setMap:function(d){this.map=d},setLayerInfosObj:function(d){this.layerInfosObj=d},setAppConfig:function(d){this.appConfig=d},getConfigInfo:function(d){if(d&&d.sources&&0<d.sources.length){var e=null;return this.searchLayer(this.map)&&d.upgradeFromGeocoder?(e=this.map.itemInfo.itemData.applicationProperties.viewing.search,e=W.map(e.layers,
V.hitch(this,function(l,n){n.hintText=l;return this._getQueryTypeGeocoder(n)},e.hintText)),Z(e).then(V.hitch(this,function(l){d.sources=[].concat(l).concat(d.sources);return d}))):d}return O(this._getSoucesFromPortalAndWebmap()).then(V.hitch(this,function(l){return{allPlaceholder:"",showInfoWindowOnSelect:!0,sources:l}}))},_getSoucesFromPortalAndWebmap:function(){var d=[],e=null;this.searchLayer(this.map)&&(e=this.map.itemInfo.itemData.applicationProperties.viewing.search,W.forEach(e.layers,V.hitch(this,
function(l,n){n.hintText=l;d.push(this._getQueryTypeGeocoder(n))},e.hintText)));return P.getPortalSelfInfo(this.appConfig.portalUrl).then(V.hitch(this,function(l){if((l=l.helperServices&&l.helperServices.geocode)&&0<l.length)for(var n=0,q=l.length;n<q;n++){var k=l[n];k&&d.push(this._processSingleLine(k))}return Z(d).then(V.hitch(this,function(w){for(var I=[],H=0;H<w.length;H++){var v=w[H];v&&(v&&"query"===v.type?I.push(v):(v={name:v.name||this._getGeocodeName(v.url),url:v.url,singleLineFieldName:v.singleLineFieldName,
placeholder:v.placeholder||window.jimuNls.common.findAddressOrPlace||v.name||this._getGeocodeName(v.url),maxResults:6,searchInCurrentMapExtent:!1,type:"locator"},v.enableLocalSearch=this._isEsriLocator(v.url),v.localSearchMinScale=3E5,v.localSearchDistance=5E4,I.push(v)))}return I}))}))},_getQueryTypeGeocoder:function(d){var e=this.map.getLayer(d.id),l=null,n=null,q=null;q=F.isDefined(d.subLayer)?d.id+"_"+d.subLayer:d.id;l=this.layerInfosObj.traversal(function(k){return k.id===q?(n=k,!0):!1});return e&&
l&&n?(l=F.isDefined(d.subLayer)?n.url||e.url+"/"+d.subLayer:n.url||e.url,{name:n.title,layerId:q,url:l,placeholder:d.hintText||window.jimuNls.common.findAddressOrPlace,searchFields:[d.field.name],displayField:d.field.name,exactMatch:d.field.exactMatch||!1,maxResults:6,searchInCurrentMapExtent:!1,type:"query"}):null},_isEsriLocator:function(d){this._esriLocatorRegExp.lastIndex=0;return this._esriLocatorRegExp.test(d)},_processSingleLine:function(d){if(d.singleLineFieldName)return d;if(this._isEsriLocator(d.url))return d.singleLineFieldName=
"SingleLine",d;var e=new t;x({url:d.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(V.hitch(this,function(l){l.singleLineAddressField&&l.singleLineAddressField.name?(d.singleLineFieldName=l.singleLineAddressField.name,e.resolve(d)):(console.warn(d.url+"has no singleLineFieldName"),e.resolve(null))}),V.hitch(this,function(l){console.error(l);e.resolve(null)}));return e.promise},_getGeocodeName:function(d){if("string"!==typeof d)return"geocoder";d=d.split("/");return d[d.length-
2]||"geocoder"},getGeocoderName:function(d){return this._getGeocodeName(d)},hasAppSearchInfo:function(d){return d.itemInfo&&d.itemInfo.itemData&&d.itemInfo.itemData.applicationProperties&&d.itemInfo.itemData.applicationProperties.viewing&&d.itemInfo.itemData.applicationProperties.viewing.search},searchLayer:function(d){if(!this.hasAppSearchInfo(d))return!1;d=d.itemInfo.itemData.applicationProperties.viewing.search;return d.enabled&&d.layers&&0!==d.layers.length?!0:!1}}})},"widgets/NearMe/item-list":function(){define("require dojo/_base/declare dijit/_WidgetBase dojo/dom-construct dojo/query dojo/_base/array jimu/utils dojo/_base/lang dijit/layout/ContentPane dojo/dom-attr dojo/dom-style dojo/dom-class dojo/on dojo/Deferred dojo/Evented dojo/promise/all jimu/dijit/Message jimu/dijit/TabContainer dojo/text!./item-list.html esri/Color esri/dijit/Directions esri/dijit/PopupTemplate esri/graphic esri/geometry/Point esri/geometry/Polyline esri/geometry/Polygon esri/SpatialReference esri/geometry/geometryEngine esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/symbols/jsonUtils esri/symbols/SimpleFillSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleMarkerSymbol esri/tasks/query esri/tasks/RelationshipQuery esri/units dojo/_base/fx dojo/number jimu/LayerInfos/LayerInfos jimu/FilterManager esri/geometry/webMercatorUtils dijit/registry jimu/dijit/EditorXssFilter esri/renderers/jsonUtils jimu/symbolUtils esri/geometry/Multipoint dojo/keys dijit/focus dojo/string esri/geometry/scaleUtils ./libs/swiper dojo/text!./swiperLayout.html dojo/_base/event".split(" "),
function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,H,v,G,Q,T,M,R,C,a,B,da,la,ma,pa,N,oa,na,J,y,A,ea,ta,qa,wa,Ba,b,f,D,r,X,ba,ra,g,K,U,Y,ia,va){return W([t,w],{_itemListTemplate:G,_serviceArea:null,_operationalLayers:null,_selectedPoint:null,_panels:{},_currentPanel:null,map:null,config:null,folderUrl:null,loading:null,nls:null,parentDiv:null,outerContainer:null,_featureListContent:null,_featureInfoPanel:null,_directionInfoPanel:null,_tabContainer:null,_isNoFeature:null,_isSlide:!0,_loadAttachmentTimer:null,
_failedLayers:[],_routeCalculated:!1,_selectedLayer:null,_selectedItem:null,_selectedFeature:null,_selectedFeatureItem:null,_featureGraphicsLayer:null,_directionsWidget:null,_layerCount:null,_tables:[],_searchedFeatures:{},_attributeSearchList:null,_filterIcon:null,_proximityIcon:null,_gallerySwiper:[],_mediaRefreshTimers:null,_allContentPanes:[],_allLayersAreHidden:!1,postCreate:function(){this._allLayersAreHidden=!1;this._proximityIcon=this._filterIcon=null;this._gallerySwiper=[];this._allContentPanes=
[];this._tables=[];this._panels={};this._failedLayers=[];this._operationalLayers=null;this._searchedFeatures={};this._attributeSearchList=null;this._tablesLayer={};this.domNode=O.create("div",{"class":"esriCTItemListMainContainer"},this.outerContainer);this.updateListHeight();this.filterManager=Ba.getInstance();this._getUpdatedLayerFilters();this._createPanels();this._loadFeatureLayers();this._featureGraphicsLayer=new pa;this.map.addLayer(this._featureGraphicsLayer);this.editorXssFilter=D.getInstance()},
updateListHeight:function(){var m=l.get(this.searchOuterContainer,"height");m+=23;l.set(this.filterListMainDiv,"height","calc(100% - "+m+"px)");l.set(this.domNode,"height","calc(100% - "+m+"px)")},_createPanels:function(){this._panels.layerListPanel=O.create("div",{"class":"esriCTLayerList"},this.domNode);this._panels.featureListPanel=O.create("div",{"class":"esriCTFeatureList"},this.domNode);var m=O.toDom(this._itemListTemplate).childNodes[0];e.set(m,"tabindex",0);n.add(m,"esriCTPanelHeader");this._panels.featureListPanel.appendChild(m);
this._featureListContent=O.create("div",{"class":"esriCTFeatureListContent"},null);l.set(this._featureListContent,"color",this.config.fontColor);this._panels.featureListPanel.appendChild(this._featureListContent);this._attachEventOnBackButton(this._panels.featureListPanel);this._panels.infoPanel=O.create("div",{"class":"esriCTDirectionInfoPanel"},this.domNode);m=O.toDom(this._itemListTemplate).childNodes[0];e.set(m,"tabindex",0);n.add(m,"esriCTPanelHeader");this._panels.infoPanel.appendChild(m);this._attachEventOnBackButton(this._panels.infoPanel);
this._featureInfoPanel=new d({},null);this._featureInfoPanel.startup();this.config.enableDirection?(this._directionInfoPanel=new d({},null),this._directionInfoPanel.startup(),this._tabContainer=new v({tabs:[{title:this.nls.informationTabTitle,content:this._featureInfoPanel},{title:this.nls.directionTabTitle,content:this._directionInfoPanel}]},O.create("div",{"class":"esriCTTabContainer"},this._panels.infoPanel)),this._tabContainer.startup(),e.set(this._featureInfoPanel.domNode,"tabindex",0),e.set(this._featureInfoPanel.domNode,
"role","document"),n.add(this._featureInfoPanel.domNode,"esriCTInfoPanelFocus"),m={"class":"esriCTProximityParent"},void 0===this.config.enableProximitySearch||this.config.enableProximitySearch||(m.style="display: none"),m=O.create("div",m,this._panels.infoPanel),this.own(this._tabContainer.on("tabChanged",x.hitch(this,function(E){this.emit("tab-change",E);E===this.nls.directionTabTitle?this._routeCalculated?"block"===l.get(this.proximityButton.parentElement,"display")?F.initLastFocusNode(this.domNodeObj,
this.proximityButton):this.emit("setLastNodeInFeatureInfo",F.getFocusNodesInDom(this._directionsWidget.domNode).reverse()[0]):this._initializeDirectionWidget():this._getFeatureInfoLastNode();this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize()})))):(this._panels.infoPanel.appendChild(this._featureInfoPanel.domNode),n.add(this._featureInfoPanel.domNode,"esriCTFeatureInfo"),e.set(this._featureInfoPanel.domNode,"tabindex",0),e.set(this._featureInfoPanel.domNode,
"role","document"),(m=Z(".esriCTItemListMainContainer .esriCTDirectionInfoPanel .esriCTPanelHeader"))&&n.add(m[0],"esriCTBorderBottom"),m={"class":"esriCTProximityParent",style:"bottom: 0px"},void 0===this.config.enableProximitySearch||this.config.enableProximitySearch||(m.style="display: none"),m=O.create("div",m,this._panels.infoPanel));this.proximityButton=O.create("div",{"class":"esriCTProximityIconContainer",title:this.nls.proximityButtonTooltip,"aria-label":this.nls.proximityButtonTooltip,tabindex:"0",
role:"button"},m);this._proximityIcon=O.create("div",{"class":"esriCTProximityIcon",style:{"background-color":this.selectedThemeColor}},this.proximityButton);this.own(q(this.proximityButton,"click",x.hitch(this,function(){this._selectedFeature&&this._selectedFeature.geometry&&this.emit("init-proximity",new R(this._selectedFeature.geometry))})));this.own(q(this.proximityButton,"keydown",x.hitch(this,function(E){(E.keyCode===ra.ENTER||E.keyCode===ra.SPACE)&&this._selectedFeature&&this._selectedFeature.geometry&&
this.emit("init-proximity",new R(this._selectedFeature.geometry))})));this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize();this._attachEventToTab()},_attachEventOnBackButton:function(m){var E=Z(".esriCTItemlList",m)[0];var S=Z(".esriCTBackButton",m)[0];E&&S&&this.own(q(E,"click, keypress",x.hitch(this,function(ha){if("keypress"===ha.type){var ka=ha.charCode||ha.keyCode;if(ka!==ra.ENTER&&ka!==ra.SPACE)return}ha.stopPropagation();"none"!==l.get(S,
"display")&&this._isSlide&&(this._isSlide=!1,this._selectedItem=null,this._clearGrahics(),this._clearDirections(),this._clearMediaRefreshTimers(),this._isFeatureList?(this._isFeatureList=!1,this._showPanel("featureListPanel",!0),g.focus(Z(".esriCTItemlList[tabindex\x3d'0']",this._featureListContent)[0])):(this.loading.hide(),this._clearContent(this._featureListContent),this.config.selectedSearchLayerOnly&&this.showLayersOnBackToLayerList(),this._selectedLayer=null,this._isFeatureList=!1,this._showPanel("layerListPanel",
!0),g.focus(Z(".esriCTItemlList[tabindex\x3d'0']",this._panels.layerListPanel)[0])))})))},_loadFeatureLayers:function(){var m;this._operationalLayers=[];this._tables=this.map.webMapResponse.itemInfo.itemData.tables;for(m=0;m<this.config.searchLayers.length;m++)this.config.searchLayers[m].popupInfo||this.config.searchLayers.splice(m,1);for(m=0;m<this.config.searchLayers.length;m++)if(this.config.searchLayers[m].popupInfo){var E=new ma(this.config.searchLayers[m].url,{infoTemplate:new M(this.config.searchLayers[m].popupInfo)});
E.id=this.config.searchLayers[m].id?this.config.searchLayers[m].id:"FL_"+this.config.searchLayers[m].title+m;E.title=this.config.searchLayers[m].title;this.config.searchLayers[m].definitionExpression&&E.setDefinitionExpression(this.config.searchLayers[m].definitionExpression);this.config.searchLayers[m].renderer&&E.setRenderer(r.fromJson(this.config.searchLayers[m].renderer));E.index=m;E.layerIndex=this._operationalLayers.length;E.isMapServer=this.config.searchLayers[m].isMapServer;E.baseURL=this.config.searchLayers[m].baseURL;
E.showAttachments=this.config.searchLayers[m].popupInfo.showAttachments;this._operationalLayers.push(E);this._onLayerLoad(E)}},_onLayerLoad:function(m){m.loaded?m.tableInfos=this._getRelatedTableInfo(m.index):this.own(m.on("load",x.hitch(this,function(){m.tableInfos=this._getRelatedTableInfo(m.index)})))},_getRelatedTableInfo:function(m){var E,S=[];(E=this._operationalLayers[m])&&P.forEach(E.relationships,x.hitch(this,function(ha){P.forEach(this._tables,x.hitch(this,function(ka,xa){ka.url.replace(/.*?:\/\//g,
"")===(E.baseURL+ha.relatedTableId).replace(/.*?:\/\//g,"")&&ka.popupInfo&&(ka.relationshipIds||(ka.relationshipIds={}),ka.relationshipIds[E.id]=ha.id,S.push(xa),this._tablesLayer[ka.id]=new ma(ka.url),this._tablesLayer[ka.id].showAttachments=!0)}))}));return S},hasValidLayers:function(){return this._operationalLayers&&0<this._operationalLayers.length?!0:!1},_clearContent:function(m){m&&O.empty(m)},displayLayerList:function(m,E,S){var ha=[];this.loading.hide();this._layerCount=0;this._isSlide=this._isNoFeature=
!0;this._attributeSearchList=null;S?(this._attributeSearchList=S,this._tabContainer&&this._tabContainer.controlNode&&(l.set(this._tabContainer.controlNode,"display","none"),n.add(this._tabContainer.containerNode,"esriCTTopBorder"))):this._tabContainer&&this._tabContainer.controlNode&&(l.set(this._tabContainer.controlNode,"display","block"),n.remove(this._tabContainer.containerNode,"esriCTTopBorder"));this.clearResultPanel();this._getUpdatedLayerFilters();this._searchedFeatures={};this.config.showAllLayers&&
this.showAllLayers();this._setSearchedLocation(m);this._setServiceArea(E);this._failedLayers=[];this._filterConfiguredLayer(ha);I(ha).then(x.hitch(this,function(){var ka=Z(".esriCTItemlList[tabindex\x3d'0']",this._panels.layerListPanel);ka&&0<ka.length&&(this._currentPanelName="layerListPanel",n.add(ka[ka.length-1],"esriCTLastLayerFocusNode"));this._onFeatureCountComplete();this.emit("setLastNode","layerListPanel")}))},_getUpdatedLayerFilters:function(){wa.getInstance(this.map,this.map.webMapResponse.itemInfo).then(x.hitch(this,
function(m){P.forEach(this.config.searchLayers,x.hitch(this,function(E){var S=m.getLayerInfoById(E.id);S&&(E.definitionExpression=S.getFilter())}))}))},_filterConfiguredLayer:function(m){this._currentPanel=this._panels.layerListPanel;l.set(this._currentPanel,"display","block");l.set(this._currentPanel,"left","0px");this._allLayersAreHidden=!0;for(var E=0;E<this._operationalLayers.length;E++)this._resetFilter(this._operationalLayers[E].layerIndex),this._createItemTemplate(this._operationalLayers[E],
m);1===this._operationalLayers.length&&this._getOperationalLayersVisibility(this._operationalLayers[0].url,this._operationalLayers[0].id)&&(l.set(this._panels.layerListPanel,"display","none"),this._onSingleLayerFound(null,this._operationalLayers[0]))},_onSingleLayerFound:function(m,E){if(m){var S=new k;m.push(S)}(m=Z(".esriCTBackButton",this._panels.featureListPanel)[0])&&l.set(m,"display","none");this._currentPanel=this._panels.featureListPanel;l.set(this._currentPanel,"display","block");l.set(this._currentPanel,
"left","0px");E&&this._displayFeatureList(E,S)},_onSingleFeatureFound:function(m){this._displayFilteredFeatures(m.attributes[this._selectedLayer.objectIdField]);this._showFeatureDetails(null,m);if(m=Z(".esriCTBackButton",this._panels.infoPanel)[0])l.set(m,"display","block"),1===this._layerCount&&l.set(this._panels.featureListPanel,"display","none")},_createItemTemplate:function(m,E){var S=O.toDom(this._itemListTemplate).childNodes[0];n.add(S,"esriCTDisabled");l.set(S,"color",this.config.fontColor);
this._currentPanel.appendChild(S);this._setItemName(S,m.title);this._queryForCountOnly(S,m,E);this._attachClickEvent(S,m,!0)},_setItemName:function(m,E,S){S&&(m=Z(S,m)[0]);if(S=Z(".esriCTItemName",m)[0])e.set(S,"innerHTML",E),e.set(m,"aria-label",F.stripHTML(E||"")),e.set(m,"title",F.stripHTML(E||""))},_attachClickEvent:function(m,E){this.own(q(m,"click, keypress",x.hitch(this,function(S){if("keypress"===S.type){var ha=S.charCode||S.keyCode;if(ha!==ra.ENTER&&ha!==ra.SPACE)return}!n.contains(m,"esriCTDisabled")&&
this._isSlide&&(S.stopPropagation(),this._isSlide=!1,this._selectedItem=m,(S=Z(".esriCTBackButton",this._panels.featureListPanel)[0])&&l.set(S,"display","block"),this._displayFeatureList(E,null))})))},_displayFeatureList:function(m,E){this._clearContent(this._featureListContent);this._selectedLayer=m;if(this.config.enableDirection){var S=Z(".jimu-tab",this._panels.infoPanel);var ha=Z(".jimu-tab .control",this._panels.infoPanel);var ka=Z(".esriCTItemListMainContainer .esriCTDirectionInfoPanel .esriCTPanelHeader");
ha&&ha[0]&&S&&S[0]&&ka&&ka[0]&&("esriGeometryPolygon"===m.geometryType&&this.config.intersectSearchedLocation?(n.add(S[0],"esriCTOverrideHeight"),n.add(ha[0],"esriCTHidden"),n.add(ka[0],"esriCTBorderBottom")):(n.remove(S[0],"esriCTOverrideHeight"),n.remove(ha[0],"esriCTHidden"),n.remove(ka[0],"esriCTBorderBottom")))}this._setItemName(this._panels.featureListPanel,this._selectedLayer.title,".esriCTPanelHeader");this._queryForFeatureList(E)},_getQueryParams:function(m){var E=new y;E.spatialRelationship=
"esriSpatialRelIntersects";E.outSpatialReference=this.map.spatialReference;E.outFields=["*"];if(this._attributeSearchList)this._attributeSearchList[m.id]&&0<this._attributeSearchList[m.id].length?E.objectIds=this._attributeSearchList[m.id]:E.where="1\x3d2";else if(this._serviceArea||this._selectedPoint)E.geometry=this._serviceArea||this._selectedPoint.geometry;return E},_queryForCountOnly:function(m,E,S){var ha;var ka=this._getQueryParams(E);if(ha=this._getOperationalLayersVisibility(E.url,E.id))this._allLayersAreHidden=
!1;this.config.intersectSearchedLocation&&"esriGeometryPolygon"===E.geometryType&&this._selectedPoint&&(ka.geometry=this._selectedPoint.geometry);var xa=new k;ka.where&&"1\x3d2"===ka.where||!ha?(l.set(m,"display","none"),e.set(m,"tabindex","-1"),g.focus(Z(".esriCTItemlList[tabindex\x3d'0']",m.parentElement)[0]),this.config.selectedSearchLayerOnly&&this._showHideOperationalLayer(E.url,E.id,!1),xa.resolve()):E.queryFeatures(ka,x.hitch(this,function(Aa){0<Aa.features.length&&ha?(this._selectedLayer=
E,this._layerCount++,this._searchedFeatures[E.id]=Aa.features,this._setItemCount(m,Aa.features.length,!0),this._showFilteredFeaturesOnLoad(Aa.features,E.id)):(l.set(m,"display","none"),e.set(m,"tabindex","-1"),g.focus(Z(".esriCTItemlList[tabindex\x3d'0']",m.parentElement)[0]),this.config.selectedSearchLayerOnly&&this._showHideOperationalLayer(E.url,E.id,!1));xa.resolve()}),x.hitch(this,function(){m&&(l.set(m,"display","none"),e.set(m,"tabindex","-1"),g.focus(Z(".esriCTItemlList[tabindex\x3d'0']",
m.parentElement)[0]),this.config.selectedSearchLayerOnly&&this._showHideOperationalLayer(E.url,E.id,!1));this._failedLayers.push(E.title);xa.resolve()}));S.push(xa)},_getFeatureLayerDetailsFormArray:function(m){var E;if(this._operationalLayers&&0<this._operationalLayers.length){var S=this._operationalLayers.length;for(E=0;E<S;E++)if(this._operationalLayers[E].id===m)return this._operationalLayers[E]}return null},_showFilteredFeaturesOnLoad:function(m,E){var S,ha="",ka;E=this._getFeatureLayerDetailsFormArray(E);
if(this.config.selectedSearchLayerOnly&&(1<m.length&&(m=this._getSortedFeatureList(m)),ka=this._getMaxResultCountValue(m.length,E.maxRecordCount))){for(S=0;S<ka;S++)ha&&(ha+=","),ha+=m[S].attributes[this._selectedLayer.objectIdField];m=this._selectedLayer.objectIdField+" in ("+ha+")";this._setFilterOnMapLayer(m,E.id,E.url,E.isMapServer)}},_onFeatureCountComplete:function(){if(this._isNoFeature){this.clearResultPanel();l.set(this._panels.layerListPanel,"display","block");l.set(this._panels.layerListPanel,
"left","0px");var m=this.editorXssFilter.sanitize(this.config.noFeatureFoundMessage);m=m?m:this.editorXssFilter.sanitize(this.nls.noFeatureFoundText);if(this._attributeSearchList||this._allLayersAreHidden)m=this.editorXssFilter.sanitize(this.nls.errorInAttributeSearch);O.create("div",{"class":"esriCTNoFeatureFound","aria-label":m,innerHTML:m},this._panels.layerListPanel);this.emit("noFeatureFound")}else 1===this._layerCount&&1!==this._operationalLayers.length&&(l.set(this._panels.layerListPanel,"display",
"none"),this._onSingleLayerFound(null,this._selectedLayer));this._failedLayers.length&&(m=this.nls.unableToFetchResults+"\n\x3c/t\x3e\x3cul\x3e\x3cli\x3e"+this._failedLayers.join("\n \x3c/li\x3e\x3cli\x3e")+"\x3c/li\x3e\x3c/ul\x3e",this._showMessage(m));this.loading.hide();this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize()},_queryForFeatureList:function(m){this.loading.show();if(this._searchedFeatures[this._selectedLayer.id])this.config.selectedSearchLayerOnly&&
this._hideAllLayers(),0<this._searchedFeatures[this._selectedLayer.id].length&&this._creatFeatureList(this._searchedFeatures[this._selectedLayer.id]),this.loading.hide(),m&&m.resolve();else{var E=this._getQueryParams(this._selectedLayer);this.config.intersectSearchedLocation&&this._selectedLayer&&"esriGeometryPolygon"===this._selectedLayer.geometryType&&this._selectedPoint&&(E.geometry=this._selectedPoint.geometry);this._selectedLayer.queryFeatures(E,x.hitch(this,function(S){this.config.selectedSearchLayerOnly?
(this._hideAllLayers(),0<S.features.length&&(this._showFilteredFeaturesOnLoad(S.features,this._selectedLayer.id),this._creatFeatureList(S.features))):0<S.features.length&&this._getOperationalLayersVisibility(this._selectedLayer.url,this._selectedLayer.id)&&(this._showFilteredFeaturesOnLoad(S.features,this._selectedLayer.id),this._creatFeatureList(S.features));this.loading.hide();m&&m.resolve()}),x.hitch(this,function(){this.loading.hide();this._failedLayers.push(this._selectedLayer.title);m&&m.resolve()}))}},
resetAllFilters:function(){for(var m=0;m<this._operationalLayers.length;m++)this._resetFilter(this._operationalLayers[m].layerIndex)},_setItemCount:function(m,E,S){var ha=Z(".esriCTItemCount",m)[0];Z(".esriCTItemName",m);ha&&(n.remove(ha,"esriCTLoadingIcon"),S?(E=this._getMaxResultCountValue(E,this._selectedLayer.maxRecordCount),this.config.showFeaturesCount&&(e.set(ha,"innerHTML","("+qa.format(E)+")"),ha=e.get(m,"title")+" "+qa.format(E),e.set(m,"title",ha),e.set(m,"aria-label",ha)),E&&(this._isNoFeature=
!1,n.remove(m,"esriCTDisabled"),e.set(m,"tabindex","0"),e.set(m,"role","button"),g.focus(Z(".esriCTItemlList[tabindex\x3d'0']",m.parentElement)[0]))):(E=qa.format(E.toFixed(2))+" "+this.nls.units[this.config.bufferDistanceUnit.value].acronym,e.set(ha,"innerHTML",E),m&&(ha=e.get(m,"title")+" "+E,e.set(m,"title",ha),e.set(m,"aria-label",ha))))},_getMaxResultCountValue:function(m,E){E||(E=1E3);return!this._attributeSearchList&&this.config.maxResultCount&&this.config.maxResultCount<=E?m<this.config.maxResultCount?
m:this.config.maxResultCount:m<E?m:E},_creatFeatureList:function(m){var E="",S;var ha=Z(".esriCTPanelHeader",this._panels.featureListPanel)[0];this._isNoFeature=!1;0<m.length&&(m=this._getSortedFeatureList(m),ha&&this._setItemCount(ha,m.length,!0));var ka=this._getMaxResultCountValue(m.length,this._selectedLayer.maxRecordCount);if(1===ka)this._onSingleFeatureFound(m[0]);else{for(ha=0;ha<ka;ha++){E&&(E+=",");E+=m[ha].attributes[this._selectedLayer.objectIdField];var xa=O.toDom(this._itemListTemplate).childNodes[0];
n.add(xa,"esriCTFeatureListItem");ha===ka-1&&n.add(xa,"esriCTLastFeatureFocusNode");e.set(xa,"tabindex","0");e.set(xa,"role","button");e.set(xa,"aria-label",m[ha].getTitle());this._featureListContent.appendChild(xa);this._setItemName(xa,m[ha].getTitle()||"");this._attributeSearchList||!m[ha].geometry||m[ha].geometry&&"polygon"===m[ha].geometry.type&&this.config.intersectSearchedLocation?(S=Z(".esriCTItemCount",xa)[0])&&n.remove(S,"esriCTLoadingIcon"):m[ha].hasOwnProperty("distanceToLocation")&&this._setItemCount(xa,
m[ha].distanceToLocation,!1);this._attachEventOnFeatureDiv(xa,m[ha])}this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize();this._displayFilteredFeatures(E);this._showPanel("featureListPanel");g.focus(Z(".esriCTItemlList[tabindex\x3d'0']",this._featureListContent)[0]);this.loading.hide();1===ka&&xa.click()}},_displayFilteredFeatures:function(m){this.config.selectedSearchLayerOnly&&(this._showHideOperationalLayer(this._selectedLayer.url,this._selectedLayer.id,
!0),this._selectedLayer.setDefinitionExpression(this._selectedLayer.objectIdField+" in ("+m+")"))},_setFilterOnMapLayer:function(m,E,S,ha){E&&(ha?(E=E.substring(0,E.lastIndexOf("_")),(S=this.map.getLayer(E))&&this.filterManager.applyWidgetFilter(E,this.id,m)):(S=this.map.getLayer(E))&&this.filterManager.applyWidgetFilter(E,this.id,m))},_resetFilter:function(m){var E=this._operationalLayers[m].isMapServer?this._operationalLayers[m].id.substring(0,this._operationalLayers[m].id.lastIndexOf("_")):this._operationalLayers[m].id;
this.filterManager.getWidgetFilter(E,this.id)?(this._setFilterOnMapLayer("",this._operationalLayers[m].id,this._operationalLayers[m].url,this._operationalLayers[m].isMapServer),wa.getInstance(this.map,this.map.webMapResponse.itemInfo).then(x.hitch(this,function(S){var ha;if(ha=S.getLayerInfoById(E)){var ka=ha.getFilter();!ka&&this._operationalLayers[m].isMapServer&&(ha=S.getLayerInfoById(this._operationalLayers[m].id))&&(ka=ha.getFilter());this.config.searchLayers[m].definitionExpression=ka;this._operationalLayers[m].setDefinitionExpression(ka)}}))):
this._operationalLayers[m]&&this.config.searchLayers[m]&&this._operationalLayers[m].setDefinitionExpression(this.config.searchLayers[m].definitionExpression)},_getSortedFeatureList:function(m){var E;var S=this._canGetGeodesicDistance();for(E=0;E<m.length;E++)m[E].distanceToLocation=this._attributeSearchList?m[E].getTitle().toLowerCase():S&&m[E].geometry?this._getGeodesicDistances(m[E].geometry):this._selectedPoint&&m[E].geometry?la.distance(this._selectedPoint.geometry,m[E].geometry,this.config.bufferDistanceUnit.distanceUnit):
0;m.sort(function(ha,ka){return ha.distanceToLocation<ka.distanceToLocation?-1:ha.distanceToLocation>ka.distanceToLocation?1:0});return m},_canGetGeodesicDistance:function(){var m=new da(4326);return this.config.isGeodesic&&this._selectedPoint&&b.canProject(this._selectedPoint.geometry,m)?!0:!1},_getGeodesicDistances:function(m){if(!this._selectedPoint)return 0;var E="point"===this._selectedPoint.geometry.type?this._selectedPoint.geometry:this._selectedPoint.geometry.getPoint(0,0);if("point"!==m.type)if((m=
la.nearestCoordinate(m,E))&&!m.isEmpty)m=m.coordinate;else return 0;var S=new a([[E.x,E.y],[m.x,m.y]]);S.setSpatialReference(E.spatialReference);E=new da(4326);if(b.canProject(m,E)){S=b.project(S,E);var ha=la.geodesicLength(S,this.config.bufferDistanceUnit.distanceUnit);isNaN(ha)&&(ha=0)}return ha},_attachEventOnFeatureDiv:function(m,E){this.own(q(m,"click, keypress",x.hitch(this,function(S){if("keypress"===S.type&&(S=S.charCode||S.keyCode,S!==ra.ENTER&&S!==ra.SPACE))return;this._isFeatureList=!0;
(S=Z(".esriCTBackButton",this._panels.infoPanel)[0])&&l.set(S,"display","block");this._showFeatureDetails(m,E)})))},_showFeatureDetails:function(m,E){this._setItemName(this._panels.infoPanel,this._selectedLayer.title,".esriCTPanelHeader");this._showPanel("infoPanel");var S=Z(".esriCTProximityParent",this.domNode);S&&0<S.length&&(S=S[0],E.geometry?n.remove(S,"esriCTHidden"):n.add(S,"esriCTHidden"));this._tabContainer&&(this._tabContainer.selectTab(this.nls.informationTabTitle),!E.geometry||this._attributeSearchList?
(l.set(this._tabContainer.controlNode,"display","none"),n.add(this._tabContainer.containerNode,"esriCTTopBorder")):(l.set(this._tabContainer.controlNode,"display","block"),n.remove(this._tabContainer.containerNode,"esriCTTopBorder")));this._selectedFeatureItem=m;this._selectedFeature=E;this._clearDirections();this._highlightFeatureOnMap();this._displayFeatureInfo(E);this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize()},_zoomToSelectedPointFeature:function(m){var E;
this.config.searchSourceSettings&&this.config.searchSourceSettings.sources&&0<this.config.searchSourceSettings.sources.length&&P.some(this.config.searchSourceSettings.sources,x.hitch(this,function(S){if(S&&S.layerId&&this._selectedLayer.id&&S.layerId===this._selectedLayer.id)return E=U.getExtentForScale(this.map,S.zoomScale).centerAt(m.geometry),!0}));E?this.map.setExtent(E):this.map.centerAndZoom(m.geometry,this.map.getMaxZoom()-1)},_displayFeatureInfo:function(m){var E;this._loadAttachmentTimer&&
clearTimeout(this._loadAttachmentTimer);this._featureInfoPanel&&(this._featureInfoPanel.set("content",""),this._gallerySwiper=[],this._allContentPanes=[],this._attributeSearchList||!m.geometry||m.geometry&&"polygon"===m.geometry.type&&this.config.intersectSearchedLocation||this._addDistanceToLocationInDetailsPanel(m),this._showPopupInfo(m,m._layer),this.config.attributeSymbology&&(E=this._getConfiguredSymbologyForLayer(this._selectedLayer.id))&&0<E.length&&this._checkAttributeSymbology(m,E));if(this.config.zoomToFeature)if(m.geometry&&
"point"===m.geometry.type)if(E=m.geometry,this._selectedPoint){var S=this._getPointFromGeometry(this._selectedPoint.geometry);E={paths:[[[E.x,E.y],[S.x,S.y]]],spatialReference:this.map.spatialReference};E=new a(E);this.map.setExtent(E.getExtent().expand(1.5))}else this._zoomToSelectedPointFeature(m);else m.geometry&&this.map.setExtent(m.geometry.getExtent().expand(1.5));this._getRelatedRecords(m)},_addDistanceToLocationInDetailsPanel:function(m){if(m.hasOwnProperty("distanceToLocation")){m=qa.format(m.distanceToLocation.toFixed(2))+
" "+this.nls.units[this.config.bufferDistanceUnit.value].acronym;m=O.create("div",{innerHTML:K.substitute(this.nls.approximateDistanceTitle,{DistanceToLocation:m}),"class":"esriCTDistanceToLocation"});var E=new d({style:{padding:"0px"}});E.set("content",m);this._featureInfoPanel.addChild(E)}},_getRelatedRecords:function(m){P.forEach(this._selectedLayer.tableInfos,x.hitch(this,function(E){this._queryRelatedRecords(this._tables[E],m.attributes[this._selectedLayer.objectIdField])}))},_queryRelatedRecords:function(m,
E){if(this._selectedLayer&&m){var S=new A;S.objectIds=[parseInt(E,10)];S.outFields=["*"];S.relationshipId=m.relationshipIds[this._selectedLayer.id];m.layerDefinition&&m.layerDefinition.definitionExpression&&(S.definitionExpression=m.layerDefinition.definitionExpression);this._selectedLayer.queryRelatedFeatures(S,x.hitch(this,function(ha){ha=ha[E];P.forEach(ha?ha.features:[],x.hitch(this,function(ka){ka.setInfoTemplate(new M(m.popupInfo));this._showPopupInfo(ka,this._tablesLayer[m.id])}));this.parentDivId&&
f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize()}))}},_showPopupInfo:function(m,E){if(this._featureInfoPanel&&m){m._layer||(m._layer=E);m._layer._map||(m._layer._map=this.map);var S=new d({"class":"esriCTPopupInfo"});var ha=m.getContent();var ka=f.byId(ha.id);S.set("content",ha);this.own(q(ka,"content-update",x.hitch(this,function(){this._getFeatureInfoLastNode();g.focus(this._featureInfoPanel.domNode)})));this._allContentPanes.push(S);this._featureInfoPanel.addChild(S);
this._checkAttachments(ka,m,E)}},_checkAttachments:function(m,E,S){n.add(Z(".mediaSection",m.domNode)[0],"esriCTHidden");var ha=Z(".attachmentsSection",m.domNode)[0];O.empty(ha);n.remove(ha,"hidden");S.hasAttachments&&S.showAttachments?(this.loading.show(),this._loadAttachmentTimer=setTimeout(x.hitch(this,function(){this._showAttachments(E,ha,S,m)}),500)):this._createGallery(S,ha,[],m)},_showAttachments:function(m,E,S,ha){this.config.showImageGallery?(m=m.attributes[S.objectIdField],O.empty(E),S.queryAttachmentInfos(m,
x.hitch(this,function(ka){this.loading.hide();this._createGallery(S,E,ka,ha);this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize()}))):(this.loading.hide(),n.add(E,"esriCTHidden"),this._getFeatureInfoLastNode())},resetGallery:function(){"infoPanel"===this._currentPanelName&&(!this._tabContainer||this._tabContainer&&this._tabContainer.selected===this.nls.informationTabTitle)&&this._gallerySwiper&&(P.forEach(this._gallerySwiper,function(m){m&&
(m.update(),m.slideReset())},this),this._getFeatureInfoLastNode())},_createGallery:function(m,E,S,ha){var ka;this._clearMediaRefreshTimers();this.config.showImageGallery&&(S=this._checkForHyperlinks(S,this._selectedFeature));var xa=S.length,Aa=[];if(S&&0<S.length||m&&m.infoTemplate&&m.infoTemplate.info&&m.infoTemplate.info.mediaInfos&&0<m.infoTemplate.info.mediaInfos.length){m.infoTemplate&&m.infoTemplate.info&&m.infoTemplate.info.mediaInfos&&(xa+=m.infoTemplate.info.mediaInfos.length);this.loading.show();
m=O.create("div",{"class":"esriCTThumbnailContainer"},E);O.create("div",{style:{clear:"both"}},m);var Ea=O.toDom(ia);var Ca=Z(".swiper-wrapper",Ea)[0];var Ka=!1;if(S&&0<S.length)for(m=0;m<S.length;m++)if(0>Aa.indexOf(S[m].url))if(Aa.push(S[m].url),-1!==S[m].contentType.indexOf("image")&&S[m].contentType.match(/(\/tiff)/)&&(S[m].contentType="application/tiff"),S[m].contentType&&-1<S[m].contentType.indexOf("image")){var Oa=O.create("div",{"class":"swiper-slide"},Ca);var Va=O.create("img",{alt:S[m].name,
"class":"esriCTAttachmentImg",src:S[m].url},Oa);this._attachEventOnImage(Va,null);Ka=!0}else S[m].contentType&&-1<S[m].contentType.toLowerCase().indexOf("video/mp4")?(Oa=O.create("div",{"class":"swiper-slide"},Ca),Va=O.toDom('\x3cvideo class\x3d"esriCTVideoElement" src\x3d"'+S[m].url+'" height\x3d"auto" width\x3d"100%" controls\x3e\x3csource src\x3d"'+S[m].url+'" type\x3d"'+S[m].contentType+'" poster\x3d"'+S[m].url+'"\x3e\x3c/video\x3e'),O.place(Va,Oa),Ka=!0):(Oa=O.create("div",{"class":"esriCTNonImageAttachmentContainer",
tabindex:"0","aria-label":S[m].name,role:"button",src:S[m].url},E),Va=this.folderUrl+"images/no-attachment.png",Va=O.create("img",{alt:"","class":"esriCTNonImageAttachmentImg esriCTAutoHeight",src:Va},Oa),Va=O.create("div",{"class":"esriCTImageFormatDiv"},Oa),this._fetchDocumentContentType(S[m],Va),this._attachEventOnImage(Oa,null));this._charts=[];this._checkMediaInfos(Ca,ha,Aa).then(x.hitch(this,function($a){if(Ka||$a)O.place(Ea,E),ka=new Y(Ea,{height:"250px",pagination:".swiper-pagination",nextButton:".swiper-button-next",
prevButton:".swiper-button-prev",slidesPerView:1,paginationClickable:!0,spaceBetween:30,loop:!0,a11y:!0}),this.own(q(ka,"onSlideChangeStart",x.hitch(this,function(){P.forEach(Z(".esriCTVideoElement",Ca),x.hitch(this,function(Ya){Ya.pause()}))}))),this.own(q(ka,"imagesReady",x.hitch(this,function(){P.forEach(Z(".swiper-slide-duplicate",Ca),x.hitch(this,function(Ya){var Xa;(Xa=Z(".esriCTAttachmentImg",Ya))&&0<Xa.length&&(Xa=Xa[0],Ya=e.get(Xa,"refreshInterval"),this._attachEventOnImage(Xa,Ya))}))}))),
P.forEach(this._charts,x.hitch(this,function(Ya){Ya.resize(200,200)})),1===xa&&(ka.nextButton&&0<ka.nextButton.length&&n.add(ka.nextButton[0],"esriCTHidden"),ka.prevButton&&0<ka.prevButton.length&&n.add(ka.prevButton[0],"esriCTHidden"),ka.lockSwipes());this.loading.hide();this._gallerySwiper.push(ka);this._getFeatureInfoLastNode()}))}else this._gallerySwiper.push(null),this._getFeatureInfoLastNode()},_getFeatureInfoLastNode:function(){var m;if("block"===l.get(this.proximityButton.parentElement,"display"))var E=
this.proximityButton;if(!E)for(var S=this._allContentPanes.length-1;0<=S&&((m=Z(".swiper-pagination-bullet",this._allContentPanes[S].domNode))&&0<m.length?E=m.reverse()[0]:(m=F.getFocusNodesInDom(this._allContentPanes[S].domNode))&&0<m.length&&(E=m.reverse()[0]),!E);S--);!E&&this._featureInfoPanel&&this._featureInfoPanel.domNode&&(E=this._featureInfoPanel.domNode);if(!E&&(E=this._getInformationTabAsLastFocusNode()))return;E||(E=Z(".esriCTItemListMainContainer .esriCTDirectionInfoPanel .esriCTPanelHeader",
this.domNode.parentElement)[0]);this.emit("setLastNodeInFeatureInfo",E)},_checkForHyperlinks:function(m,E){var S;var ha=[];ha=E.attributes;for(S in ha)ha.hasOwnProperty(S)&&ha[S]&&String(ha[S]).match(/^(http(s?):)/)&&(String(ha[S]).match(/\.(png|jpg|jpeg|gif|bmp)(\/|$)/i)?(E={},E.contentType="image/"+String(ha[S]).match(/\.(png|jpg|jpeg|gif|bmp)(\/|$)/i)[1],E.url=ha[S],m.push(E)):String(ha[S]).match(/\.(mp4)(\/?)/i)&&(E={contentType:"video/mp4"},E.url=ha[S],m.push(E)));return m},_checkMediaInfos:function(m,
E,S){var ha,ka;var xa=new k;var Aa=[];if(E._mediaInfos&&0<E._mediaInfos.length)var Ea=E._mediaInfos;else E&&E.template.info&&E.template.info.mediaInfos&&0<E.template.info.mediaInfos.length&&(Ea=E.template.info.mediaInfos);Ea&&E._mediaInfos&&0<E._mediaInfos.length?setTimeout(x.hitch(this,function(){for(var Ca=0;Ca<Ea.length;Ca++){var Ka=Ea[Ca],Oa=0;("image"===Ka.type||"image"!==Ka.type&&Ka.value.fields&&0<Ka.value.fields.length)&&0>S.indexOf(Ka.value.sourceURL)&&(S.push(Ka.value.sourceURL),ha=O.create("div",
{"class":"swiper-slide"},m),"image"===Ka.type?(Ka.hasOwnProperty("refreshInterval")&&(Oa=Ka.refreshInterval),ka=O.create("img",{alt:Ka.value.sourceURL,"class":"esriCTAttachmentImg",src:Ka.value.sourceURL,refreshInterval:Oa},ha),Oa&&e.set("refreshInterval",Oa),this._attachEventOnImage(ka,Oa)):Aa.push(this._loadMediaCharts(E,Ka,ha)))}0<Aa.length?I(Aa).then(x.hitch(this,function(){xa.resolve(!0)})):xa.resolve(!0)}),1E3):xa.resolve(!1);return xa.promise},_loadMediaCharts:function(m,E,S){var ha=new k,
ka=this,xa=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"];m=E.value.theme||m.chartTheme;x.isString(m)&&(m=m.replace(/\./gi,"/"),-1===m.indexOf("/")&&(m="dojox/charting/themes/"+m));m||(m="esri/dijit/Rainbow");xa.push(m);try{V(xa,function(Aa,Ea,Ca){ka._createChart(S,E,Aa,Ea,Ca).then(x.hitch(this,function(){ha.resolve()}))})}catch(Aa){ha.resolve()}return ha.promise},_createChart:function(m,E,S,ha,ka){var xa=E.type;var Aa=E.value;E=new k;S=new S(O.create("div",{"class":"chart"},m));ka&&
S.setTheme(ka);switch(xa){case "piechart":S.addPlot("default",{type:"Pie",labels:!1});S.addSeries("Series A",Aa.fields);break;case "linechart":S.addPlot("default",{type:"Markers"});S.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});S.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});P.forEach(Aa.fields,function(Ea,Ca){Ea.x=Ca+1});S.addSeries("Series A",Aa.fields);break;case "columnchart":S.addPlot("default",{type:"Columns",gap:3});S.addAxis("y",{includeZero:!0,
vertical:!0,fixUpper:"minor"});S.addSeries("Series A",Aa.fields);break;case "barchart":S.addPlot("default",{type:"Bars",gap:3}),S.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),S.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),S.addSeries("Series A",Aa.fields)}new ha(S);S.render();this._charts.push(S);E.resolve();return E.promise},_fetchDocumentContentType:function(m,E){m=(m=/(?:\.([^.]+))?$/.exec(m.name))&&m[1]?"."+m[1].toUpperCase():this.nls.unknownAttachmentExt;
e.set(E,"innerHTML",m)},_attachEventOnImage:function(m,E){this.own(q(m,"click",x.hitch(this,function(){this._displayImageAttachments(m,!1)})));this.own(q(m,"keydown",x.hitch(this,function(S){this._displayImageAttachments(m,!0,S)})));E&&(E*=6E4)&&0<E&&(E=setInterval(x.hitch(this,function(){m.setAttribute("src",m.alt+"?"+Math.random())}),E),this._mediaRefreshTimers.push(E))},_clearMediaRefreshTimers:function(){this._mediaRefreshTimers&&P.forEach(this._mediaRefreshTimers,function(m){clearInterval(m)});
this._mediaRefreshTimers=[]},_displayImageAttachments:function(m,E,S){E&&S.keyCode!==ra.ENTER&&S.keyCode!==ra.SPACE||window.open(e.get(m,"src"))},_onImageLoad:function(m){n.remove(m.target.parentNode,"esriCTImageLoader");this._setImageDimensions(m.target)},_setImageDimensions:function(m){var E=m.parentElement;if(m&&0<m.offsetHeight){e.set(m,"originalHeight",m.offsetHeight);l.set(m,"maxHeight",m.offsetHeight+"px");l.set(m,"maxWidth",m.offsetWidth+"px");var S=parseFloat(e.get(m,"originalHeight"));if(E.offsetHeight<
m.offsetHeight||S>E.offsetHeight)S=m.offsetWidth/m.offsetHeight,E=E.offsetHeight-2,S=Math.floor(E*S),n.remove(m,"esriCTAutoHeight"),l.set(m,"width",S+"px"),l.set(m,"height",E+"px")}},_onError:function(m){n.remove(m.target.parentNode,"esriCTImageLoader")},_setSearchedLocation:function(m){this._selectedPoint=m},_setServiceArea:function(m){this._serviceArea=m},clearResultPanel:function(){this._isFeatureList=!1;this._clearContent(this._panels.layerListPanel);l.set(this._panels.layerListPanel,"display",
"none");l.set(this._panels.featureListPanel,"display","none");l.set(this._panels.infoPanel,"display","none");this._clearContent(this._featureListContent);this._clearDirections();this._clearGrahics()},removeGraphicsLayer:function(){this._featureGraphicsLayer&&(this.map.removeLayer(this._featureGraphicsLayer),this._featureGraphicsLayer=null)},_clearGrahics:function(){this._featureGraphicsLayer&&this._featureGraphicsLayer.clear()},_showPanel:function(m,E){l.set(this._panels[m],{display:"block",left:"-100%"});
E?(this._slide(this._panels[m],-100,0),this._slide(this._currentPanel,0,100)):(this._slide(this._currentPanel,0,-100),this._slide(this._panels[m],100,0));this._currentPanelName=m;this._currentPanel=this._panels[m];this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize();setTimeout(x.hitch(this,function(){this.emit("setLastNode",m)}),400)},_slide:function(m,E,S){l.set(m,"display","block");l.set(m,"left",E+"%");ta.animateProperty({node:m,properties:{left:{start:E,
end:S,units:"%"}},duration:300,onEnd:x.hitch(this,function(){l.set(m,"left",S);0===S?l.set(m,"display","block"):l.set(m,"display","none");this._isSlide=!0})}).play()},_showMessage:function(m){(new H({message:m})).message=m},_initializeDirectionWidget:function(){if(!this._directionsWidget){f.byId("directionDijit"+this.id)&&f.byId("directionDijit"+this.id).destroy();var m={id:"directionDijit"+this.id,map:this.map,directionsLengthUnits:ea[this.config.directionLengthUnit.routeUnit],showTrafficOption:!1,
dragging:!1,routeTaskUrl:this.config.routeService,routeSymbol:new na(this.config.symbols.routeSymbol)};this.config.helperServices&&this.config.helperServices.printTask&&this.config.helperServices.printTask.url&&(m.printTaskUrl=this.config.helperServices.printTask.url);this._directionsWidget=new T(m,O.create("div",{},null));this._directionsWidget.startup();this.own(this._directionsWidget.on("directions-finish",x.hitch(this,function(){this._directionsWidget.zoomToFullRoute();this.parentDivId&&f.byId(this.parentDivId)&&
f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize();this.loading.hide();"block"===l.get(this.proximityButton.parentElement,"display")?F.initLastFocusNode(this.domNodeObj,this.proximityButton):this.emit("setLastNodeInFeatureInfo",F.getFocusNodesInDom(this._directionsWidget.domNode).reverse()[0])})));this._directionInfoPanel.set("content",this._directionsWidget.domNode)}this._routeSelectedLocations()},_clearDirections:function(){this._directionsWidget&&this._routeCalculated&&this._directionsWidget.clearDirections();
this._routeCalculated=!1},_getPointFromGeometry:function(m){switch(m.type){case "extent":var E=m.getCenter();break;case "multipoint":E=m.getPoint(0);break;case "point":E=m;break;case "polygon":E=m.getCentroid();break;case "polyline":E=m.getPoint(0,0)}return E},_routeSelectedLocations:function(){var m=[];this._clearDirections();this._selectedPoint&&this._selectedFeature&&this._selectedFeature.geometry&&(this.loading.show(),m.push(this._getPointFromGeometry(this._selectedPoint.geometry)),m.push(this._getPointFromGeometry(this._selectedFeature.geometry)),
this._directionsWidget.updateStops(m).then(x.hitch(this,function(){this._directionsWidget.getDirections();this._routeCalculated=!0}),x.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.failedToGenerateRouteMsg)})))},_highlightFeatureOnMap:function(){var m;this._clearGrahics();this._selectedFeature&&this._selectedFeature.geometry&&(m=this._getHighLightSymbol(this._selectedFeature,this._selectedLayer))&&m.geometry&&this._featureGraphicsLayer.add(m)},_getHighLightSymbol:function(m,
E){switch(m.geometry.type){case "point":case "multipoint":return this._getPointSymbol(m,E);case "polyline":return this._getPolyLineSymbol(m,E);case "polygon":return this._getPolygonSymbol(m)}},_getHighLightSymbolColor:function(){var m=new Q([0,255,255,1]);this.config.highlightColor&&(m=new Q(this.config.highlightColor),this.config.hasOwnProperty("showSelectionColor")||(this.config.showSelectionColor=!0),m.a=this.config.showSelectionColor?1:0);return m},_getPointSymbol:function(m,E){var S,ha;var ka=
!1;var xa=this._getHighLightSymbolColor();xa=new J(J.STYLE_SQUARE,null,new na(na.STYLE_SOLID,xa,3));xa.setColor(null);xa.size=30;if(E&&E.renderer)if(E.renderer.symbol)ka=!0,xa=this._updatePointSymbolProperties(xa,E.renderer.symbol);else if(E.renderer.infos&&0<E.renderer.infos.length){for(ha=0;ha<E.renderer.infos.length;ha++){E.typeIdField?S=m.attributes[E.typeIdField]:E.renderer.attributeField&&(S=m.attributes[E.renderer.attributeField]);var Aa=E.renderer.infos[ha].value;void 0!==S&&null!==S&&""!==
S&&void 0!==Aa&&null!==Aa&&""!==Aa&&S.toString()===Aa.toString()&&(ka=!0,xa=this._updatePointSymbolProperties(xa,E.renderer.infos[ha].symbol))}!ka&&E.renderer.defaultSymbol&&(ka=!0,xa=this._updatePointSymbolProperties(xa,E.renderer.defaultSymbol))}if(m.geometry&&"point"===m.geometry.type)var Ea=new C(m.geometry.x,m.geometry.y,new da({wkid:m.geometry.spatialReference.wkid}));else m.geometry&&"multipoint"===m.geometry.type&&(Ea=new ba(new da({wkid:m.geometry.spatialReference.wkid})),m.geometry.points&&
P.forEach(m.geometry.points,function(Ca){Ea.addPoint(Ca)}));return new R(Ea,xa,m.attributes)},_updatePointSymbolProperties:function(m,E){if(E.hasOwnProperty("height")&&E.hasOwnProperty("width")){var S=E.height;var ha=E.width;S=(S>ha?S:ha)+10;m.size=S}E.hasOwnProperty("size")&&(!S||S<E.size)&&(m.size=E.size+10);E.hasOwnProperty("xoffset")&&(m.xoffset=E.xoffset);E.hasOwnProperty("yoffset")&&(m.yoffset=E.yoffset);return m},_getPolyLineSymbol:function(m,E){var S,ha;var ka=5;var xa=this._getHighLightSymbolColor();
if(E&&E.renderer)if(E.renderer.symbol&&E.renderer.symbol.hasOwnProperty("width"))ka=E.renderer.symbol.width;else if(E.renderer.infos&&0<E.renderer.infos.length)for(ha=0;ha<E.renderer.infos.length;ha++){E.typeIdField?S=m.attributes[E.typeIdField]:E.renderer.attributeField&&(S=m.attributes[E.renderer.attributeField]);var Aa=E.renderer.infos[ha].value;void 0!==S&&null!==S&&""!==S&&void 0!==Aa&&null!==Aa&&""!==Aa&&S.toString()===Aa.toString()&&E.renderer.infos[ha].symbol.hasOwnProperty("width")&&(ka=
E.renderer.infos[ha].symbol.width)}else E.renderer.defaultSymbol&&E.renderer.defaultSymbol.hasOwnProperty("width")&&(ka=E.renderer.defaultSymbol.width);E=new na(na.STYLE_SOLID,xa,ka);var Ea=new a(new da({wkid:m.geometry.spatialReference.wkid}));m.geometry.paths&&0<m.geometry.paths.length&&P.forEach(m.geometry.paths,x.hitch(this,function(Ca){Ea.addPath(Ca)}));return new R(Ea,E,m.attributes)},_getPolygonSymbol:function(m){var E=this._getHighLightSymbolColor();E=new oa(oa.STYLE_SOLID,new na(na.STYLE_SOLID,
E,4),new Q([0,0,0,0]));var S=new B(new da({wkid:m.geometry.spatialReference.wkid}));m.geometry.rings&&(S.rings=x.clone(m.geometry.rings));return new R(S,E,m.attributes)},_hideAllLayers:function(){if(this.config.selectedSearchLayerOnly){var m;for(m=0;m<this.config.searchLayers.length;m++)this._showHideOperationalLayer(this.config.searchLayers[m].url,this.config.searchLayers[m].id,!1)}},showAllLayers:function(m){var E;for(E=0;E<this.config.searchLayers.length;E++){var S=m?this.config.searchLayers[E].visibility:
!0;this.config.selectedSearchLayerOnly&&this._searchedFeatures[this.config.searchLayers[E].id]&&1>this._searchedFeatures[this.config.searchLayers[E].id].length&&(S=!1);this._showHideOperationalLayer(this.config.searchLayers[E].url,this.config.searchLayers[E].id,S)}},showLayersOnBackToLayerList:function(){var m;for(m=0;m<this.config.searchLayers.length;m++)if(this.config.selectedSearchLayerOnly){var E=this._searchedFeatures[this.config.searchLayers[m].id]&&0<this._searchedFeatures[this.config.searchLayers[m].id].length?
!0:!1;this._showHideOperationalLayer(this.config.searchLayers[m].url,this.config.searchLayers[m].id,E)}},_showHideOperationalLayer:function(m,E,S){var ha;var ka=m.split("/");ka=ka[ka.length-1];for(ha in this.map._layers)if(this.map._layers.hasOwnProperty(ha))if(E&&this.map._layers[ha].url===m&&this.map._layers[ha].id===E)this.map._layers[ha].setVisibility(S);else if(this.map._layers[ha].visibleLayers&&E&&this.map._layers[ha].id===E.substring(0,E.lastIndexOf("_"))){var xa=this.map._layers[ha].url[this.map._layers[ha].url.length-
1];xa="/"===xa?this.map._layers[ha].url+ka:this.map._layers[ha].url+"/"+ka;if(xa===m){xa=this.map._layers[ha].visibleLayers;var Aa=P.indexOf(xa,parseInt(ka,10));S?-1===Aa&&xa.push(parseInt(ka,10)):-1!==Aa&&xa.splice(Aa,1);this.map._layers[ha].setVisibleLayers?this.map._layers[ha].setVisibleLayers(xa):(this.map._layers[ha].visibleLayers=xa,this.map._layers[ha].setVisibility(S))}}},_getOperationalLayersVisibility:function(m,E){var S;var ha=m.split("/");ha=ha[ha.length-1];for(S in this.map._layers)if(this.map._layers.hasOwnProperty(S)){if(E&&
this.map._layers[S].url===m&&this.map._layers[S].id===E)return this.map._layers[S].visible;if(this.map._layers[S].visibleLayers&&E&&this.map._layers[S].id===E.substring(0,E.lastIndexOf("_"))){var ka=this.map._layers[S].url[this.map._layers[S].url.length-1];ka="/"===ka?this.map._layers[S].url+ha:this.map._layers[S].url+"/"+ha;if(ka===m&&(ka=this.map._layers[S].visibleLayers,ka=P.indexOf(ka,parseInt(ha,10)),-1!==ka))return this.map._layers[S].visible}}return!1},_getConfiguredSymbologyForLayer:function(m){var E=
[];if(this.config.attributeSymbology&&this.config.attributeSymbology.hasOwnProperty(m))return this.config.attributeSymbology[m];this.config.attributeSymbology&&this.config.attributeSymbology.length&&0<this.config.attributeSymbology.length&&P.forEach(this.config.attributeSymbology,x.hitch(this,function(S){S.hasOwnProperty("layerId")&&S.layerId===m&&E.push(S)}));return E},_checkAttributeSymbology:function(m,E){var S;if(S=Z(".attachmentsSection",this._featureInfoPanel.domNode)[0]){var ha=O.create("div",
{"class":"esriCTAttributeSymbolWrapper"},null);O.place(ha,S,"before")}P.forEach(E,x.hitch(this,function(ka){m.attributes.hasOwnProperty(ka.fieldName)&&m.attributes[ka.fieldName]===ka.fieldValue&&this._createAttributeSymbol(ka,ha)}))},_createAttributeSymbol:function(m,E){var S=N.fromJson(m.symbol);m=this._selectedLayer.getField(m.fieldName);E=O.create("div",{"class":"esriCTAttributeSymbolContainer",title:m&&m.alias?m.alias:""},E);S=X.createSymbolNode(S);O.place(S,E)},resetIconColors:function(){this._filterIcon&&
l.set(this._filterIcon,"background-color",this.selectedThemeColor);this._proximityIcon&&l.set(this._proximityIcon,"background-color",this.selectedThemeColor)},_attachEventToTab:function(){""!==this._tabContainer&&null!==this._tabContainer&&void 0!==this._tabContainer&&this._tabContainer.controlNodes&&1<this._tabContainer.controlNodes.length&&this.own(q(this._tabContainer.controlNodes[1],"keydown",x.hitch(this,function(m){m.keyCode===ra.TAB&&!m.shiftKey&&this._tabContainer.viewStack&&this._tabContainer.viewStack.getSelectedLabel()===
this.nls.informationTabTitle&&(this.config.enableProximitySearch?(va.stop(m),g.focus(this.proximityButton)):(va.stop(m),this.emit("setFocusOnFirstFocusableNode")))})))},_getInformationTabAsLastFocusNode:function(){if(""!==this._tabContainer&&null!==this._tabContainer&&void 0!==this._tabContainer&&this._tabContainer.viewStack&&this._tabContainer.viewStack.getSelectedLabel()===this.nls.informationTabTitle&&this._tabContainer.controlNodes&&0<this._tabContainer.controlNodes.length){var m=this._tabContainer.controlNodes[0];
if(!this.config.enableProximitySearch)return F.initLastFocusNode(this.domNodeObj,m),!0}return!1}})})},"esri/dijit/Directions":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),
function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,H,v,G,Q,T,M,R,C,a,B,da,la,ma,pa,N,oa,na,J,y,A,ea,ta,qa,wa,Ba,b,f,D,r,X,ba,ra,g,K,U,Y,ia,va,m,E,S,ha,ka,xa,Aa,Ea,Ca,Ka,Oa,Va,$a,Ya){var Xa=y.getProtocolForWebResource(),cb=la.createSubclass({_setSourcesAttr:function(c){c&&(c=c.map(function(h){h.locator&&null==h.locationType&&(h=t.mixin({locationType:"street"},h));return h}));this.inherited(arguments,[c])}});W=W("esri.dijit.Directions",[E,x],{templateString:da,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,
deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(c,h){if(!c.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!h)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');
this._i18n=B;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",
stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",
routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",
esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",linkButtonClass:"esriLinkButton",
activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:Xa+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:Xa+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",
geometryTaskUrl:Xa+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new qa(B.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new qa(B.widgets.directions.maneuver,B.widgets.directions.waypoint),segmentInfoTemplate:new qa(B.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),
textSymbolFont:new m("11px",m.STYLE_NORMAL,m.VARIANT_NORMAL,m.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new P([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new U({url:V.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new U({url:V.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new U({url:V.toUrl("./images/Directions/bluePoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new U({url:V.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new U({url:V.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new U({url:V.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new U({url:V.toUrl("./images/Directions/grayPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new U({url:V.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new K({color:[255,255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new K({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],width:1,
type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new Y).setColor(new P([20,89,127,.75])).setWidth(10).setCap(Y.CAP_ROUND).setJoin(Y.JOIN_ROUND),segmentSymbol:(new Y).setColor(new P([255,255,255,1])).setWidth(6).setCap(Y.CAP_ROUND).setJoin(Y.JOIN_ROUND),barrierRenderer:new va({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new va({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new va({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=c;this.defaults=t.mixin({},this.options,c,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(c=2;c<this.defaults.minStops;c++)this.defaults.stops.splice(0,0,"");this.domNode=h},postCreate:function(){this.inherited(arguments);this.own(H(this._activateButtonNode,F,t.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(H(this._lineBarrierButtonNode,F,t.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(H(this._addDestinationNode,
F,t.hitch(this,this._addStopButton)));this.own(H(this._optionsButtonNode,F,t.hitch(this,this._toggleOptionsMenu)));this.own(H(this._saveMenuButton,F,t.hitch(this,this._toggleSaveMenu)));this.own(H(this._saveButton,F,t.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(H(this._saveAsButton,F,t.hitch(this,function(){t.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(H(this._findOptimalOrderNode,F,t.hitch(this,this._toggleCheckbox)));
this.own(H(this._returnToStartNode,F,t.hitch(this,this._toggleCheckbox)));this.own(H(this._useTrafficNode,F,t.hitch(this,this._toggleCheckbox)));this.own(H(this._useMilesNode,F,t.hitch(this,this._toggleUnits)));this.own(H(this._useKilometersNode,F,t.hitch(this,this._toggleUnits)));this.own(H(this._getDirectionsButtonNode,F,t.hitch(this,this.getDirections)));this.own(H(this._clearDirectionsButtonNode,F,t.hitch(this,function(){this.clearDirections()})));var c=t.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(t.hitch(this,function(){T.set(this._startTimeMenu,"display","none")}),100)});this.own(H(this._startTimeButtonNode,F,t.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===T.get(this._startTimeMenu,"display")?T.set(this._startTimeMenu,"display","none"):(T.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(H(this._startTimeMenuLeaveNow,
"blur",c));this.own(H(this._startTimeMenuDepartAt,"blur",c));this.own(H(this._startTimeMenuNone,"blur",c));this.own(H(this._startTimeMenuLeaveNow,"mousedown",t.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(H(this._startTimeMenuDepartAt,"mousedown",t.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(H(this._startTimeMenuNone,"mousedown",t.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new Y).setColor(new P([0,255,0,0])).setWidth(20).setCap(Y.CAP_ROUND);this._stopLayer=new b({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new b({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new b({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new b({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new b({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new b({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var h=new A(null,this.waypointSymbol,{});c=t.hitch(this,function(){this._moveInProgress||this._solveInProgress||!h._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(h),clearTimeout(h._solveTimeout),h._solveTimeout=null,h.attributes.isWaypoint=!0,h._isStopIcon&&this.stopGraphics[h._index]&&(this._stopLayer.add(this.stopGraphics[h._index]),this._stopLayer.add(this.textGraphics[h._index])));h._showTooltip()});this._handle=t.mixin(h,{_isHandle:!0,_tooltip:ma.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:c},this.map.container),_showTooltip:t.hitch(this,function(u){h._tooltip.style.display=!u||u instanceof MouseEvent?
"none":"inline";u&&(u="string"===typeof u?u:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(u)+"\x3c/table\x3e",h._tooltip.innerHTML!==u&&(h._tooltip.innerHTML=u))}),_isShown:t.hitch(this,function(){return-1<Z.indexOf(this._stopLayer.graphics,h)}),_remove:c});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();ma.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(t.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(t.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(c,h){return this._enqueue(function(){return this._modifyStopSequence(c,
h)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(c,h,u){return this._enqueue(function(){this.clearMessages();return this._removeStop(c,h,u)})},updateStops:function(c){return this._enqueue(function(){return this._updateStops(c)})},addStops:function(c,h){return this._enqueue(function(){return this._addStops(c,h)}).then(t.hitch(this,this.zoomToFullRoute))},addStop:function(c,
h){return this._enqueue(function(){return this._addStop(c,h)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(c,h,u){return this._enqueue(function(){return this._updateStop(c,h,u)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(c){this.routeParams.barriers=c;return this._getDirections().then(t.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(c){this.routeParams.polylineBarriers=c;return this._getDirections().then(t.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(c){this.routeParams.polygonBarriers=c;return this._getDirections().then(t.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(c){return this._enqueue(function(){return this._getDirections().then(t.hitch(this,function(){!0!==c&&this.zoomToFullRoute()}))})},selectSegment:function(c){if(!(!this.directions||!this.directions.features||
0>c||c>=this.directions.features.length))for(var h=C("[data-segment]",this._resultsNode),u=0;u<h.length;u++){var L=parseInt(R.get(h[u],"data-segment"),10);if(c===L&&h[u]!==this._focusedDirectionsItem){this._focusedDirectionsItem=h[u];this.centerAtSegmentStart(c);this.onSegmentSelect(this.directions.features[c]);h[u].focus();break}}},unhighlightSegment:function(c){var h=this._segmentGraphics;if(h&&(!this._focusedDirectionsItem||c)){for(c=0;c<h.length;c++)this._routeLayer.remove(h[c]);this._segmentGraphics=
[]}},highlightSegment:function(c,h){if(!(this._focusedDirectionsItem&&!h||c>=this.directions.features.length)){c=c||0;var u=t.hitch(this,function(Fa){var Da=this.map.toMap({x:0,y:0});return this.map.toScreen(Da.offset(Fa,0)).x}),L=t.hitch(this,function(Fa){for(var Da=0,Ia=0;Ia<Fa.length;Ia++)for(var Na=1;Na<Fa[Ia].length;Na++){var Ua=Fa[Ia][Na-1],Qa=Fa[Ia][Na];Da+=u(Math.sqrt((Ua[0]-Qa[0])*(Ua[0]-Qa[0])+(Ua[1]-Qa[1])*(Ua[1]-Qa[1])))}return Da}),z=t.hitch(this,function(Fa){var Da=this.map.toMap({x:0,
y:0});return this.map.toMap({x:Fa,y:0}).x-Da.x}),aa=function(Fa,Da,Ia){Da=Math.max(1,Da);for(var Na=Ia?Fa[0].length-1:0,Ua=0,Qa,Pa,Ma,Ha=[[Fa[0][Ia?Na:0]]];Ia&&0<Na||!Ia&&Na<Fa[0].length-1;){Pa=Fa[0][Ia?Na-1:Na];Ma=Fa[0][Ia?Na:Na+1];if(Qa=u(Math.sqrt((Pa[0]-Ma[0])*(Pa[0]-Ma[0])+(Pa[1]-Ma[1])*(Pa[1]-Ma[1]))))if(Ua+Qa<Da)Ia?Ha[0].splice(0,0,Pa):Ha[0].push(Ma),Ua+=Qa;else{Da=(Da-Ua)/Qa;Ia?Ha[0].splice(0,0,[Ma[0]-(Ma[0]-Pa[0])*Da,Ma[1]-(Ma[1]-Pa[1])*Da]):Ha[0].push([Pa[0]+(Ma[0]-Pa[0])*Da,Pa[1]+(Ma[1]-
Pa[1])*Da]);break}Na+=Ia?-1:1}return 0<Ua+Qa?Ha:Fa};h=this.get("directions").features[c];var ca=new ra(h.geometry),fa=40*Math.PI/180;t.mixin(h.attributes,{_index:c});if(c){var ja=aa(this.get("directions").features[c-1].geometry.paths,25,!0),ua="esriDMTStop"!==h.attributes.maneuverType?aa(ca.paths,25,!1):ja;ja=ua!==ja?[ja[0].concat(ua[0])]:ua;var sa=(new ra(ua)).getExtent();if(1<ua[0].length&&15<=u(Math.max(sa.getWidth(),sa.getHeight()))){aa=15*Math.cos(fa/2);L=15*Math.sin(fa/2);var ya=ua[0].length-
2;fa=ua[0][ya+1];for(sa=0;0<=ya&&!sa;){var za=ua[0][ya];sa=u(Math.sqrt((za[0]-fa[0])*(za[0]-fa[0])+(za[1]-fa[1])*(za[1]-fa[1])));ya--}22>sa&&(ua=sa+(22-sa)/3,ya=sa+2*(22-sa)/3,ya=[za[0]+ya/sa*(fa[0]-za[0]),za[1]+ya/sa*(fa[1]-za[1])],za=[fa[0]-ua/sa*(fa[0]-za[0]),fa[1]-ua/sa*(fa[1]-za[1])],fa=ya,sa=22);aa/=sa;ua=[fa[0]-(fa[0]-za[0])*aa,fa[1]-(fa[1]-za[1])*aa];za[1]!==fa[1]?(aa=(fa[0]-za[0])/(fa[1]-za[1]),za=z(L/Math.sqrt(1+aa*aa)),z=aa*za):(za=0,z=z(L));Infinity===Math.abs(za)||Infinity===Math.abs(z)||
isNaN(za)||isNaN(z)||(ja[0].push(fa),ja[0].push([ua[0]-za,ua[1]+z]),ja[0].push([ua[0]+za,ua[1]-z]),ja[0].push(fa))}else ja=aa(ja,2*L(ua),!0);ca.paths=ja}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);z=t.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new P([parseInt(.9*this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new A(h.geometry,z,h.attributes,this.get("segmentInfoTemplate")),
new A(ca,this.routeSymbol,h.attributes,this.get("segmentInfoTemplate")),new A(ca,this.segmentSymbol,h.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));h=t.hitch(this,function(Fa){if(0<Fa&&Fa<this.directions.features.length){Fa=this.directions.features[Fa]._associatedFeaturesWithWaypoints;for(var Da=0;Da<Fa.length;Da++)Fa[Da]._associatedSnapFeature&&
Fa[Da]._associatedSnapFeature.getDojoShape()&&Fa[Da]._associatedSnapFeature.getDojoShape().moveToFront()}});h(c-1);h(c);this.onSegmentHighlight(this.directions.features[c])}},zoomToSegment:function(c){var h=new N;if(this.directions&&this.directions.features){var u=Math.max(0,Math.min(this.directions.features.length-1,c||0));this.map.setExtent(this.get("directions").features[u].geometry.getExtent(),!0).promise.always(t.hitch(this,function(){this.highlightSegment(u);h.resolve()}))}else h.reject(Error("No directions."));
return h.promise},centerAtSegmentStart:function(c){var h=new N;if(this.directions&&this.directions.features){var u=Math.max(0,Math.min(this.directions.features.length-1,c||0));var L=this.directions.features[u];this.map.centerAt(L.geometry.getPoint(0,0)).promise.always(t.hitch(this,function(){this.highlightSegment(u,!0);this._showSegmentPopup(L,u);h.resolve()}))}else h.reject(Error("No directions."));return h.promise},zoomToFullRoute:function(){var c=new N;this.directions&&this.directions.features?
(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(c.resolve)):c.resolve();return c.promise},setListIcons:function(){var c,h=this._dnd.getAllNodes();for(c=0;c<h.length;c++){var u=C("."+this._css.stopIconClass,h[c])[0];u&&(u.innerHTML=this._getLetter(c));M.remove(h[c],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);u=this._getStopSymbol(this.stops[c]);
u===this.fromSymbol?M.add(h[c],this._css.stopOriginClass):u===this.toSymbol?M.add(h[c],this._css.stopDestinationClass):u===this.unreachedSymbol&&M.add(h[c],this._css.stopUnreachedClass)}c=C("[data-reverse-td]",this._dndNode)[0];ma.destroy(c);this.get("showReverseStopsButton")&&ma.create("td",{"data-reverse-td":"true",rowspan:h.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+
B.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(L){L.stopPropagation()},onmouseout:function(L){L.stopPropagation()}},h[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var c=0;c<this.stopGraphics.length;c++)if(this.stopGraphics[c]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==c)){this._stopLayer.add(this.stopGraphics[c]);var h=this.stopGraphics[c].getDojoShape();h&&h.moveToFront();this._stopLayer.add(this.textGraphics[c]);
(h=this.textGraphics[c].getDojoShape())&&h.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var c=this.stops,h=0;h<c.length;h++){var u=c[h];if(u&&u.feature){var L=u.feature.attributes,z=L?L.Status:void 0,aa=null;this._isStopAWaypoint(u)||(aa=new ia(this._getLetter(h),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&
aa.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));aa=new A(u.feature.geometry,aa,{address:u.name},this.get("stopsInfoTemplate"));aa._isStopLabel=!0;aa._index=h;var ca=u.feature.geometry,fa=this._getStopSymbol(u),ja=t,ua=ja.mixin;z={address:u.name,Status:void 0===z?0:z,CurbApproach:L&&L.CurbApproach?L.CurbApproach:null,TimeWindowStart:L&&L.TimeWindowStart?L.TimeWindowStart:null,TimeWindowEnd:L&&L.TimeWindowEnd?L.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(u)};var sa=
void 0,ya={};for(sa in L)L.hasOwnProperty(sa)&&0===sa.indexOf("Attr_")&&(ya[sa]=L[sa]);u=new A(ca,fa,ua.call(ja,z,ya),this.get(this._isStopAWaypoint(u)?"waypointInfoTemplate":"stopsInfoTemplate"));u._isStopIcon=!0;u._index=h;this.stopGraphics[h]=u;this.textGraphics[h]=aa}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();this.addRouteSymbols();this.setListIcons()},setTravelMode:function(c){return this._enqueue(function(){this.clearMessages();
this._travelModeSelector.setValue(c);return this._setTravelMode(c)})},getSupportedTravelModeNames:function(){var c=[],h=this.serviceDescription;if(h&&h.supportedTravelModes&&h.supportedTravelModes.length){h=h.supportedTravelModes;for(var u=0;u<h.length;u++)c.push(h[u].name)}return c},setDirectionsLengthUnits:function(){var c=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(c)})},setDirectionsLanguage:function(){var c=
1===arguments.length?arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(c)})},useMyCurrentLocation:function(c){this.clearMessages();return this._createLocateButton(this.geocoders[c],!0,!0)},loadRoute:function(c){return this._enqueue(t.hitch(this,function(){return this._loadRoute(c)}))},_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var c=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();this._setWidgetProperties();return this._init().then(t.hitch(this,function(){this.mapClickActive=!c;this.set("mapClickActive",c);this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var c=this.get("mapClickActive"),h=t.hitch(this,function(u){for(var L=u?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,
this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],z=0;z<L.length;z++)for(var aa=L[z],ca=0;ca<aa.length;ca++){var fa=aa[ca].getDojoShape();fa&&fa[u?"moveToBack":"moveToFront"].call(fa)}});this.drawToolbar&&(this.barrierToolActive=!1,this.drawToolbar.deactivate(),M.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();c?(this.map.activeDirectionsWidget&&
this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=H(this.map,"click",t.hitch(this,function(u){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new A(u.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),M.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),
M.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());h(!c);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(Va.FREEHAND_POLYLINE),M.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):
(this.drawToolbar.deactivate(),M.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var c=this.get("map"),h=c.graphicsLayerIds.length-1;c.reorderLayer(this._routeLayer,h);c.reorderLayer(this._polygonBarriersLayer,h);c.reorderLayer(this._polylineBarriersLayer,h);c.reorderLayer(this._barriersLayer,h);c.reorderLayer(this._waypointsEventLayer,h);
c.reorderLayer(this._stopLayer,h)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(c){}this.geocoders.splice(0,1)}this.geocoders=[]},_disconnectEvents:function(){var c=this._clearDirections(!0),h;if(this._watchEvents&&this._watchEvents.length)for(h=0;h<this._watchEvents.length;h++)this._watchEvents[h].unwatch();if(this._onEvents&&this._onEvents.length)for(h=0;h<this._onEvents.length;h++)this._onEvents[h].remove();
if(this._geocoderEvents)for(h=0;h<this._geocoderEvents.length;h++)this._geocoderEvents[h].value.unwatch(),this._geocoderEvents[h].blur.remove(),this._geocoderEvents[h].select.remove(),this._geocoderEvents[h].suggest.remove();this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return c},_getDirections:function(){var c=new N;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&
this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(t.hitch(this,function(h){this.stops=h;this._setStops();this._configureRoute().always(t.hitch(this,function(u){c.resolve(u)}))}),t.hitch(this,function(h){this.set("directions",null);this._clearRouteGraphics();c.reject(h);this.onDirectionsFinish(h)}))):this._clearDirections(!0).always(t.hitch(this,function(){this.createRouteSymbols();c.resolve()}));return c.promise},
_clearDirections:function(){var c=new N;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),c.resolve()):arguments.length?c.resolve():this._reset().then(c.resolve,c.reject):c.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();
return c.promise},_setTravelMode:function(c){var h=new N,u=this.serviceDescription,L=function(){h.resolve(c)};if(u&&u.supportedTravelModes&&u.supportedTravelModes.length){var z=u.supportedTravelModes,aa=!1;for(u=0;u<z.length;u++)if(z[u].name===c){aa=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==c?(this.routeParams.travelMode=z[u].impedanceAttributeName?z[u]:z[u].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(L)):L();this._travelModeSelector&&
this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=z[u].description);break}aa||h.reject(c)}else h.reject(c);return h.promise},_setDirectionsLengthUnits:function(c){this._clearDisplayBeforeSolve();var h=new N;M.remove(this._useMilesNode,this._css.stopsPressedButtonClass);M.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);c===ea.KILOMETERS?M.add(this._useKilometersNode,this._css.stopsPressedButtonClass):c===ea.MILES&&M.add(this._useMilesNode,this._css.stopsPressedButtonClass);
c===ea.KILOMETERS||c===ea.METERS||c===ea.MILES||c===ea.FEET||c===ea.YARDS||c===ea.NAUTICAL_MILES?(this.directionsLengthUnits=c,h.resolve(c)):h.reject(c);return h.promise},_setDirectionsLanguage:function(c){this._clearDisplayBeforeSolve();var h=new N;c=this._setDirectionsLanguageByLocale(c);this._solveAndZoom().always(function(){h.resolve(c)},h.reject);return h.promise},_showLoadingSpinner:function(c){void 0===c&&(c=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);
c?(M.add(this._widgetContainer,this._css.resultsLoadingClass),M.add(this._resultsNode,"esriRoutesContainerBusy")):(M.remove(this._widgetContainer,this._css.resultsLoadingClass),M.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(c,h){var u=new N;this._requestQueueTail||(this._requestQueueTail=new N,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(t.hitch(this,function(){try{t.mixin(this,{_incrementalSolveStopRange:null},h);var L=c.call(this);L&&"object"===
typeof L&&L.hasOwnProperty("isFulfilled")?L.then(t.hitch(this,function(z){u.resolve(z);this._showLoadingSpinner()}),t.hitch(this,function(z){u.reject(z);this._showLoadingSpinner()})):(u.resolve(L),this._showLoadingSpinner())}catch(z){u.reject(z),this._showLoadingSpinner()}}));this._requestQueueTail=u;this._showLoadingSpinner();return u.promise},_createDnD:function(){this._dnd=new oa(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){ma.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),
this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&this._restoreMapTimeExtent(),this._useTrafficItemNode.title=B.widgets.directions.trafficLabelLive,M.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();else{var c=this,h=function(){this._keepDirections||c._clearDisplayBeforeSolve();this._keepDirections=!1},u=t.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),L=t.hitch(this,function(){this.map&&
this.map.enableKeyboardNavigation()});this._departAtTime=new n({required:!0,value:new Date,onChange:h,onFocus:u,onBlur:L},this._departAtTimeContainer);this._departAtDate=new l({required:!0,value:new Date,onChange:h,onFocus:u,onBlur:L,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},_setStartTime:function(c,h,u){if(isNaN(u))this.startTime="now"===u?u:"none";else{h=u instanceof Date?u:new Date(u);u=this.directions&&this.directions.features&&this.directions.features[0]&&this.directions.features[0].attributes;
var L=6E4*-h.getTimezoneOffset();h=new Date(h-L+(u&&u.arriveTimeUTC?u.ETA-u.arriveTimeUTC:L));this._departAtTime._keepDirections=!c;this._departAtDate._keepDirections=!c;this._departAtTime.setValue(h);this._departAtDate.setValue(h)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var c=this._getImpedanceAttribute();c=this._isTimeUnits(c?c.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;this._startTimeButtonNode.disabled=!c;M[c?"remove":"add"].apply(this,
[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);M[c?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);c||this.set("startTime","now")},_usingAGOL:function(c){c||(c=this.routeTaskUrl);return-1<c.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var c={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,
enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=t.mixin({maxResults:1,locationToAddressDistance:100},this.defaults.searchOptions,c)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var c="EN-US"===O.locale.toUpperCase()?ea.MILES:ea.KILOMETERS;this.defaults.directionsLengthUnits?c=this.defaults.directionsLengthUnits:this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(c=this.userOptions.routeParams.directionsLengthUnits);this.set("directionsLengthUnits",
c)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&!this.trafficLayer&&(this.trafficLayer=new Ba(Xa+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&
!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(c,h){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);h||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(c,h){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);h||this.canModifyStops||
!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,M.remove(this._startTimeButtonNodeContainer,"departAtButton"),M.remove(this._departAtContainer,"departAtContainerVisible")):(M.add(this._startTimeButtonNodeContainer,"departAtButton"),M.add(this._departAtContainer,
"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();this.set(this.defaults);this.routeLayer=t.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(c){var h=new N;c?this.get("loaded")?this._reset().then(t.hitch(this,
function(){this._addStops(c).then(h.resolve,h.reject)}),h.reject):this._addStops(c).then(h.resolve,h.reject):h.reject();return h.promise},_removeStop:function(c,h,u,L){var z=new N,aa=t.hitch(this,function(fa){this.stops.splice(fa,1);var ja=this._dnd.getAllNodes()[fa],ua=this.get("geocoders");this._geocoderEvents[ja.id]&&(this._geocoderEvents[ja.id].blur.remove(),this._geocoderEvents[ja.id].select.remove(),this._geocoderEvents[ja.id].suggest.remove(),this._geocoderEvents[ja.id].value.unwatch());ua[fa].destroy();
ua.splice(fa,1);this.set("geocoders",ua);ma.destroy(ja);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders()});if(0>c||c>=this.stops.length||void 0===c)c=this.stops.length-1;var ca=!1;for(L=this.stopGraphics[c]&&this._isStopAWaypoint(this.stops[c])||L;!ca;)aa(c),L?ca=!0:(c-=0>=c||c<this.stops.length&&this._isStopAWaypoint(this.stops[c])?0:1,ca=!this._isStopAWaypoint(this.stops[c]));for(;this.stops.length-this._getWaypointCount()<
this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();u?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),this.createRouteSymbols(),z.resolve()):this._solveAndZoom(h).then(z.resolve,z.reject);return z.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);this._trafficLayerAdded=!1},_addStops:function(c,h){var u=new N,L=[],z=this.autoSolve;this.autoSolve=!1;void 0===h&&(h=this._getStopCount());
for(var aa=0;aa<Math.min(c.length,this.maxStops-this._getStopCount());aa++){var ca=new N;this._addStop(c[aa],h+aa,!0).always(ca.resolve);L.push(ca)}pa(L).always(t.hitch(this,function(){this.autoSolve=z;this._getDirections().always(function(){u.resolve(c)})}));return u.promise},_addStop:function(c,h,u){var L=new N;this._checkMaxStops();this.maxStopsReached?(this._showMessage(B.widgets.directions.error.maximumStops),L.reject(Error(B.widgets.directions.error.maximumStops))):(void 0===c&&void 0===h&&
(h=this.stops.length),c instanceof A&&c.attributes&&c.attributes.isWaypoint&&(!h||h===this.stops.length||2>this._getStopCount())&&!u?(this._showMessage(B.widgets.directions.error.waypointShouldBeInBetweenStops),L.reject(Error(B.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(c).then(t.hitch(this,function(z){this._isStopAWaypoint(z)&&z&&z.feature&&(z.feature.attributes=t.mixin({},z.feature.attributes,{isWaypoint:!0,CurbApproach:3}));this._insertStop(z,h);this.autoSolve&&
""!==z.name?this._getDirections().always(function(){L.resolve(z,h)}):L.resolve(z,h)}),t.hitch(this,function(z){L.reject(z)})));return L.promise},_removeEmptyStops:function(){for(var c=0,h=this.stops.length-this._getWaypointCount()-this.minStops;c<this.stops.length&&0<h;)this.stops[c]&&this.stops[c].name?c++:(this._removeStop(c,!0,!0,!0),h--,this._moveInProgress&&this._handle._index>=c&&this._handle._isStopIcon&&this._handle._index--)},_setReverseGeocode:function(c,h,u){if(c.feature.geometry&&-1<u){var L=
{address:c.name};this.stopGraphics[u]&&(t.mixin(this.stopGraphics[u].attributes,L),this.stopGraphics[u].setGeometry(h));this.textGraphics[u]&&(t.mixin(this.textGraphics[u].attributes,L),this.textGraphics[u].setGeometry(h));this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(L=this.geocoders[u])&&L.inputNode&&(L.value=c.name,L.inputNode.value=c.name);t.mixin(c.feature.attributes,this.stops[u].feature.attributes);this.stops[u]=c;this.stops[u].feature.setGeometry(h);
this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(c,h){var u;if(void 0===h)for(u=0;u<this.geocoders.length;u++){if(!this.geocoders[u].get("value")){var L=this.geocoders[u];break}}else u=h,this.geocoders[u]&&!this.geocoders[u].get("value")&&(L=this.geocoders[u]);!L||void 0!==h&&h!==u||this._isStopAWaypoint(c)?(void 0===h&&(h=this.geocoders.length),this.stops.splice(h,0,c),this._createGeocoder(c,h)):(this.stops[u]=c,L.set("value",c.name),L._stopReference=
c);this._optionsMenu()},_createGeocoder:function(c,h){var u=this._dnd.getAllNodes(),L=!1,z=!1,aa=u.length;u[h]?(z=u[h],L=!0):L=z=!1;var ca=t.hitch(this,function(sa,ya){var za=ya?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,Fa=ya?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;M.replace(sa.children[0],za,Fa);2<this.geocoders.length&&(za=ya?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,Fa=ya?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,
M.replace(sa.children[3].children[0],za,Fa))}),fa=ma.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(c)?"display:none;":"",onmouseover:function(){ca(this,!0)},onmouseout:function(){ca(this,!1)}});ma.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},fa);u=ma.create("td",{className:this._css.stopIconColumnClass},fa);ma.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(aa),"data-center-at":"true"},u);aa=ma.create("td",
{className:this._css.esriStopGeocoderColumnClass},fa);aa=ma.create("div",{},aa);u=ma.create("td",{className:this._css.stopIconRemoveColumnClass},fa);ma.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},u);this._dnd.insertNodes(!1,[fa],L,z);L=t.mixin({},this.get("searchOptions"),{value:c.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex});var ja=new cb(L,aa),ua=t.hitch(this,function(sa,ya){this._enqueue(function(){if(ya!==sa&&ja._stopReference&&
ja._stopReference.name!==ya){var za=Z.indexOf(this.stops,ja._stopReference);this.stops[za]={name:ya};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(za));this._setStops();this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this.createRouteSymbols()}})});ja._tr=fa;ja._stopReference=c;ja.startup();this.geocoders.splice(h,0,ja);this._geocoderEvents[fa.id]={blur:ja.on("blur",function(){""!==this.value&&this._stopReference&&!this._stopReference.feature&&
this.search()}),select:ja.on("select-result",t.hitch(this,function(sa){var ya=!0;if(sa&&(sa.results||sa.result)){var za=this._dnd.getAllNodes();za=Z.indexOf(za,fa);var Fa=ja.value,Da=sa.results&&sa.results.results&&sa.results.results.length?sa.results.results[0]:sa.result;Da?(Da.name=Fa,this.stops[za]=this._toPointGeometry(Da),this.geocoders[za]._stopReference=this.stops[za],ua("",Fa)):(this.removeStop(za),this.set("directions",null),this._showMessage(B.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
sa.target.get("value"))),this._clearRouteGraphics(),ya=!1);ya&&this.getDirections()}})),suggest:ja.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var sa=C("LI[role\x3d'menuitem']",this.suggestionsNode),ya=0;ya<sa.length;ya++)R.set(sa[ya],"tabindex",-1);else this._hideSuggestionsMenu()}),value:ja.watch("value",function(sa,ya,za){ua(ya,za)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var c=
0;c<this.geocoders.length;c++)if(this.geocoders[c].inputNode===document.activeElement){this.geocoders[c]._hideSuggestionsMenu();this.geocoders[c].inputNode.blur();1<this._getStopCount()+this._getWaypointCount()&&this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(c){c&&", , "===c.name&&(c.name=c.feature&&c.feature.attributes&&c.feature.attributes.Match_addr?c.feature.attributes.Match_addr+("POI"===c.feature.attributes.Addr_type&&c.feature.attributes.City&&-1===c.feature.attributes.Match_addr.indexOf(c.feature.attributes.City)?
", "+c.feature.attributes.City:""):"");return c},_toPointGeometry:function(c){var h=c.feature.geometry;h&&(h.getCentroid?c.feature.geometry=h.getCentroid():h.getExtent&&(h=h.getExtent())&&(c.feature.geometry=h.getCenter()));return c},_removeLocateButtonVisibilityEvents:function(){for(var c=0;c<this.geocoders.length;c++){var h=this.geocoders[c];h._onMouseEnter&&h._onMouseEnter.remove();h._onMouseOut&&h._onMouseOut.remove();h._onKeyPress&&h._onKeyPress.remove();h._locateButton&&(h._locateButton._onMouseEnter&&
h._locateButton._onMouseEnter.remove(),h._locateButton._onMouseOut&&h._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();for(var c=this,h=function(ja){ja instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;c._createLocateButton(this._geocoder,!0)},u=function(ja){ja instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=
setTimeout(t.hitch(this,function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||c._destroyLocateButton(this._locateButton)}),400)},L=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(t.hitch(this,function(){""===this.value?c._createLocateButton(this._geocoder,!0):c._destroyLocateButton(this._locateButton)}),400)},z=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},aa=function(){this._geocoder._lbShown_lb=
!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(t.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||c._destroyLocateButton(this._geocoder.inputNode._locateButton)}),400)},ca=0;ca<this.geocoders.length;ca++){var fa=this.geocoders[ca];fa&&fa.inputNode&&(fa.inputNode._geocoder=fa,fa._onMouseEnter=H(fa.inputNode,v.enter,h),fa._onMouseOut=H(fa.inputNode,[v.leave,"blur"],u),fa._onKeyPress=H(fa.inputNode,"keydown",L),fa.inputNode._locateButton&&
(fa=fa.inputNode._locateButton,fa._onMouseEnter=H(fa.domNode,v.enter,z),fa._onMouseOut=H(fa.domNode,v.leave,aa)))}},_createLocateButton:function(c,h,u){var L=new N;c.inputNode._locateButton&&c.inputNode._locateButton._locating?L.resolve():V(["./LocateButton"],t.hitch(this,function(z){this._destroyLocateButton(c.inputNode._locateButton);if(c&&!this._solveInProgress){var aa=ma.create("div",{},c.domNode);M.add(c.domNode,this._css.stopsInnerGeocoderClass);var ca=new z({map:this.map,highlightLocation:!1,
centerAt:!1,setScale:!1,useTracking:!1},aa);ca.startup();c.inputNode._locateButton=ca;ca.domNode._geocoder=c;this._setLocateButtonVisibilityEvents();z=t.hitch(this,function(){ca._locating=!0;c.set("value","");c.inputNode.placeholder=B.widgets.directions.retrievingMyLocation.toUpperCase()});ca._onBeforeLocate=H(ca._locateNode,F,z);ca._onLocate=H(ca,"locate",t.hitch(this,function(fa){ca._locating=!1;fa.graphic?(h&&this._destroyLocateButton(c.inputNode._locateButton),this.updateStop(new A(fa.graphic.geometry),
Z.indexOf(this.geocoders,c)).then(t.hitch(this,function(){1<this.stopGraphics.length?this.getDirections().always(function(){L.resolve(fa)}):L.resolve(fa)}))):(c.set("value",""),c.inputNode.placeholder=B.widgets.directions.myLocationError.toUpperCase(),console.error(fa.error),L.reject(fa.error))}));u?(z(),ca.locate().then(null,L.reject)):L.resolve()}else L.resolve()}));return L.promise},_destroyLocateButton:function(c){if(c){var h=c.domNode._geocoder;clearTimeout(h._destroyTimeout);c._locating?h._destroyTimeout=
setTimeout(t.hitch(this,function(){h._lbShown_lb||h._lbShown_f||this._destroyLocateButton(c)}),100):(c.clear(),c._onBeforeLocate.remove(),c._onLocate.remove(),c._onMouseEnter&&c._onMouseEnter.remove(),c._onMouseOut&&c._onMouseOut.remove(),c.destroy(),h.inputNode&&(h.inputNode._locateButton=null,h._setPlaceholder(h.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(t.hitch(this,function(c,h){for(var u,L,z=0;z<this.get("geocoders").length;z++)this.geocoders[z]._stopReference===
c?u=z:this.geocoders[z]._stopReference===h&&(L=z);return u>L?1:L>u?-1:0})),this._setStops())},_getCandidate:function(c){var h=new N,u=typeof c;c?"object"===u&&c.hasOwnProperty("feature")&&c.hasOwnProperty("name")?(c.feature.attributes&&void 0!==c.feature.attributes.displayName&&!this._isStopAWaypoint(c)&&(c.name=c.feature.attributes.displayName,c.feature.attributes.Name=this._userDefinedStopName),c.name=this._isStopAWaypoint(c)?this._waypointName:String(c.name),"point"!==c.feature.geometry.type&&
(c.feature.geometry=new X([c.feature.geometry.x,c.feature.geometry.y],this.map.spatialReference)),h.resolve(c)):"object"===u&&c.hasOwnProperty("address")&&c.hasOwnProperty("location")?(c=this._globalGeocoder._hydrateResult(c),h.resolve(c)):"object"!==u||!c.hasOwnProperty("name")||null!==c.name&&""!==c.name?c instanceof A&&c.attributes&&(void 0!==c.attributes.Name||c.attributes.isWaypoint)?(u=this._addStopWrapperToGraphic(c,c.attributes.isWaypoint?this._waypointName:String(c.attributes.Name)),String(c.attributes.Name)&&
(u.feature.attributes.Name=this._userDefinedStopName),h.resolve(u)):("object"===u&&c.hasOwnProperty("name")&&(c=String(c.name)),this._reverseGeocode(c).then(h.resolve,h.reject)):h.resolve(t.clone(this._emptyStop)):h.resolve(t.clone(this._emptyStop));return h.promise},_reverseGeocode:function(c){var h=new N,u,L=c.geometry?c.geometry:c;if(this._globalGeocoder){var z=t.hitch(this,function(ja){var ua=new N,sa=500;if(this.map){var ya=this.map.toScreen(L);ya.x+=r._calculateClickTolerance([ja]);this.map.spatialReference.isWebMercator()?
(sa=Math.abs(this.map.toMap(ya).x-L.x),ua.resolve(sa)):4326===this.map.spatialReference.wkid?(sa=Math.abs(f.geographicToWebMercator(this.map.toMap(ya)).x-f.geographicToWebMercator(L).x),ua.resolve(sa)):this._geometryService&&(ja=new Aa,ja.distanceUnit=xa.UNIT_METER,ja.geometry1=L,ja.geometry2=this.map.toMap(ya),this._geometryService.distance(ja,function(za){sa=za;ua.resolve(sa)},function(){ua.resolve(sa)}))}return ua.promise}),aa=[],ca=this._globalGeocoder.sources,fa=function(){ca[u].featureLayer&&
aa.push(z(ca[u].featureLayer).then(t.hitch(ca[u],function(ja){this.searchQueryParams=t.mixin(this.searchQueryParams,{distance:ja})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(u=0;u<ca.length;u++)fa();else u=this._globalGeocoder.activeSourceIndex,fa();pa(aa).always(t.hitch(this,function(){this._globalGeocoder.search(L).then(t.hitch(this,function(ja){var ua=!1;if(ja){var sa=null;for(u=0;u<this._globalGeocoder.sources.length;u++)if(ja[u]&&ja[u].length){var ya=ja[u];break}if(ya.length&&
(ua=!0,sa=ya[0],this._globalGeocoder.sources[u].featureLayer))for(ja=Number.POSITIVE_INFINITY,u=0;u<ya.length;u++){ya[u]=this._toPointGeometry(ya[u]);var za=D.geodesicLengths([new ra({paths:[[f.xyToLngLat(L.x,L.y),f.xyToLngLat(ya[u].feature.geometry.x,ya[u].feature.geometry.y)]],spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];ja>za&&(ja=za,sa=ya[u])}(sa=this._decorateEmptyAGOLGeocoderResponse(sa))&&""!==sa.name&&null!==sa.name&&void 0!==sa.name?(sa.name=String(sa.name),
isNaN(L.x)||isNaN(L.y)||this.map.spatialReference.wkid!==L.spatialReference.wkid?!sa.feature.geometry||isNaN(sa.feature.geometry.x)||isNaN(sa.feature.geometry.y)?(this._showMessage(B.widgets.directions.error.locator),h.reject(Error(B.widgets.directions.error.locator))):h.resolve(sa):(sa.feature.geometry=L,h.resolve(sa))):ua=!1}ua||(c instanceof X?c=new A(c):c instanceof Array&&(c=new A(new X(c[0],c[1]))),c instanceof A?this._decorateUngeocodedStop(c).then(h.resolve,h.reject):(this._showMessage(B.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
c.toString())),h.reject(Error(B.widgets.directions.error.unknownStop.replace("\x3cname\x3e",c.toString())))))}))}))}else this._showMessage(B.widgets.directions.error.locatorUndefined),h.reject(Error(B.widgets.directions.error.locatorUndefined));return h.promise},_updateStop:function(c,h,u){var L=new N;this.stops&&this.stops[h]?c instanceof A&&c.attributes&&c.attributes.isWaypoint&&(!h||h===this.stops.length-1||2>this._getStopCount())?(this._showMessage(B.widgets.directions.error.waypointShouldBeInBetweenStops),
L.reject(Error(B.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(c).then(t.hitch(this,function(z){var aa=z.feature;aa=aa?aa.geometry:null;var ca=this.stops[h].feature;ca=ca?ca.geometry:null;aa=aa&&ca&&(aa.x!==ca.x||aa.y!==ca.y)||!aa&&ca;this.stops[h]=z;this.geocoders[h]||this._createGeocoder(z,h);ca=this.geocoders[h];ca._stopReference=z;ca._tr.style.display=this._isStopAWaypoint(z)?"none":"";ca.value=z.name;ca.inputNode&&(ca.inputNode.value=z.name);aa&&this.autoSolve&&
1<this._getStopCount()+this._getWaypointCount()||u?this._getDirections().then(L.resolve,L.reject):(this._setStops(),L.resolve(z))}),t.hitch(this,function(z){L.reject(z)})):(this._showMessage(B.widgets.directions.error.couldNotUpdateStop),L.reject(Error(B.widgets.directions.error.couldNotUpdateStop)));this._optionsMenu();return L.promise},_renderDirections:function(){var c=this.get("directions");if(this._resultsNode){var h='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';h+=this._renderDirectionsSummary(c);
h+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';h+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';h+=this._renderDirectionsTable(c);h+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=h);this._disconnectResults();(c=C("[data-segment]",this._resultsNode))&&c.length&&Z.forEach(c,t.hitch(this,function(u){this._resultEvents.push(H(u,v.enter,t.hitch(this,function(){if(!this._focusedDirectionsItem){var L=parseInt(R.get(u,"data-segment"),10);this.highlightSegment(L)}})));
this._resultEvents.push(H(u,"focusout",t.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(H(u,v.leave,this.unhighlightSegment));this._resultEvents.push(H(u,"click, keydown",t.hitch(this,function(L){L&&("click"===L.type||"keydown"===L.type&&L.keyCode===w.ENTER)&&(this._focusedDirectionsItem!==u?this.selectSegment(parseInt(R.get(u,"data-segment"),10)):(u.blur(),this.map.infoWindow.hide(),this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))}))}},
_renderDirectionsSummary:function(c){var h="",u=t.hitch(this,function(){for(var ca={},fa=this._getDirectionsTimeAttribute()||{},ja=this._getTimeNeutralAttribute()||{},ua=0,sa=0,ya=this.get("stops"),za=ya.length-1;0<=za;za--)if(null!==ya[za].feature.attributes.ArriveCurbApproach){ca=ya[za].feature.attributes;break}for(var Fa in ca)ca.hasOwnProperty(Fa)&&(Fa==="Cumul_"+fa.name&&(ua=ca[Fa]),Fa==="Cumul_"+ja.name&&(sa=ca[Fa]));ca="esriTrafficLabelHidden";ya=B.widgets.directions.noTraffic;za=c.totalTime-
c.totalDriveTime;za=(sa-this._convertCostValue(za,fa.units,ja.units))/(ua-za||1);0<za&&.8>za?(ca="esriTrafficLabelHeavy",ya=B.widgets.directions.heavyTraffic):1===za?(ca="esriTrafficLabelNone",ya=B.widgets.directions.noTraffic):1.25<za&&(ca="esriTrafficLabelLight",ya=B.widgets.directions.ligthTraffic);ja=this._formatTime(sa,!1,ja.units);return{label:ya,labelClass:ca,ratio:za,noTrafficCostStr:1!==za&&ja?ja+" "+B.widgets.directions.onAverage+"\x3cbr\x3e":"",trafficCost:ua,noTrafficCost:sa,timeAtt:fa}});
if(c.totalLength||c.totalTime){u=u();var L=this._getImpedanceAttribute();h+="\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e";if(this._isTimeUnits(L.units))h+=this._formatTime(u.trafficCost,!0,u.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+B.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+B.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+
(u.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+u.labelClass+"'\x3e"+u.label+"\x3c/div\x3e"+u.noTrafficCostStr:"")+this._formatDistance(c.totalLength);else{L=(L=B.widgets.directions.units[this.directionsLengthUnits])?L.name:"";var z=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,aa=this.directions.features[0].attributes;h+=a.format(c.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+L+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+
(u.noTrafficCost&&z?"\x3cdiv class\x3d'esriTrafficLabel "+u.labelClass+"'\x3e"+u.label+"\x3c/div\x3e"+u.noTrafficCostStr:"")+this._formatTime(c.totalTime)+" "+("none"!==this.startTime&&u.noTrafficCost&&z?B.widgets.directions.atTheMoment+" "+this._toSpatiallyLocalTimeString(aa.arriveTimeUTC,aa.ETA):"")}h+="\x3c/div\x3e\x3c/div\x3e"}return h},_renderDirectionsTable:function(c){for(var h=0,u=0,L=0,z='\x3ctable summary\x3d"'+c.routeName+'"\x3e\x3ctbody role\x3d"menu"\x3e',aa=0;aa<c.features.length;aa++){var ca=
c.features[aa].attributes;"esriDMTDepart"===ca.maneuverType&&(u=L=0);L+=ca.length;u+=ca.time;h+=ca.time;z+=this._renderDirectionsItemTR(c.features[aa],L,u,h)}return z+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(c,h,u,L){var z=this.directions,aa=z?Z.indexOf(z.features,c):-1;L="";var ca=this._css.routeClass,fa=c._associatedStopWithReturnToStart&&c._associatedStopWithReturnToStart.attributes,ja=c.attributes;if(-1<aa){ja&&(ja.step=aa+1);ja.maneuverType&&(ca+=" "+ja.maneuverType);
fa&&null===fa.ArriveCurbApproach&&null!==fa.DepartCurbApproach?ca+=" "+this._css.routeOriginClass:fa&&null!==fa.ArriveCurbApproach&&null===fa.DepartCurbApproach&&(ca+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);L+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+ca+" "+this._css.routeZoomClass+'" data-segment\x3d"'+aa+'"\x3e';L+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';L+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';L+=this._getLetter(c._associatedStop);
L=L+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"'+(this._css.routeTextColumnClass+'"\x3e');L+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';L+='\x3cdiv class\x3d"'+this._css.routeTextClass+'"\x3e';c=(z.strings[aa]||[]).slice();if("esriDMTDepart"===ja.maneuverType||"esriDMTStop"===ja.maneuverType)for(z=0;z<this.stops.length;z++)this.stops[z]&&this.stops[z].name&&c.push({string:this.stops[z].name});if(c){ca=ja.text;for(z=0;z<c.length;z++)ca=this._boldText(ca,c[z].string);ja.formattedText=ca}else ja.formattedText=
ja.text;if("esriDMTStop"===ja.maneuverType&&(h||u)||"esriDMTDepart"===ja.maneuverType&&0===aa)h=this._formatDistance(h-ja.length,!0),u=this._formatTime(u-ja.time),aa=this._formatTime(ja.time),c=this._formatDistance(ja.length,!0),ja.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+h+(h&&u?" \x26middot; ":"")+u+(h||u?"\x3cbr\x3e":"")+(aa?B.widgets.directions.serviceTime+":\x26nbsp;"+aa:"")+(aa&&c?"\x3cbr\x3e":"")+(c?B.widgets.directions.serviceDistance+":\x26nbsp;"+c:"")+"\x3c/div\x3e";
L+="\x3cstrong\x3e"+a.format(ja.step)+".\x3c/strong\x3e "+ja.formattedText;L+="\x3c/div\x3e";h=this._formatDistance(ja.length,!0);u=this._formatTime(ja.time);"esriDMTStop"!==ja.maneuverType&&"esriDMTDepart"!==ja.maneuverType||!this.routeParams.startTime||-22091616E5===ja.ETA?h&&(L+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',L+=h,u&&(L+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+u),L+="\x3c/div\x3e"):L+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._toSpatiallyLocalTimeString(ja.arriveTimeUTC,
ja.ETA)+"\x3c/div\x3e";L+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return L},_toSpatiallyLocalTimeString:function(c,h){var u=new Date(h),L=new Date(u.getTime()+6E4*u.getTimezoneOffset());L=O.date.locale.format(L,{selector:"time"});var z="";c?(h=(h-c)/1E3/60/60,c=Math.floor(h),h=60*(h-c),c=B.widgets.directions.GMT+(0>c?"":"+")+a.format(c,{pattern:"00"})+a.format(h,{pattern:"00"}),z=L+" "+c):z="now"===this.startTime?O.date.locale.format(u,{selector:"time"}):L;return z},_addStopWrapperToGraphic:function(c,
h){return{extent:new ba({xmin:c.geometry.x-.25,ymin:c.geometry.y-.25,xmax:c.geometry.x+.25,ymax:c.geometry.y+.25,spatialReference:c.geometry.spatialReference}),feature:c,name:h}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},_showBarriers:function(){this._clearBarriersGraphics();var c=this.routeParams,h=c.polylineBarriers&&c.polylineBarriers.features||[],u=c.polygonBarriers&&c.polygonBarriers.features||[];Z.forEach(c.barriers&&
c.barriers.features||[],t.hitch(this,function(L){this._barriersLayer.add(L)}));Z.forEach(h,t.hitch(this,function(L){this._polylineBarriersLayer.add(L)}));Z.forEach(u,t.hitch(this,function(L){this._polygonBarriersLayer.add(L)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();this._polygonBarriersLayer.refresh()},_showRoute:function(c){this._clearDisplayAfterSolve();var h=c.routeResults[0].directions,u=new N;if(h){this.set("solveResult",c);this.set("directions",h);var L=c.routeResults[0].stops,
z,aa;if(L&&L.length){var ca=[];for(z=0;z<L.length;z++){var fa=L[z];fa.attributes.isWaypoint=fa.attributes.Name===this._waypointName||fa.attributes.isWaypoint;fa=this._addStopWrapperToGraphic(fa,fa.attributes.Name);this.stops[z]&&this.stops[z].feature&&this.stops[z].feature.attributes&&this.stops[z].feature.attributes.Name===this._userDefinedStopName&&(fa.feature.attributes.Name=this._userDefinedStopName);this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===z?this._returnToStartStop=
fa:ca.push(fa)}if(this.stops.length>ca.length)for(z=0;z<this.stops.length;z++)this.stops[z].feature||""!==this.stops[z].name||ca.splice(z,0,this._emptyStop);this.stops=ca;for(z=0;z<this.stops.length;z++)this._updateStop(this.stops[z],z);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new A(h.mergedGeometry,this.get("routeSymbol")));L=[];ca=[];for(z=fa=0;z<h.featuresWithWaypoints.length;z++){var ja=h.featuresWithWaypoints[z];if("esriDMTDepart"===ja.attributes.maneuverType)for(aa=
0;aa<this.stops.length;aa++)if(this.stops[aa].feature===ja._associatedStop){fa=aa+1;break}ja.setSymbol(this.get("routeSymbol"));this._routeLayer.add(ja);L.push(ja);(aa=ja.getDojoShape())&&aa.moveToBack();aa=new A(ja.geometry,this._symbolEventPaddingDirections,ja.attributes);aa._nextStopIndex=fa-.5;aa._isSnapFeature=!0;ja._associatedSnapFeature=aa;this._waypointsEventLayer.add(aa);"esriDMTDepart"!==ja.attributes.maneuverType&&(aa=ja.geometry.getPoint(0,0))&&(aa=new A(aa,this.maneuverSymbol),aa._directionsFeature=
ja._associatedFeatureNoWaypoints,ca.push(aa),this._waypointsEventLayer.add(ca[ca.length-1]))}this.set("displayedRouteGraphics",L);this.set("displayedManeuverPointGraphics",ca);this._renderDirections();for(z=0;z<this.stops.length;z++)if(this._isStopAWaypoint(this.stops[z])&&this._modifiedWaypointIndex===z){for(aa=0;aa<h.featuresWithWaypoints.length;aa++)if(L=h.featuresWithWaypoints[aa],L._associatedStop===this.stops[z].feature){if("esriDMTStop"===L.attributes.maneuverType||"esriDMTDepart"===L.attributes.maneuverType)this.stops[z].feature.geometry.x=
L.geometry.paths[0][0][0],this.stops[z].feature.geometry.y=L.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=null;break}T.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(c)}else c=c.routeResults[0].route,c.setSymbol(this.routeSymbol),this._routeLayer.add(c),this._incrementalRouteSegment=c;u.resolve();this._moveLayersToFront();this.createRouteSymbols();return u.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var c=0;c<this.geocoders.length;c++)this.geocoders[c]&&
this.stops[c]&&(this.geocoders[c]._stopReference=this.stops[c])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(c){var h=[];if(c&&c.length){for(var u=0;u<c.length;u++)h.push(this._getCandidate(c[u]));return pa(h)}c=new N;c.resolve([]);return c.promise},_clearResultsHTML:function(){this._resultsNode.innerHTML="";T.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(c){if(c&&
this.get("showSegmentPopup")&&this.get("map").infoWindow){var h=c.geometry.getPoint(0,0);c=new A(h,null,c.attributes,this.get("segmentInfoTemplate"));var u=this.get("map").infoWindow;u.setFeatures([c]);u.show(h)}},_addStopButton:function(){this.addStop().then(t.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-1].focus()}))},_sortGeocoders:function(){var c=this._dnd.getAllNodes();this.geocoders.sort(t.hitch(this,function(u,L){return u.domNode&&u.domNode.parentNode&&
u.domNode.parentNode.parentNode&&L.domNode&&L.domNode.parentNode&&L.domNode.parentNode.parentNode?Z.indexOf(c,u.domNode.parentNode.parentNode)>Z.indexOf(c,L.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var h=0;h<this.geocoders.length;h++)this.geocoders[h]&&this.geocoders[h].inputNode&&(this.geocoders[h].inputNode.title=B.widgets.directions.stopNoTitle+(h+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&
this._resultEvents.length)for(var c=0;c<this._resultEvents.length;c++)this._resultEvents[c]&&this._resultEvents[c].remove();this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(c){var h="",u;for(u in c)if(0===u.indexOf("Total_")&&c.hasOwnProperty(u)){var L=this._getCostAttribute(u.substr(6));L&&(h+=this._isTimeUnits(L.units)?this._formatTime(c[u],!1,L.units):this._formatDistance(c[u],!0,L.units),h+=h?" \x26middot; ":"")}h&&(h=B.widgets.directions.toNearbyStops+": \x3cb\x3e"+h.substr(0,
h.length-10)+"\x3c/b\x3e");return h},_formatTime:function(c,h,u){u||(u=(this._getDirectionsTimeAttribute()||{}).units);var L="";u=Math.round(this._convertCostValue(c,u,"esriNAUMinutes"));c=Math.floor(u/60);u=Math.floor(u%60);h?L=a.format(c,{pattern:100>c?"00":"000"})+":"+a.format(u,{pattern:"00"}):(c&&(L+=c+" "+B.widgets.directions.time.hr+" "),L+=c||u?u+" "+B.widgets.directions.time.min:"");return L},_formatDistance:function(c,h,u){u||(u=this.directionsLengthUnits);var L=this.directionsLengthUnits,
z=B.widgets.directions.units[L],aa=L.replace("esri","").toLowerCase();c=this._convertCostValue(c,u,L);z&&(aa=h?z.abbr:z.name);return c?a.format(c,{locale:"root",places:2})+" "+aa:""},_projectToGeographic:function(c){var h=new N;if(!c)return h.reject("Directions:: 'geometry' is not defined.",{geometry:c}),h.promise;if(4326==c.spatialReference.wkid)return h.resolve(c),h.promise;if(!this._geometryService)return h.reject("Directions:: Geometry service is not defined."),h.promise;var u=new Ya;u.outSR=
new wa(4326);u.geometries=[c];this._geometryService.project(u).then(function(L){h.resolve(L&&L[0])},h.reject);return h.promise},_createToolbars:function(){this.editToolbar||(this.editToolbar=new Oa(this.map));this.drawToolbar||(this.drawToolbar=new Va(this.map),B.toolbars.draw.freehand=B.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=t.hitch(this,function(c){var h=new A(c.geometry,null,{BarrierType:0});this._projectToGeographic(c.geographicGeometry||c.geometry).then(t.hitch(this,
function(u){1<D.geodesicLengths([u],ea.METERS)[0]&&(this._polylineBarriersLayer.add(h),this.routeParams.polylineBarriers||(this.routeParams.polylineBarriers=new S),this.routeParams.polylineBarriers.features.push(h),this._clearStopsStatusAttr(),this.getDirections(!0))}))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var c=new N;this._globalGeocoder=new cb(this.get("searchOptions"));H.once(this._globalGeocoder,
"load",c.resolve,c.reject);this._globalGeocoder.startup();return c.promise},_init:function(){var c=new N;this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,!1);T.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(c.resolve);else H.once(this.get("map"),"load",t.hitch(this,function(){this._configure().always(c.resolve)}));return c.promise},_setDefaultStops:function(){var c=new N;this.defaults.stops&&this.defaults.stops.length?
this._updateStops(this.defaults.stops).then(t.hitch(this,function(){this._removeEmptyStops();c.resolve()}),c.reject):c.resolve();return c.promise},_configure:function(){var c=new N;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(t.hitch(this,function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();
this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var h=[this._createRouteTask(),this._setDefaultStops()];pa(h).then(t.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var u=this.directionsLanguage||this.userOptions.routeParams&&this.userOptions.routeParams.directionsLanguage||O.locale.toLowerCase();this._setDirectionsLanguageByLocale(u);this._setupTravelModes().then(t.hitch(this,function(){this.set("loaded",
!0);this.onLoad();c.resolve(!0)}),function(L){c.reject(L)})}),function(u){c.reject(u)})}),function(h){c.reject(h)});this._naRouteSharing=null;return c.promise},_setDirectionsLanguageByLocale:function(c){var h=this.serviceDescription.directionsSupportedLanguages,u=function(z){if(h)for(var aa=0;aa<h.length;aa++)if(h[aa].toLowerCase().substr(0,2)===z)return h[aa];return null},L=u(c);L||(c=c.substr(0,2),L=u(c));this.directionsLanguage=L;return this.routeParams.directionsLanguage=L},_getStopSymbol:function(c,
h){var u=c&&(c.feature&&c.feature.attributes||c.attributes),L=this.stopSymbol;u&&(L=this._isStopAWaypoint(c)?this.waypointSymbol:void 0===u.Status||0===u.Status||6===u.Status?null===u.ArriveCurbApproach&&null!==u.DepartCurbApproach?this.get(h?"fromSymbolDrag":"fromSymbol"):null!==u.ArriveCurbApproach&&null===u.DepartCurbApproach?this.get(h?"toSymbolDrag":"toSymbol"):this.get(h?"stopSymbolDrag":"stopSymbol"):this.get(h?"unreachedSymbolDrag":"unreachedSymbol"));return L},_addTrafficLayer:function(){this.trafficLayer&&
!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(c){c.target===this._useMilesNode?this.setDirectionsLengthUnits(ea.MILES):c.target===this._useKilometersNode&&this.setDirectionsLengthUnits(ea.KILOMETERS)},_toggleCheckbox:function(c){var h=R.get(c.target,"checked");c.target===this._findOptimalOrderNode?this.set("optimalRoute",h):c.target===this._useTrafficNode?this.set("traffic",h):c.target===this._returnToStartNode&&
this.set("returnToStart",h)},_isStopLocated:function(c){return c&&c.feature&&c.feature.attributes&&(!c.feature.attributes.Status||6===c.feature.attributes.Status)},_configureRouteOptions:function(){var c=this.get("routeParams"),h;this.get("directionsLengthUnits")?c.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",c.directionsLengthUnits);c.findBestSequence=this.get("optimalRoute");if(c.findBestSequence)for(c.preserveFirstStop=this._isStopLocated(this.stops[0]),
c.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-1])||this.returnToStart&&this._isStopLocated(this.stops[0]),h=0;h<this.stops.length;)this._isStopAWaypoint(this.stops[h])?this._removeStop(h,!0,!0):h++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-1]))for(h=this.stops.length-1;0<h;)this._isStopAWaypoint(this.stops[h])&&this._removeStop(h,!0,!0),h--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||this.serviceDescription&&
10.6<=this.serviceDescription.currentVersion)if(c.useTimeWindows=!0,"now"===this.startTime)c.timeWindowsAreUTC=!0,c.startTimeIsUTC=!0,c.startTime=new Date;else if("none"===this.startTime)c.startTime=null;else{c.timeWindowsAreUTC=!1;c.startTimeIsUTC=!1;var u=this._departAtTime,L=6E4*u.getValue().getTimezoneOffset();u=new Date(u.getValue().getTime()+this._departAtDate.getValue().getTime()-L);u=new Date(u.getTime()-6E4*u.getTimezoneOffset());c.startTime=u}else c.startTime=null,c.useTimeWindows=!1;u=
this._getImpedanceAttribute();L=this._getTimeNeutralAttribute();var z=this._getDirectionsTimeAttribute();h=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;L&&-1===Z.indexOf(h,L.name)&&h.push(L.name);!this._isTimeUnits(u.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&z&&-1===Z.indexOf(h,z.name)&&h.push(z.name);this.routeParams.accumulateAttributes=h;c.returnStops=!0;z=[];for(h=0;h<this.stopGraphics.length;h++)if(this.stopGraphics[h]&&
(z.push(new A(this.stopGraphics[h].toJson())),h)){var aa=z[0].attributes,ca=z[h].attributes;for(fa in ca)ca.hasOwnProperty(fa)&&!aa.hasOwnProperty(fa)&&(aa[fa]=null)}if(this.get("returnToStart")&&this.stopGraphics.length&&this._isStopLocated(this.stops[0])){var fa=new A(this.stopGraphics[0].toJson());this._returnToStartStop=this._addStopWrapperToGraphic(fa,fa.attributes.Name);z.push(fa)}else this._returnToStartStop=null;c.stops.features=z;if(L)for(h=0;h<z.length;h++)z[h].attributes["Attr_"+L.name]=
this._convertCostValue(z[h].attributes["Attr_"+u.name],u.units,L.units);this.set("routeParams",c)},_configureRoute:function(){var c=new N;c.promise.always(t.hitch(this,function(){this._checkMaxStops()}));this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var h=this._incrementalSolveStopRange;h.start<h.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(h.start,h.end+1):h.start>h.end&&(this.routeParams.stops.features=
this.routeParams.stops.features.slice(h.start,this.routeParams.stops.features.length-1).concat(this.routeParams.stops.features.slice(0,h.end+1)))}else this._incrementalSolveStopRange=null;var u={},L=this.routeParams.stops.features;for(h=0;h<L.length;h++){var z=L[h].attributes.address;var aa=(h===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:z)+"_"+this._stopSequence++;L[h].attributes.Name=aa;u[aa]=z;delete L[h].attributes.address;delete L[h].attributes.isWaypoint;
delete L[h].attributes.Status}this._solveInProgress=!0;var ca={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,t.hitch(this,function(fa){this._solveResultProcessing(fa,u,ca).then(c.resolve,c.reject)}),t.hitch(this,function(fa){t.mixin(this,ca);this._solveInProgress=!1;for(var ja=0;ja<this.stops.length;ja++)this.stops[ja].feature&&(this.stops[ja].feature.attributes=t.mixin(this.stops[ja].feature.attributes,{Status:5}));this.set("directions",null);this._clearDisplayAfterSolve();
this.createRouteSymbols();this._routeTaskError(fa);c.reject(fa)}));return c.promise},_solveResultProcessing:function(c,h,u){var L=new N;t.mixin(this,u);this._solveInProgress=!1;u=c.routeResults[0];var z=u.directions;u=u.stops;if(z){this._solverMessages=c.messages;var aa=function(sa){for(var ya in h)if(sa&&0===z.routeName.indexOf(ya)||!sa&&0<z.routeName.indexOf(ya))return h[ya];return""};var ca=aa(!0);aa=aa(!1);z.routeName=(ca!==this._waypointName?ca:B.widgets.directions.waypoint)+" \u2014 "+(aa!==
this._waypointName?aa:B.widgets.directions.waypoint);for(ca=0;ca<z.features.length;ca++)if(aa=z.features[ca].attributes,"esriDMTDepart"===aa.maneuverType||"esriDMTStop"===aa.maneuverType)for(var fa in h)if(h.hasOwnProperty(fa)&&-1<aa.text.indexOf(fa)){aa.text=aa.text.replace(fa,h[fa]);for(var ja=0;ja<u.length;ja++){var ua=u[ja].attributes;if(ua.Name===fa){t.mixin(z.features[ca],{_associatedStop:u[this.returnToStart&&ja===u.length-1?0:ja],_associatedStopWithReturnToStart:u[ja]});if(!ua.ArriveTime&&
!ua.ArriveTimeUTC&&aa.ETA&&aa.arriveTimeUTC){ua.ArriveTime=aa.ETA;ua.ArriveTimeUTC=aa.arriveTimeUTC;ja=0;if(0==ca&&"esriDMTDepart"===aa.maneuverType||0<ca&&"esriDMTStop"===aa.maneuverType)ja=this._convertCostValue(aa.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");ua.DepartTime=ua.ArriveTime+ja;ua.DepartTimeUTC=ua.ArriveTimeUTC+ja}break}}}for(ca=0;ca<u.length;ca++)this._returnToStartStop&&u[ca].attributes.Name===this._returnToStartStop.feature.attributes.Name&&(this._returnToStartStop._resultsStopIndex=
ca),u[ca].attributes.Name=h[u[ca].attributes.Name];this._directionsPostprocessing(z);this.traffic&&this._updateMapTimeExtent()}this._showRoute(c).always(t.hitch(this,function(){this._incrementalSolveStopRange=null;L.resolve(c)}));return L.promise},_directionsPostprocessing:function(c){var h,u=function(aa,ca){var fa=c.features[aa]._associatedFeaturesWithWaypoints||[];fa.push(c.featuresWithWaypoints[ca]);c.features[aa]._associatedFeaturesWithWaypoints=fa;c.featuresWithWaypoints[ca]._associatedFeatureNoWaypoints=
c.features[aa]};var L=t.hitch(this,function(aa){return"\x3cdiv class\x3d'"+this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(aa._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});c.featuresWithWaypoints=[];for(h=0;h<c.features.length;h++){var z=new A(c.features[h].toJson());z.setInfoTemplate(new qa({title:this._i18n.widgets.directions.maneuver,content:L}));c.featuresWithWaypoints.push(z);c.featuresWithWaypoints[h]._associatedStop=c.features[h]._associatedStop;
c.featuresWithWaypoints[h]._associatedStopWithReturnToStart=c.features[h]._associatedStopWithReturnToStart}c.stringsWithWaypoints=t.mixin([],c.strings);c.eventsWithWaypoints=t.mixin([],c.events);for(L=h=0;h<c.features.length;)c.features[h]._associatedStop&&c.features[h]._associatedStop.attributes.Name===this._waypointName?(c.features.splice(h,h?2:1),c.strings.splice(h,h?2:1),c.events.splice(h,h?2:1),h&&c.features[h]&&"esriDMTStraight"===c.features[h].attributes.maneuverType?(z=c.features.splice(h,
1)[0],c.strings[h-1]=(c.strings[h-1]||[]).concat(c.strings.splice(h,1)[0]||[]),c.strings[h-1].length||(c.strings[h-1]=void 0),c.events[h-1]=(c.events[h-1]||[]).concat(c.events.splice(h,1)[0]||[]),c.events[h-1].length||(c.events[h-1]=void 0),c.features[h-1].attributes.length+=z.attributes.length,c.features[h-1].attributes.time+=z.attributes.time,c.features[h-1].geometry.paths[0]=c.features[h-1].geometry.paths[0].concat(z.geometry.paths[0]),u(h-1,L++),u(h-1,L++),u(h-1,L++)):(h&&u(h-1,L++),h<c.features.length&&
u(h,L++))):(u(h,L++),h++)},_boldText:function(c,h){try{var u=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+h.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]","g");c=(" "+c+" ").replace(u,"\x3cstrong\x3e\x26nbsp;"+h+"\x26nbsp;\x3c/strong\x3e");c=c.trim()}catch(L){}return c},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var c=0;c<this.stopGraphics.length;c++)this._stopLayer.remove(this.stopGraphics[c]),this._stopLayer.remove(this.textGraphics[c]);
this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var c=this.directions&&this.directions.features[0]&&this.directions.features[0].attributes||{},h=(new Date).getTime();h="none"==this.startTime?h:c.arriveTimeUTC||h;this._useTrafficItemNode.title="none"!==this.startTime&&c.arriveTimeUTC?B.widgets.directions.trafficLabelDepartAt+": "+this._toSpatiallyLocalTimeString(c.arriveTimeUTC,c.ETA):"";this._myTimeExtentUpdate=!0;c=new Date(h);this.map.setTimeExtent(new ta(c,
c))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var c=this.displayedRouteGraphics,h=this.displayedManeuverPointGraphics,u=this._routeLayer,L=this._waypointsEventLayer,z=0,aa=0,ca=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};c&&aa<c.length;){if(c[aa]._associatedStop)for(var fa=0;fa<this.stops.length;fa++)if(this.stops[fa].feature===
c[aa]._associatedStop){z=fa;break}z>=ca.start&&z<ca.end||ca.start>=ca.end&&(z>=ca.start||z<ca.end)?(u.remove(c[aa]),c.splice(aa,1)):aa++}u.remove(this._incrementalRouteSegment);this.set("displayedRouteGraphics",c?c:[]);h&&h.length&&Z.forEach(h,function(ja){L.remove(ja)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();this.unhighlightSegment(!0)},_clearInfoWindow:function(){var c=this.get("map").infoWindow;c&&(c.hide(),c.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);
this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();this.clearMessages()},_getLetter:function(c){var h=this.alphabet,u="",L=function(ca){var fa="";"0123456789"===h||"1234567890"===h?fa=String(ca+1):(ca=ca||0,ca>=h.length&&(fa=L(Math.floor(ca/h.length)-1),ca%=h.length),fa+=h[ca]);return fa},z=c instanceof A?t.hitch(this,function(){for(var ca=this.get("returnToStart")?0:-1,fa=0;fa<this.stops.length;fa++)if(this.stops[fa].feature===
c){ca=fa;break}return ca})():c;if(-1<z&&h&&h.length){h instanceof Array&&(h=h.toString().replace(/,/g,""));u=-1;for(var aa=0;aa<=z;aa++)u+=this._isStopAWaypoint(this.stops[aa])?0:1;u=L(u)}return u},_solveAndZoom:function(c){if(this.autoSolve)return this._getDirections().then(t.hitch(this,function(){c||this.zoomToFullRoute()}));var h=new N;h.resolve();return h.promise},_setupEvents:function(){this._onEvents.push(H(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(H(this._dndNode,
"[data-reverse-stops]:click, [data-reverse-stops]:keydown",t.hitch(this,function(z){z&&("click"===z.type||"keydown"===z.type&&z.keyCode===w.ENTER)&&this.modifyStopSequence()})));this._onEvents.push(H(this._printButton,"click, keydown",t.hitch(this,function(z){z&&("click"===z.type||"keydown"===z.type&&z.keyCode===w.ENTER)&&this._printDirections()})));this._onEvents.push(H(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",t.hitch(this,function(z){z&&("click"===z.type||"keydown"===
z.type&&z.keyCode===w.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(H(this._dndNode,"[data-remove]:click, [data-remove]:keydown",t.hitch(this,function(z){if(z&&("click"===z.type||"keydown"===z.type&&z.keyCode===w.ENTER)){var aa=C("[data-remove]",this._dndNode);z=Z.indexOf(aa,z.target);this.removeStop(z)}})));this._onEvents.push(H(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",t.hitch(this,function(z){if(z&&("click"===z.type||"keydown"===z.type&&z.keyCode===w.ENTER)){var aa=
C("[data-center-at]",this._dndNode);z=Z.indexOf(aa,z.target);this.stops[z]&&this.stops[z].feature&&this.stops[z].feature.geometry&&this.map.centerAndZoom(this.stops[z].feature.geometry)}})));this._onEvents.push(H(this.map,"zoom-end",t.hitch(this,function(){var z=this._segmentGraphics;z&&z[0]&&void 0!==z[0].attributes._index&&this.highlightSegment(z[0].attributes._index,!0)})));this._onEvents.push(H(this._dnd,"Drop",t.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var z,aa=!1,ca=
[],fa=this._dnd.getAllNodes();for(z=0;z<this.geocoders.length;z++){var ja=Z.indexOf(fa,this.geocoders[z]._tr);if(-1<ja&&z!==ja&&z!==ja-1){for(;0<ja&&this._isStopAWaypoint(this.stops[ja]);)ja--;aa=!0;break}}aa&&(ca=this._markWPsForRemovalAfterUserChangedStopSequence(z,ja));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(ca);this.stops[ja].name&&this.getDirections()})));this._onEvents.push(H(this._dnd,"DndStart",t.hitch(this,function(){var z=C("body")[0];M.add(z,this._css.dndDragBodyClass);
this._removeLocateButtonVisibilityEvents()})));this._onEvents.push(H(this._dnd,"DndDrop, DndCancel",t.hitch(this,function(){var z=C("body")[0];M.remove(z,this._css.dndDragBodyClass);this._setLocateButtonVisibilityEvents()})));var c=this._handle,h=t.hitch(this,function(z){var aa=t.hitch(this,function(fa,ja,ua,sa,ya){var za=c._isShown();c.setGeometry(fa);c._tooltip.style.left=z.screenPoint.x+"px";c._tooltip.style.top=z.screenPoint.y+"px";!za||c._index===ua&&c.attributes.isWaypoint===sa||(c._remove(),
za=!1);c.setSymbol(ja);c._index=ua;c._isStopIcon=c._index===Math.floor(c._index);c.attributes.isWaypoint=sa;c._isStopIcon&&(c.attributes.address=this.stopGraphics[ua].attributes.address,c.setInfoTemplate(this.stopGraphics[ua].infoTemplate));if(this.canModifyWaypoints||c._isStopIcon)za||(this._stopLayer.add(c),(fa=c.getDojoShape())&&fa[sa?"moveToBack":"moveToFront"].call(fa)),this.editToolbar.activate(Oa.MOVE,c);sa=sa?c._isStopIcon?B.widgets.directions.dragWaypoint:this.canModifyWaypoints?B.widgets.directions.dragRoute:
"":B.widgets.directions.dragStop;c._showTooltip(ya||sa)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&!c._solveTimeout)if(clearTimeout(c._removeTimeout),(z.graphic._isStopIcon||z.graphic._isStopLabel)&&!z.graphic.attributes.isWaypoint&&this.canModifyStops||z.graphic._isStopIcon&&z.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var ca=z.graphic._isStopLabel?this.stopGraphics[z.graphic._index]:z.graphic;aa(ca.geometry,this._getStopSymbol(this.stops[ca._index],
!0),ca._index,!0===ca.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[ca._index]);this._stopLayer.remove(this.textGraphics[ca._index])}else if(z.graphic._isSnapFeature||z.graphic._isHandle&&!z.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(z.screenPoint).then(t.hitch(this,function(fa){if(!this.maxStopsReached&&!this._moveInProgress&&fa){for(var ja=this.displayedManeuverPointGraphics,ua=null,sa=0;sa<
ja.length;sa++)if(ja[sa].geometry.x===fa.x&&ja[sa].geometry.y===fa.y){ua=ja[sa]._directionsFeature;ja=Z.indexOf(this.directions.features,ua);-1<ja&&this.highlightSegment(ja);break}aa(fa,z.graphic._isHandle?c.symbol:this.waypointSymbol,z.graphic._isHandle?c._index:z.graphic._nextStopIndex,z.graphic._isHandle?c.attributes.isWaypoint:!0,ua)}}))}),u=t.hitch(this,function(){clearTimeout(c._removeTimeout);c._removeTimeout=setTimeout(c._remove,100);this.unhighlightSegment()}),L=t.hitch(this,function(z){if(this.barrierToolActive){z=
z.graphic;var aa=this.routeParams,ca=aa.barriers?Z.indexOf(aa.barriers.features,z):-1,fa=aa.polygonBarriers?Z.indexOf(aa.polygonBarriers.features,z):-1,ja=aa.polylineBarriers?Z.indexOf(aa.polylineBarriers.features,z):-1;-1<ca&&aa.barriers.features.splice(ca,1);-1<fa&&aa.polygonBarriers.features.splice(fa,1);-1<ja&&aa.polylineBarriers.features.splice(ja,1);this._barriersLayer.remove(z);this._polygonBarriersLayer.remove(z);this._polylineBarriersLayer.remove(z);this._clearStopsStatusAttr();this.getDirections(!0)}});
this._onEvents.push(this._waypointsEventLayer.on("mouse-move",h));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",u));this._onEvents.push(this._stopLayer.on("mouse-move",h));this._onEvents.push(this._stopLayer.on("mouse-out",u));this._onEvents.push(this._barriersLayer.on("click",L));this._onEvents.push(this._polylineBarriersLayer.on("click",L));this._onEvents.push(this._polygonBarriersLayer.on("click",L));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));
this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));this._watchEvents.push(this.watch("showReturnToStartOption",this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",
this._setStartTime));this._watchEvents.push(this.watch("traffic",this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));this._watchEvents.push(this.watch("routeTaskUrl",t.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",t.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",t.hitch(this,function(){this._createGeometryTask()})));
this._watchEvents.push(this.watch("routeParams",t.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",t.hitch(this,function(){this._setSearchOptions();this._createGlobalGeocoder();var z=this.get("searchOptions").sources;if(z)for(var aa=0;aa<this.geocoders.length;aa++)this.geocoders[aa].set("sources",z)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",
this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));this._watchEvents.push(this.watch("showMilesKilometersOption",this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",
this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton));this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));this._watchEvents.push(this.watch("showPrintPage",function(){T.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){T.set(this._saveMenuButton,"display",
this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var c=t.hitch(this,function(u){var L="";if((u=u.routeResults?u.routeResults[0]:null)&&u.route){u=u.route.attributes;var z=this.routeParams.travelMode;if(z){L+="\x3cb\x3e"+z.name+"\x3c/b\x3e "+B.widgets.directions.toNearbyStops+": ";var aa=void 0!==u["Total_"+z.timeAttributeName]?this._formatTime(u["Total_"+z.timeAttributeName],!1,(this._getCostAttribute(z.timeAttributeName)||{}).units):"";L+=(void 0!==
u["Total_"+z.distanceAttributeName]?this._formatDistance(u["Total_"+z.distanceAttributeName],!0,(this._getCostAttribute(z.distanceAttributeName)||{}).units):"")+(aa?" \x26middot; "+aa:"")}else L=this._formatArbitraryCostsForRouteTooltip(u)}this._handle._showTooltip(L)}),h=t.hitch(this,function(u,L){var z=new N,aa=this._handle,ca=this.map.toScreen(aa._origPoint).offset(u.transform.dx+aa.symbol.xoffset,u.transform.dy+aa.symbol.yoffset);u.origMapPoint||(u.origMapPoint=this.map.toMap(ca));T.set(aa._tooltip,
"left",ca.x+"px");T.set(aa._tooltip,"top",ca.y+"px");clearTimeout(aa._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())aa._solveTimeout=setTimeout(function(){h(u,L).always(z.resolve)},100);else if(aa._isStopIcon){ca=u.graphic._index;var fa=this.stops[ca];(fa=fa?{name:fa.name,extent:fa.extent,feature:new A(fa.feature.toJson())}:null)?(fa.feature.setGeometry(u.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[ca])?ca:null,this._incrementalSolveStopRange=
{start:this.returnToStart?(this.stops.length+ca-1)%this.stops.length:Math.max(0,ca-1),end:this.returnToStart?(ca+1)%this.stops.length:Math.min(this.stops.length-1,ca+1)},this.updateStop(fa,ca,L).always(t.hitch(this,function(ja){aa._solveTimeout=null;ja.routeResults&&c(ja);z.resolve()}))):z.resolve()}else z.resolve();return z.promise});this._onEvents.push(H(this.editToolbar,"graphic-click",t.hitch(this,function(u){if(u.graphic.attributes.isWaypoint)!u.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||
(this._handle._remove(),this._moveInProgress=!0,this.removeStop(u.graphic._index,!0).always(t.hitch(this,function(){this._moveInProgress=!1})));else{var L=this.get("map").infoWindow;L&&(L.setFeatures([u.graphic]),L.show(u.graphic.geometry))}})));this._onEvents.push(H(this.editToolbar,"graphic-move-start",t.hitch(this,function(u){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;u=u.graphic;u._origPoint=new X(u.geometry.toJson());
u._maxDeviation=0;u._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(H(this.editToolbar,"graphic-move-stop",t.hitch(this,function(u){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)h(u,!0).always(t.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));
else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var L=this.stops[u.graphic._index],z=(L&&L.feature&&L.feature.attributes&&L.feature.attributes.Name)===this._userDefinedStopName,aa=L&&L.name;this._reverseGeocode(new A(u.graphic.toJson())).then(t.hitch(this,function(ca){z&&(ca.name=aa,ca.feature.attributes.Name=this._userDefinedStopName);this._setReverseGeocode(ca,ca.feature.geometry,u.graphic._index).always(t.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();
this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));this._onEvents.push(H(this.editToolbar,"graphic-move",t.hitch(this,function(u){var L=this._handle,z=u.transform;z.dx&&z.dy&&(u.graphic._maxDeviation=Math.max(L._maxDeviation,Math.sqrt(z.dx*z.dx+z.dy*z.dy)));10<L._maxDeviation&&(L._solveHasHappened=!0,u.graphic===L&&L.attributes.isWaypoint&&!L._isStopIcon?(this.set("optimalRoute",!1),L._index+=.5,L._isStopIcon=!0,u.graphic._stopIndex=L._index,this._incrementalSolveStopRange=
{start:this.returnToStart?(this.stops.length+L._index-1)%this.stops.length:Math.max(0,L._index-1),end:this.returnToStart?(L._index+1)%(this.stops.length+1):Math.min(this.stops.length,L._index+1)},this.addStop({name:this._waypointName,feature:new A(L.geometry,L.symbol,{isWaypoint:!0,CurbApproach:3})},u.graphic._stopIndex)):((L=u.graphic.getDojoShape())&&L.moveToFront(),h(u)))})))},_isStopAWaypoint:function(c){return c&&c.feature&&c.feature.attributes&&c.feature.attributes.isWaypoint},_getStopCount:function(){var c=
0,h;for(h=0;h<this.stops.length;h++)c+=!this._isStopAWaypoint(this.stops[h])&&this.stops[h].name?1:0;return c},_getWaypointCount:function(){var c=0,h;for(h=0;h<this.stops.length;h++)c+=this._isStopAWaypoint(this.stops[h])?1:0;return c},_decorateUngeocodedStop:function(c){var h=new N,u=function(z,aa){h.resolve({name:void 0===z?B.widgets.directions.unlocatedStop:z.toFixed(6)+" "+aa.toFixed(6),feature:c})};if(c.geometry)if(c.geometry.spatialReference&&4326!==c.geometry.spatialReference.wkid)if(this.map&&
this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var L=f.xyToLngLat(c.geometry.x,c.geometry.y);u(L[0],L[1])}else this._geometryService?(L=new Ya,L.outSR=new wa(4326),L.geometries=[c.geometry],this._geometryService.project(L).then(t.hitch(this,function(z){z&&z.length?u(z[0].x,z[0].y):u(c.geometry.x,c.geometry.y)}),t.hitch(this,function(){u()}))):u(c.geometry.x,c.geometry.y);else u(c.geometry.x,c.geometry.y);else u();return h.promise},_trafficLayerUpdate:function(c,h,u){c=this.get("map");
h&&this._trafficLayerAdded&&(c.removeLayer(h),this._trafficLayerAdded=!1);u&&this.get("traffic")&&!this._trafficLayerAdded&&(c.addLayer(u),u.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(c){var h=B.widgets.directions.error.routeTask,u=c.details,L=function(z){return(res=z.match(/(\d+)/))?": "+res[0]:"."};u&&1===u.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===u[0]?h=B.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===
u[0]?h=B.widgets.directions.error.nonNAmTruckingMode:0===u[0].indexOf("The number of input locations loaded into Barriers")?h=B.widgets.directions.error.tooManyBarriers+L(u[0]):0===u[0].indexOf("The number of input locations loaded into PolygonBarriers")?h=B.widgets.directions.error.tooManyPolygonBarriers+L(u[0]):0===u[0].indexOf("The number of input locations loaded into PolylineBarriers")&&(h=B.widgets.directions.error.tooManyPolylineBarriers+L(u[0])));this._showMessage(h);this.onDirectionsFinish(c)},
_showMessage:function(c,h){var u="";this.messages.push({msg:c,error:!h});if(this.messages.length){u+="\x3cul\x3e";for(var L=0;L<this.messages.length;L++)u+='\x3cli class\x3d"'+(this.messages[L].error?this._css.routesErrorClass:this._css.routesInfoClass)+'"\x3e'+this.messages[L].msg+"\x3c/li\x3e";u+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=u);if(!h)this.onError(c)},_isTimeUnits:function(c){return"milliseconds"===c||"esriNAUSeconds"===c||"esriNAUMinutes"===c||"esriNAUHours"===c||"esriNAUDays"===
c},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||this.serviceDescription.directionsTimeAttribute)},_getTimeNeutralAttribute:function(){var c=
(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(c)},_getCostAttribute:function(c){for(var h=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],u,L=0;L<h.length;L++)if(h[L].name===c&&"esriNAUTCost"===h[L].usageType){u=h[L];break}return u},_convertCostValue:function(c,h,u){var L=this._isTimeUnits(h),z=this._isTimeUnits(u);h=L?this._toMinutes(c,h):this._toMeters(c,h);return L===z?z?this._fromMinutes(h,u):this._fromMeters(h,
u):c},_toMinutes:function(c,h,u){c=c||0;switch(h){case "milliseconds":c/=Math.pow(6E4,u?-1:1);break;case "esriNAUSeconds":c/=Math.pow(60,u?-1:1);break;case "esriNAUHours":c*=Math.pow(60,u?-1:1);break;case "esriNAUDays":c*=Math.pow(1440,u?-1:1)}return c},_fromMinutes:function(c,h){return this._toMinutes(c,h,!0)},_toMeters:function(c,h,u){c=c||0;switch((h||"").replace("esriNAU","esri")){case "esriInches":c*=Math.pow(.0254,u?-1:1);break;case "esriFeet":c*=Math.pow(.3048,u?-1:1);break;case "esriYards":c*=
Math.pow(.9144,u?-1:1);break;case "esriMiles":c*=Math.pow(1609.344,u?-1:1);break;case "esriNauticalMiles":c*=Math.pow(1851.995396854,u?-1:1);break;case "esriMillimeters":c/=Math.pow(1E3,u?-1:1);break;case "esriCentimeters":c/=Math.pow(100,u?-1:1);break;case "esriKilometers":c*=Math.pow(1E3,u?-1:1);break;case "esriDecimeters":c/=Math.pow(10,u?-1:1)}return c},_fromMeters:function(c,h){return this._toMeters(c,h,!0)},_createRouteTask:function(){var c=new N;this.set("routeTask",new ha(this.get("routeTaskUrl")));
this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(t.hitch(this,function(h){h.networkDataset?(this.set("serviceDescription",h),this.set("maxStops",parseInt(this.userOptions.maxStops||h.serviceLimits&&h.serviceLimits.Route_MaxStops||this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,c.resolve()):this.routeTask.getOwningSystemUrl().then(t.hitch(this,function(u){this.owningSystemUrl=
u;c.resolve()}),c.reject)):(this._showMessage(B.widgets.directions.error.cantFindRouteServiceDescription),c.reject(Error(B.widgets.directions.error.cantFindRouteServiceDescription)))}),t.hitch(this,function(){this._showMessage(B.widgets.directions.error.cantFindRouteServiceDescription);c.reject(Error(B.widgets.directions.error.cantFindRouteServiceDescription));this.mapClickActive=!1;this._activate()}));return c.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&
1<this._globalGeocoder.sources.length){var c=t.hitch(this,function(L){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",L);for(var z=0;z<this.geocoders.length;z++)this.geocoders[z].set("activeSourceIndex",L);this._truncateSearchSourceIfNeeded()});if(!this._searchSourceSelector){for(var h=[{value:"all",label:B.widgets.Search.main.all,selected:!0}],u=0;u<this._globalGeocoder.sources.length;u++)h.push({value:String(u),label:this._globalGeocoder.sources[u].name});
this._searchSourceSelector=new d({className:"esriSearchSourcesDDL",style:"width:100%;",options:h},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",c);this._searchSourceSelector.domNode.style.width=""}c("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=new d({className:"esriTravelModesDDL",style:"width:100%;"},
this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",t.hitch(this,function(c){this._travelModeSelector._interractive?this._enqueue(function(){return this._setTravelMode(c).always(t.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=!0})))},_setupTravelModes:function(){var c=this.get("serviceDescription"),h=c.supportedTravelModes,u=new N;if(h&&h.length&&
this._travelModeSelector){for(var L=h[0].name,z=[],aa=0;aa<h.length;aa++){for(var ca="AUTOMOBILE"===h[aa].type?"Driving":"TRUCK"===h[aa].type?"Trucking":"WALK"===h[aa].type?"Walking":"Other",fa="",ja=c.networkDataset.networkAttributes,ua=0;ua<ja.length;ua++){var sa=ja[ua];if(sa.name===h[aa].impedanceAttributeName){if("esriNAUCentimeters"===sa.units||"esriNAUDecimalDegrees"===sa.units||"esriNAUDecimeters"===sa.units||"esriNAUFeet"===sa.units||"esriNAUInches"===sa.units||"esriNAUKilometers"===sa.units||
"esriNAUMeters"===sa.units||"esriNAUMiles"===sa.units||"esriNAUMillimeters"===sa.units||"esriNAUNauticalMiles"===sa.units||"esriNAUYards"===sa.units)fa="Distance";else if("esriNAUDays"===sa.units||"esriNAUHours"===sa.units||"esriNAUMinutes"===sa.units||"esriNAUSeconds"===sa.units)fa="Time";break}}z.push({id:h[aa].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+ca+fa+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+h[aa].description+
'"\x3e'+h[aa].name+"\x3c/div\x3e"});!c.defaultTravelMode||h[aa].id!==c.defaultTravelMode&&h[aa].itemId!==c.defaultTravelMode||(L=h[aa].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new k({objectStore:new q({data:z})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(L);this._setTravelMode(L).always(u.resolve)}else this._checkStartTimeUIAvailability(),this.set("showTravelModesOption",!1),u.resolve();return u.promise},_createPrintTask:function(){this._printService=
(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new Ea(this.printTaskUrl,{async:!1}):null;var c=new Ka;c.exportOptions={width:670,height:750,dpi:96};c.format="PNG32";c.layout="MAP_ONLY";c.preserveScale=!1;c.showAttribution=!1;var h=new Ca;h.map=this.map;h.outSpatialReference=this.map.spatialReference;h.template=c;this._printParams=h},_createGeometryTask:function(){this._geometryService=null;this._usingAGOL()?this._geometryService=new xa(this.geometryTaskUrl):this.geometryTaskUrl=
(this._geometryService=this.defaults.geometryTaskUrl?new xa(this.defaults.geometryTaskUrl):$a.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var c=this.get("serviceDescription");T.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&c&&c.supportedTravelModes&&c.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":"none")},_showMilesKilometersOption:function(){T.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?
"block":"none")},_showClearButton:function(){T.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){T.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){T.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var c=
{returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new S,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var h=new ka;this.routeParams=t.mixin(h,{outputGeometryPrecision:0,outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),c)},
_markWPsForRemovalAfterUserChangedStopSequence:function(c,h){for(var u=c-1,L=[];0<=u&&this._isStopAWaypoint(this.stops[u]);)L.push(this.stops[u]),u--;for(u=c+1;u<this.stops.length&&this._isStopAWaypoint(this.stops[u]);)L.push(this.stops[u]),u++;if(h>c)for(u=h+1;u<this.stops.length&&this._isStopAWaypoint(this.stops[u]);)L.push(this.stops[u]),u++;else if(void 0!==h)for(u=h-1;0<=u&&this._isStopAWaypoint(this.stops[u]);)L.push(this.stops[u]),u--;else if(this.returnToStart&&0===c)for(u=this.stops.length-
1;0<=u&&this._isStopAWaypoint(this.stops[u]);)L.push(this.stops[u]),u--;return L},_removeSomeWaypoints:function(c){for(var h=new N,u=[],L=0;L<c.length;L++){var z=Z.indexOf(this.stops,c[L]);-1<z&&u.push(this._removeStop(z,!0,!0))}pa(u).always(h.resolve);return h.promise},_modifyStopSequence:function(c,h){var u=this._dnd.getAllNodes(),L=new N,z,aa=[];if(u.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==c)if(0<=c&&0<=h&&c<this.stops.length&&h<this.stops.length&&c!==h){u=
this._markWPsForRemovalAfterUserChangedStopSequence(c,h);var ca=this.stops.splice(c,1);this.stops.splice(h,0,ca[0]);for(z=0;z<this.stops.length;z++)aa.push(this._updateStop(this.stops[z],z));aa.push(this._removeSomeWaypoints(u));pa(aa).always(t.hitch(this,function(){this._solveAndZoom().always(L.resolve)}))}else L.reject("Invalid From and To values.");else{for(z=0;z<this.stops.length;)this._isStopAWaypoint(this.stops[z])?aa.push(this._removeStop(z,!0,!0)):z++;pa(aa).always(t.hitch(this,function(){aa=
[];this.stops.reverse();for(z=0;z<this.stops.length;z++)aa.push(this._updateStop(this.stops[z],z));pa(aa).always(t.hitch(this,function(){this._solveAndZoom().always(L.resolve)}))}))}else L.resolve();return L.promise},_setMenuNodeValues:function(c){"traffic"!==c&&this._clearDisplayBeforeSolve();c=this.get("optimalRoute");this._findOptimalOrderNode&&R.set(this._findOptimalOrderNode,"checked",c);this._returnToStartNode&&(c=this.returnToStart&&!this.maxStopsReached&&this.stops[0]&&(!this.stops[0].feature||
this._isStopLocated(this.stops[0])),R.set(this._returnToStartNode,"checked",c),this.set("returnToStart",c),this.maxStopsReached&&this.returnToStart&&this._showMessage(B.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),this._incrementalSolveStopRange=null,c=this.stops.length;0<c--&&this._isStopAWaypoint(this.stops[c]);)this._removeSomeWaypoints([this.stops[c]]);
this._useTrafficNode&&(R.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case ea.KILOMETERS:R.set(this._useKilometersNode,"checked",!0);R.set(this._useMilesNode,"checked",!1);break;case ea.MILES:R.set(this._useKilometersNode,"checked",!1),R.set(this._useMilesNode,"checked",!0)}T.set(this._printButton,"display",this.showPrintPage?"inline-block":
"none");T.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&T.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&T.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&T.set(this._findOptimalOrderItemNode,"display",
this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?M.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(M.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===T.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-this._getWaypointCount()?M.add(this._widgetContainer,this._css.stopsRemovableClass):
M.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(c,h,u){M.remove(this.domNode,h);M.add(this.domNode,u)},_toggleOptionsMenu:function(){"block"===T.get(this._optionsMenuNode,"display")?(T.set(this._optionsMenuNode,"display","none"),M.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=
B.widgets.directions.showOptions):(T.set(this._optionsMenuNode,"display","block"),M.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=B.widgets.directions.hideOptions)},_toggleSaveMenu:function(c){"block"===T.get(this._saveMenuNode,"display")||!1===c?(T.set(this._saveMenuNode,"display","none"),M.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):(this.clearMessages(),T.set(this._saveMenuNode,"display","block"),M.add(this._saveMenuButton,this._css.stopsPressedButtonClass),
this._enableSharing().then(t.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var h=this._folderSelector.store.objectStore.data,u=0;u<h.length;u++)if(h[u].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==h[u].id&&(this._folderSelector._interractive=!1,this._folderSelector.setValue(h[u].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||
!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){M[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(ma,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=
this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(c){c=V.toUrl(c);return/^https?:/i.test(c)?c:/^\/\//i.test(c)?Xa+c:/^\//i.test(c)?Xa+"//"+window.location.host+c:c},_getManeuverImage:function(c){return c?"esriDMTStop"===c||"esriDMTDepart"===c?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+c+".png"):""},_loadPrintDirections:function(c){var h=this.get("printTemplate"),u=new N;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(u.resolve,
u.reject):u.resolve();u.then(t.hitch(this,function(){if(!h&&this.directions){var L=this._getAbsoluteUrl("./css/Directions.css"),z=this._getAbsoluteUrl("./css/DirectionsPrint.css"),aa=this._getAbsoluteUrl("./images/Directions/print-logo.png");var ca=Q.isBodyLtr()?"ltr":"rtl";h="";h+="\x3c!DOCTYPE HTML\x3e";h+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+ca+'"\x3e';h+="\x3chead\x3e";h+='\x3cmeta charset\x3d"utf-8"\x3e';h+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';
h+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";h+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+L+'" /\x3e';h+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+z+'" /\x3e';h+="\x3c/head\x3e";h+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';h+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';h+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+B.common.close+'" onclick\x3d"window.close();"\x3e'+
B.common.close+"\x3c/div\x3e";h+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+B.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+B.widgets.directions.print+"\x3c/div\x3e";h+="\x3c/div\x3e";h+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';h+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';h+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+aa+'" /\x3e';h+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+
this.get("directions").routeName+"\x3c/div\x3e";h+=this._renderDirectionsSummary(this.directions);c&&(h+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',h+='\x3chr class\x3d"esriNoPrint"/\x3e');h+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';h+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+B.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';
h+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';h+="\x3c/div\x3e";h+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';h+=this._renderDirectionsTable(this.directions);h+="\x3c/div\x3e";h+="\x3c/div\x3e";h+="\x3c/div\x3e";h+="\x3c/body\x3e";h+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(h);this._printWindow.document.close()}))},resize:function(){this._truncateSearchSourceIfNeeded()},_truncateSearchSourceIfNeeded:function(){var c=
this._searchSourceSelector;if(this._searchSourceSelector){var h=c.containerNode.firstChild;T.set(h,"width","");c.domNode.clientWidth>this.domNode.clientWidth&&T.set(h,"width",this._searchSourceContainerNode.clientWidth-20+"px")}},_printDirections:function(){if(this.directions){var c=screen.width/2,h=screen.height/1.5;c="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+c+", height\x3d"+h+", top\x3d"+(screen.height/2-h/2)+
", left\x3d"+(screen.width/2-c/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",c,!0)):(this._printWindow=window.open("","directions_widget_print",c,!0),this._loadPrintDirections(!!this._printService),this._printService&&V(["dojo/_base/window"],t.hitch(this,function(u){this.zoomToFullRoute().then(t.hitch(this,function(){this._printService.execute(this._printParams,t.hitch(this,function(L){u.withDoc(this._printWindow.document,
function(){var z=G.byId("divMap");z&&(M.remove(z,"esriPrintWait"),M.add(z,"esriPageBreak"),ma.create("img",{src:L.url,"class":"esriPrintMapImg"},z))})}),t.hitch(this,function(L){u.withDoc(this._printWindow.document,function(){var z=G.byId("divMap");z&&M.remove(z,"esriPrintWait")});console.error("Error while calling print service:\n "+L)}))}))})))}},_enableButton:function(c,h){h=h||void 0===h;M[h?"remove":"add"].apply(this,[c,"esriDisabledDirectionsButton"]);c._enabled=h},_clearStopsStatusAttr:function(){for(var c=
0;c<this.stops.length;c++)this.stops[c].feature&&this.stops[c].feature.attributes&&(this.stops[c].feature.attributes.Status=void 0)},_enableSharing:function(){var c=new N;!this._naRouteSharing&&this.owningSystemUrl?V(["../tasks/NARouteSharing"],t.hitch(this,function(h){this._naRouteSharing=new h(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new d({className:"esriFoldersDDL",style:"width: 100%;",sortByLabel:!1,disabled:!0,_interractive:!0,onChange:t.hitch(this,
function(){this._folderSelector._interractive?this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),this._folderSelector.startup(),this._outputLayer=new e({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',maxLength:98,disabled:!0,onKeyPress:t.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||!this._userCanCreatePortalItem)}),onFocus:t.hitch(this,function(){this.map&&
this.map.disableKeyboardNavigation()}),onBlur:t.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());this._naRouteSharing.getFolders().then(t.hitch(this,function(u){for(var L=[],z=0;z<u.length;z++)L.push({id:u[z].url,folderId:u[z].id,label:u[z].title});this._folderSelector.setStore(new k({objectStore:new q({data:L})}));this._naRouteSharing.canCreateItem().then(t.hitch(this,function(aa){this._folderSelector.set("disabled",!aa);
this._userCanCreatePortalItem=aa}));this._enableButton(this._saveButton);c.resolve()}),t.hitch(this,function(u){console.log(u);this._naRouteSharing=null;this._toggleSaveMenu(!1);c.reject(u)}))})):this.owningSystemUrl?c.resolve():(c.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),this._naRouteSharing=null);return c.promise},_storeRouteUI:function(){var c=new N;this._outputLayer&&this._outputLayer.isValid()?this._storeRoute(this._outputLayer.getValue(),
this._folderSelector.getValue(),this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(c.resolve,c.reject):(this._outputLayer&&this._outputLayer.focus(),c.reject(Error("Need result layer name specified.")));return c.promise},_storeRoute:function(c,h,u){var L=new N,z=this.directions;if(this._savingRoute||!this._naRouteSharing)return this._saveButton.blur(),L.reject(Error("Not ready to store route.")),L.promise;this.clearMessages();L.then(null,t.hitch(this,function(Ga){console.log("ERR",
Ga);this._showMessage(B.widgets.directions.error.cantSaveRoute)}));L.promise.always(t.hitch(this,function(){this._enableButton(this._saveButton);T.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._showLoadingSpinner();this._savingRoute=!1}));if(z&&z.features&&z.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(c&&h){var aa=t.hitch(this,function(Ga){return this._naRouteSharing.getAttributeUnits(Ga,
this.serviceDescription)});var ca=this.routeParams.travelMode.timeAttributeName;var fa=this.routeParams.travelMode.distanceAttributeName,ja=aa(ca),ua=aa(fa),sa=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,ya=this._naRouteSharing.toMeters,za=this._naRouteSharing.toMinutes,Fa=function(Ga,La,Ra){var Sa;for(Sa in Ga)if(Ga.hasOwnProperty(Sa)&&0===Sa.indexOf(La)&&-1===Z.indexOf(Ra,Sa.substr(La.length))){var ab=ab||{};ab[Sa.substr(La.length)]=Ga[Sa]}return ab},Da=
[],Ia=[],Na=[];if(ca&&ja&&fa&&ua){var Ua=[],Qa=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||[],Pa=this.serviceDescription.networkDataset.networkAttributes;for(aa=0;aa<Pa.length;aa++)"esriNAUTCost"===Pa[aa].usageType&&-1===Z.indexOf(Qa,Pa[aa].name)&&Pa[aa].name!==ca&&Pa[aa].name!==fa&&Ua.push(Pa[aa].name);Qa=this.get("stops");var Ma={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};for(aa=0;aa<Qa.length;aa++)if(Qa[aa].feature&&Qa[aa].feature.toJson){Pa=
Qa[aa].feature.toJson();var Ha=Pa.attributes;var Ja=Pa.geometry,Ta=this._naRouteSharing.getUTCOffset(Ha.ArriveTime,Ha.ArriveTimeUTC),Wa=this._naRouteSharing.getUTCOffset(Ha.DepartTime,Ha.DepartTimeUTC);t.mixin(Ma,{xmin:Ma.xmin>Ja.x?Ja.x:Ma.xmin,ymin:Ma.ymin>Ja.y?Ja.y:Ma.ymin,xmax:Ma.xmax<Ja.x?Ja.x:Ma.xmax,ymax:Ma.ymax<Ja.y?Ja.y:Ma.ymax});Pa.attributes={__OBJECTID:aa+1,CurbApproach:Ha.CurbApproach,ArrivalCurbApproach:Ha.ArriveCurbApproach,DepartureCurbApproach:Ha.DepartCurbApproach,Name:Ha.Name===
this._waypointName?B.widgets.directions.waypoint:Ha.Name===this._userDefinedStopName?Qa[aa].name:Ha.Name,RouteName:z.routeName,Sequence:Ha.Sequence,Status:Ha.Status,LocationType:Ha.isWaypoint?1:0,TimeWindowStart:Ha.TimeWindowStart,TimeWindowEnd:Ha.TimeWindowEnd,TimeWindowStartUTCOffset:Ta,TimeWindowEndUTCOffset:Ta,ServiceMinutes:za(Ha["Attr_"+ca],ja),ServiceMeters:ya(Ha["Attr_"+fa],ua),ServiceCosts:na.stringify(Fa(Ha,"Attr_",Ua)),CumulativeMinutes:za(Ha["Cumul_"+ca],ja),CumulativeMeters:ya(Ha["Cumul_"+
fa],ua),CumulativeCosts:na.stringify(Fa(Ha,"Cumul_",Ua)),LateMinutes:za(Ha["Violation_"+ca],ja),WaitMinutes:za(Ha["Wait_"+ca],ja),ArrivalTime:this._naRouteSharing.toUTCTime(Ha.ArriveTime,Ta),DepartureTime:this._naRouteSharing.toUTCTime(Ha.DepartTime,Wa),ArrivalUTCOffset:Ta,DepartureUTCOffset:Wa};Da.push(Pa)}fa=0;ua=function(Ga){try{Ga.strings=na.parse(Ga.strings)}catch(Ra){bb.strings=void 0}if(Ga.strings&&Ga.strings.length)for(var La=0;La<Ga.strings.length;La++)if("esriDSTGeneral"===Ga.strings[La].stringType)return Ga.strings[La].string};
Qa=function(Ga,La){for(var Ra=[],Sa=0;Sa<(Ga||[]).length;Sa++)Ga[Sa].stringType!==La&&La||Ra.push(Ga[Sa].string);return Ra.length?Ra.toString():void 0};Pa=function(Ga){switch(Ga){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";
case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";
case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";
case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};for(aa=0;aa<z.featuresWithWaypoints.length;aa++){var Za=z.featuresWithWaypoints[aa];Ja=Za.toJson();Ta=Ja.attributes;Wa=Ja.geometry&&Ja.geometry.paths&&Ja.geometry.paths[0]||[];var db=Ja.geometry.hasM||Wa[0]&&3===Wa[0].length;Ha=this._naRouteSharing.getUTCOffset(Ta.ETA,Ta.arriveTimeUTC);Ja.attributes={__OBJECTID:aa+1,Sequence:++fa,StopID:function(){var Ga=void 0,La=Za._associatedStopWithReturnToStart&&
Za._associatedStopWithReturnToStart.attributes.Sequence;if(La)for(var Ra=0;Ra<Da.length;Ra++)if(Da[Ra].attributes.Sequence===La){Ga=Da[Ra].attributes.__OBJECTID;break}return Ga}(),DirectionPointType:Pa(Ta.maneuverType),DisplayText:Za._associatedStopWithReturnToStart&&Za._associatedStopWithReturnToStart.attributes.isWaypoint?Ta.text.replace(this._waypointName,B.widgets.directions.waypoint):Ta.text,ArrivalTime:this._naRouteSharing.toUTCTime(Ta.ETA,Ha),ArrivalUTCOffset:Ha,Azimuth:void 0,Name:Qa(z.stringsWithWaypoints[aa],
"esriDSTStreetName"),AlternateName:Qa(z.stringsWithWaypoints[aa],"esriDSTAltName"),ExitName:Qa(z.stringsWithWaypoints[aa],"esriDSTExit"),IntersectingName:Qa(z.stringsWithWaypoints[aa],"esriDSTCrossStreet"),BranchName:Qa(z.stringsWithWaypoints[aa],"esriDSTBranch"),TowardName:Qa(z.stringsWithWaypoints[aa],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,Level:void 0};delete Ja.symbol;delete Ja.infoTemplate;Wa.length?(Ja.geometry={x:Wa[0][0],y:Wa[0][1],spatialReference:Ja.geometry.spatialReference},
db&&t.mixin(Ja.geometry,{m:Wa[0][2]})):delete Ja.geometry;Ia.push(Ja);Ja=Za.toJson();Ta=Ja.attributes;Wa=Ja.geometry&&Ja.geometry.paths&&Ja.geometry.paths[0]||[];Ha=!0;for(ca=0;ca<Wa.length-1;ca++)if(Wa[ca][0]!==Wa[ca+1][0]||Wa[ca][1]!==Wa[ca+1][1]){Ha=!1;break}Ha||(Ja.attributes={DirectionPointID:aa+1,DirectionLineType:"esriDLTSegment",Meters:ya(Ta.length,sa),Minutes:za(Ta.time,ja),FromLevel:void 0,ToLevel:void 0},Ja.geometry.hasM=db,delete Ja.symbol,delete Ja.infoTemplate,Na.push(Ja));var bb=z.eventsWithWaypoints[Ja.attributes.Sequence]||
[];for(ca=0;ca<bb.length;ca++)Ja=bb[ca].toJson(),Ta=Ja.attributes,Ha=this._naRouteSharing.getUTCOffset(Ta.ETA,Ta.arriveTimeUTC),Ja.attributes={Sequence:++fa,DirectionPointType:"esriDPTEvent",DisplayText:ua(Ta),ArrivalTime:this._naRouteSharing.toUTCTime(Ta.ETA,Ha),ArrivalUTCOffset:Ha,Name:Ta.strings},Ia.push(Ja)}ca=this.routeParams.barriers&&this.routeParams.barriers.features||[];var eb=[];for(aa=0;aa<ca.length;aa++)fa=ca[aa].toJson(),ua=fa.attributes,fa.attributes={BarrierType:ua.BarrierType||0,FullEdge:ua.FullEdge||
!1,AddedCost:ua["Attr_"+this._getImpedanceAttribute().name]||0,Costs:na.stringify(Fa(ua,"Attr_",Ua)),CurbApproach:ua.CurbApproach||0,Name:ua.Name},eb.push(fa);ca=this.routeParams.polylineBarriers&&this.routeParams.polylineBarriers.features||[];var fb=[];for(aa=0;aa<ca.length;aa++)fa=ca[aa].toJson(),ua=fa.attributes,fa.attributes={BarrierType:ua.BarrierType||0,ScaleFactor:ua["Attr_"+this._getImpedanceAttribute().name]||1,Costs:na.stringify(Fa(ua,"Attr_",Ua)),Name:ua.Name},fb.push(fa);ca=this.routeParams.polygonBarriers&&
this.routeParams.polygonBarriers.features||[];var gb=[];for(aa=0;aa<ca.length;aa++)fa=ca[aa].toJson(),ua=fa.attributes,fa.attributes={BarrierType:ua.BarrierType||0,ScaleFactor:ua["Attr_"+this._getImpedanceAttribute().name]||1,Costs:na.stringify(Fa(ua,"Attr_",Ua)),Name:ua.Name},gb.push(fa);var hb={geometry:z.mergedGeometry,attributes:{RouteName:z.routeName,TotalMinutes:za(z.totalTime,ja),TotalMeters:ya(z.totalLength,sa),TotalLateMinutes:function(){for(var Ga=0,La=0;La<Da.length;La++)Ga+=Da[La].attributes.LateMinutes||
0;return Ga}(),TotalWaitMinutes:function(){for(var Ga=0,La=0;La<Da.length;La++)Ga+=Da[La].attributes.WaitMinutes||0;return Ga}(),TotalCosts:Da[Da.length-1].attributes.CumulativeCosts,StartTime:"none"!==this.startTime?Da[0].attributes.ArrivalTime:null,EndTime:"none"!==this.startTime?Da[Da.length-1].attributes.DepartureTime:null,StartUTCOffset:Da[0].attributes.ArrivalUTCOffset,EndUTCOffset:Da[Da.length-1].attributes.DepartureUTCOffset,Messages:na.stringify(this._solverMessages),AnalysisSettings:na.stringify({travelMode:t.hitch(this,
function(){var Ga=t.clone(this.routeParams.travelMode);"\x26lt;"===Ga.name.substr(0,4)&&"\x26gt;"===Ga.name.substr(Ga.name.length-4,4)&&(Ga.name=Ga.name.substr(4,Ga.name.length-8));return Ga})(),directionsLanguage:this.routeParams.directionsLanguage||this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,
accumulateAttributeNames:this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames})}};this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);t.hitch(this,function(){var Ga=new N;this._printService?this.zoomToFullRoute().then(t.hitch(this,function(){var La=this._printParams.template,Ra=La.exportOptions;La.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(Sa){La.exportOptions=Ra;Ga.resolve(Sa.url)},
function(Sa){La.exportOptions=Ra;console.error("Error while calling print service:\n "+Sa);Ga.resolve()})})):Ga.resolve();return Ga.promise})().then(t.hitch(this,function(Ga){var La={folder:h,name:c,stops:Da,directionPoints:Ia,directionLines:Na,barriers:eb,polylineBarriers:fb,polygonBarriers:gb,extent:t.mixin(t.clone(z.extent),{xmin:Ma.xmin>z.extent.xmin?z.extent.xmin:Ma.xmin,ymin:Ma.ymin>z.extent.ymin?z.extent.ymin:Ma.ymin,xmax:Ma.xmax<z.extent.xmax?z.extent.xmax:Ma.xmax,ymax:Ma.ymax<z.extent.ymax?
z.extent.ymax:Ma.ymax}),routeInfo:hb,thumbnail:Ga};this._userCanCreatePortalItem?this._naRouteSharing.store(La,this.routeLayer.itemId,"1.0.0").then(t.hitch(this,function(Ra){if(Ra.success){var Sa=this._naRouteSharing.portal;Sa="//"+(Sa.isPortal?Sa.portalHostname:Sa.urlKey+"."+Sa.customBaseUrl);this._toggleSaveMenu();this._showMessage(B.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+Sa+"/home/item.html?id\x3d"+Ra.id+"'\x3e"+B.widgets.directions.share+
"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(Ra.id);else this.onRouteItemCreated(Ra.id);t.mixin(this.routeLayer,{itemId:Ra.id,title:La.name,isItemOwner:!0,ownerFolder:u});L.resolve(Ra)}else L.reject(Ra)}),L.reject):this._naRouteSharing.createFeatureCollection(La,"1.0.0").then(t.hitch(this,function(Ra){L.resolve(Ra);this._toggleSaveMenu();this.onFeatureCollectionCreated(Ra)}),L.reject)}))}else L.reject(Error("Cannot deduce the impedance used."))}else L.reject(Error("Missing required parameter: layerName, folder must be specified."));
else L.reject(Error("Shared route must be built using a Travel Mode."));else L.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));else L.reject(Error("No route to share. Build a route first."));return L.promise},_loadRoute:function(c){var h=new N;h.promise.always(t.hitch(this,function(){this._showLoadingSpinner(!1);T.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":
"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));this._reset().then(t.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(t.hitch(this,function(){var u=t.clone(this.serviceDescription),L=t.hitch(this,function(ja){t.mixin(this.routeLayer,{itemId:c,title:ja.title,isItemOwner:ja.isItemOwner,ownerFolder:ja.ownerFolder})}),z,aa,ca,fa;u.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(c,u).then(t.hitch(this,function(ja){if(ja.routeParameters){t.mixin(this.routeParams,
ja.routeParameters);this.routeParams.accumulateAttributes=ja.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var ua=ja.routeParameters.travelMode,sa=ua?this._getCostAttribute(ua.impedanceAttributeName):void 0;sa=sa?this._isTimeUnits(sa.units)?"Time":"Distance":"";fa=u.supportedTravelModes&&u.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():
[];if(canUseRouteLayerTM=1!==ja.successCode&&sa){var ya="AUTOMOBILE"===ua.type?"Driving":"TRUCK"===ua.type?"Trucking":"WALK"===ua.type?"Walking":"Other";ua.name="\x26lt;"+ua.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(u.supportedTravelModes||[]).concat(ua);fa.push({id:ua.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+ya+sa+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+ua.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new k({objectStore:new q({data:fa})}));
this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ua.name)}else{sa=!1;if(ua&&ua.name)for(fa=u.supportedTravelModes||[],z=0;z<fa.length;z++)if(fa[z].name===ua.name){sa=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ua.name);this.routeParams.travelMode=fa[z].impedanceAttributeName?fa[z]:fa[z].itemId;ja.loadMessages.push({message:B.widgets.directions.error.tmFromPortalSameName+" "+ua.name,messageType:"Warning"});break}if(!sa)if((ua=u.defaultTravelMode)&&
fa)for(z=0;z<fa.length;z++){if(fa[z].id===ua){this.routeParams.travelMode=fa[z].impedanceAttributeName?fa[z]:fa[z].itemId;ja.loadMessages.push({message:B.widgets.directions.error.tmFromPortalDefault+" "+(fa[z].name?fa[z].name:fa[z].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(ja.solveResult&&ja.solveResult.routeResults){var za=Infinity,Fa=-Infinity;ua=ja.solveResult.routeResults[0].stops;var Da=ja.solveResult.routeResults[0].directions.features;
sa={};for(z=0;z<ua.length;z++){var Ia=ua[z].attributes;if(Ia.isWaypoint)for(aa=0;aa<Da.length;aa++)ya=Da[aa].attributes,ya._stopSequence===Ia.Sequence&&(ya.text=ya.text.replace(Ia.Name,this._waypointName));ca=Ia.Name+"_"+this._stopSequence++;sa[ca]=Ia.isWaypoint?this._waypointName:Ia.Name;Ia.Name=ca;if(Ia.Sequence<za&&(null!==Ia.ArriveCurbApproach||null!==Ia.DepartCurbApproach)){var Na=Ia.Name;za=Ia.Sequence}if(Ia.Sequence>Fa&&(null!==Ia.ArriveCurbApproach||null!==Ia.DepartCurbApproach)){var Ua=Ia.Name;
Fa=Ia.Sequence}}ca=Na+" - "+Ua;ja.solveResult.routeResults[0].routeName=ca;ja.solveResult.routeResults[0].directions.routeName=ca;for(z=0;z<Da.length;z++)if(ya=Da[z].attributes,void 0!==ya._stopSequence)for(aa=0;aa<ua.length;aa++)if(ya._stopSequence===ua[aa].attributes.Sequence){ca=ua[aa].attributes.Name;ya.text=(ya.text||"").replace(sa[ca],ca);delete ya._stopSequence;break}Na=ua[ua.length-1];ua[0].geometry.x===Na.geometry.x&&ua[0].geometry.y===Na.geometry.y&&(this._returnToStartStop=this._addStopWrapperToGraphic(new A(Na.geometry,
null,Na.attributes),sa[Na.attributes.Name]),this.set("returnToStart",!0));this._solveResultProcessing(ja.solveResult,sa).then(t.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);L(ja);this.zoomToFullRoute();h.resolve(ja)}),h.reject)}else{if(ja.routeParameters){Na=ja.routeParameters.stops.features;this.stops=[];for(z=0;z<Na.length;z++)this.stops.push(this._addStopWrapperToGraphic(Na[z],Na[z].attributes.Name)),this._updateStop(this.stops[z],z);this._setStops();ja.loadMessages.push({message:B.widgets.directions.routeLayerStopsOnly,
messageType:"Warning"})}else ja.loadMessages.push({message:B.widgets.directions.routeLayerEmpty,messageType:"Warning"});L(ja);h.resolve(ja)}for(z=0;z<ja.loadMessages.length;z++)this._showMessage(ja.loadMessages[z].message)}),t.hitch(this,function(ja){h.reject(ja);this._showMessage("GWM_0003"===ja.messageCode?B.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:B.widgets.directions.error.loadError)}))}),h.reject)}),h.reject);return h.promise}});I("extend-esri")&&
t.setObject("dijit.Directions",W,J);return W})},"dojo/data/ObjectStore":function(){define("../_base/lang ../Evented ../_base/declare ../_base/Deferred ../promise/all ../_base/array ../_base/connect ../regexp".split(" "),function(V,W,t,O,Z,P,F,x){function d(e){return"*"==e?".*":"?"==e?".":e}return t("dojo.data.ObjectStore",[W],{objectStore:null,constructor:function(e){this._dirtyObjects=[];e.labelAttribute&&(e.labelProperty=e.labelAttribute);V.mixin(this,e)},labelProperty:"label",getValue:function(e,
l,n){return"function"===typeof e.get?e.get(l):l in e?e[l]:n},getValues:function(e,l){e=this.getValue(e,l);return e instanceof Array?e:void 0===e?[]:[e]},getAttributes:function(e){var l=[],n;for(n in e)!e.hasOwnProperty(n)||"_"==n.charAt(0)&&"_"==n.charAt(1)||l.push(n);return l},hasAttribute:function(e,l){return l in e},containsValue:function(e,l,n){return-1<P.indexOf(this.getValues(e,l),n)},isItem:function(e){return"object"==typeof e&&e&&!(e instanceof Date)},isItemLoaded:function(e){return e&&"function"!==
typeof e.load},loadItem:function(e){var l;"function"===typeof e.item.load?O.when(e.item.load(),function(n){l=n;var q=n instanceof Error?e.onError:e.onItem;q&&q.call(e.scope,n)}):e.onItem&&e.onItem.call(e.scope,e.item);return l},close:function(e){return e&&e.abort&&e.abort()},fetch:function(e){function l(v){e.onError&&e.onError.call(q,v,e)}e=V.delegate(e,e&&e.queryOptions);var n=this,q=e.scope||n,k=e.query;if("object"==typeof k){k=V.delegate(k);for(var w in k){var I=k[w];"string"==typeof I&&(k[w]=
RegExp("^"+x.escapeString(I,"*?\\").replace(/\\.|\*|\?/g,d)+"$",e.ignoreCase?"mi":"m"),k[w].toString=function(v){return function(){return v}}(I))}}var H=this.objectStore.query(k,e);O.when(H.total,function(v){O.when(H,function(G){e.onBegin&&e.onBegin.call(q,v||G.length,e);if(e.onItem)for(var Q=0;Q<G.length;Q++)e.onItem.call(q,G[Q],e);e.onComplete&&e.onComplete.call(q,e.onItem?null:G,e);return G},l)},l);e.abort=function(){H.cancel&&H.cancel()};H.observe&&(this.observing&&this.observing.cancel(),this.observing=
H.observe(function(v,G,Q){if(-1==P.indexOf(n._dirtyObjects,v))if(-1==G)n.onNew(v);else if(-1==Q)n.onDelete(v);else for(var T in v)if(T!=n.objectStore.idProperty)n.onSet(v,T,null,v[T])},!0));this.onFetch(H);e.store=this;return e},getFeatures:function(){return{"dojo.data.api.Read":!!this.objectStore.get,"dojo.data.api.Identity":!0,"dojo.data.api.Write":!!this.objectStore.put,"dojo.data.api.Notification":!0}},getLabel:function(e){if(this.isItem(e))return this.getValue(e,this.labelProperty)},getLabelAttributes:function(e){return[this.labelProperty]},
getIdentity:function(e){return this.objectStore.getIdentity?this.objectStore.getIdentity(e):e[this.objectStore.idProperty||"id"]},getIdentityAttributes:function(e){return[this.objectStore.idProperty]},fetchItemByIdentity:function(e){var l;O.when(this.objectStore.get(e.identity),function(n){l=n;e.onItem.call(e.scope,n)},function(n){e.onError.call(e.scope,n)});return l},newItem:function(e,l){if(l){var n=this.getValue(l.parent,l.attribute,[]);n=n.concat([e]);e.__parent=n;this.setValue(l.parent,l.attribute,
n)}this._dirtyObjects.push({object:e,save:!0});this.onNew(e);return e},deleteItem:function(e){this.changing(e,!0);this.onDelete(e)},setValue:function(e,l,n){var q=e[l];this.changing(e);e[l]=n;this.onSet(e,l,q,n)},setValues:function(e,l,n){if(!V.isArray(n))throw Error("setValues expects to be passed an Array object as its value");this.setValue(e,l,n)},unsetAttribute:function(e,l){this.changing(e);var n=e[l];delete e[l];this.onSet(e,l,n,void 0)},changing:function(e,l){e.__isDirty=!0;for(var n=0;n<this._dirtyObjects.length;n++){var q=
this._dirtyObjects[n];if(e==q.object){l&&(q.object=!1,this._saveNotNeeded||(q.save=!0));return}}q=e instanceof Array?[]:{};for(n in e)e.hasOwnProperty(n)&&(q[n]=e[n]);this._dirtyObjects.push({object:!l&&e,old:q,save:!this._saveNotNeeded})},save:function(e){e=e||{};var l=[],n=[],q=this,k=this._dirtyObjects;try{F.connect(e,"onError",function(){if(!1!==e.revertOnError){var T=k;k=n;q.revert();q._dirtyObjects=T}else q._dirtyObjects=k.concat(n)});var w;this.objectStore.transaction&&(w=this.objectStore.transaction());
for(var I=0;I<k.length;I++){var H=k[I],v=H.object,G=H.old;delete v.__isDirty;if(v){var Q=this.objectStore.put(v,{overwrite:!!G});l.push(Q)}else"undefined"!=typeof G&&(Q=this.objectStore.remove(this.getIdentity(G)),l.push(Q));n.push(H);k.splice(I--,1)}Z(l).then(function(T){e.onComplete&&e.onComplete.call(e.scope,T)},function(T){e.onError&&e.onError.call(e.scope,T)});w&&w.commit()}catch(T){e.onError.call(e.scope,value)}},revert:function(){for(var e=this._dirtyObjects,l=e.length;0<l;){l--;var n=e[l],
q=n.object;n=n.old;if(q&&n){for(var k in n)n.hasOwnProperty(k)&&q[k]!==n[k]&&(this.onSet(q,k,q[k],n[k]),q[k]=n[k]);for(k in q)n.hasOwnProperty(k)||(this.onSet(q,k,q[k]),delete q[k])}else if(n)this.onNew(n);else this.onDelete(q);delete (q||n).__isDirty;e.splice(l,1)}},isDirty:function(e){return e?e.__isDirty:!!this._dirtyObjects.length},onSet:function(){},onNew:function(){},onDelete:function(){},onFetch:function(e){}})})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),
function(V,W,t,O,Z,P,F,x,d,e,l,n){V=V([d,n],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(q){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=W.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(q,k,w,I,H){try{var v=[],G=[],Q=q.directions||[],T=q.routes?q.routes.features:
[],M=q.stops?q.stops.features:[],R=q.barriers?q.barriers.features:[],C=q.polygonBarriers?q.polygonBarriers.features:[],a=q.polylineBarriers?q.polylineBarriers.features:[],B=q.messages,da=t.forEach,la=t.indexOf,ma=!0,pa,N,oa=q.routes&&q.routes.spatialReference||q.stops&&q.stops.spatialReference||q.barriers&&q.barriers.spatialReference||q.polygonBarriers&&q.polygonBarriers.spatialReference||q.polylineBarriers&&q.polylineBarriers.spatialReference;this._chk=q.checksum;da(Q,function(y){v.push(pa=y.routeName);
G[pa]={directions:y}});da(T,function(y){-1===la(v,pa=y.attributes.Name)&&(v.push(pa),G[pa]={});G[pa].route=y});da(M,function(y){N=y.attributes;-1===la(v,pa=N.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(v.push(pa),G[pa]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==pa&&(ma=!1);void 0===G[pa].stops&&(G[pa].stops=[]);G[pa].stops.push(y)});0<M.length&&!0===ma&&(G[v[0]].stops=G["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete G["esri.tasks.RouteTask.NULL_ROUTE_NAME"],v.splice(t.indexOf(v,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),
1));var na=[];da(v,function(y,A){G[y].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===y?null:y;G[y].spatialReference=oa;na.push(new e(G[y]))});q=function(y){da(y,function(A,ea){A.geometry&&(A.geometry.spatialReference=oa);y[ea]=new P(A)});return y};da(B,function(y,A){B[A]=new l(y)});var J={routeResults:na,barriers:q(R),polygonBarriers:q(C),polylineBarriers:q(a),messages:B};this._successHandler([J],"onSolveComplete",w,H)}catch(y){this._errorHandler(y,I,H)}},solve:function(q,k,w,I){var H=I.assembly;
q=this._encode(W.mixin({},this._url.query,{f:"json"},q.toJson(H&&H[0]),this._chk?{checksum:this._chk}:{}));var v=this._handler,G=this._errorHandler;return F({url:this._url.path,timeout:25E4,content:q,callbackParamName:"callback",load:function(Q,T){v(Q,T,k,w,I.dfd)},error:function(Q){G(Q,w,I.dfd)}})},onSolveComplete:function(){}});x._createWrappers(V);O("extend-esri")&&W.setObject("tasks.RouteTask",V,Z);return V})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),
function(V,W,t,O,Z,P,F){V=V(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(x){var d=x.spatialReference,e=x.route;if(x.directions){var l=[],n=[],q=[];t.forEach(x.directions.features,function(w,I){n[I]=w.compressedGeometry;l[I]=w.strings;q[I]=w.events});x.directions.strings=l;x.directions.events=q;this.directions=new F(x.directions,n)}this.routeName=x.routeName;e&&(e.geometry&&(e.geometry.spatialReference=d),this.route=new P(e));if(x.stops){var k=this.stops=[];t.forEach(x.stops,function(w,
I){w.geometry&&(w.geometry.spatialReference=d);k[w.attributes.Sequence-1]=new P(w)})}},routeName:null,directions:null,route:null,stops:null});O("extend-esri")&&W.setObject("tasks.RouteResult",V,Z);return V})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(V,W,t,O,Z,P,F,x,d,e,l){V=V(l,{declaredClass:"esri.tasks.DirectionsFeatureSet",
constructor:function(n,q){this.routeId=n.routeId;this.routeName=n.routeName;W.mixin(this,n.summary);this.extent=new F(this.envelope);var k=this._fromCompressedGeometry,w=this.features,I=this.extent.spatialReference,H=[];t.forEach(q,function(v,G){w[G].setGeometry(H[G]=v?k(v,I):w[G].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(H,I);this.geometryType="esriGeometryPolyline";t.forEach(n.events,function(v,G){t.forEach(v,function(Q,T){v[T]=new e(new d(Q.point.x,Q.point.y,I),null,{ETA:Q.ETA,
strings:Z.stringify(Q.strings),arriveTimeUTC:Q.arriveTimeUTC})});n.events[G]=v});delete this.envelope},_fromCompressedGeometry:function(n,q){var k=0,w=0,I=0,H=0,v=[],G=0,Q=0,T=0;(n=n.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(n=[]);if(0===parseInt(n[G],32)){G=2;var M=parseInt(n[G],32);G++;var R=parseInt(n[G],32);G++;if(M&1){Q=t.indexOf(n,"|")+1;var C=parseInt(n[Q],32);Q++}if(M&2){T=t.indexOf(n,"|",Q)+1;var a=parseInt(n[T],32);T++}}else R=parseInt(n[G],32),G++;for(;G<n.length&&"|"!==n[G];){M=parseInt(n[G],
32)+k;G++;k=M;var B=parseInt(n[G],32)+w;G++;w=B;M=[M/R,B/R];Q&&(B=parseInt(n[Q],32)+I,Q++,I=B,M.push(B/C));T&&(B=parseInt(n[T],32)+H,T++,H=B,M.push(B/a));v.push(M)}k=new x({paths:[v],hasZ:0<Q,hasM:0<T});k.setSpatialReference(q);return k},_mergePolylinesToSinglePath:function(n,q){var k=[],w=!1;t.forEach(n,function(v){t.forEach(v.paths,function(G){w=w||v.hasM;k=k.concat(G)})});var I=[],H=[0,0];t.forEach(k,function(v){if(v[0]!==H[0]||v[1]!==H[1])I.push(v),H=v});return new x({paths:[I],spatialReference:q,
hasM:w})}});O("extend-esri")&&W.setObject("tasks.DirectionsFeatureSet",V,P);return V})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(V,W,t,O){V=V(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(Z){W.mixin(this,Z)}});W.mixin(V,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});t("extend-esri")&&W.setObject("tasks.NAMessage",
V,O);return V})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare","dojo/json","dojo/Deferred","dojo/_base/lang","../request"],function(V,W,t,O,Z){return V(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(P,F){var x=new t;if(this._sd)x.resolve(this._sd);else if(this._url&&this._url.orig){var d=this._url.orig,e=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":
"ServiceAreas",l,n=function(q){Z({url:q+("/"===q[q.length-1]?"":"/")+"GetTravelModes/execute",content:{f:"json",serviceName:e},callbackParamName:"callback"}).then(function(k){var w=[],I=null;if(k&&k.results&&k.results.length)for(var H=0;H<k.results.length;H++)if("supportedTravelModes"===k.results[H].paramName){if(k.results[H].value&&k.results[H].value.features)for(var v=0;v<k.results[H].value.features.length;v++)if(k.results[H].value.features[v].attributes){var G=W.parse(k.results[H].value.features[v].attributes.TravelMode);
w.push(G)}}else"defaultTravelMode"===k.results[H].paramName&&(I=k.results[H].value);l.supportedTravelModes=w;l.defaultTravelMode=I;x.resolve(l)},function(k){console.log("Could not read from the routingUtilities service.");x.reject(k)})};Z({url:d,content:{f:"json"},callbackParamName:"callback"}).then(function(q){l=q;l.supportedTravelModes||(l.supportedTravelModes=[]);for(q=0;q<l.supportedTravelModes.length;q++)l.supportedTravelModes[q].id||(l.supportedTravelModes[q].id=l.supportedTravelModes[q].itemId);
F?x.resolve(l):P?n(P):10.4<=l.currentVersion?Z({url:d+("/"===d[d.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(k){l.supportedTravelModes=k.supportedTravelModes;l.defaultTravelMode=k.defaultTravelMode;x.resolve(l)},function(k){console.log("Could not get to the NAServer's retrieveTravelModes.");x.reject(k)}):Z({url:d.substring(0,d.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(k){k.owningSystemUrl?
(d=k.owningSystemUrl,Z({url:d+("/"===d[d.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(w){w&&w.helperServices&&w.helperServices.routingUtilities&&w.helperServices.routingUtilities.url?n(w.helperServices.routingUtilities.url):(console.log("Portal does not have helperServices.routingUtilities defined."),x.resolve(l))},function(w){console.log("Could not get to the portal's self.");x.reject(w)})):x.resolve(l)},function(k){console.log("Could not get to the NAServer service description.");
x.reject(k)})},function(q){x.reject(q)})}else x.reject("NA Task has no URL specified.");x.then(O.hitch(this,function(q){this._sd=q}),O.hitch(this,function(){this._sd=null}));return x.promise},getOwningSystemUrl:function(){var P=new t;if(this._url&&this._url.orig){var F=this._url.orig;Z({url:F.substring(0,F.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(x){P.resolve(x.owningSystemUrl)})}else P.resolve(void 0);return P.promise}})})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),
function(V,W,t,O,Z,P,F,x){V=V(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,
overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,timeWindowsAreUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(d){var e={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,
returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&t.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||t.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,
preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,
useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:x.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,travelMode:"object"===typeof this.travelMode?t.toJson(this.travelMode):this.travelMode},l=this.stops;"esri.tasks.FeatureSet"===l.declaredClass&&0<
l.features.length?e.stops=t.toJson({type:"features",features:F._encodeGraphics(l.features,d&&d["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===l.declaredClass?e.stops=l:"esri.tasks.DataFile"===l.declaredClass&&(e.stops=t.toJson({type:"features",url:l.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":e.directionsOutputType=
"esriDOTComplete";break;case "complete-no-events":e.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":e.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":e.directionsOutputType="esriDOTStandard";break;case "summary-only":e.directionsOutputType="esriDOTSummaryOnly";break;default:e.directionsOutputType=this.directionsOutputType}l=function(n,q){return n?"esri.tasks.FeatureSet"===n.declaredClass?0<n.features.length?t.toJson({type:"features",features:F._encodeGraphics(n.features,
d&&d[q])}):null:"esri.tasks.DataLayer"===n.declaredClass?n:"esri.tasks.DataFile"===n.declaredClass?t.toJson({type:"features",url:n.url}):t.toJson(n):null};this.barriers&&(e.barriers=l(this.barriers,"barriers.features"));this.polygonBarriers&&(e.polygonBarriers=l(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(e.polylineBarriers=l(this.polylineBarriers,"polylineBarriers.features"));return P.filter(e,function(n){if(null!==n)return!0})}});O("extend-esri")&&W.setObject("tasks.RouteParameters",
V,Z);return V})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(V,W,t){var O={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"},Z={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},P={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",
AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},F={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},x={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},d={LengthUnit:O,OutputLine:Z,UTurn:P,OutputPolygon:F,TravelDirection:x};W("extend-esri")&&(V.setObject("tasks._NALengthUnit",O,t),V.setObject("tasks.NAOutputLine",
Z,t),V.setObject("tasks.NAUTurn",P,t),V.setObject("tasks.NAOutputPolygon",F,t),V.setObject("tasks.NATravelDirection",x,t));return d})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(V,W,t,O,Z,P){V=V(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var F={},x=this.geometry1;x&&(F.geometry1=t.toJson({geometryType:P.getJsonType(x),
geometry:x}));if(x=this.geometry2)F.geometry2=t.toJson({geometryType:P.getJsonType(x),geometry:x});F.sr=t.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(F.distanceUnit=this.distanceUnit);this.geodesic&&(F.geodesic=this.geodesic);return F}});O("extend-esri")&&W.setObject("tasks.DistanceParameters",V,Z);return V})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,H,v,G,Q,T,M,R,C){V=V(G,{declaredClass:"esri.tasks.PrintTask",constructor:function(a,B){this.url=a;this.printGp=new H(this.url);this._handler=W.hitch(this,this._handler);B&&B.async&&(this.async=!0);this._colorEvaluator=C("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(a,B,da){if(!this._loadGpServerMetadata)return this._execute(a,B,da);var la=new Z(e._dfdCanceller),ma=this._url.path,pa=ma.lastIndexOf("/GPServer/");
0<pa&&(ma=ma.slice(0,pa+9));la._pendingDfd=n({url:ma,callbackParamName:"callback",content:W.mixin({},this._url.query,{f:"json"})}).then(W.hitch(this,function(N){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===N.executionType;this._cimVersion=N.cimVersion;this._is11xService=!!this._cimVersion;la._pendingDfd=this._execute(a);return la._pendingDfd})).then(W.hitch(this,function(N){this._successHandler([N],null,B,la)})).otherwise(function(N){da&&da(N);la.errback(N)});return la},
_handler:function(a,B,da,la,ma){try{if(this.async)"esriJobSucceeded"===a.jobStatus?this.printGp.getResultData(a.jobId,"Output_File",W.hitch(this,function(N){pa=N.value;this._successHandler([pa],"onComplete",da,ma)})):this._errorHandler(Error(a.jobStatus),la,ma);else{var pa=a[0].value;this._successHandler([pa],"onComplete",da,ma)}}catch(N){this._errorHandler(N,la,ma)}},_execute:function(a,B,da){var la=this._handler,ma=this._errorHandler,pa=a.template||new v;pa.hasOwnProperty("showLabels")||(pa.showLabels=
!0);var N=pa.exportOptions,oa;N&&(oa={outputSize:[N.width,N.height],dpi:N.dpi});N=pa.layoutOptions;var na=[];if(N){this.legendAll=!1;N.legendLayers?t.forEach(N.legendLayers,function(D){var r={};r.id=D.layerId;D.subLayerIds&&(r.subLayerIds=D.subLayerIds);na.push(r)}):this.legendAll=!0;if("Miles"===N.scalebarUnit||"Kilometers"===N.scalebarUnit){var J="esriKilometers";var y="esriMiles"}else if("Meters"===N.scalebarUnit||"Feet"===N.scalebarUnit)J="esriMeters",y="esriFeet";var A={esriMiles:"mi",esriKilometers:"km",
esriFeet:"ft",esriMeters:"m"};A={titleText:N.titleText,authorText:N.authorText,copyrightText:N.copyrightText,customTextElements:N.customTextElements,scaleBarOptions:{metricUnit:J,metricLabel:A[J],nonMetricUnit:y,nonMetricLabel:A[y]},legendOptions:{operationalLayers:na}}}J=this._getPrintDefinition(a.map,pa);a.outSpatialReference&&(J.mapOptions.spatialReference=a.outSpatialReference.toJson());a.template&&x.isDefined(a.template.showAttribution)&&(J.mapOptions.showAttribution=a.template.showAttribution);
W.mixin(J,{exportOptions:oa,layoutOptions:A});this.allLayerslegend&&W.mixin(J.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(J.operationalLayers){oa=J.operationalLayers;var ea=function(D){return x.fixJson(W.mixin(D,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},ta=RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),qa=/[\u0600-\u06FF]/,wa=function(D){var r=D.text,X=(D=D.font)&&D.family&&D.family.toLowerCase();
r&&D&&("arial"===X||"arial unicode ms"===X)&&(D.family=ta.test(r)?"Arial Unicode MS":"Arial","normal"!==D.style&&qa.test(r)&&(D.family="Arial Unicode MS"))};for(A=0;A<oa.length;A++)if(oa[A].featureCollection&&oa[A].featureCollection.layers)for(y=0;y<oa[A].featureCollection.layers.length;y++){var Ba=oa[A].featureCollection.layers[y];if(Ba.layerDefinition&&Ba.layerDefinition.drawingInfo&&Ba.layerDefinition.drawingInfo.renderer&&Ba.layerDefinition.drawingInfo.renderer.symbol){var b=Ba.layerDefinition.drawingInfo.renderer;
"esriCLS"===b.symbol.type?b.symbol=ea(b.symbol):"esriTS"===b.symbol.type?wa(b.symbol):b.symbol.outline&&"esriCLS"===b.symbol.outline.type&&(b.symbol.outline=ea(b.symbol.outline))}if(Ba.featureSet&&Ba.featureSet.features)for(N=0;N<Ba.featureSet.features.length;N++)b=Ba.featureSet.features[N],b.symbol&&("esriCLS"===b.symbol.type?b.symbol=ea(b.symbol):"esriTS"===b.symbol.type?wa(b.symbol):b.symbol.outline&&"esriCLS"===b.symbol.outline.type&&(b.symbol.outline=ea(b.symbol.outline)))}}pa={Web_Map_as_JSON:O.toJson(x.fixJson(J)),
Format:pa.format,Layout_Template:pa.layout};a.extraParameters&&(pa=W.mixin(pa,a.extraParameters));var f=new Z(e._dfdCanceller);a=function(D,r){la(D,r,B,da,f)};J=function(D){ma(D,da,f)};f._pendingDfd=this.async?this.printGp.submitJob(pa,a,null,J):this.printGp.execute(pa,a,J);return f},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",
features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",
drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(a){if(!(8>=P("ie")||!a.path&&"image/svg+xml"!==a.contentType)){var B=R.createSurface(T.create("div"),1024,1024);var da="image/svg+xml"===a.contentType?B.createObject(R.Image,{src:"data:image/svg+xml;base64,"+a.imageData,width:M.pt2px(a.width),height:M.pt2px(a.height),x:0,y:0}):B.createObject(R.Path,a.path).setFill(a.color).setStroke(a.outline);"pendingRender"in B&&B._render(!0);var la=
B.rawNode.getContext("2d"),ma=Math.ceil(da.getBoundingBox().width),pa=Math.ceil(da.getBoundingBox().height);da=la.getImageData(da.getBoundingBox().x,da.getBoundingBox().y,ma,pa);la.canvas.width=ma;la.canvas.height=pa;la.putImageData(da,0,0);la=la.canvas.toDataURL("image/png");a={type:"esriPMS",imageData:la.substr(22,la.length),angle:a.angle,contentType:"image/png",height:a.size?a.size:M.px2pt(pa),width:a.size?ma/pa*a.size:M.px2pt(ma),xoffset:a.xoffset,yoffset:a.yoffset};B.destroy();return a}},_convertSvgRenderer:function(a){"simple"===
a.type&&a.symbol&&(a.symbol.path||"image/svg+xml"===a.symbol.contentType)?a.symbol=this._convertSvgSymbol(a.symbol):"uniqueValue"===a.type?(a.defaultSymbol&&(a.defaultSymbol.path||"image/svg+xml"===a.defaultSymbol.contentType)&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.uniqueValueInfos&&t.forEach(a.uniqueValueInfos,function(B){if(B.symbol.path||"image/svg+xml"===B.symbol.contentType)B.symbol=this._convertSvgSymbol(B.symbol)},this)):"classBreaks"===a.type&&(a.defaultSymbol&&(a.defaultSymbol.path||
"image/svg+xml"===a.defaultSymbol.contentType)&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.classBreakInfos&&t.forEach(a.classBreakInfos,function(B){if(B.symbol.path||"image/svg+xml"===B.symbol.contentType)B.symbol=this._convertSvgSymbol(B.symbol)},this))},_createFeatureCollection:function(a,B,da,la){var ma=this._createPolygonLayer(),pa=this._createPolylineLayer(),N=this._createPointLayer(),oa=this._createMultipointLayer(),na=this._createPointLayer();na.layerDefinition.name="textLayer";
delete na.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass)ma.layerDefinition.name=pa.layerDefinition.name=N.layerDefinition.name=oa.layerDefinition.name=W.getObject("arcgisProps.title",!1,a)||a.name||a.id;var J=a.renderer&&"esri.renderer.SimpleRenderer"===a.renderer.declaredClass;if(!a.renderer||a.renderer.valueExpression||W.isFunction(a.renderer.attributeField))delete ma.layerDefinition.drawingInfo,delete pa.layerDefinition.drawingInfo,
delete N.layerDefinition.drawingInfo,delete oa.layerDefinition.drawingInfo;else{var y=a.renderer.toJson({useLegacyRotationProperties:!0});if("temporal"===y.type){y={latestObservationRenderer:y.latestObservationRenderer,trackLinesRenderer:y.trackRenderer,observationAger:y.observationAger,renderer:y.observationRenderer};var A={};a._trackIdField&&(A.trackIdField=a._trackIdField);a._startTimeField&&(A.startTimeField=a._startTimeField);a._endTimeField&&(A.endTimeField=a._endTimeField);ma.layerDefinition.drawingInfo=
y;ma.layerDefinition.timeInfo=A;pa.layerDefinition.drawingInfo=y;pa.layerDefinition.timeInfo=A;N.layerDefinition.drawingInfo=y;N.layerDefinition.timeInfo=A;oa.layerDefinition.drawingInfo=y;oa.layerDefinition.timeInfo=A}else ma.layerDefinition.drawingInfo.renderer=y,pa.layerDefinition.drawingInfo.renderer=y,N.layerDefinition.drawingInfo.renderer=y,oa.layerDefinition.drawingInfo.renderer=y}y=a.fields;y||!a.renderer||a.renderer.valueExpression||W.isFunction(a.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===
a.renderer.declaredClass?(y=[{name:a.renderer.attributeField,type:"esriFieldTypeDouble"}],a.renderer.normalizationField&&y.push({name:a.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===a.renderer.declaredClass&&(y=[{name:a.renderer.attributeField,type:"esriFieldTypeString"}],a.renderer.attributeField2&&y.push({name:a.renderer.attributeField2,type:"esriFieldTypeString"}),a.renderer.attributeField3&&y.push({name:a.renderer.attributeField3,type:"esriFieldTypeString"})));
y&&(ma.layerDefinition.fields=y,pa.layerDefinition.fields=y,N.layerDefinition.fields=y,oa.layerDefinition.fields=y);y=a.graphics;a.isFeatureReductionActive&&a.isFeatureReductionActive()&&(y=a.getSingleGraphics());A=y.length;var ea;for(ea=0;ea<A;ea++){var ta=y[ea];if(!1!==ta.visible&&ta.geometry){var qa=ta.toJson();qa.symbol&&qa.symbol.outline&&qa.symbol.outline.color&&qa.symbol.outline.color[3]&&!this._is11xService&&(qa.symbol.outline.color[3]=255);if(a.renderer&&!qa.symbol&&(W.isFunction(a.renderer.attributeField)||
a.renderer.valueExpression||this._isFeatureCollectionRequired(a.renderer,a)||"esri.renderer.DotDensityRenderer"===a.renderer.declaredClass||da)){da=da||a.renderer;var wa=null;try{wa=da.getSymbol(ta)}catch(Ba){}if(!wa)continue;qa.symbol=wa.toJson();this._isFeatureCollectionRequired(da,a)&&this._applyVisualVariables(qa.symbol,{renderer:da,graphic:ta,symbol:wa,mapResolution:B&&B.getResolutionInMeters(),mapScale:B&&B.getScale()})}qa.symbol&&(qa.symbol.path||"image/svg+xml"===qa.symbol.contentType?qa.symbol=
this._convertSvgSymbol(qa.symbol):qa.symbol.text&&delete qa.attributes);switch(ta.geometry.type){case "polygon":ma.featureSet.features.push(qa);break;case "polyline":pa.featureSet.features.push(qa);break;case "point":qa.symbol&&qa.symbol.text?na.featureSet.features.push(qa):N.featureSet.features.push(qa);break;case "multipoint":oa.featureSet.features.push(qa);break;case "extent":qa.geometry=k.fromExtent(ta.geometry).toJson(),ma.featureSet.features.push(qa)}}}B=[];0<ma.featureSet.features.length&&
B.push(ma);0<pa.featureSet.features.length&&B.push(pa);0<oa.featureSet.features.length&&B.push(oa);0<N.featureSet.features.length&&B.push(N);0<na.featureSet.features.length&&B.push(na);if(!B.length)return null;t.forEach(B,function(Ba){var b=t.every(Ba.featureSet.features,function(f){return f.symbol});if(J||b)la&&la.forceFeatureAttributes||t.forEach(Ba.featureSet.features,function(f){delete f.attributes}),la.forceFeatureAttributes||delete Ba.layerDefinition.fields;b&&delete Ba.layerDefinition.drawingInfo});
t.forEach(B,function(Ba){Ba.layerDefinition.drawingInfo&&Ba.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(Ba.layerDefinition.drawingInfo.renderer)},this);return{id:a.id,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0,featureCollection:{layers:B}}},_getPrintDefinition:function(a,B){var da={operationalLayers:this._createOperationalLayers(a,B)},la=this._vtlExtent||a.extent,ma=a.spatialReference;this._vtlExtent=null;a.spatialReference._isWrappable()&&(la=la._normalize(!0),
ma=la.spatialReference);la={mapOptions:{showAttribution:a.showAttribution,extent:la.toJson(),spatialReference:ma.toJson()}};B.preserveScale&&W.mixin(la.mapOptions,{scale:B.outScale||a.getScale()});a.timeExtent&&W.mixin(la.mapOptions,{time:[a.timeExtent.startTime.getTime(),a.timeExtent.endTime.getTime()]});a={};W.mixin(a,la,da);return a},_createOperationalLayers:function(a,B){var da,la=[],ma=0;B.preserveScale&&(ma=B.outScale||a.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=
null;var pa=t.map(a.layerIds,a.getLayer,a);a._mapImageLyr&&pa.push(a._mapImageLyr);for(da=0;da<pa.length;da++){var N=pa[da];if(N.loaded&&N.visible&&(!ma||N.isVisibleAtScale(ma))){var oa=N.declaredClass;var na={id:N.id,title:W.getObject("arcgisProps.title",!1,N)||N.id,opacity:N.opacity,minScale:N.minScale||0,maxScale:N.maxScale||0};na=W.mixin(na,this._getUrlAndToken(N));N.getNode()&&Q.get(N.getNode(),"data-reference")&&(na._isRefLayer=!0);switch(oa){case "esri.layers.ArcGISDynamicMapServiceLayer":var J=
[];oa=!!N._params.layers;if(N._params.dynamicLayers)oa=B.outScale?N._getDynLayerObjs(B.outScale):O.fromJson(N._params.dynamicLayers),t.forEach(oa,function(qa){J.push({id:qa.id,name:qa.name,layerDefinition:qa});delete qa.id;delete qa.name;delete qa.maxScale;delete qa.minScale}),0===J.length&&(na.visibleLayers=[-1]);else if(N.supportsDynamicLayers){if(oa||N.layerDefinitions||N.layerTimeOptions){var y=N.createDynamicLayerInfosFromLayerInfos(),A=null;oa&&(A=N.visibleLayers);A=d._getVisibleLayers(y,A);
var ea=d._getLayersForScale(B.outScale||a.getScale(),y);t.forEach(y,function(qa){if(!qa.subLayerIds){var wa=qa.id;-1<t.indexOf(A,wa)&&-1<t.indexOf(ea,wa)&&(qa={source:qa.source.toJson()},N.layerDefinitions&&N.layerDefinitions[wa]&&(qa.definitionExpression=N.layerDefinitions[wa]),N.layerTimeOptions&&N.layerTimeOptions[wa]&&(qa.layerTimeOptions=N.layerTimeOptions[wa].toJson()),J.push({id:wa,layerDefinition:qa}))}});0===J.length&&(na.visibleLayers=[-1])}}else t.forEach(N.layerInfos,function(qa){var wa=
{id:qa.id,layerDefinition:{}};N.layerDefinitions&&N.layerDefinitions[qa.id]&&(wa.layerDefinition.definitionExpression=N.layerDefinitions[qa.id]);N.layerTimeOptions&&N.layerTimeOptions[qa.id]&&(wa.layerDefinition.layerTimeOptions=N.layerTimeOptions[qa.id].toJson());(wa.layerDefinition.definitionExpression||wa.layerDefinition.layerTimeOptions)&&J.push(wa)}),oa&&(na.visibleLayers=N.visibleLayers.length?N.visibleLayers:[-1]);J.length&&(na.layers=J);la.push(na);this.allLayerslegend&&this.allLayerslegend.push({id:N.id,
subLayerIds:N.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":na=W.mixin(na,{url:N.url,bandIds:N.bandIds,compressionQuality:N.compressionQuality,format:N.format,interpolation:N.interpolation});N.mosaicRule&&W.mixin(na,{mosaicRule:N.mosaicRule.toJson()});if(N.renderingRule||N.renderer)this._is11xService?(N.renderingRule&&(na.renderingRule=N.renderingRule.toJson()),N.renderer&&(na.layerDefinition=na.layerDefinition||{},na.layerDefinition.drawingInfo=na.layerDefinition.drawingInfo||
{},na.layerDefinition.drawingInfo.renderer=N.renderer.toJson())):(oa=N.getExportImageRenderingRule())&&W.mixin(na,{renderingRule:oa.toJson()});la.push(na);this.allLayerslegend&&this.allLayerslegend.push({id:N.id});break;case "esri.layers.RasterXLayer":this._is11xService&&(na=W.mixin(na,{url:N.url,bandIds:N.bandIds,interpolation:N.interpolation}),N.renderer&&(na.layerDefinition=na.layerDefinition||{},na.layerDefinition.drawingInfo=na.layerDefinition.drawingInfo||{},na.layerDefinition.drawingInfo.renderer=
N.renderer.toJson()),la.push(na),this.allLayerslegend&&this.allLayerslegend.push({id:N.id}));break;case "esri.layers.WMSLayer":na=W.mixin(na,{url:N.url,title:N.title,type:"wms",version:N.version,transparentBackground:N.imageTransparency,visibleLayers:N.visibleLayers});la.push(na);this.allLayerslegend&&this.allLayerslegend.push({id:N.id,subLayerIds:N.visibleLayers});break;case "esri.virtualearth.VETiledLayer":oa=N.mapStyle;"roadOnDemand"===oa?oa="Road":"aerialWithLabelsOnDemand"===oa&&(oa="Hybrid");
na=W.mixin(na,{visibility:N.visible,type:"BingMaps"+oa,culture:N.culture,key:N.bingMapsKey});la.push(na);break;case "esri.layers.OpenStreetMapLayer":na=W.mixin(na,{credits:N.copyright,type:"OpenStreetMap",url:q.getAbsoluteUrl(N.tileServers[0])});la.push(na);break;case "esri.layers.WMTSLayer":na=W.mixin(na,{url:N.url,type:"wmts",layer:N._identifier,style:N._style,format:N.format,tileMatrixSet:N._tileMatrixSetId});la.push(na);break;case "esri.layers.MapImageLayer":oa=N.getImages();t.forEach(oa,function(qa,
wa){qa.visible&&qa.href&&(na={id:N.id+"_image"+wa,type:"image",title:N.id,minScale:N.minScale||0,maxScale:N.maxScale||0,opacity:N.opacity*qa.opacity,extent:qa.extent.toJson()},"data:image/png;base64,"===qa.href.substr(0,22)?na.imageData=qa.href.substr(22):na.url=qa.href,la.push(na))});break;case "esri.layers.VectorTileLayer":delete na.url;delete na.token;if(this._is11xService&&N.currentStyleInfo.serviceUrl&&N.currentStyleInfo.styleUrl&&(oa=F.id&&F.id.findCredential(N.currentStyleInfo.styleUrl),y=
F.id&&F.id.findCredential(N.currentStyleInfo.serviceUrl),!oa&&!y||"2.1.0"!==this._cimVersion)){na.type="VectorTileLayer";na.styleUrl=N.currentStyleInfo.styleUrl;oa&&(na.token=oa.token);y&&y.token!==na.token&&(na.additionalTokens=[{url:N.currentStyleInfo.serviceUrl,token:y.token}]);la.push(na);break}na.type="image";oa=this._vtlExtent||a.extent.offset(0,0);var ta=B.exportOptions&&B.exportOptions.dpi||96;y={format:"png",pixelRatio:ta/96};"MAP_ONLY"!==B.layout||!B.preserveScale||B.outScale&&B.outScale!==
a.getScale()||96!==ta||!B.exportOptions||B.exportOptions.width%2===a.width%2&&B.exportOptions.height%2===a.height%2||(y.area={x:0,y:0,width:a.width,height:a.height},B.exportOptions.width%2!==a.width%2&&--y.area.width,B.exportOptions.height%2!==a.height%2&&--y.area.height,this._vtlExtent||(ta=a.toMap({x:y.area.width,y:y.area.height}),oa.update(oa.xmin,ta.y,ta.x,oa.ymax,oa.spatialReference),this._vtlExtent=oa));na.extent=oa._normalize(!0).toJson();oa=N.takeScreenshot(y);oa.isResolved()?oa.then(function(qa){"data:image/png;base64,"===
qa.dataURL.substr(0,22)&&(na.imageData=qa.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");na.imageData&&la.push(na);break;case "esri.layers.WebTiledLayer":oa=N.url.replace(/\$\{/g,"{");na=W.mixin(na,{type:"WebTiledLayer",urlTemplate:oa,credits:N.copyright});N.subDomains&&0<N.subDomains.length&&(na.subDomains=N.subDomains);N._wmtsInfo&&(na.wmtsInfo=N._wmtsInfo);delete na.url;la.push(na);break;default:if(N.getTileUrl||N.getImageUrl)na=
W.mixin(na,{url:N.url}),la.push(na)}}}pa=t.map(a.graphicsLayerIds,a.getLayer,a);for(da=0;da<pa.length;da++)N=pa[da],N.isFeatureReductionActive&&N.isFeatureReductionActive()&&(N.getSingleGraphics().length?pa.splice(++da,0,N.getFeatureReductionLayer()):pa[da]=N.getFeatureReductionLayer());for(da=0;da<pa.length;da++)if(N=pa[da],N.loaded&&N.visible&&(!ma||N.isVisibleAtScale(ma)))switch(oa=N.declaredClass,oa){case "esri.layers.CSVLayer":if(this._is11xService){na={id:N.id,url:N.url,title:N.title,opacity:N.opacity,
minScale:N.minScale||0,maxScale:N.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:N.latitudeFieldName,longitudeFieldName:N.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:N.renderer&&N.renderer.toJson()}}};la.push(na);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===oa&&!B.showLabels||N.renderer&&"esri.renderer.HeatmapRenderer"===N.renderer.declaredClass)continue;oa=null;N.url&&N.renderer&&("esri.renderer.ScaleDependentRenderer"===
N.renderer.declaredClass?"scale"===N.renderer.rangeType?oa=N.renderer.getRendererInfoByScale(a.getScale())&&N.renderer.getRendererInfoByScale(a.getScale()).renderer:"zoom"===N.renderer.rangeType&&(oa=N.renderer.getRendererInfoByZoom(a.getZoom())&&N.renderer.getRendererInfoByZoom(a.getZoom()).renderer):oa=N.renderer);y=oa&&"esri.layers.CSVLayer"!==N.declaredClass&&!this._isFeatureCollectionRequired(oa,N)&&!oa.valueExpression;ta=N.isFeatureReductionActive&&N.isFeatureReductionActive();if(oa&&!ta&&"esri.renderer.DotDensityRenderer"!==
oa.declaredClass&&"esri.layers.StreamLayer"!==N.declaredClass&&(this._is11xService||y)&&("esri.renderer.SimpleRenderer"===oa.declaredClass||"esri.renderer.TemporalRenderer"===oa.declaredClass||null==oa.attributeField||W.isString(oa.attributeField)&&N._getField(oa.attributeField,!0)))if(na={id:N.id,title:W.getObject("arcgisProps.title",!1,N)||N.id,opacity:N.opacity,minScale:N.minScale||0,maxScale:N.maxScale||0,layerDefinition:{drawingInfo:{renderer:oa.toJson({useLegacyRotationProperties:!this._is11xService})}}},
na=W.mixin(na,this._getUrlAndToken(N)),"esri.renderer.TemporalRenderer"===oa.declaredClass&&(y=na.layerDefinition.drawingInfo,y.latestObservationRenderer=y.renderer.latestObservationRenderer,y.trackLinesRenderer=y.renderer.trackRenderer,y.observationAger=y.renderer.observationAger,y.renderer=y.renderer.observationRenderer,N._trackIdField&&(na.layerDefinition.timeInfo={trackIdField:N._trackIdField})),this._convertSvgRenderer(na.layerDefinition.drawingInfo.renderer),this._is11xService||1>N.opacity||
"esri.renderer.TemporalRenderer"===oa.declaredClass||this._updateLayerOpacity(na))if(N._params.source&&(oa=N._params.source.toJson(),W.mixin(na.layerDefinition,{source:oa})),N.getDefinitionExpression()&&W.mixin(na.layerDefinition,{definitionExpression:N.getDefinitionExpression()}),2!==N.mode)0<N.getSelectedFeatures().length&&(oa=t.map(N.getSelectedFeatures(),function(qa){return qa.attributes[N.objectIdField]}),0<oa.length&&N.getSelectionSymbol()&&W.mixin(na,{selectionObjectIds:oa,selectionSymbol:N.getSelectionSymbol().toJson()}));
else{oa=t.map(N.getSelectedFeatures(),function(qa){return qa.attributes[N.objectIdField]});if(0===oa.length||!N._params.drawMode)break;W.mixin(na.layerDefinition,{objectIds:oa});oa=null;N.getSelectionSymbol()&&(oa=new w(N.getSelectionSymbol()));W.mixin(na.layerDefinition.drawingInfo,{renderer:oa&&oa.toJson()})}else na=this._createFeatureCollection(N,a,null,B);else na=oa&&(oa.valueExpression||this._isFeatureCollectionRequired(oa,N)||"esri.renderer.DotDensityRenderer"===oa.declaredClass)?this._createFeatureCollection(N,
a,oa,B):this._createFeatureCollection(N,a,null,B);if(!na)continue;la.push(na);this.allLayerslegend&&this.allLayerslegend.push({id:N.id});break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":na=this._createFeatureCollection(N,a,null,B);if(!na)continue;la.push(na);this.allLayerslegend&&this.allLayerslegend.push({id:N.id});break;case "esri.layers.ArcGISImageServiceVectorLayer":na={id:N.id,title:W.getObject("arcgisProps.title",!1,N)||N.id,opacity:N.opacity,
minScale:N.minScale||0,maxScale:N.maxScale||0,visibility:N.visible,symbolTileSize:N.symbolTileSize,layerDefinition:{drawingInfo:{renderer:N.renderer.toJson({useLegacyRotationProperties:!this._is11xService})}}},na=W.mixin(na,this._getUrlAndToken(N)),N.mosaicRule&&W.mixin(na,{mosaicRule:N.mosaicRule.toJson()}),la.push(na),this.allLayerslegend&&this.allLayerslegend.push({id:N.id})}ma&&t.forEach(la,function(qa){qa.minScale=0;qa.maxScale=0});a.graphics&&0<a.graphics.graphics.length&&(na=this._createFeatureCollection(a.graphics,
a,null,B))&&la.push(na);a._labels&&B.showLabels&&(na=this._createFeatureCollection(a._labels,a,null,B))&&la.push(na);t.forEach(la,function(qa,wa,Ba){qa._isRefLayer&&(delete qa._isRefLayer,Ba.splice(wa,1),Ba.push(qa))});return la},_getUrlAndToken:function(a){return{token:a._getToken(),url:a._url?a._url.path:null}},_updateLayerOpacity:function(a){var B=this._colorEvaluator(a);B=t.filter(B,function(pa){return W.isArray(pa)&&4===pa.length});var da=!0;if(B.length){var la=B[0][3],ma;for(ma=1;ma<B.length;ma++)if(la!==
B[ma][3]){da=!1;break}if(da)for(a.opacity=la/255,ma=0;ma<B.length;ma++)B[ma][3]=255}return da},_isFeatureCollectionRequired:function(a,B){if(B&&B.isFeatureReductionActive&&B.isFeatureReductionActive())return!0;var da=!1;if(B=this._getVariable(a,"rotationInfo",!1))da=(da=B.field)&&W.isFunction(da)||B.valueExpression;return a.hasVisualVariables("sizeInfo")||a.hasVisualVariables("colorInfo")||a.hasVisualVariables("opacityInfo")||da},_getVariable:function(a,B,da){if(a)var la=(a=a.getVisualVariablesForType(B,
da))&&a[0];return la},_applyVisualVariables:function(a,B){var da=B.renderer,la=B.graphic,ma=B.symbol,pa=B.mapResolution,N=B.mapScale,oa=ma.type;if("textsymbol"!==oa&&"shieldlabelsymbol"!==oa){var na=this._getVariable(da,"sizeInfo",!1),J=this._getVariable(da,"colorInfo",!1),y=this._getVariable(da,"opacityInfo",!1);B=this._getVariable(da,"rotationInfo",!1);ma instanceof I&&(na=this._getVariable(da,"sizeInfo","outline")||na);pa=na?da.getSize(la,{sizeInfo:na,shape:"simplemarkersymbol"===oa?ma.style:null,
resolution:pa,scale:N}):la.size;null!=pa&&("simplemarkersymbol"===oa?a.size=M.px2pt(pa):"picturemarkersymbol"===oa?(N=ma.width/ma.height*pa,a.width=M.px2pt(N),a.height=M.px2pt(pa),0!==ma.xoffset&&(a.xoffset=M.px2pt(ma.xoffset/ma.width*N)),0!==ma.yoffset&&(a.yoffset=M.px2pt(ma.yoffset/ma.height*pa))):"simplelinesymbol"===oa?a.width=M.px2pt(pa):a.outline&&(a.outline.width=M.px2pt(pa)));J&&(!(ma=da.getColor(la,{colorInfo:J}))||"simplemarkersymbol"!==oa&&"simplelinesymbol"!==oa&&"simplefillsymbol"!==
oa||(a.color=l.toJsonColor(ma)));y&&(ma=da.getOpacity(la,{opacityInfo:y}),null!=ma&&a.color&&(a.color[3]=Math.round(255*ma)));B&&(da=da.getRotationAngle(la,{rotationInfo:B}))&&(a.angle=-da)}}});P("extend-esri")&&W.setObject("tasks.PrintTask",V,F);return V})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,H,v,G,Q,T,M,R){V=V(n,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(C){this._jobUpdateHandler=W.hitch(this,this._jobUpdateHandler);this._getJobStatus=W.hitch(this,this._getJobStatus);this._getResultDataHandler=
W.hitch(this,this._getResultDataHandler);this._getResultImageHandler=W.hitch(this,this._getResultImageHandler);this._executeHandler=W.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(C){this.updateDelay=C},setProcessSpatialReference:function(C){this.processSpatialReference=C},setOutputSpatialReference:function(C){this._setOutSR(C)},setOutSpatialReference:function(C){this._setOutSR(C)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(C){this.outSpatialReference=this.outputSpatialReference=C},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(C,a,B){for(var da in C){var la=C[da];W.isArray(la)?C[da]=Z.toJson(t.map(la,function(ma){return this._gpEncode({item:ma},!0).item},this)):la instanceof Date&&(C[da]=la.getTime())}return this._encode(C,a,B)},_decode:function(C){var a=
C.dataType,B=new Q(C);if(-1!==t.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],a))return B;if("GPLinearUnit"===a)B.value=new I(B.value);else if("GPFeatureRecordSetLayer"===a||"GPRecordSet"===a)B.value=new q(B.value);else if("GPDataFile"===a)B.value=new H(B.value);else if("GPDate"===a)C=B.value,W.isString(C)?B.value=new G({date:C}):B.value=new Date(C);else if("GPRasterData"===a||"GPRasterDataLayer"===a)C=C.value.mapImage,B.value=C?new R(C):new v(B.value);else if(-1!==a.indexOf("GPMultiValue:")){var da=
a.split(":")[1];C=B.value;B.value=t.map(C,function(la){return this._decode({paramName:"_name",dataType:da,value:la}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+B.dataType),B=null;return B},submitJob:function(C,a,B,da,la){var ma=this._getOutSR(),pa=la.assembly;C=this._gpEncode(W.mixin({},this._url.query,{f:"json","env:outSR":ma?ma.wkid||Z.toJson(ma.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||Z.toJson(this.processSpatialReference.toJson()):
null},C),null,pa&&pa[0]);var N=this._jobUpdateHandler,oa=this._errorHandler;return d({url:this._url.path+"/submitJob",content:C,callbackParamName:"callback",load:function(na,J){N(na,J,!1,a,B,la.dfd)},error:function(na){oa(na,da,la.dfd)}})},_jobUpdateHandler:function(C,a,B,da,la,ma){var pa=C.jobId;a=new k(C);this._successHandler([a],"onStatusUpdate",la,B&&ma);if(!B)switch(clearTimeout(this._updateTimers[pa]),this._updateTimers[pa]=null,ma&&ma.progress(a),C.jobStatus){case k.STATUS_SUBMITTED:case k.STATUS_EXECUTING:case k.STATUS_WAITING:case k.STATUS_NEW:var N=
this._getJobStatus;this._updateTimers[pa]=setTimeout(function(){N(pa,B,da,la,ma)},this.updateDelay);break;default:this._successHandler([a],"onJobComplete",da,ma)}},_getJobStatus:function(C,a,B,da,la){var ma=this._jobUpdateHandler;d({url:this._url.path+"/jobs/"+C,content:W.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(pa,N){ma(pa,N,a,B,da,la)},error:this._errorHandler})},_getResultDataHandler:function(C,a,B,da,la){try{var ma=this._decode(C);this._successHandler([ma],
"onGetResultDataComplete",B,la)}catch(pa){this._errorHandler(pa,da,la)}},getResultData:function(C,a,B,da){var la=this._getResultDataHandler,ma=this._errorHandler,pa=new O(e._dfdCanceller);pa._pendingDfd=d({url:this._url.path+"/jobs/"+C+"/results/"+a,content:W.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(N,oa){la(N,oa,B,da,pa)},error:function(N){ma(N,da,pa)}});return pa},checkJobStatus:function(C,a,B){var da=this._jobUpdateHandler,la=this._errorHandler,
ma=new O(e._dfdCanceller);ma._pendingDfd=d({url:this._url.path+"/jobs/"+C,content:W.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(pa,N){da(pa,N,!0,null,a,ma)},error:function(pa){la(pa,B,ma)}});return ma},cancelJob:function(C,a,B){var da=this._errorHandler,la=new O(e._dfdCanceller);la._pendingDfd=d({url:this._url.path+"/jobs/"+C+"/cancel",content:W.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:W.hitch(this,function(ma,pa){this._successHandler([ma],
"onJobCancel",a,la)}),error:function(ma){da(ma,B,la)}});return la},execute:function(C,a,B,da){var la=this._getOutSR(),ma=da.assembly;C=this._gpEncode(W.mixin({},this._url.query,{f:"json","env:outSR":la?la.wkid||Z.toJson(la.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||Z.toJson(this.processSpatialReference.toJson()):null},C),null,ma&&ma[0]);var pa=this._executeHandler,N=this._errorHandler;return d({url:this._url.path+"/execute",content:C,callbackParamName:"callback",
load:function(oa,na){pa(oa,na,a,B,da.dfd)},error:function(oa){N(oa,B,da.dfd)}})},_executeHandler:function(C,a,B,da,la){try{var ma=C.results,pa,N=C.messages;var oa=0;for(pa=ma.length;oa<pa;oa++)ma[oa]=this._decode(ma[oa]);oa=0;for(pa=N.length;oa<pa;oa++)N[oa]=new w(N[oa]);this._successHandler([ma,N],"onExecuteComplete",B,la)}catch(na){this._errorHandler(na,da,la)}},_getResultImageHandler:function(C,a,B,da,la){try{var ma=this._decode(C);this._successHandler([ma],"onGetResultImageComplete",B,la)}catch(pa){this._errorHandler(pa,
da,la)}},getResultImage:function(C,a,B,da,la){var ma=this._getResultImageHandler,pa=this._errorHandler;B=this._gpEncode(W.mixin({},this._url.query,{f:"json"},B.toJson()));var N=new O(e._dfdCanceller);N._pendingDfd=d({url:this._url.path+"/jobs/"+C+"/results/"+a,content:B,callbackParamName:"callback",load:function(oa,na){ma(oa,na,da,la,N)},error:function(oa){pa(oa,la,N)}});return N},cancelJobStatusUpdates:function(C){clearTimeout(this._updateTimers[C]);this._updateTimers[C]=null},getResultImageLayer:function(C,
a,B,da){if(null==a){var la=this._url.path.indexOf("/GPServer/");C=this._url.path.substring(0,la)+"/MapServer/jobs/"+C}else C=this._url.path+"/jobs/"+C+"/results/"+a;this._url.query&&(C+="?"+F.objectToQuery(this._url.query));a=null==a?new M(C,{imageParameters:B}):new T(C,{imageParameters:B},!0);this.onGetResultImageLayerComplete(a);da&&da(a);return a},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},
onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});l._createWrappers(V);P("extend-esri")&&W.setObject("tasks.Geoprocessor",V,x);return V})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(V,W,t,O,Z){V=V(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(P){this.messages=[];W.mixin(this,P);P=this.messages;var F,x=P.length;for(F=0;F<x;F++)P[F]=new Z(P[F])},jobId:"",jobStatus:""});W.mixin(V,{STATUS_CANCELLED:"esriJobCancelled",
STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});t("extend-esri")&&W.setObject("tasks.JobInfo",V,O);return V})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],
function(V,W,t,O){V=V(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(Z){W.mixin(this,Z)}});W.mixin(V,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});t("extend-esri")&&
W.setObject("tasks.GPMessage",V,O);return V})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(V,W,t,O){V=V(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(Z){Z&&W.mixin(this,Z)},distance:0,units:null,toJson:function(){var Z={};this.distance&&(Z.distance=this.distance);this.units&&(Z.units=this.units);return Z}});t("extend-esri")&&W.setObject("tasks.LinearUnit",V,O);return V})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(V,W,t,O){V=V(null,{declaredClass:"esri.tasks.DataFile",constructor:function(Z){Z&&W.mixin(this,Z)},url:null,itemID:null,toJson:function(){var Z={};this.url&&(Z.url=this.url);this.itemID&&(Z.itemID=this.itemID);return Z}});t("extend-esri")&&W.setObject("tasks.DataFile",V,O);return V})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(V,W,t,O){V=V(null,{declaredClass:"esri.tasks.RasterData",
constructor:function(Z){Z&&W.mixin(this,Z)},url:null,format:null,itemID:null,toJson:function(){var Z={};this.url&&(Z.url=this.url);this.format&&(Z.format=this.format);this.itemID&&(Z.itemID=this.itemID);return Z}});t("extend-esri")&&W.setObject("tasks.RasterData",V,O);return V})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(V,W,t,O,Z){V=V(null,{declaredClass:"esri.tasks.Date",constructor:function(P){P&&(P.format&&(this.format=
P.format),this.date=t.parse(P.date,{selector:"date",datePattern:this.format}))},date:new Date,format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:t.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});O("extend-esri")&&W.setObject("tasks.Date",V,Z);return V})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(V,W,t,O){V=V(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(Z){W.mixin(this,
Z)}});t("extend-esri")&&W.setObject("tasks.ParameterValue",V,O);return V})},"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(V,W,t,O,Z,P,F){V=V(F,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(x,d){d&&d.imageParameters&&d.imageParameters.extent&&(this.initialExtent=this.fullExtent=d.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);
this.getImageUrl=W.hitch(this,this.getImageUrl);this.loaded=!0;this.onLoad(this)},getImageUrl:function(x,d,e,l){var n=x.spatialReference.wkid;l(this._url.path+"?"+Z.objectToQuery(W.mixin(this._params,{f:"image",bbox:t.toJson(x.toJson()),bboxSR:n,imageSR:n,size:d+","+e})))}});O("extend-esri")&&W.setObject("tasks._GPResultImageLayer",V,P);return V})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(V,W,t,O){V=V(null,{declaredClass:"esri.tasks.PrintTemplate",
label:null,exportOptions:{width:800,height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});t("extend-esri")&&W.setObject("tasks.PrintTemplate",V,O);return V})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),function(V,W,t,O,Z,P,F,
x,d,e,l,n,q){function k(J,y,A,ea,ta,qa,wa,Ba,b,f){var D=y.length,r=0;if(f){var X=f.l/ta;r=f.i}else X=y[0]/ta;for(;qa<wa;){if(qa+X>wa){var ba={l:(qa+X-wa)*ta,i:r};X=wa-qa}r%2||(J.beginPath(),J.arc(A,ea,ta,qa,qa+X,Ba),b&&J.stroke());qa+=X;++r;X=y[r%D]/ta}return ba}function w(J,y,A,ea){var ta=0,qa=0,wa=0;if(ea){var Ba=ea.l;wa=ea.i}else Ba=y[0];for(;1>qa;)qa=q.tAtLength(J,Ba),1==qa&&(ta=q.computeLength(J),ta={l:Ba-ta,i:wa}),J=q.splitBezierAtT(J,qa),wa%2||A.push(J[0]),J=J[1],++wa,Ba=y[wa%y.length];return ta}
function I(J,y,A,ea){var ta=[y.last.x,y.last.y].concat(A),qa=!(J instanceof Array);A=4===A.length?"quadraticCurveTo":"bezierCurveTo";var wa=[];y=w(ta,y.canvasDash,wa,ea);for(ea=0;ea<wa.length;++ea)ta=wa[ea],qa?(J.moveTo(ta[0],ta[1]),J[A].apply(J,ta.slice(2))):(J.push("moveTo",[ta[0],ta[1]]),J.push(A,ta.slice(2)));return y}function H(J,y,A,ea,ta,qa,wa){var Ba=0,b=0,f=0,D=q.distance(A,ea,ta,qa),r=0;y=y.canvasDash;var X=A,ba=ea,ra=!(J instanceof Array);wa?(f=wa.l,r=wa.i):f+=y[0];for(;.01<Math.abs(1-
b);){f>D&&(Ba={l:f-D,i:r},f=D);b=f/D;wa=A+(ta-A)*b;var g=ea+(qa-ea)*b;r++%2||(ra?(J.moveTo(X,ba),J.lineTo(wa,g)):(J.push("moveTo",[X,ba]),J.push("lineTo",[wa,g])));X=wa;ba=g;f+=y[r%y.length]}return Ba}var v=V.canvas={},G=null,Q=l.multiplyPoint,T=Math.PI,M=2*T,R=T/2;n=W.extend;if(Z.global.CanvasRenderingContext2D){Z=Z.doc.createElement("canvas").getContext("2d");var C="function"==typeof Z.setLineDash,a="function"==typeof Z.fillText}var B={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,
1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};v.Shape=O("dojox.gfx.canvas.Shape",x.Shape,{_render:function(J){J.save();this._renderTransform(J);this._renderClip(J);this._renderShape(J);this._renderFill(J,!0);this._renderStroke(J,!0);J.restore()},_renderClip:function(J){this.canvasClip&&(this.canvasClip.render(J),J.clip())},_renderTransform:function(J){if("canvasTransform"in this){var y=this.canvasTransform;
J.translate(y.dx,y.dy);J.rotate(y.angle2);J.scale(y.sx,y.sy);J.rotate(y.angle1)}},_renderShape:function(J){},_renderFill:function(J,y){if("canvasFill"in this){var A=this.fillStyle;if("canvasFillImage"in this){var ea=A.width,ta=A.height,qa=this.canvasFillImage.width,wa=this.canvasFillImage.height,Ba=Math.min(ea==qa?1:ea/qa,ta==wa?1:ta/wa),b=(ea-Ba*qa)/2,f=(ta-Ba*wa)/2;G.width=ea;G.height=ta;var D=G.getContext("2d");D.clearRect(0,0,ea,ta);D.drawImage(this.canvasFillImage,0,0,qa,wa,b,f,Ba*qa,Ba*wa);
this.canvasFill=J.createPattern(G,"repeat");delete this.canvasFillImage}J.fillStyle=this.canvasFill;y&&("pattern"!==A.type||0===A.x&&0===A.y||J.translate(A.x,A.y),J.fill())}else J.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(J,y){var A=this.strokeStyle;A?(J.strokeStyle=A.color.toString(),J.lineWidth=A.width,J.lineCap=A.cap,"number"==typeof A.join?(J.lineJoin="miter",J.miterLimit=A.join):J.lineJoin=A.join,this.canvasDash?C?(J.setLineDash(this.canvasDash),y&&J.stroke()):this._renderDashedStroke(J,
y):y&&J.stroke()):y||(J.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(J,y){},getEventSource:function(){return null},on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(J){this.inherited(arguments);var y=J?"width"in J?"rect":"cx"in J?"ellipse":"points"in J?"polyline":"d"in J?"path":null:null;if(J&&!y)return this;this.canvasClip=J?da(y,J):null;this.parent&&this.parent._makeDirty();return this}});var da=function(J,y){switch(J){case "ellipse":return{canvasEllipse:N({shape:y}),
render:function(A){return v.Ellipse.prototype._renderShape.call(this,A)}};case "rect":return{shape:W.delegate(y,{r:0}),render:function(A){return v.Rect.prototype._renderShape.call(this,A)}};case "path":return{canvasPath:la(y),render:function(A){this.canvasPath._renderShape(A)}};case "polyline":return{canvasPolyline:y.points,render:function(A){return v.Polyline.prototype._renderShape.call(this,A)}}}return null},la=function(J){var y=new dojox.gfx.canvas.Path;y.canvasPath=[];y._setPath(J.d);return y},
ma=function(J,y,A){var ea=J.prototype[y];J.prototype[y]=A?function(){this.parent&&this.parent._makeDirty();ea.apply(this,arguments);A.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return ea.apply(this,arguments)}};ma(v.Shape,"setTransform",function(){this.matrix?this.canvasTransform=V.decompose(this.matrix):delete this.canvasTransform});ma(v.Shape,"setFill",function(){var J=this.fillStyle;if(J){if("object"==typeof J&&"type"in J){var y=this.surface.rawNode.getContext("2d");
switch(J.type){case "linear":case "radial":var A="linear"==J.type?y.createLinearGradient(J.x1,J.y1,J.x2,J.y2):y.createRadialGradient(J.cx,J.cy,0,J.cx,J.cy,J.r);t.forEach(J.colors,function(ea){A.addColorStop(ea.offset,V.normalizeColor(ea.color).toString())});break;case "pattern":G||(G=document.createElement("canvas")),y=new Image,this.surface.downloadImage(y,J.src),this.canvasFillImage=y}}else A=J.toString();this.canvasFill=A}else delete this.canvasFill});ma(v.Shape,"setStroke",function(){var J=this.strokeStyle;
if(J){var y=this.strokeStyle.style.toLowerCase();y in B&&(y=B[y]);if(y instanceof Array){this.canvasDash=y=y.slice();var A;for(A=0;A<y.length;++A)y[A]*=J.width;if("butt"!=J.cap){for(A=0;A<y.length;A+=2)y[A]-=J.width,1>y[A]&&(y[A]=1);for(A=1;A<y.length;A+=2)y[A]+=J.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!C&&!!this.canvasDash});ma(v.Shape,"setShape");v.Group=O("dojox.gfx.canvas.Group",v.Shape,{constructor:function(){x.Container._init.call(this)},_render:function(J){J.save();
this._renderTransform(J);this._renderClip(J);for(var y=0;y<this.children.length;++y)this.children[y]._render(J);J.restore()},destroy:function(){x.Container.clear.call(this,!0);v.Shape.prototype.destroy.apply(this,arguments)}});v.Rect=O("dojox.gfx.canvas.Rect",[v.Shape,x.Rect],{_renderShape:function(J){var y=this.shape,A=Math.min(y.r,y.height/2,y.width/2),ea=y.x,ta=ea+y.width,qa=y.y;y=qa+y.height;var wa=ea+A,Ba=ta-A,b=qa+A,f=y-A;J.beginPath();J.moveTo(wa,qa);A?(J.arc(Ba,b,A,-R,0,!1),J.arc(Ba,f,A,0,
R,!1),J.arc(wa,f,A,R,T,!1),J.arc(wa,b,A,T,T+R,!1)):(J.lineTo(Ba,qa),J.lineTo(ta,f),J.lineTo(wa,y),J.lineTo(ea,b));J.closePath()},_renderDashedStroke:function(J,y){var A=this.shape,ea=Math.min(A.r,A.height/2,A.width/2),ta=A.x,qa=ta+A.width,wa=A.y,Ba=wa+A.height,b=ta+ea,f=qa-ea,D=wa+ea,r=Ba-ea;ea?(J.beginPath(),A=H(J,this,b,wa,f,wa),y&&J.stroke(),A=k(J,this.canvasDash,f,D,ea,-R,0,!1,y,A),J.beginPath(),A=H(J,this,qa,D,qa,r,A),y&&J.stroke(),A=k(J,this.canvasDash,f,r,ea,0,R,!1,y,A),J.beginPath(),A=H(J,
this,f,Ba,b,Ba,A),y&&J.stroke(),A=k(J,this.canvasDash,b,r,ea,R,T,!1,y,A),J.beginPath(),A=H(J,this,ta,r,ta,D,A),y&&J.stroke(),k(J,this.canvasDash,b,D,ea,T,T+R,!1,y,A)):(J.beginPath(),A=H(J,this,b,wa,f,wa),A=H(J,this,f,wa,qa,r,A),A=H(J,this,qa,r,b,Ba,A),H(J,this,b,Ba,ta,D,A),y&&J.stroke())}});var pa=[];(function(){var J=e.curvePI4;pa.push(J.s,J.c1,J.c2,J.e);for(var y=45;360>y;y+=45){var A=l.rotateg(y);pa.push(Q(A,J.c1),Q(A,J.c2),Q(A,J.e))}})();var N=function(J){var y=[],A=J.shape,ea=l.normalize([l.translate(A.cx,
A.cy),l.scale(A.rx,A.ry)]);var ta=Q(ea,pa[0]);y.push([ta.x,ta.y]);for(A=1;A<pa.length;A+=3){var qa=Q(ea,pa[A]);var wa=Q(ea,pa[A+1]);ta=Q(ea,pa[A+2]);y.push([qa.x,qa.y,wa.x,wa.y,ta.x,ta.y])}if(J._needsDash){ta=[];qa=y[0];for(A=1;A<y.length;++A)wa=[],w(qa.concat(y[A]),J.canvasDash,wa),qa=[y[A][4],y[A][5]],ta.push(wa);J._dashedPoints=ta}return y};v.Ellipse=O("dojox.gfx.canvas.Ellipse",[v.Shape,x.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=N(this);return this},setStroke:function(){this.inherited(arguments);
C||(this.canvasEllipse=N(this));return this},_renderShape:function(J){var y=this.canvasEllipse,A;J.beginPath();J.moveTo.apply(J,y[0]);for(A=1;A<y.length;++A)J.bezierCurveTo.apply(J,y[A]);J.closePath()},_renderDashedStroke:function(J,y){var A=this._dashedPoints;J.beginPath();for(var ea=0;ea<A.length;++ea)for(var ta=A[ea],qa=0;qa<ta.length;++qa){var wa=ta[qa];J.moveTo(wa[0],wa[1]);J.bezierCurveTo(wa[2],wa[3],wa[4],wa[5],wa[6],wa[7])}y&&J.stroke()}});v.Circle=O("dojox.gfx.canvas.Circle",[v.Shape,x.Circle],
{_renderShape:function(J){var y=this.shape;J.beginPath();J.arc(y.cx,y.cy,y.r,0,M,1)},_renderDashedStroke:function(J,y){var A=this.shape,ea=0,ta=this.canvasDash.length;for(i=0;ea<M;){var qa=this.canvasDash[i%ta]/A.r;i%2||(J.beginPath(),J.arc(A.cx,A.cy,A.r,ea,ea+qa,0),y&&J.stroke());ea+=qa;++i}}});v.Line=O("dojox.gfx.canvas.Line",[v.Shape,x.Line],{_renderShape:function(J){var y=this.shape;J.beginPath();J.moveTo(y.x1,y.y1);J.lineTo(y.x2,y.y2)},_renderDashedStroke:function(J,y){var A=this.shape;J.beginPath();
H(J,this,A.x1,A.y1,A.x2,A.y2);y&&J.stroke()}});v.Polyline=O("dojox.gfx.canvas.Polyline",[v.Shape,x.Polyline],{setShape:function(){this.inherited(arguments);var J=this.shape.points,y=J[0],A;this.bbox=null;this._normalizePoints();if(J.length)if("number"==typeof y)y=J;else for(y=[],A=0;A<J.length;++A){var ea=J[A];y.push(ea.x,ea.y)}else y=[];this.canvasPolyline=y;return this},_renderShape:function(J){var y=this.canvasPolyline;if(y.length){J.beginPath();J.moveTo(y[0],y[1]);for(var A=2;A<y.length;A+=2)J.lineTo(y[A],
y[A+1])}},_renderDashedStroke:function(J,y){var A=this.canvasPolyline,ea=0;J.beginPath();for(var ta=0;ta<A.length;ta+=2)ea=H(J,this,A[ta],A[ta+1],A[ta+2],A[ta+3],ea);y&&J.stroke()}});v.Image=O("dojox.gfx.canvas.Image",[v.Shape,x.Image],{setShape:function(){this.inherited(arguments);var J=new Image;this.surface.downloadImage(J,this.shape.src);this.canvasImage=J;return this},_renderShape:function(J){var y=this.shape;J.drawImage(this.canvasImage,y.x,y.y,y.width,y.height)}});v.Text=O("dojox.gfx.canvas.Text",
[v.Shape,x.Text],{_setFont:function(){this.fontStyle?this.canvasFont=V.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var J=this.shape,y=0;if(J.text){var A=this.surface.rawNode.getContext("2d");A.save();this._renderTransform(A);this._renderFill(A,!1);this._renderStroke(A,!1);this.canvasFont&&(A.font=this.canvasFont);y=A.measureText(J.text).width;A.restore()}return y},_render:function(J){J.save();this._renderTransform(J);this._renderFill(J,!1);this._renderStroke(J,!1);
this._renderShape(J);J.restore()},_renderShape:function(J){var y=this.shape;y.text&&(J.textAlign="middle"===y.align?"center":y.align,this.canvasFont&&(J.font=this.canvasFont),this.canvasFill&&J.fillText(y.text,y.x,y.y),this.strokeStyle&&(J.beginPath(),J.strokeText(y.text,y.x,y.y),J.closePath()))}});ma(v.Text,"setFont");a||v.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var oa={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",
h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};v.Path=O("dojox.gfx.canvas.Path",[v.Shape,d.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);C||(this.segmented=!1,this._confirmSegmented());
return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(J){var y=W.clone(this.last);this[oa[J.action]](this.canvasPath,J.action,J.args,this._needsDash?this._dashedPath:null);this.last=y;this.inherited(arguments)},_renderShape:function(J){var y=this.canvasPath;J.beginPath();for(var A=0;A<y.length;A+=2)J[y[A]].apply(J,y[A+1])},_renderDashedStroke:C?function(){}:function(J,y){var A=this._dashedPath;J.beginPath();for(var ea=0;ea<A.length;ea+=2)J[A[ea]].apply(J,
A[ea+1]);y&&J.stroke()},_moveToA:function(J,y,A,ea){J.push("moveTo",[A[0],A[1]]);ea&&ea.push("moveTo",[A[0],A[1]]);for(y=2;y<A.length;y+=2)J.push("lineTo",[A[y],A[y+1]]),ea&&(this._dashResidue=H(ea,this,A[y-2],A[y-1],A[y],A[y+1],this._dashResidue));this.last.x=A[A.length-2];this.last.y=A[A.length-1];this.lastControl={}},_moveToR:function(J,y,A,ea){y="x"in this.last?[this.last.x+=A[0],this.last.y+=A[1]]:[this.last.x=A[0],this.last.y=A[1]];J.push("moveTo",y);ea&&ea.push("moveTo",y);for(y=2;y<A.length;y+=
2)J.push("lineTo",[this.last.x+=A[y],this.last.y+=A[y+1]]),ea&&(this._dashResidue=H(ea,this,ea[ea.length-1][0],ea[ea.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(J,y,A,ea){for(y=0;y<A.length;y+=2)ea&&(this._dashResidue=H(ea,this,this.last.x,this.last.y,A[y],A[y+1],this._dashResidue)),J.push("lineTo",[A[y],A[y+1]]);this.last.x=A[A.length-2];this.last.y=A[A.length-1];this.lastControl={}},_lineToR:function(J,y,A,ea){for(y=0;y<A.length;y+=2)J.push("lineTo",
[this.last.x+=A[y],this.last.y+=A[y+1]]),ea&&(this._dashResidue=H(ea,this,ea[ea.length-1][0],ea[ea.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(J,y,A,ea){for(y=0;y<A.length;++y)J.push("lineTo",[A[y],this.last.y]),ea&&(this._dashResidue=H(ea,this,ea[ea.length-1][0],ea[ea.length-1][1],A[y],this.last.y,this._dashResidue));this.last.x=A[A.length-1];this.lastControl={}},_hLineToR:function(J,y,A,ea){for(y=0;y<A.length;++y)J.push("lineTo",[this.last.x+=
A[y],this.last.y]),ea&&(this._dashResidue=H(ea,this,ea[ea.length-1][0],ea[ea.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(J,y,A,ea){for(y=0;y<A.length;++y)J.push("lineTo",[this.last.x,A[y]]),ea&&(this._dashResidue=H(ea,this,ea[ea.length-1][0],ea[ea.length-1][1],this.last.x,A[y],this._dashResidue));this.last.y=A[A.length-1];this.lastControl={}},_vLineToR:function(J,y,A,ea){for(y=0;y<A.length;++y)J.push("lineTo",[this.last.x,this.last.y+=A[y]]),ea&&
(this._dashResidue=H(ea,this,ea[ea.length-1][0],ea[ea.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(J,y,A,ea){for(y=0;y<A.length;y+=6)J.push("bezierCurveTo",A.slice(y,y+6)),ea&&(this._dashResidue=I(ea,this,J[J.length-1],this._dashResidue));this.last.x=A[A.length-2];this.last.y=A[A.length-1];this.lastControl.x=A[A.length-4];this.lastControl.y=A[A.length-3];this.lastControl.type="C"},_curveToR:function(J,y,A,ea){for(y=0;y<A.length;y+=6)J.push("bezierCurveTo",
[this.last.x+A[y],this.last.y+A[y+1],this.lastControl.x=this.last.x+A[y+2],this.lastControl.y=this.last.y+A[y+3],this.last.x+A[y+4],this.last.y+A[y+5]]),ea&&(this._dashResidue=I(ea,this,J[J.length-1],this._dashResidue)),this.last.x+=A[y+4],this.last.y+=A[y+5];this.lastControl.type="C"},_smoothCurveToA:function(J,y,A,ea){for(y=0;y<A.length;y+=4){var ta="C"==this.lastControl.type;J.push("bezierCurveTo",[ta?2*this.last.x-this.lastControl.x:this.last.x,ta?2*this.last.y-this.lastControl.y:this.last.y,
A[y],A[y+1],A[y+2],A[y+3]]);ea&&(this._dashResidue=I(ea,this,J[J.length-1],this._dashResidue));this.lastControl.x=A[y];this.lastControl.y=A[y+1];this.lastControl.type="C"}this.last.x=A[A.length-2];this.last.y=A[A.length-1]},_smoothCurveToR:function(J,y,A,ea){for(y=0;y<A.length;y+=4){var ta="C"==this.lastControl.type;J.push("bezierCurveTo",[ta?2*this.last.x-this.lastControl.x:this.last.x,ta?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+A[y],this.last.y+A[y+1],this.last.x+A[y+2],this.last.y+
A[y+3]]);ea&&(this._dashResidue=I(ea,this,J[J.length-1],this._dashResidue));this.lastControl.x=this.last.x+A[y];this.lastControl.y=this.last.y+A[y+1];this.lastControl.type="C";this.last.x+=A[y+2];this.last.y+=A[y+3]}},_qCurveToA:function(J,y,A,ea){for(y=0;y<A.length;y+=4)J.push("quadraticCurveTo",A.slice(y,y+4));ea&&(this._dashResidue=I(ea,this,J[J.length-1],this._dashResidue));this.last.x=A[A.length-2];this.last.y=A[A.length-1];this.lastControl.x=A[A.length-4];this.lastControl.y=A[A.length-3];this.lastControl.type=
"Q"},_qCurveToR:function(J,y,A,ea){for(y=0;y<A.length;y+=4)J.push("quadraticCurveTo",[this.lastControl.x=this.last.x+A[y],this.lastControl.y=this.last.y+A[y+1],this.last.x+A[y+2],this.last.y+A[y+3]]),ea&&(this._dashResidue=I(ea,this,J[J.length-1],this._dashResidue)),this.last.x+=A[y+2],this.last.y+=A[y+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(J,y,A,ea){for(y=0;y<A.length;y+=2){var ta="Q"==this.lastControl.type;J.push("quadraticCurveTo",[this.lastControl.x=ta?2*this.last.x-this.lastControl.x:
this.last.x,this.lastControl.y=ta?2*this.last.y-this.lastControl.y:this.last.y,A[y],A[y+1]]);ea&&(this._dashResidue=I(ea,this,J[J.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=A[A.length-2];this.last.y=A[A.length-1]},_qSmoothCurveToR:function(J,y,A,ea){for(y=0;y<A.length;y+=2){var ta="Q"==this.lastControl.type;J.push("quadraticCurveTo",[this.lastControl.x=ta?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=ta?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+
A[y],this.last.y+A[y+1]]);ea&&(this._dashResidue=I(ea,this,J[J.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=A[y];this.last.y+=A[y+1]}},_arcTo:function(J,y,A,ea){y="a"==y;for(var ta=0;ta<A.length;ta+=7){var qa=A[ta+5],wa=A[ta+6];y&&(qa+=this.last.x,wa+=this.last.y);var Ba=e.arcAsBezier(this.last,A[ta],A[ta+1],A[ta+2],A[ta+3]?1:0,A[ta+4]?1:0,qa,wa);t.forEach(Ba,function(b){J.push("bezierCurveTo",b)});ea&&(this._dashResidue=I(ea,this,p,this._dashResidue));this.last.x=qa;this.last.y=
wa}this.lastControl={}},_closePath:function(J,y,A,ea){J.push("closePath",[]);ea&&(this._dashResidue=H(ea,this,this.last.x,this.last.y,ea[1][0],ea[1][1],this._dashResidue));this.lastControl={}}});t.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),function(J){ma(v.Path,J)});v.TextPath=O("dojox.gfx.canvas.TextPath",[v.Shape,d.TextPath],{_renderShape:function(J){},_setText:function(){},_setFont:function(){}});v.Surface=O("dojox.gfx.canvas.Surface",
x.Surface,{constructor:function(){x.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){x.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(J,y){this.width=V.normalizedLength(J);this.height=V.normalizedLength(y);if(!this.rawNode)return this;J=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,J=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,J=!0);J&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?
{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(J){!this.rawNode||!J&&this.pendingImageCount||(J=this.rawNode.getContext("2d"),J.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(J),"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender))},render:function(J){J.save();for(var y=0;y<this.children.length;++y)this.children[y]._render(J);J.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||
(this.pendingRender=setTimeout(W.hitch(this,this._render),0))},downloadImage:function(J,y){var A=W.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);J.onload=A;J.onerror=A;J.onabort=A;J.src=y},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});
v.createSurface=function(J,y,A){if(!y&&!A){var ea=P.position(J);y=y||ea.w;A=A||ea.h}"number"==typeof y&&(y+="px");"number"==typeof A&&(A+="px");ea=new v.Surface;J=F.byId(J);var ta=J.ownerDocument.createElement("canvas");ta.width=V.normalizedLength(y);ta.height=V.normalizedLength(A);J.appendChild(ta);ea.rawNode=ta;ea._parent=J;return ea.surface=ea};var na=x.Container;O={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();
return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(J){this._makeDirty();return na.add.apply(this,arguments)},remove:function(J,y){this._makeDirty();return na.remove.apply(this,arguments)},clear:function(){this._makeDirty();return na.clear.apply(this,arguments)},getBoundingBox:na.getBoundingBox,_moveChildToFront:function(J){this._makeDirty();return na._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(J){this._makeDirty();return na._moveChildToBack.apply(this,
arguments)}};d={createObject:function(J,y){J=new J;J.surface=this.surface;J.setShape(y);this.add(J);return J}};n(v.Group,O);n(v.Group,x.Creator);n(v.Group,d);n(v.Surface,O);n(v.Surface,x.Creator);n(v.Surface,d);v.fixTarget=function(J,y){return!0};return v})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(V,W,t,O,Z,P,F,x,d,e){function l(q,k){for(var w=
q.length-1;k<w;)q[k]=q[++k];q.length=w}var n=V.shape={};n.Shape=t("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(Z("gfxRegistry")){var q=n.register(this);this.getUID=function(){return q}}},destroy:function(){Z("gfxRegistry")&&n.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},
getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var q=this.getBoundingBox();if(!q)return null;var k=this._getRealMatrix();return[e.multiplyPoint(k,q.x,q.y),e.multiplyPoint(k,q.x+q.width,q.y),e.multiplyPoint(k,q.x+q.width,q.y+q.height),e.multiplyPoint(k,q.x,
q.y+q.height)]},getEventSource:function(){return this.rawNode},setClip:function(q){this.clip=q},getClip:function(){return this.clip},setShape:function(q){this.shape=V.makeParameters(this.shape,q);this.bbox=null;return this},setFill:function(q){if(!q)return this.fillStyle=null,this;var k=null;if("object"==typeof q&&"type"in q)switch(q.type){case "linear":k=V.makeParameters(V.defaultLinearGradient,q);break;case "radial":k=V.makeParameters(V.defaultRadialGradient,q);break;case "pattern":k=V.makeParameters(V.defaultPattern,
q)}else k=V.normalizeColor(q);this.fillStyle=k;return this},setStroke:function(q){if(!q)return this.strokeStyle=null,this;if("string"==typeof q||W.isArray(q)||q instanceof d)q={color:q};q=this.strokeStyle=V.makeParameters(V.defaultStroke,q);q.color=V.normalizeColor(q.color);return this},setTransform:function(q){this.matrix=e.clone(q?e.normalize(q):e.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var q=this.getParent();q&&(q._moveChildToFront(this),
this._moveToFront());return this},moveToBack:function(){var q=this.getParent();q&&(q._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(q){return q?this.setTransform([this.matrix,q]):this},applyLeftTransform:function(q){return q?this.setTransform([q,this.matrix]):this},applyTransform:function(q){return q?this.setTransform([this.matrix,q]):this},removeShape:function(q){this.parent&&this.parent.remove(this,q);return this},
_setParent:function(q,k){this.parent=q;return this._updateParentMatrix(k)},_updateParentMatrix:function(q){this.parentMatrix=q?e.clone(q):null;return this._applyTransform()},_getRealMatrix:function(){for(var q=this.matrix,k=this.parent;k;)k.matrix&&(q=e.multiply(k.matrix,q)),k=k.parent;return q}});n._eventsProcessing={on:function(q,k){return P(this.getEventSource(),q,n.fixCallback(this,V.fixTarget,k))},connect:function(q,k,w){"on"==q.substring(0,2)&&(q=q.substring(2));return this.on(q,w?W.hitch(k,
w):k)},disconnect:function(q){return q.remove()}};n.fixCallback=function(q,k,w,I){I||(I=w,w=null);if(W.isString(I)){w=w||O.global;if(!w[I])throw['dojox.gfx.shape.fixCallback: scope["',I,'"] is null (scope\x3d"',w,'")'].join("");return function(H){return k(H,q)?w[I].apply(w,arguments||[]):void 0}}return w?function(H){return k(H,q)?I.apply(w,arguments||[]):void 0}:function(H){return k(H,q)?I.apply(w,arguments):void 0}};W.extend(n.Shape,n._eventsProcessing);n.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(q){var k=q.getParent();k&&k.remove(q,!0);this.children.push(q);return q._setParent(this,this._getRealMatrix())},remove:function(q,k){for(var w=0;w<this.children.length;++w)if(this.children[w]==q){k||(q.parent=null,q.parentMatrix=null);l(this.children,w);break}return this},clear:function(q){for(var k,w=0;w<this.children.length;++w)k=this.children[w],k.parent=null,k.parentMatrix=null,q&&k.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var q=null;F.forEach(this.children,function(k){var w=k.getBoundingBox();w&&((k=k.getTransform())&&(w=e.multiplyRectangle(k,w)),q?(q.x=Math.min(q.x,w.x),q.y=Math.min(q.y,w.y),q.endX=Math.max(q.endX,w.x+w.width),q.endY=Math.max(q.endY,w.y+w.height)):q={x:w.x,y:w.y,endX:w.x+w.width,endY:w.y+w.height})});q&&(q.width=q.endX-q.x,q.height=q.endY-q.y);return q}return null},_moveChildToFront:function(q){for(var k=0;k<this.children.length;++k)if(this.children[k]==
q){l(this.children,k);this.children.push(q);break}return this},_moveChildToBack:function(q){for(var k=0;k<this.children.length;++k)if(this.children[k]==q){l(this.children,k);this.children.unshift(q);break}return this}};n.Surface=t("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){F.forEach(this._nodes,x.destroy);this._nodes=[];F.forEach(this._events,function(q){q&&q.remove()});this._events=[];this.rawNode=null;
if(Z("ie"))for(;this._parent.lastChild;)x.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(q){},whenLoaded:function(q,k){var w=W.hitch(q,k);if(this.isLoaded)w(this);else P.once(this,"load",function(I){w(I)})}});W.extend(n.Surface,n._eventsProcessing);n.Rect=t("dojox.gfx.shape.Rect",n.Shape,{constructor:function(q){this.shape=V.getDefault("Rect");this.rawNode=
q},getBoundingBox:function(){return this.shape}});n.Ellipse=t("dojox.gfx.shape.Ellipse",n.Shape,{constructor:function(q){this.shape=V.getDefault("Ellipse");this.rawNode=q},getBoundingBox:function(){if(!this.bbox){var q=this.shape;this.bbox={x:q.cx-q.rx,y:q.cy-q.ry,width:2*q.rx,height:2*q.ry}}return this.bbox}});n.Circle=t("dojox.gfx.shape.Circle",n.Shape,{constructor:function(q){this.shape=V.getDefault("Circle");this.rawNode=q},getBoundingBox:function(){if(!this.bbox){var q=this.shape;this.bbox={x:q.cx-
q.r,y:q.cy-q.r,width:2*q.r,height:2*q.r}}return this.bbox}});n.Line=t("dojox.gfx.shape.Line",n.Shape,{constructor:function(q){this.shape=V.getDefault("Line");this.rawNode=q},getBoundingBox:function(){if(!this.bbox){var q=this.shape;this.bbox={x:Math.min(q.x1,q.x2),y:Math.min(q.y1,q.y2),width:Math.abs(q.x2-q.x1),height:Math.abs(q.y2-q.y1)}}return this.bbox}});n.Polyline=t("dojox.gfx.shape.Polyline",n.Shape,{constructor:function(q){this.shape=V.getDefault("Polyline");this.rawNode=q},setShape:function(q,
k){q&&q instanceof Array?(this.inherited(arguments,[{points:q}]),k&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[q]);return this},_normalizePoints:function(){var q=this.shape.points,k=q&&q.length;if(k&&"number"==typeof q[0]){for(var w=[],I=0;I<k;I+=2)w.push({x:q[I],y:q[I+1]});this.shape.points=w}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var q=this.shape.points,k=q.length,w=q[0],I=w.x,H=w.y,v=w.x,G=w.y,Q=1;Q<k;++Q)w=
q[Q],I>w.x&&(I=w.x),v<w.x&&(v=w.x),H>w.y&&(H=w.y),G<w.y&&(G=w.y);this.bbox={x:I,y:H,width:v-I,height:G-H}}return this.bbox}});n.Image=t("dojox.gfx.shape.Image",n.Shape,{constructor:function(q){this.shape=V.getDefault("Image");this.rawNode=q},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});n.Text=t(n.Shape,{constructor:function(q){this.fontStyle=null;this.shape=V.getDefault("Text");this.rawNode=q},getFont:function(){return this.fontStyle},
setFont:function(q){this.fontStyle="string"==typeof q?V.splitFontString(q):V.makeParameters(V.defaultFont,q);this._setFont();return this},getBoundingBox:function(){var q=null;this.getShape().text&&(q=V._base._computeTextBoundingBox(this));return q}});n.Creator={createShape:function(q){switch(q.type){case V.defaultPath.type:return this.createPath(q);case V.defaultRect.type:return this.createRect(q);case V.defaultCircle.type:return this.createCircle(q);case V.defaultEllipse.type:return this.createEllipse(q);
case V.defaultLine.type:return this.createLine(q);case V.defaultPolyline.type:return this.createPolyline(q);case V.defaultImage.type:return this.createImage(q);case V.defaultText.type:return this.createText(q);case V.defaultTextPath.type:return this.createTextPath(q)}return null},createGroup:function(){return this.createObject(V.Group)},createRect:function(q){return this.createObject(V.Rect,q)},createEllipse:function(q){return this.createObject(V.Ellipse,q)},createCircle:function(q){return this.createObject(V.Circle,
q)},createLine:function(q){return this.createObject(V.Line,q)},createPolyline:function(q){return this.createObject(V.Polyline,q)},createImage:function(q){return this.createObject(V.Image,q)},createText:function(q){return this.createObject(V.Text,q)},createPath:function(q){return this.createObject(V.Path,q)},createTextPath:function(q){return this.createObject(V.TextPath,{}).setText(q)},createObject:function(q,k){return null}};return n})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang",
"dojo/_base/declare","./matrix","./shape"],function(V,W,t,O,Z){Z=t("dojox.gfx.path.Path",Z.Shape,{constructor:function(P){this.shape=W.clone(V.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=P;this.segmented=!1},setAbsoluteMode:function(P){this._confirmSegmented();this.absolute="string"==typeof P?"absolute"==P:P;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&
"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var P=this.bbox,F=this._getRealMatrix();this.bbox=null;for(var x=0,d=this.segments.length;x<d;++x)this._updateWithSegment(this.segments[x],F);F=this.bbox;this.bbox=P;return this.tbbox=F?[{x:F.l,y:F.t},{x:F.r,y:F.t},{x:F.r,y:F.b},{x:F.l,y:F.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in
this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(P,F,x){x&&(F=O.multiplyPoint(x,P,F),P=F.x,F=F.y);this.bbox&&"l"in this.bbox?(this.bbox.l>P&&(this.bbox.l=P),this.bbox.r<P&&(this.bbox.r=P),this.bbox.t>F&&(this.bbox.t=F),this.bbox.b<F&&(this.bbox.b=F)):this.bbox={l:P,b:F,r:P,t:F}},_updateWithSegment:function(P,F){var x=P.args,d=x.length,e;switch(P.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(e=0;e<d;e+=2)this._updateBBox(x[e],
x[e+1],F);this.last.x=x[d-2];this.last.y=x[d-1];this.absolute=!0;break;case "H":for(e=0;e<d;++e)this._updateBBox(x[e],this.last.y,F);this.last.x=x[d-1];this.absolute=!0;break;case "V":for(e=0;e<d;++e)this._updateBBox(this.last.x,x[e],F);this.last.y=x[d-1];this.absolute=!0;break;case "m":e=0;"x"in this.last||(this._updateBBox(this.last.x=x[0],this.last.y=x[1],F),e=2);for(;e<d;e+=2)this._updateBBox(this.last.x+=x[e],this.last.y+=x[e+1],F);this.absolute=!1;break;case "l":case "t":for(e=0;e<d;e+=2)this._updateBBox(this.last.x+=
x[e],this.last.y+=x[e+1],F);this.absolute=!1;break;case "h":for(e=0;e<d;++e)this._updateBBox(this.last.x+=x[e],this.last.y,F);this.absolute=!1;break;case "v":for(e=0;e<d;++e)this._updateBBox(this.last.x,this.last.y+=x[e],F);this.absolute=!1;break;case "c":for(e=0;e<d;e+=6)this._updateBBox(this.last.x+x[e],this.last.y+x[e+1],F),this._updateBBox(this.last.x+x[e+2],this.last.y+x[e+3],F),this._updateBBox(this.last.x+=x[e+4],this.last.y+=x[e+5],F);this.absolute=!1;break;case "s":case "q":for(e=0;e<d;e+=
4)this._updateBBox(this.last.x+x[e],this.last.y+x[e+1],F),this._updateBBox(this.last.x+=x[e+2],this.last.y+=x[e+3],F);this.absolute=!1;break;case "A":for(e=0;e<d;e+=7)this._updateBBox(x[e+5],x[e+6],F);this.last.x=x[d-2];this.last.y=x[d-1];this.absolute=!0;break;case "a":for(e=0;e<d;e+=7)this._updateBBox(this.last.x+=x[e+5],this.last.y+=x[e+6],F);this.absolute=!1}P=[P.action];for(e=0;e<d;++e)P.push(V.formatNumber(x[e],!0));if("string"==typeof this.shape.path)this.shape.path+=P.join("");else for(e=
0,d=P.length;e<d;++e)this.shape.path.push(P[e])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(P,F){this.tbbox=null;var x=this._validSegments[P.toLowerCase()];"number"==typeof x&&(x?F.length>=x&&(P={action:P,args:F.slice(0,F.length-F.length%x)},this.segments.push(P),this._updateWithSegment(P)):(P={action:P,args:[]},this.segments.push(P),this._updateWithSegment(P)))},_collectArgs:function(P,F){for(var x=0;x<F.length;++x){var d=F[x];"boolean"==typeof d?P.push(d?1:0):
"number"==typeof d?P.push(d):d instanceof Array?this._collectArgs(P,d):"x"in d&&"y"in d&&P.push(d.x,d.y)}},moveTo:function(){this._confirmSegmented();var P=[];this._collectArgs(P,arguments);this._pushSegment(this.absolute?"M":"m",P);return this},lineTo:function(){this._confirmSegmented();var P=[];this._collectArgs(P,arguments);this._pushSegment(this.absolute?"L":"l",P);return this},hLineTo:function(){this._confirmSegmented();var P=[];this._collectArgs(P,arguments);this._pushSegment(this.absolute?
"H":"h",P);return this},vLineTo:function(){this._confirmSegmented();var P=[];this._collectArgs(P,arguments);this._pushSegment(this.absolute?"V":"v",P);return this},curveTo:function(){this._confirmSegmented();var P=[];this._collectArgs(P,arguments);this._pushSegment(this.absolute?"C":"c",P);return this},smoothCurveTo:function(){this._confirmSegmented();var P=[];this._collectArgs(P,arguments);this._pushSegment(this.absolute?"S":"s",P);return this},qCurveTo:function(){this._confirmSegmented();var P=
[];this._collectArgs(P,arguments);this._pushSegment(this.absolute?"Q":"q",P);return this},qSmoothCurveTo:function(){this._confirmSegmented();var P=[];this._collectArgs(P,arguments);this._pushSegment(this.absolute?"T":"t",P);return this},arcTo:function(){this._confirmSegmented();var P=[];this._collectArgs(P,arguments);this._pushSegment(this.absolute?"A":"a",P);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var P=
this.shape.path;this.shape.path=[];this._setPath(P);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(P){P=W.isArray(P)?P:P.match(V.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(P){for(var F="",x=[],d=P.length,e=0;e<d;++e){var l=P[e],n=parseFloat(l);isNaN(n)?(F&&this._pushSegment(F,x),x=[],F=l):x.push(n)}this._pushSegment(F,x)}},setShape:function(P){this.inherited(arguments,["string"==typeof P?{path:P}:P]);this.segmented=!1;this.segments=
[];V.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});t=t("dojox.gfx.path.TextPath",Z,{constructor:function(P){"text"in this||(this.text=W.clone(V.defaultTextPath));"fontStyle"in this||(this.fontStyle=W.clone(V.defaultFont))},getText:function(){return this.text},setText:function(P){this.text=V.makeParameters(this.text,"string"==typeof P?{text:P}:P);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(P){this.fontStyle="string"==typeof P?
V.splitFontString(P):V.makeParameters(V.defaultFont,P);this._setFont();return this}});return V.path={Path:Z,TextPath:t}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(V,W,t){function O(e){var l=Math.cos(e);e=Math.sin(e);var n={x:l+4/3*(1-l),y:e-4/3*l*(1-l)/e};return{s:{x:l,y:-e},c1:{x:n.x,y:-n.y},c2:n,e:{x:l,y:e}}}var Z=2*Math.PI,P=Math.PI/4,F=Math.PI/8,x=P+F,d=O(F);return V.arc={unitArcAsBezier:O,curvePI4:d,arcAsBezier:function(e,l,n,q,k,w,I,H){k=!!k;w=!!w;
var v=t._degToRad(q);q=l*l;var G=n*n,Q=t.multiplyPoint(t.rotate(-v),{x:(e.x-I)/2,y:(e.y-H)/2}),T=Q.x*Q.x,M=Q.y*Q.y;q=Math.sqrt((q*G-q*M-G*T)/(q*M+G*T));isNaN(q)&&(q=0);q={x:q*l*Q.y/n,y:-q*n*Q.x/l};k==w&&(q={x:-q.x,y:-q.y});q=t.multiplyPoint([t.translate((e.x+I)/2,(e.y+H)/2),t.rotate(v)],q);l=t.normalize([t.translate(q.x,q.y),t.rotate(v),t.scale(l,n)]);q=t.invert(l);e=t.multiplyPoint(q,e);H=t.multiplyPoint(q,I,H);I=Math.atan2(e.y,e.x);q=I-Math.atan2(H.y,H.x);w&&(q=-q);0>q?q+=Z:q>Z&&(q-=Z);n=F;H=d;
n=w?n:-n;e=[];for(k=q;0<k;k-=P)k<x&&(n=k/2,H=O(n),n=w?n:-n,k=0),Q=t.normalize([l,t.rotate(I+n)]),w?(q=t.multiplyPoint(Q,H.c1),v=t.multiplyPoint(Q,H.c2),Q=t.multiplyPoint(Q,H.e)):(q=t.multiplyPoint(Q,H.c2),v=t.multiplyPoint(Q,H.c1),Q=t.multiplyPoint(Q,H.s)),e.push([q.x,q.y,v.x,v.y,Q.x,Q.y]),I+=2*n;return e}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(V,W,t){function O(d,e){return Math.abs(d-e)<=1E-6*(Math.abs(d)+Math.abs(e))}function Z(d,e,l,n){if(!isFinite(d))return l;
if(!isFinite(l))return d;e=Math.abs(e);n=Math.abs(n);return(e*d+n*l)/(e+n)}function P(d){d=t.normalize(d);var e=-d.xx-d.yy,l=d.xx*d.yy-d.xy*d.yx,n=Math.sqrt(e*e-4*l);e=-(e+(0>e?-n:n))/2;l/=e;n=d.xy/(e-d.xx);var q=1,k=d.xy/(l-d.xx),w=1;O(e,l)&&(n=1,k=q=0,w=1);isFinite(n)||(n=1,q=(e-d.xx)/d.xy,isFinite(q)||(n=(e-d.yy)/d.yx,q=1,isFinite(n)||(n=1,q=d.yx/(e-d.yy))));isFinite(k)||(k=1,w=(l-d.xx)/d.xy,isFinite(w)||(k=(l-d.yy)/d.yx,w=1,isFinite(k)||(k=1,w=d.yx/(l-d.yy))));d=Math.sqrt(n*n+q*q);var I=Math.sqrt(k*
k+w*w);isFinite(n/=d)||(n=0);isFinite(q/=d)||(q=0);isFinite(k/=I)||(k=0);isFinite(w/=I)||(w=0);return{value1:e,value2:l,vector1:{x:n,y:q},vector2:{x:k,y:w}}}function F(d,e){var l=0>d.xx*d.yy||0<d.xy*d.yx?-1:1,n=e.angle1=(Math.atan2(d.yx,d.yy)+Math.atan2(-l*d.xy,l*d.xx))/2;l=Math.cos(n);n=Math.sin(n);e.sx=Z(d.xx/l,l,-d.xy/n,n);e.sy=Z(d.yy/l,l,d.yx/n,n);return e}function x(d,e){var l=0>d.xx*d.yy||0<d.xy*d.yx?-1:1,n=e.angle2=(Math.atan2(l*d.yx,l*d.xx)+Math.atan2(-d.xy,d.yy))/2;l=Math.cos(n);n=Math.sin(n);
e.sx=Z(d.xx/l,l,d.yx/n,n);e.sy=Z(d.yy/l,l,-d.xy/n,n);return e}return V.decompose=function(d){var e=t.normalize(d);d={dx:e.dx,dy:e.dy,sx:1,sy:1,angle1:0,angle2:0};if(O(e.xy,0)&&O(e.yx,0))return W.mixin(d,{sx:e.xx,sy:e.yy});if(O(e.xx*e.yx,-e.xy*e.yy))return F(e,d);if(O(e.xx*e.xy,-e.yx*e.yy))return x(e,d);var l=new t.Matrix2D(e);var n=W.mixin(l,{dx:0,dy:0,xy:l.yx,yx:l.xy});l=P([e,n]);n=P([n,e]);l=new t.Matrix2D({xx:l.vector1.x,xy:l.vector2.x,yx:l.vector1.y,yy:l.vector2.y});n=new t.Matrix2D({xx:n.vector1.x,
xy:n.vector1.y,yx:n.vector2.x,yy:n.vector2.y});e=new t.Matrix2D([t.invert(l),e,t.invert(n)]);F(n,d);e.xx*=d.sx;e.yy*=d.sy;x(l,d);e.xx*=d.sx;e.yy*=d.sy;return W.mixin(d,{sx:e.xx,sy:e.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(V){V=V.bezierutils={};V.tAtLength=function(F,x){var d=0,e=6==F.length,l=0,n=0,q=e?O:P,k=function(w,I){for(var H=0,v=0;v<w.length-2;v+=2)H+=t(w[v],w[v+1],w[v+2],w[v+3]);v=e?t(F[0],F[1],F[4],F[5]):t(F[0],F[1],F[6],F[7]);H-v>I||l+H>x+I?(++n,w=q(w,.5),
k(w[0],I),Math.abs(l-x)<=I||k(w[1],I)):(l+=H,d+=1/(1<<n))};x&&k(F,.5);return d};var W=V.computeLength=function(F){for(var x=6==F.length,d=0,e=0;e<F.length-2;e+=2)d+=t(F[e],F[e+1],F[e+2],F[e+3]);e=x?t(F[0],F[1],F[4],F[5]):t(F[0],F[1],F[6],F[7]);return.1<d-e?(F=x?O(F,.5):Z(F,.5),d=W(F[0],x),d+=W(F[1],x)):d},t=V.distance=function(F,x,d,e){return Math.sqrt((d-F)*(d-F)+(e-x)*(e-x))},O=function(F,x){var d=1-x,e=d*d,l=x*x,n=F[0],q=F[1],k=F[2],w=F[3],I=F[4];F=F[5];var H=e*n+2*d*x*k+l*I;e=e*q+2*d*x*w+l*F;
return[[n,q,d*n+x*k,d*q+x*w,H,e],[H,e,d*k+x*I,d*w+x*F,I,F]]},Z=function(F,x){var d=1-x,e=d*d,l=e*d,n=x*x,q=n*x,k=F[0],w=F[1],I=F[2],H=F[3],v=F[4],G=F[5],Q=F[6];F=F[7];var T=l*k+3*e*x*I+3*d*n*v+q*Q;l=l*w+3*e*x*H+3*d*n*G+q*F;return[[k,w,d*k+x*I,d*w+x*H,e*k+2*d*x*I+n*v,e*w+2*d*x*H+n*G,T,l],[T,l,e*I+2*d*x*v+n*Q,e*H+2*d*x*G+n*F,d*v+x*Q,d*G+x*F,Q,F]]},P=V.splitBezierAtT=function(F,x){return 6==F.length?O(F,x):Z(F,x)};return V})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang",
"dojox","dojo/_base/array"],function(V,W,t){W.getObject("json",!0,t);t.json._slice=function(O,Z,P,F){var x=O.length,d=[];P=P||x;Z=0>Z?Math.max(0,Z+x):Math.min(x,Z);for(P=0>P?Math.max(0,P+x):Math.min(x,P);Z<P;Z+=F)d.push(O[Z]);return d};t.json._find=function(O,Z){function P(d){Z&&(!0!==Z||d instanceof Array?d[Z]&&F.push(d[Z]):F.push(d));for(var e in d){var l=d[e];Z?l&&"object"==typeof l&&P(l):F.push(l)}}var F=[];if(Z instanceof Array){if(1==Z.length)return O[Z[0]];for(var x=0;x<Z.length;x++)F.push(O[Z[x]])}else P(O);
return F};t.json._distinctFilter=function(O,Z){for(var P=[],F={},x=0,d=O.length;x<d;++x){var e=O[x];Z(e,x,O)&&("object"==typeof e&&e?e.__included||(e.__included=!0,P.push(e)):F[e+typeof e]||(F[e+typeof e]=!0,P.push(e)))}x=0;for(d=P.length;x<d;++x)P[x]&&delete P[x].__included;return P};return t.json.query=function(O,Z){function P(n,q,k,w,I,H,v,G){return x[G].match(/[\*\?]/)||"~"==v?"/^"+x[G].substring(1,x[G].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+
("~"==v?"$/i":"$/")+".test("+q+")":n}var F=0,x=[];O=O.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(n){F+="["==n?1:"]"==n?-1:0;return"]"==n&&0<F?"`]":'"'==n.charAt(0)||"'"==n.charAt(0)?"`"+(x.push(n)-1):n});var d="";O.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});O=O.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(n){return"."==n.charAt(0)?n:"@"==n?"$obj":(n.match(/:|^(\$|Math|true|false|null)$/)?
"":"$obj.")+n}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(n,q,k){return(q=n.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(k="",n.match(/^\./)&&(d="dojox.json._find("+d,k=",true)"),d=(q[1].match(/=/)?"dojo.map":q[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+d,k+",function($obj){return "+q[2]+"})"):(q=n.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+q[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(w,I,H){return"var av\x3d "+H.replace(/\$obj/,
"a")+",bv\x3d "+H.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==I?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==I?-1:1)+";}\n"})+"return 0;})":(q=n.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(d="dojox.json._slice("+d,","+(q[1]||0)+","+(q[2]||0)+","+(q[3]||1)+")"):n.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(d="dojox.json._find("+d,("."==n.charAt(1)?",'"+k+"'":n.match(/,/)?","+n:"")+")"):n}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,
P).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(n,q,k,w,I,H,v,G){return P(n,w,I,H,v,G,k,q)});O=d+("$"==O.charAt(0)?"":"$")+O.replace(/`([0-9]+|\])/g,function(n,q){return"]"==q?"]":x[q]});for(var e=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+O+"}"),l=0;l<arguments.length-1;l++)arguments[l]=arguments[l+1];return Z?e.apply(this,arguments):e}})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel"],function(V,W,t,O){V=V(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});t("extend-esri")&&W.setObject("tasks.PrintParameters",V,O);return V})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,H,v,G,Q,T){var M=W(q,{declaredClass:"esri.toolbars.Edit",constructor:function(R,C){this._map=R;this._tool=0;if(this._map.loaded)this._scratchGL=R.graphics;else var a=O.connect(this._map,"onLoad",this,function(){O.disconnect(a);a=null;this._scratchGL=this._map.graphics});R=F("esri-mobile");this._defaultOptions=t.mixin({vertexSymbol:new v(v.STYLE_CIRCLE,R?20:12,new G(G.STYLE_SOLID,new P([0,0,0,.5]),1),new P([128,128,128])),ghostVertexSymbol:new v(v.STYLE_CIRCLE,
R?18:10,new G(G.STYLE_SOLID,new P([0,0,0,.5]),1),new P([255,255,255,.75])),ghostLineSymbol:new G(G.STYLE_DOT,new P([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:R?24:16,boxLineSymbol:new G(G.STYLE_DASH,new P([64,64,64]),1),boxHandleSymbol:new v(v.STYLE_SQUARE,R?16:9,new G(G.STYLE_SOLID,new P([0,0,0,.5]),1),new P([255,255,255,.75])),textAnchorSymbol:new v(v.STYLE_CIRCLE,10,null,new P([255,0,0]))},C||{})},activate:function(R,C,a){this.deactivate();this._graphic=C;this._options=
t.mixin(t.mixin({},this._defaultOptions),a||{});var B=M.MOVE;a=M.EDIT_VERTICES;var da=M.SCALE,la=M.ROTATE,ma=M.EDIT_TEXT,pa=!1,N=!1,oa=!1,na=this._map,J=na.spatialReference,y=C.geometry.spatialReference;this._geo=!(!J||!y||J.equals(y)||!J.isWebMercator()||4326!==y.wkid);this._isTextPoint=this._prepareTextSymbolEditing(C,R);(R&B)===B&&(pa=this._enableMove(C));B=(R&da)===da;la=(R&la)===la;if(B||la)oa=this._enableBoxEditing(C,B,la);(R&a)===a&&(N=this._enableVertexEditing(C));(R&ma)===ma&&this._enableTextEditing(C);
if(!(pa||N||oa))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=R)this._mapPanEndHandle=O.connect(na,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=O.connect(na,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,C);na.snappingManager&&(pa||N)&&na.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var R=this._tool,C=this._graphic;
if(R){var a=!!this._modified;this._clear();O.disconnect(this._mapPanEndHandle);O.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(R,C,{isModified:a});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(R,C){},onDeactivate:function(R,
C,a){},onGraphicMoveStart:function(R){},onGraphicFirstMove:function(R){this._modified=!0},onGraphicMove:function(R,C){},onGraphicMoveStop:function(R,C){},onGraphicClick:function(R,C){},onVertexMoveStart:function(R,C){},onVertexFirstMove:function(R,C){this._modified=!0},onVertexMove:function(R,C,a){},onVertexMoveStop:function(R,C,a){},onVertexAdd:function(R,C){this._modified=!0},onVertexClick:function(R,C){},onVertexMouseOver:function(R,C){},onVertexMouseOut:function(R,C){},onVertexDelete:function(R,
C){this._modified=!0},onTextEditStart:function(R,C){},onTextEditEnd:function(R){},onScaleStart:function(R){},onScaleFirstMove:function(R){this._modified=!0},onScale:function(R,C){},onScaleStop:function(R,C){},onRotateStart:function(R){},onRotateFirstMove:function(R){this._modified=!0},onRotate:function(R,C){},onRotateStop:function(R,C){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic",
"transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(R,C){if("point"===R.geometry.type||"multipoint"===R.geometry.type){var a=R.getLayer(),B=a.renderer;a=R.symbol||a._getSymbol(R);!a&&(B.hasVisualVariables("sizeInfo",!1)||B.hasVisualVariables("colorInfo",!1)||B.hasVisualVariables("opacityInfo",!1))&&B.addBreak&&
B.infos&&1===B.infos.length&&(a=B.infos[0].symbol||B.defaultSymbol);if(a&&"textsymbol"===a.type){if((C&M.SCALE)===M.SCALE||(C&M.ROTATE)===M.ROTATE||(C&M.EDIT_TEXT)===M.EDIT_TEXT){R.setSymbol(new Q(a.toJson()));var da=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(R),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){da._boxEditor&&da._boxEditor.refresh()})):
V(["../dijit/SymbolEditor"],function(la){if(!da._textSymbolEditor){var ma=da._options.textSymbolEditorHolder?x.create("div",null,da._options.textSymbolEditorHolder):x.create("div",null,da._map.root);da._textSymbolEditor=new la({graphic:R},ma);la=da._textSymbolEditor.domNode.parentNode.id;d.set(da._textSymbolEditor.domNode,{position:"map_root"===la?"absolute":"relative",left:"map_root"===la?da._map.width/2-100+"px":"5px",top:"20px","z-index":50});da._textSymbolEditor.startup();da._textSymbolEditor.createForm(R);
da._textSymbolEditor.show();da._textSymbolEditor.on("symbol-change",function(){da._boxEditor&&da._boxEditor.refresh()})}})}if((C&M.MOVE)===M.MOVE||(C&M.ROTATE)===M.ROTATE||(C&M.SCALE)===M.SCALE)this._textAnchor=new T(R.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(R){var C=this._map;switch(R.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new w(R,C,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(R){var C=
this._map;switch(R.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=I.create(R,C,this),!0}return!1},_enableBoxEditing:function(R,C,a){var B=this._map,da=R.geometry.type;return"polyline"===da||"polygon"===da||this._isTextPoint?(this._boxEditor=new k(R,B,this,C,a,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(R){return this._isTextPoint?(this._textEditor=new H(R,this._map,this),O.connect(this._textEditor,"onEditStart",t.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var R=this._graphicMover;R&&(R.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var R=this._vertexEditor;R&&(R.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var R=this._boxEditor;R&&(R.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(R,C,a){a&&this._refreshMoveables()},_refreshMoveables:function(R){var C=Z.filter([this._graphicMover,this._vertexEditor,this._boxEditor],l.isDefined);Z.forEach(C,function(a){a.refresh(R)})},_beginOperation:function(R){Z.forEach(this._getAffectedTools(R),function(C){C.suspend()})},_endOperation:function(R){Z.forEach(this._getAffectedTools(R),function(C){C.resume()})},_getAffectedTools:function(R){var C=[];switch(R){case "MOVE":C=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":C=[this._boxEditor];break;case "BOX":C=[this._vertexEditor]}return C=Z.filter(C,l.isDefined)}});t.mixin(M,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});F("extend-esri")&&t.setObject("toolbars.Edit",M,e);return M})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,H){V=V(null,{declaredClass:"esri.toolbars._Box",constructor:function(v,G,Q,T,M,R,C){this._graphic=v;this._map=G;this._toolbar=Q;this._scale=T;this._rotate=M;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=R;v=Q._options;this._markerSymbol=v.boxHandleSymbol;this._lineSymbol=v.boxLineSymbol;this._moveStartHandler=W.hitch(this,this._moveStartHandler);this._firstMoveHandler=W.hitch(this,this._firstMoveHandler);
this._moveStopHandler=W.hitch(this,this._moveStopHandler);this._moveHandler=W.hitch(this,this._moveHandler);this._isTextPoint=C;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){t.forEach(this._getAllGraphics(),function(v){v.hide()})},resume:function(){t.forEach(this._getAllGraphics(),function(v){v.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
t.forEach(this._connects,O.disconnect);var v=this._toolbar._scratchGL;this._anchors&&t.forEach(this._anchors,function(G){v.remove(G.graphic);(G=G.moveable)&&G.destroy()});this._box&&v.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var v=this._map,G=this._toolbar._scratchGL,Q=this._getBoxCoords(),T=new q(v.spatialReference),M=W.clone(t.filter(Q,function(R,C){return 8!==C&&0===C%2}));M[0]&&M.push([M[0][0],M[0][1]]);T.addPath(M);this._rotate&&
T.addPath([Q[1],Q[8]]);this._box?this._box.setGeometry(T):(this._box=new H(T,this._lineSymbol),G.add(this._box));this._anchors?t.forEach(this._anchors,function(R,C){this._scale||(C=8);var a=new n(Q[C],v.spatialReference);R.graphic.setGeometry(a);a=R.moveable;var B=R.graphic.getDojoShape();B&&(a?B!==a.shape&&(a.destroy(),R.moveable=this._getMoveable(R.graphic,C)):R.moveable=this._getMoveable(R.graphic,C))},this):(this._anchors=[],this._connects=[],t.forEach(Q,function(R,C){!this._scale&&8>C||(R=new n(R,
v.spatialReference),R=new H(R,this._markerSymbol),this._isTextPoint&&1===C%2&&R.hide(),G.add(R),this._anchors.push({graphic:R,moveable:this._getMoveable(R,C)}))},this))}else this._cleanUp()},_getBoxCoords:function(v){var G=this._map,Q=[],T,M,R;if(this._isTextPoint){var C=this._graphic.getNode().getBoundingClientRect();var a=G.__container.getBoundingClientRect();C=[{x:C.left-a.left,y:C.top-a.top},{x:C.right-a.left,y:C.top-a.top},{x:C.right-a.left,y:C.bottom-a.top},{x:C.left-a.left,y:C.bottom-a.top}]}else C=
this._getTransformedBoundingBox(this._graphic);t.forEach(C,function(B,da,la){T=B;(M=la[da+1])||(M=la[0]);R={x:(T.x+M.x)/2,y:(T.y+M.y)/2};v||(T=G.toMap(T),R=G.toMap(R));Q.push([T.x,T.y]);Q.push([R.x,R.y])});this._rotate&&(C=W.clone(Q[1]),C=v?{x:C[0],y:C[1]}:G.toScreen({x:C[0],y:C[1],spatialReference:G.spatialReference}),C.y-=this._toolbar._options.rotateHandleOffset,v||(C=G.toMap(C)),Q.push([C.x,C.y]));return Q},_getTransformedBoundingBox:function(v){var G=this._map,Q=v.geometry.getExtent(),T=v.geometry.spatialReference;
v=new n(Q.xmin,Q.ymax,T);Q=new n(Q.xmax,Q.ymin,T);v=G.toScreen(v);Q=G.toScreen(Q);return[{x:v.x,y:v.y},{x:Q.x,y:v.y},{x:Q.x,y:Q.y},{x:v.x,y:Q.y}]},_getAllGraphics:function(){var v=[this._box];this._anchors&&t.forEach(this._anchors,function(G){v.push(G.graphic)});return v=t.filter(v,l.isDefined)},_getMoveable:function(v,G){var Q=v.getDojoShape();if(Q)return v=new x(Q),v._index=G,this._connects.push(O.connect(v,"onMoveStart",this._moveStartHandler)),this._connects.push(O.connect(v,"onFirstMove",this._firstMoveHandler)),
this._connects.push(O.connect(v,"onMoveStop",this._moveStopHandler)),v.onMove=this._moveHandler,(Q=Q.getEventSource())&&F.set(Q,"cursor",this._toolbar._cursors["box"+G]),v},_moveStartHandler:function(v){this._toolbar["on"+(8===v.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(v){this._toolbar._deactivateScrollWheel();var G=v.host._index,Q=this._wrapOffset=v.host.shape._wrapOffsets[0]||0,T=this._graphic.getLayer().getNavigationTransform();v=t.map(this._getBoxCoords(!0),
function(R){return{x:R[0]+Q,y:R[1]}});var M=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:v[1].x,y:v[3].y};this._centerCoord=d.multiplyPoint(d.invert(T),M);if(8===G)M=d.multiplyPoint(d.invert(T),v[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,M)),this._startLine=[this._centerCoord,M],this._moveLine=W.clone(this._startLine);else if(M=d.multiplyPoint(d.invert(T),v[G]),T=d.multiplyPoint(d.invert(T),v[(G+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,M)),this._firstMoverToAnchor=Math.sqrt((M.x-this._centerCoord.x)*(M.x-this._centerCoord.x)+(M.y-this._centerCoord.y)*(M.y-this._centerCoord.y)),this._startBox=T,this._startBox.width=v[4].x-v[0].x,this._startBox.height=v[4].y-v[0].y,this._moveBox=W.clone(this._startBox),this._xfactor=M.x>T.x?1:-1,this._yfactor=M.y>T.y?1:-1,1===G||5===G)this._xfactor=0;else if(3===G||7===G)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===G?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(v,G){v=v.host._index;var Q=this._defaultEventArgs;Q.angle=0;Q.scaleX=1;Q.scaleY=1;if(8===v){var T=this._startLine;var M=this._moveLine;var R=M[1];R.x+=G.dx;R.y+=G.dy;G=this._getAngle(T,M);this._isTextPoint&&(G+=this._graphic.symbol.angle);M=d.rotategAt(G,T[0]);this._graphic.getDojoShape().setTransform(M);Q.transform=M;Q.angle=G;Q.around=T[0]}else{T=this._startBox;M=this._moveBox;M.width+=G.dx*this._xfactor;M.height+=G.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(T=M.x+this._xfactor*M.width,M=M.y+this._yfactor*M.height,T=Math.sqrt((T-this._centerCoord.x)*(T-this._centerCoord.x)+(M-this._centerCoord.y)*(M-this._centerCoord.y)),this._scaleRatio=G=R=T/this._firstMoverToAnchor,T=this._centerCoord):(G=M.width/T.width,R=M.height/T.height,T={x:T.x,y:T.y});if(isNaN(G)||Infinity===G||-Infinity===G)G=1;if(isNaN(R)||Infinity===R||-Infinity===R)R=1;M=d.scaleAt(G,R,T);if(this._isTextPoint){var C=d.rotategAt(this._graphic.symbol.angle,
T);this._graphic.getDojoShape().setTransform([C,M])}else this._graphic.getDojoShape().setTransform(M);Q.transform=M;Q.scaleX=G;Q.scaleY=R;Q.around=T}this._toolbar["on"+(8===v?this._rotateEvent:this._scaleEvent)](this._graphic,Q)},_moveStopHandler:function(v){this._toolbar._activateScrollWheel();var G=this._graphic,Q=this._toolbar,T=Q._geo?w.geographicToWebMercator(G.geometry):G.geometry,M=T.spatialReference,R=G.getDojoShape(),C=R.getTransform(),a=G.getLayer().getNavigationTransform();this._isTextPoint?
(G=this._graphic.symbol,8===v.host._index?G.angle+=this._getAngle(this._startLine,this._moveLine):G.font.setSize(Math.round(G.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(G)):(T=T.toJson(),this._updateSegments(T.paths||T.rings,C,a,M),R.setTransform(null),T=I.fromJson(T),G.setGeometry(Q._geo?w.webMercatorToGeographic(T,!0):T));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;Q._endOperation("BOX");this._defaultEventArgs.transform=
C;Q["on"+(8===v.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(v,G,Q,T){var M=this._map,R=this._wrapOffset||0;t.forEach(v,function(C){t.forEach(C,function(a){this._updatePoint(a,T,R,d,M,Q,G)},this)},this)},_updatePoint:function(v,G,Q,T,M,R,C){G=M.toScreen({x:v[0],y:v[1],spatialReference:G},!0);G.x+=Q;G=T.multiplyPoint([R,C,T.invert(R)],G);G.x-=Q;Q=M.toMap(G);v[0]=Q.x;v[1]=Q.y},_getAngle:function(v,G){return 180*Math.atan2(G[0].y-
G[1].y,G[0].x-G[1].x)/Math.PI-180*Math.atan2(v[0].y-v[1].y,v[0].x-v[1].x)/Math.PI},_deNormalizePoint:function(v,G){var Q=this._map._getFrameWidth();if(-1===Q)return v;for(v={x:v.x,y:v.y};Math.abs(v.x-G.x)>=Q;)v.x=v.x<G.x?v.x+Q:v.x-Q;var T=Math.abs(v.x-G.x);Math.abs(v.x-G.x+Q)<T?v.x+=Q:Math.abs(v.x-G.x-Q)<T&&(v.x-=Q);return v}});P("extend-esri")&&W.setObject("toolbars._Box",V,e);return V})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(V,W,t,O,Z,P,F,x,d,e){return W("dojox.gfx.Moveable",null,{constructor:function(l,n){this.shape=l;this.delay=n&&0<n.delay?n.delay:0;this.mover=n&&n.mover?n.mover:d;this.leftButtonOnly=n&&n.leftButtonOnly;this.events=[this.shape.on(P.press,V.hitch(this,"onMouseDown"))]},destroy:function(){t.forEach(this.events,function(l){l.remove()});this.events=this.shape=null},onMouseDown:function(l){this.delay?(this.events.push(this.shape.on(P.move,V.hitch(this,"onMouseMove")),this.shape.on(P.release,V.hitch(this,
"onMouseUp"))),this._lastX=l.clientX,this._lastY=l.clientY):this.leftButtonOnly&&!e.isLeft(l)||new this.mover(this.shape,l,this);O.stop(l)},onMouseMove:function(l){var n=l.clientY;if(Math.abs(l.clientX-this._lastX)>this.delay||Math.abs(n-this._lastY)>this.delay)this.onMouseUp(l),new this.mover(this.shape,l,this);O.stop(l)},onMouseUp:function(l){this.events.pop().remove()},onMoveStart:function(l){Z.publish("/gfx/move/start",l);F.add(x.body(),"dojoMove")},onMoveStop:function(l){Z.publish("/gfx/move/stop",
l);F.remove(x.body(),"dojoMove")},onFirstMove:function(l){},onMove:function(l,n,q){this.onMoving(l,n,q);this.shape.applyLeftTransform(n);this.onMoved(l,n)},onMoving:function(l,n){},onMoved:function(l,n){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(V,W,t,O,Z,P){return t("dojox.gfx.Mover",null,{constructor:function(F,x,d){this.shape=F;this.lastX=x.clientX;this.lastY=x.clientY;F=this.host=d;x=
document;d=O(x,Z.move,V.hitch(this,"onFirstMove"));this.events=[O(x,Z.move,V.hitch(this,"onMouseMove")),O(x,Z.release,V.hitch(this,"destroy")),O(x,"dragstart",V.hitch(P,"stop")),O(x,"selectstart",V.hitch(P,"stop")),d];if(F&&F.onMoveStart)F.onMoveStart(this)},onMouseMove:function(F){var x=F.clientX,d=F.clientY;this.host.onMove(this,{dx:x-this.lastX,dy:d-this.lastY},F);this.lastX=x;this.lastY=d;P.stop(F)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){W.forEach(this.events,
function(x){x.remove()});var F=this.host;if(F&&F.onMoveStop)F.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k){var w=V(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(I,H,v,G){this.graphic=I;this.map=H;this.toolbar=v;this.tempPt=G;this._enableGraphicMover();this._moved=!1},refresh:function(I){var H=this.graphic.getDojoShape();!H||!I&&H._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var I=this.graphic,H=I.getDojoShape();H&&(H._hostGraphic=I,this._moveable=new P(H,{mover:w.Mover}),this._moveStartHandle=
t.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=t.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=t.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=t.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(I=H.getEventSource())&&Z.set(I,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var I=this._moveable;if(I){t.disconnect(this._moveStartHandle);t.disconnect(this._firstMoveHandle);
t.disconnect(this._movingHandle);t.disconnect(this._moveStopHandle);var H=I.shape;H&&(H._hostGraphic=null,(H=H.getEventSource())&&Z.set(H,"cursor","inherit"));I.destroy()}this._moveable=null},_moveStartHandler:function(){var I=this.graphic,H=this.map;this._startTx=I.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&H.snappingManager&&H.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(I)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(I,H,v){I=I.shape.getTransform();H=this.map;var G;l("esri-pointer")?G=H.navigationManager.pointerEvents._processTouchEvent(v,v):v&&"pointermove"===v.type&&(G=e.prototype._processTouchEvent.call({map:H},v,v));G&&H.snappingManager&&H.snappingManager._onSnappingMouseMoveHandler(G);this.tempPt&&this.tempPt.getDojoShape().setTransform(I);this.toolbar.onGraphicMove(this.graphic,I)},_moveStopHandler:function(I){var H=this.graphic,v=this.toolbar,G=this.map,Q=v._geo?n.geographicToWebMercator(H.geometry):
H.geometry,T=Q.type,M=H.getDojoShape(),R=M.getTransform();if(O.toJson(R)!==O.toJson(this._startTx)){this._moved=!0;switch(T){case "point":T=[R,x.invert(this._startTx)];if(G.snappingManager)var C=G.snappingManager._snappingPoint;Q=C||G.toMap(x.multiplyPoint(T,G.toScreen(Q,!0)));G.snappingManager&&G.snappingManager._killOffSnapping();break;case "polyline":Q=this._updatePolyGeometry(Q,Q.paths,R);break;case "polygon":Q=this._updatePolyGeometry(Q,Q.rings,R)}M.setTransform(null);H.setGeometry(v._geo?n.webMercatorToGeographic(Q,
!0):Q);this.tempPt&&this.tempPt.setGeometry(new k(H.geometry.toJson()))}else this._moved=!1;v._endOperation("MOVE");v.onGraphicMoveStop(H,R);this._moved||(I=I.__e,G=this.map.position,I=new q(I.pageX-G.x,I.pageY-G.y),v.onGraphicClick(H,{screenPoint:I,mapPoint:this.map.toMap(I)}))},_updatePolyGeometry:function(I,H,v){var G=this.map,Q=I.getPoint(0,0);G=G.toMap(G.toScreen(Q).offset(v.dx,v.dy));v=G.x-Q.x;Q=G.y-Q.y;var T;for(G=0;G<H.length;G++){var M=H[G];for(T=0;T<M.length;T++){var R=I.getPoint(G,T);I.setPoint(G,
T,R.offset(v,Q))}}return I}});w.Mover=V(F,{declaredClass:"esri.toolbars._Mover",constructor:function(I,H,v){this.__e=H}});l("extend-esri")&&(W.setObject("toolbars._GraphicMover",w,d),W.setObject("toolbars._Mover",w.Mover,d));return w})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(V,
W,t,O,Z,P,F,x,d,e,l,n){var q=V(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(k,w,I){this.graphic=k;this.map=w;this.toolbar=I;k=I._options;this._symbol1=k.vertexSymbol;this._symbol2=k.ghostVertexSymbol;w=k.ghostLineSymbol;this._lineStroke={style:w.style,width:w.width,color:w.color};this._canDel=k.allowDeleteVertices;this._canAdd=k.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(k){k?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=t.connect(d,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=t.connect(d,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var k=this._getGraphicsLayer();this._mouseOverHandle=t.connect(k,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=t.connect(k,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new P({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),k=this._ctxDelete=new F({label:n.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
t.connect(k,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(k),this._ctxMenu.startup())},_removeControllers:function(){t.disconnect(this._firstMoveHandle);t.disconnect(this._moveStopHandle);t.disconnect(this._mouseOverHandle);t.disconnect(this._mouseOutHandle);t.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(k,w,I){var H,v,G=this.graphic,Q=[];for(H=0;H<k.length;H++){var T=k[H],M=[];for(v=0;v<T.length;v++)M.push(new d(T[v],w,G,H,v,T.length,this,I));Q.push(M)}return Q},_remove:function(k){k&&O.forEach(k,function(w){O.forEach(w,function(I){I.destroy()})})},_refresh:function(k){k&&O.forEach(k,function(w){O.forEach(w,function(I){I.refresh()})})},_isNew:function(k){return-1===O.indexOf(this._vertexMovers[k.segIndex],k)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(k){k=this._selectedMover;this._updateRelatedGraphic(k,k.relatedGraphic,k.graphic.geometry,k.segIndex,k.ptIndex,k.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(k);this._deleteVertex(k);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(k){k=k.graphic;var w=this._findMover(k);w&&(this.toolbar.onVertexMouseOver(this.graphic,w._getInfo()),w._placeholder||(this._selectedMover=w,this._canDel&&this._bindCtxNode(k.getDojoShape().getNode())))},_mouseOutHandler:function(k){if(k=
this._findMover(k.graphic))this.toolbar.onVertexMouseOut(this.graphic,k._getInfo())},_bindCtxNode:function(k){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(k);this._bindNode=k},_unbindCtxNode:function(){var k=this._bindNode;k&&this._ctxMenu.unBindDomNode(k)},_findMover:function(k){var w=[];var I=this._mpVertexMovers;O.forEach(this._vertexMovers,function(v){w=w.concat(v)});I&&O.forEach(I,function(v){w=w.concat(v)});
for(I=0;I<w.length;I++){var H=w[I];if(H.graphic===k)return H}},_firstMoveHandler:function(k){!this._isNew(k)&&this._canAdd&&this._hideRelatedMidpoints(k);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(k,w){var I=this._isNew(k);w&&(w.dx||w.dy)?(this._updateRelatedGraphic(k,k.relatedGraphic,k.graphic.geometry,k.segIndex,k.ptIndex,k.segLength,I),this._canAdd&&(I?this._addMidpoints(k):(this._repositionRelatedMidpoints(k),this._showRelatedMidpoints(k))),this.toolbar._endOperation("VERTICES")):
!I&&this._canAdd&&this._showRelatedMidpoints(k)},_showRelatedMidpoints:function(k){var w=this._getAdjacentMidpoints(k.ptIndex,k.segLength),I=this._mpVertexMovers[k.segIndex];for(k=0;k<w.length;k++){var H=I[w[k]];H.graphic.show();H.refresh()}},_hideRelatedMidpoints:function(k){var w=this._getAdjacentMidpoints(k.ptIndex,k.segLength),I=this._mpVertexMovers[k.segIndex];for(k=0;k<w.length;k++)I[w[k]].graphic.hide()},_repositionRelatedMidpoints:function(k){var w,I=this._getAdjacentMidpoints(k.ptIndex,k.segLength),
H=this._mpVertexMovers[k.segIndex];for(w=0;w<I.length;w++){var v=this._getAdjacentVertices(I[w],k.segLength),G=k.relatedGraphic.geometry.getPoint(k.segIndex,v[0]);v=k.relatedGraphic.geometry.getPoint(k.segIndex,v[1]);G=new e({x:(G.x+v.x)/2,y:(G.y+v.y)/2,spatialReference:G.spatialReference.toJson()});H[I[w]].graphic.setGeometry(G)}},_addMidpoints:function(k){var w=k.segIndex,I=k.ptIndex,H=k.segLength,v=I+1,G,Q=H+1;this._mpVertexMovers[w].splice(I,1);var T=this._vertexMovers[w];for(G=0;G<v;G++)T[G].segLength+=
1;for(G=v;G<T.length;G++)T[G].ptIndex+=1,T[G].segLength+=1;k.ptIndex=v;k.segLength=T.length+1;T.splice(v,0,k);k.graphic.setSymbol(this._symbol1);T=this._mpVertexMovers[w];for(G=0;G<I;G++)T[G].segLength+=1;for(G=I;G<H-1;G++)T[G].ptIndex+=1,T[G].segLength+=1;v=this._getAdjacentVertices(I,Q);w=this._getAdjacentVertices(I+1,Q);H=k.relatedGraphic.geometry.getPoint(k.segIndex,v[0]);G=k.relatedGraphic.geometry.getPoint(k.segIndex,v[1]);v=new e({x:(H.x+G.x)/2,y:(H.y+G.y)/2,spatialReference:H.spatialReference.toJson()});
H=k.relatedGraphic.geometry.getPoint(k.segIndex,w[0]);G=k.relatedGraphic.geometry.getPoint(k.segIndex,w[1]);w=new e({x:(H.x+G.x)/2,y:(H.y+G.y)/2,spatialReference:H.spatialReference.toJson()});H=new d(v,this._symbol2,this.graphic,k.segIndex,I,Q,this,!0);k=new d(w,this._symbol2,this.graphic,k.segIndex,I+1,Q,this,!0);T.splice(I,0,H,k)},_deleteVertex:function(k){var w,I=k.ptIndex,H=this._vertexMovers[k.segIndex];for(w=0;w<I;w++)--H[w].segLength;for(w=I+1;w<H.length;w++){var v=H[w];--v.ptIndex;--v.segLength}H.splice(I,
1);w=k._getInfo();k.destroy();this.toolbar.onVertexDelete(this.graphic,w)}});W.mixin(q,{create:function(k,w,I){switch(k.geometry.type){case "multipoint":return new q.MultipointVertexEditor(k,w,I);case "polyline":return new q.PolylineVertexEditor(k,w,I);case "polygon":return new q.PolygonVertexEditor(k,w,I)}}});q.MultipointVertexEditor=V(q,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=t.connect(d,"onMoveStart",this,this._moveStartHandler);
t.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);t.disconnect(this._moveStartHandle)},_getSegments:function(k){var w=k.points,I=[],H=k.spatialReference;for(k=0;k<w.length;k++){var v=w[k];I.push(new e({x:v[0],y:v[1],spatialReference:H.toJson()}))}return[I]},_getMidpointSegments:function(k){return[]},_getControlPoints:function(k,w,I,H,v){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(k){var w=k.graphic;if(k=this._findMover(k))this.toolbar.onVertexMouseOver(w,
k._getInfo()),this._selectedMover=k,this._canDel&&this._bindCtxNode(k.graphic.getDojoShape().getNode())},_mouseOutHandler:function(k){var w=k.graphic;if(k=this._findMover(k))this.toolbar.onVertexMouseOut(w,k._getInfo())},_findMover:function(k){var w=[].concat(this._vertexMovers[0]),I=k.target;for(k=0;k<w.length;k++){var H=w[k];if(H.graphic.getDojoShape().getNode()===I)return H}},_moveStartHandler:function(k){var w=k.ptIndex,I=k.segLength-1,H=k.relatedGraphic.geometry.points;k=H.splice(w,1);H.push(k[0]);
H=this._vertexMovers[0];for(k=I;k>w;k--)--H[k].ptIndex;k=H.splice(w,1);H.push(k[0]);k[0].ptIndex=I},_moveStopHandler:function(k){this._updateRelatedGraphic(k,k.relatedGraphic,k.graphic.geometry,k.segIndex,k.ptIndex,k.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(k,w,I,H,v,G,Q,T){k=w.geometry;T?k.removePoint(v):k.setPoint(v,I);w.setGeometry(k)},_deleteMidpoints:function(k){}});q.PolylineVertexEditor=V(q,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(k){var w,I,H=k.paths,v=[];for(w=0;w<H.length;w++){var G=H[w],Q=[];for(I=0;I<G.length;I++)Q.push(k.getPoint(w,I));v.push(Q)}return v},_getMidpointSegments:function(k){var w,I,H=k.paths,v=[],G=k.spatialReference;for(w=0;w<H.length;w++){var Q=H[w],T=[];for(I=0;I<Q.length-1;I++){var M=k.getPoint(w,I),R=k.getPoint(w,I+1);M=new e({x:(M.x+R.x)/2,y:(M.y+R.y)/2,spatialReference:G.toJson()});T.push(M)}v.push(T)}return v},_getControlPoints:function(k,w,I,H,v){var G=this.map,Q,T;this._isNew(k)?
(k=H,H+=1,0<=k&&(Q=G.toScreen(w.getPoint(I,k))),H<=v&&(T=G.toScreen(w.getPoint(I,H)))):(k=H-1,H+=1,0<=k&&(Q=G.toScreen(w.getPoint(I,k))),H<v&&(T=G.toScreen(w.getPoint(I,H))));return[Q,T]},_getAdjacentMidpoints:function(k,w){var I=[],H=k-1;0<=H&&I.push(H);k<w-1&&I.push(k);return I},_getAdjacentVertices:function(k,w){return[k,k+1]},_deleteMidpoints:function(k){var w=this._mpVertexMovers[k.segIndex],I=w.length-1,H=this._getAdjacentMidpoints(k.ptIndex,k.segLength).sort(),v,G=H[0];for(v=0;v<G;v++)--w[v].segLength;
for(v=G+1;v<w.length;v++){var Q=w[v];--Q.ptIndex;--Q.segLength}if(1===H.length)w.splice(G,1)[0].destroy();else for(Q=this._getAdjacentVertices(G,I),v=k.relatedGraphic.geometry.getPoint(k.segIndex,Q[0]),Q=k.relatedGraphic.geometry.getPoint(k.segIndex,Q[1]),v=new e({x:(v.x+Q.x)/2,y:(v.y+Q.y)/2,spatialReference:v.spatialReference.toJson()}),k=new d(v,this._symbol2,this.graphic,k.segIndex,G,I,this,!0),w=w.splice(G,H.length,k),v=0;v<w.length;v++)w[v].destroy()},_updateRelatedGraphic:function(k,w,I,H,v,
G,Q,T){k=w.geometry;Q?k.insertPoint(H,v+1,l.fromJson(I.toJson())):T?k.removePoint(H,v):k.setPoint(H,v,l.fromJson(I.toJson()));w.setGeometry(k)}});q.PolygonVertexEditor=V(q,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(k){var w,I,H=k.rings,v=[];for(w=0;w<H.length;w++){var G=H[w],Q=[];for(I=0;I<G.length-1;I++)Q.push(k.getPoint(w,I));v.push(Q)}return v},_getMidpointSegments:function(k){var w,I,H=k.rings,v=[],G=k.spatialReference;for(w=0;w<H.length;w++){var Q=H[w],
T=[];for(I=0;I<Q.length-1;I++){var M=k.getPoint(w,I),R=k.getPoint(w,I+1);M=new e({x:(M.x+R.x)/2,y:(M.y+R.y)/2,spatialReference:G.toJson()});T.push(M)}v.push(T)}return v},_getControlPoints:function(k,w,I,H,v){var G=this.map;this._isNew(k)?k=H:(k=H-1,k=0>k?(v+k)%v:k);H=(H+1)%v;v=G.toScreen(w.getPoint(I,k));w=G.toScreen(w.getPoint(I,H));return[v,w]},_getAdjacentMidpoints:function(k,w){var I=k-1;return[0>I?(w+I)%w:I,k]},_getAdjacentVertices:function(k,w){return[k,(k+1)%w]},_deleteMidpoints:function(k){var w=
k.ptIndex,I=this._mpVertexMovers[k.segIndex],H=I.length-1,v=this._getAdjacentMidpoints(w,k.segLength).sort();var G=v[0];var Q=v[v.length-1];if(0===w){var T=this._getAdjacentVertices(H-1,H);w=k.relatedGraphic.geometry.getPoint(k.segIndex,T[0]);T=k.relatedGraphic.geometry.getPoint(k.segIndex,T[1]);w=new e({x:(w.x+T.x)/2,y:(w.y+T.y)/2,spatialReference:w.spatialReference.toJson()});k=new d(w,this._symbol2,this.graphic,k.segIndex,H-1,H,this,!0);I.splice(Q,1,k)[0].destroy();I.splice(G,1)[0].destroy();for(v=
0;v<I.length-1;v++)G=I[v],--G.ptIndex,--G.segLength}else{T=this._getAdjacentVertices(G,H);w=k.relatedGraphic.geometry.getPoint(k.segIndex,T[0]);T=k.relatedGraphic.geometry.getPoint(k.segIndex,T[1]);w=new e({x:(w.x+T.x)/2,y:(w.y+T.y)/2,spatialReference:w.spatialReference.toJson()});k=new d(w,this._symbol2,this.graphic,k.segIndex,G,H,this,!0);Q=I.splice(G,v.length,k);for(v=0;v<Q.length;v++)Q[v].destroy();for(v=0;v<G;v++)--I[v].segLength;for(v=G+1;v<I.length;v++)G=I[v],--G.ptIndex,--G.segLength}},_updateRelatedGraphic:function(k,
w,I,H,v,G,Q,T){k=w.geometry;Q?k.insertPoint(H,v+1,l.fromJson(I.toJson())):T?(k.removePoint(H,v),0===v&&k.setPoint(H,G-1,l.fromJson(k.getPoint(H,0).toJson()))):(k.setPoint(H,v,l.fromJson(I.toJson())),0===v&&k.setPoint(H,G,l.fromJson(I.toJson())));w.setGeometry(k)}});Z("extend-esri")&&(W.setObject("toolbars._GraphicVertexEditor",q,x),W.setObject("toolbars._MultipointVertexEditor",q.MultipointVertexEditor,x),W.setObject("toolbars._PolylineVertexEditor",q.PolylineVertexEditor,x),W.setObject("toolbars._PolygonVertexEditor",
q.PolygonVertexEditor,x));return q})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(V,W,t,O,Z,P,F,x,d,e,l,n,q){V=V(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(k,w,I,H,v,G,Q,T){this.point=k;this.symbol=w;this.relatedGraphic=I;this.segIndex=H;this.ptIndex=
v;this.segLength=G;this.editor=Q;this.map=Q.map;this._scratchGL=Q.toolbar._scratchGL;this._placeholder=T||!1;this._type=I.geometry.type;this._init();this._enable()},refresh:function(k){if(k||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var k=new l(this.point.toJson());
k=new n(k,this.symbol);switch(this._type){case "multipoint":k._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(k)}this.graphic=k},_enable:function(){var k=this.graphic.getDojoShape();k&&(k._hasMover=!0,this._moveable=this._getMoveable(k),(k=k.getEventSource())&&Z.set(k,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var k=this._moveable;if(k){t.disconnect(this._startHandle);
t.disconnect(this._firstHandle);t.disconnect(this._movingHandle);t.disconnect(this._stopHandle);var w=k.shape;w&&(w=w.getEventSource())&&Z.set(w,"cursor","inherit");k.destroy();this._moveable=null}},_needRefresh:function(){var k=this.graphic.getDojoShape(),w=!1;if(k)switch(this._type){case "multipoint":var I=this.relatedGraphic.getDojoShape();I&&(I=I.children[this.ptIndex],k!==I&&(this.graphic._shape=I,w=!0));break;case "polyline":case "polygon":w=!k._hasMover}return w},_getMoveable:function(k){k=
new P(k,O("mac")&&O("ff")&&!e("esri-touch")&&{leftButtonOnly:!0});this._startHandle=t.connect(k,"onMoveStart",this,this._moveStartHandler);this._firstHandle=t.connect(k,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=t.connect(k,"onMoving",this,this._movingHandler);this._stopHandle=t.connect(k,"onMoveStop",this,this._moveStopHandler);return k},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(k){var w=this.map;w.snappingManager&&w.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();k.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(k){var w=k.shape,I=this._getControlEdges(),H=this._scratchGL._div,v,G=[],Q=k.host.shape._wrapOffsets[0]||
0;for(v=0;v<I.length;v++){var T=I[v];T.x1+=Q;T.x2+=Q;G.push([H.createLine({x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2}).setStroke(this.editor._lineStroke),T.x1,T.y1,T.x2,T.y2])}w._lines=G;k.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(k,w,I){w=this.map;var H;e("esri-pointer")?H=w.navigationManager.pointerEvents._processTouchEvent(I,I):I&&"pointermove"===I.type&&(H=d.prototype._processTouchEvent.call({map:w},
I,I));H&&w.snappingManager&&w.snappingManager._onSnappingMouseMoveHandler(H);I=k.shape;k=I.getTransform();I=I._lines;for(H=0;H<I.length;H++)w=I[H],w[0].setShape({x1:w[1]+k.dx,y1:w[2]+k.dy,x2:w[3],y2:w[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),k)},_moveStopHandler:function(k){k=k.shape;var w=this.editor.toolbar,I=k.getTransform(),H=this.map,v=this.graphic,G=w._geo?q.geographicToWebMercator(v.geometry):v.geometry;w._activateScrollWheel();var Q,T=k._lines;if(T){for(Q=
0;Q<T.length;Q++)T[Q][0].removeShape();k._lines=null}Q=!1;T=!0;var M=this._getInfo();I&&(I.dx||I.dy)?this._placeholder&&(this._placeholder=!1,Q=!0):T=!1;if(H.snappingManager)var R=H.snappingManager._snappingPoint;var C=[I,F.invert(this._startTx)];R=R||H.toMap(F.multiplyPoint(C,H.toScreen(G,!0)));H.snappingManager&&H.snappingManager._killOffSnapping();k.setTransform(null);v.setGeometry(w._geo?q.webMercatorToGeographic(R,!0):R);this.constructor.onMoveStop(this,I);w.onVertexMoveStop(this.relatedGraphic,
M,I);if(!T)w.onVertexClick(this.relatedGraphic,M);if(Q)w.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var k=this.map,w=this.relatedGraphic.geometry,I=this.segIndex,H=this.ptIndex,v=this.segLength,G=this._scratchGL.getNavigationTransform(),Q=G.dx;G=G.dy;var T=k.toScreen(this.graphic.geometry);k=T.x-Q;T=T.y-G;var M=[];w=this.editor._getControlPoints(this,w,I,H,v);w[0]&&M.push({x1:k,y1:T,x2:w[0].x-Q,y2:w[0].y-G});w[1]&&M.push({x1:k,y1:T,x2:w[1].x-Q,y2:w[1].y-G});return M}});
e("extend-esri")&&W.setObject("toolbars.VertexMover",V,x);W.mixin(V,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return V})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(V,W,t,O,Z,P,F,x,d,e){V=V(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(l,n,q){this._graphic=l;this._map=n;
this._toolbar=q;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(l){this._editBox?(t.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=t.connect(l.getLayer(),"onDblClick",this,function(n){this._map.navigationManager.setImmediateClick(!1);n.graphic==l&&(O.stop(n),t.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,
this._addTextBox(l))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(t.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(l,n){if(!this._editBox){if(!l.symbol.text){l.symbol.text="Tempt text";l.setSymbol(l.symbol);var q=""}var k=this._createInputTextStyle(l,this._map);""!==q&&(q=n||l.symbol.text);this._editBox=P.create("input",{type:"text",value:q});
x.set(this._editBox,k);F.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=t.connect(this._editBox,"onkeyup",W.hitch(this,function(I){I.keyCode!=d.ENTER&&I.keyCode!==d.TAB||this._disable()}));this._editBoxBlurHandler=t.connect(this._editBox,"onblur",W.hitch(this,function(I){this._disable()}));l.symbol.text="";l.setSymbol(l.symbol);l.hide();var w=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",
W.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(I){x.set(w,{left:this._editBoxLeft+I.delta.x+"px",top:this._editBoxTop+I.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(x.get(w,"left"));this._editBoxTop=parseFloat(x.get(w,"top"))});this.onEditStart(l,this._editBox);this._toolbar.onTextEditStart(l,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(t.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(t.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(l,
n){n=l.getDojoShape().getTransformedBoundingBox();var q=l.getLayer();q=q.hasLocalNavigationTransform()?{dx:0,dy:0}:q.getNavigationTransform();var k=l.symbol.font;return{"font-family":k.family,"font-size":k.size+"px","font-style":k.style,"font-variant":k.variant,"font-weight":k.weight,left:n[0].x+q.dx+"px",top:n[0].y+q.dy+"px",width:Math.abs(n[0].x-n[1].x)/Math.cos(l.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var l=this._graphic.symbol;
l.text=this._editBox.value;this._graphic.setSymbol(l)}else this._graphic.getLayer().remove(this._graphic)}});Z("extend-esri")&&W.setObject("toolbars.TextEditor",V,e);return V})},"jimu/dijit/EditorXssFilter":function(){define("dojo/_base/declare dojo/_base/array dijit/_WidgetBase dojo/_base/lang dojo/Evented libs/arcgis-html-sanitizer/arcgis-html-sanitizer".split(" "),function(V,W,t,O,Z,P){var F=null,x=V([t,Z],{baseClass:"jimu-editor-xss-filter",declaredClass:"jimu.dijit.EditorXssFilter",sanitizer:null,
xss:null,whiteList:{},graphicsWhiteList:{},postCreate:function(){this.whiteList=this._getWhiteList();this.sanitizer=new P({whiteList:this.whiteList,safeAttrValue:O.hitch(this,function(d,e,l,n){return"style"===e?this.xss.friendlyAttrValue(l).replace(/"/g,"'"):"img"===d&&"src"===e?this.xss.escapeAttrValue(l):this.xss.safeAttrValue(d,e,l,n)}),onTag:O.hitch(this,function(d,e,l){if(l.isWhite&&this._isInWhiteList(d,this.graphicsWhiteList))return e}),onIgnoreTagAttr:O.hitch(this,function(d,e,l,n){if("data-"===
e.substr(0,5))return e+'\x3d"'+this.xss.escapeAttrValue(l)+'"'}),onIgnoreTag:O.hitch(this,function(d,e,l){if("o:"===d.substr(0,2)||"!--[if"===d||"!--[endif]--"===d)return e})},!0);this.xss=this.sanitizer.xss},sanitize:function(d){return this.sanitizer.sanitize(d)},_getWhiteList:function(){var d="title height width class style font-family id align text-align".split(" "),e={div:d,h1:d,h2:d,h3:d,h4:d,h5:d,h6:d,span:d,p:d,s:d,strong:d,em:d,u:d,ol:d,ul:d,li:d,a:["href","target"].concat(d),img:["src","alt",
"border"].concat(d),blockquote:d,font:["face","size","color"].concat(d),pre:d,code:d,b:d,i:d,wbr:d,video:"autoplay controls loop muted poster preload".split(" ").concat(d),audio:["autoplay","controls","loop","muted","preload"].concat(d),source:["media","src","type"].concat(d),table:["cellpadding","cellspacing","border"].concat(d),tbody:[].concat(d),tr:["valign"].concat(d),td:["valign","colspan","rowspan","nowrap"].concat(d),th:["valign","colspan","rowspan","nowrap"].concat(d),hr:d,html:d,title:d,
link:["rel","href"],style:["type"].concat(d),body:d};this.graphicsWhiteList={animate:[],animateMotion:[],animateTransform:[],circle:[],clipPath:[],"color-profile":[],defs:[],desc:[],discard:[],ellipse:[],feBlend:[],feColorMatrix:[],feComponentTransfer:[],feComposite:[],feConvolveMatrix:[],feDiffuseLighting:[],feDisplacementMap:[],feDistantLight:[],feDropShadow:[],feFlood:[],feFuncA:[],feFuncB:[],feFuncG:[],feFuncR:[],feGaussianBlur:[],feImage:[],feMerge:[],feMergeNode:[],feMorphology:[],feOffset:[],
fePointLight:[],feSpecularLighting:[],feSpotLight:[],feTile:[],feTurbulence:[],filter:[],foreignObject:[],g:[],hatch:[],hatchpath:[],line:[],linearGradient:[],marker:[],mask:[],mesh:[],meshgradient:[],meshpatch:[],meshrow:[],metadata:[],mpath:[],path:[],pattern:[],polygon:[],polyline:[],radialGradient:[],rect:[],set:[],solidcolor:[],stop:[],svg:[],switch:[],symbol:[],text:[],textPath:[],title:[],tspan:[],use:[],view:[],object:[],canvas:d};return this._extendObjectOfArrays([e,{a:["target","href","title"],
abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title",
"width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls loop preload src height width".split(" ")},this.graphicsWhiteList])},
_extendObjectOfArrays:function(d){var e={};W.forEach(d,function(l){var n=Object.keys(l);W.forEach(n,function(q){Array.isArray(l[q])&&Array.isArray(e[q])?e[q]=e[q].concat(l[q]):e[q]=l[q]},this)},this);return e},_isInWhiteList:function(d,e){e=Object.keys(e);var l=!1;W.forEach(e,function(n){d===n&&(l=!0)},this);return l}});x.getInstance=function(){null===F&&(F=new x);return F};return x})},"widgets/NearMe/libs/swiper":function(){(function(){function V(F){F.fn.swiper=function(x){var d;F(this).each(function(){var e=
new t(this,x);d||(d=e)});return d}}var W,t=function(F,x){function d(){var b=a.params.autoplay,f=a.slides.eq(a.activeIndex);f.attr("data-swiper-autoplay")&&(b=f.attr("data-swiper-autoplay")||a.params.autoplay);a.autoplayTimeoutId=setTimeout(function(){a.params.loop?(a.fixLoop(),a._slideNext(),a.emit("onAutoplay",a)):a.isEnd?x.autoplayStopOnLast?a.stopAutoplay():(a._slideTo(0),a.emit("onAutoplay",a)):(a._slideNext(),a.emit("onAutoplay",a))},b)}function e(b,f){b=W(b.target);if(!b.is(f))if("string"===
typeof f)b=b.parents(f);else if(f.nodeType){var D;b.parents().each(function(r,X){X===f&&(D=f)});if(D)return f;return}if(0!==b.length)return b[0]}function l(b,f){f=f||{};var D=new (window.MutationObserver||window.WebkitMutationObserver)(function(r){r.forEach(function(X){a.onResize(!0);a.emit("onObserverUpdate",a,X)})});D.observe(b,{attributes:"undefined"===typeof f.attributes?!0:f.attributes,childList:"undefined"===typeof f.childList?!0:f.childList,characterData:"undefined"===typeof f.characterData?
!0:f.characterData});a.observers.push(D)}function n(b){b.originalEvent&&(b=b.originalEvent);var f=b.keyCode||b.charCode;if(!a.params.allowSwipeToNext&&(a.isHorizontal()&&39===f||!a.isHorizontal()&&40===f)||!a.params.allowSwipeToPrev&&(a.isHorizontal()&&37===f||!a.isHorizontal()&&38===f))return!1;if(!(b.shiftKey||b.altKey||b.ctrlKey||b.metaKey||document.activeElement&&document.activeElement.nodeName&&("input"===document.activeElement.nodeName.toLowerCase()||"textarea"===document.activeElement.nodeName.toLowerCase()))){if(37===
f||39===f||38===f||40===f){var D=!1;if(0<a.container.parents("."+a.params.slideClass).length&&0===a.container.parents("."+a.params.slideActiveClass).length)return;var r=window.pageXOffset,X=window.pageYOffset,ba=window.innerWidth,ra=window.innerHeight,g=a.container.offset();a.rtl&&(g.left-=a.container[0].scrollLeft);g=[[g.left,g.top],[g.left+a.width,g.top],[g.left,g.top+a.height],[g.left+a.width,g.top+a.height]];for(var K=0;K<g.length;K++){var U=g[K];U[0]>=r&&U[0]<=r+ba&&U[1]>=X&&U[1]<=X+ra&&(D=!0)}if(!D)return}if(a.isHorizontal()){if(37===
f||39===f)b.preventDefault?b.preventDefault():b.returnValue=!1;(39===f&&!a.rtl||37===f&&a.rtl)&&a.slideNext();(37===f&&!a.rtl||39===f&&a.rtl)&&a.slidePrev()}else{if(38===f||40===f)b.preventDefault?b.preventDefault():b.returnValue=!1;40===f&&a.slideNext();38===f&&a.slidePrev()}a.emit("onKeyPress",a,f)}}function q(){var b="onwheel"in document;b||(b=document.createElement("div"),b.setAttribute("onwheel","return;"),b="function"===typeof b.onwheel);!b&&document.implementation&&document.implementation.hasFeature&&
!0!==document.implementation.hasFeature("","")&&(b=document.implementation.hasFeature("Events.wheel","3.0"));return b}function k(b){var f=0,D=0,r=0,X=0;"detail"in b&&(D=b.detail);"wheelDelta"in b&&(D=-b.wheelDelta/120);"wheelDeltaY"in b&&(D=-b.wheelDeltaY/120);"wheelDeltaX"in b&&(f=-b.wheelDeltaX/120);"axis"in b&&b.axis===b.HORIZONTAL_AXIS&&(f=D,D=0);r=10*f;X=10*D;"deltaY"in b&&(X=b.deltaY);"deltaX"in b&&(r=b.deltaX);(r||X)&&b.deltaMode&&(1===b.deltaMode?(r*=40,X*=40):(r*=800,X*=800));r&&!f&&(f=1>
r?-1:1);X&&!D&&(D=1>X?-1:1);return{spinX:f,spinY:D,pixelX:r,pixelY:X}}function w(b){b.originalEvent&&(b=b.originalEvent);var f=0;f=a.rtl?-1:1;var D=k(b);if(a.params.mousewheelForceToAxis)if(a.isHorizontal())if(Math.abs(D.pixelX)>Math.abs(D.pixelY))f*=D.pixelX;else return;else if(Math.abs(D.pixelY)>Math.abs(D.pixelX))f=D.pixelY;else return;else f=Math.abs(D.pixelX)>Math.abs(D.pixelY)?-D.pixelX*f:-D.pixelY;if(0!==f){a.params.mousewheelInvert&&(f=-f);if(a.params.freeMode){f=a.getWrapperTranslate()+f*
a.params.mousewheelSensitivity;D=a.isBeginning;var r=a.isEnd;f>=a.minTranslate()&&(f=a.minTranslate());f<=a.maxTranslate()&&(f=a.maxTranslate());a.setWrapperTransition(0);a.setWrapperTranslate(f);a.updateProgress();a.updateActiveIndex();(!D&&a.isBeginning||!r&&a.isEnd)&&a.updateClasses();a.params.freeModeSticky?(clearTimeout(a.mousewheel.timeout),a.mousewheel.timeout=setTimeout(function(){a.slideReset()},300)):a.params.lazyLoading&&a.lazy&&a.lazy.load();a.emit("onScroll",a,b);a.params.autoplay&&a.params.autoplayDisableOnInteraction&&
a.stopAutoplay();if(0===f||f===a.maxTranslate())return}else{if(60<(new window.Date).getTime()-a.mousewheel.lastScrollTime)if(0>f)if((!a.isEnd||a.params.loop)&&!a.animating)a.slideNext(),a.emit("onScroll",a,b);else{if(a.params.mousewheelReleaseOnEdges)return!0}else if((!a.isBeginning||a.params.loop)&&!a.animating)a.slidePrev(),a.emit("onScroll",a,b);else if(a.params.mousewheelReleaseOnEdges)return!0;a.mousewheel.lastScrollTime=(new window.Date).getTime()}b.preventDefault?b.preventDefault():b.returnValue=
!1;return!1}}function I(b,f){b=W(b);var D=a.rtl?-1:1;var r=b.attr("data-swiper-parallax")||"0";var X=b.attr("data-swiper-parallax-x");var ba=b.attr("data-swiper-parallax-y");X||ba?(X=X||"0",ba=ba||"0"):a.isHorizontal()?(X=r,ba="0"):(ba=r,X="0");X=0<=X.indexOf("%")?parseInt(X,10)*f*D+"%":X*f*D+"px";ba=0<=ba.indexOf("%")?parseInt(ba,10)*f+"%":ba*f+"px";b.transform("translate3d("+X+", "+ba+",0px)")}function H(b){0!==b.indexOf("on")&&(b=b[0]!==b[0].toUpperCase()?"on"+b[0].toUpperCase()+b.substring(1):
"on"+b);return b}if(!(this instanceof t))return new t(F,x);var v={direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,autoplay:!1,autoplayDisableOnInteraction:!0,autoplayStopOnLast:!1,iOSEdgeSwipeDetection:!1,iOSEdgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeMomentumVelocityRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,
effect:"slide",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},flip:{slideShadows:!0,limitRotation:!0},cube:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94},fade:{crossFade:!1},parallax:!1,zoom:!1,zoomMax:3,zoomMin:1,zoomToggle:!0,scrollbar:null,scrollbarHide:!0,scrollbarDraggable:!1,scrollbarSnapOnRelease:!1,keyboardControl:!1,mousewheelControl:!1,mousewheelReleaseOnEdges:!1,mousewheelInvert:!1,mousewheelForceToAxis:!1,mousewheelSensitivity:1,mousewheelEventsTarged:"container",
hashnav:!1,hashnavWatchState:!1,history:!1,replaceState:!1,breakpoints:void 0,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,onlyExternal:!1,threshold:0,touchMoveStopPropagation:!0,touchReleaseOnEdges:!1,uniqueNavElements:!0,pagination:null,paginationElement:"span",
paginationClickable:!1,paginationHide:!1,paginationBulletRender:null,paginationProgressRender:null,paginationFractionRender:null,paginationCustomRender:null,paginationType:"bullets",resistance:!0,resistanceRatio:.85,nextButton:null,prevButton:null,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingInPrevNextAmount:1,lazyLoadingOnTransitionStart:!1,preloadImages:!0,updateOnImagesReady:!0,
loop:!1,loopAdditionalSlides:0,loopedSlides:null,control:void 0,controlInverse:!1,controlBy:"slide",normalizeSlideIndex:!0,allowSwipeToPrev:!0,allowSwipeToNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",passiveListeners:!0,containerModifierClass:"swiper-container-",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",
slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",buttonDisabledClass:"swiper-button-disabled",paginationCurrentClass:"swiper-pagination-current",paginationTotalClass:"swiper-pagination-total",paginationHiddenClass:"swiper-pagination-hidden",paginationProgressbarClass:"swiper-pagination-progressbar",
paginationClickableClass:"swiper-pagination-clickable",paginationModifierClass:"swiper-pagination-",lazyLoadingClass:"swiper-lazy",lazyStatusLoadingClass:"swiper-lazy-loading",lazyStatusLoadedClass:"swiper-lazy-loaded",lazyPreloaderClass:"swiper-lazy-preloader",notificationClass:"swiper-notification",preloaderClass:"preloader",zoomContainerClass:"swiper-zoom-container",observer:!1,observeParents:!1,a11y:!1,prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",
lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",runCallbacksOnInit:!0},G=x&&x.virtualTranslate;x=x||{};var Q={},T;for(T in x)if("object"!==typeof x[T]||null===x[T]||x[T].nodeType||x[T]===window||x[T]===document||"undefined"!==typeof O&&x[T]instanceof O||"undefined"!==typeof jQuery&&x[T]instanceof jQuery)Q[T]=x[T];else{Q[T]={};for(var M in x[T])Q[T][M]=x[T][M]}for(var R in v)if("undefined"===typeof x[R])x[R]=v[R];else if("object"===typeof x[R])for(var C in v[R])"undefined"===
typeof x[R][C]&&(x[R][C]=v[R][C]);var a=this;a.params=x;a.originalParams=Q;a.classNames=[];"undefined"!==typeof W&&"undefined"!==typeof O&&(W=O);if("undefined"===typeof W&&(W="undefined"===typeof O?window.Dom7||window.Zepto||window.jQuery:O,!W))return;a.$=W;a.currentBreakpoint=void 0;a.getActiveBreakpoint=function(){if(!a.params.breakpoints)return!1;var b=!1,f=[];for(r in a.params.breakpoints)a.params.breakpoints.hasOwnProperty(r)&&f.push(r);f.sort(function(X,ba){return parseInt(X,10)>parseInt(ba,
10)});for(var D=0;D<f.length;D++){var r=f[D];r>=window.innerWidth&&!b&&(b=r)}return b||"max"};a.setBreakpoint=function(){var b=a.getActiveBreakpoint();if(b&&a.currentBreakpoint!==b){var f=b in a.params.breakpoints?a.params.breakpoints[b]:a.originalParams,D=a.params.loop&&f.slidesPerView!==a.params.slidesPerView,r;for(r in f)a.params[r]=f[r];a.currentBreakpoint=b;D&&a.destroyLoop&&a.reLoop(!0)}};a.params.breakpoints&&a.setBreakpoint();a.container=W(F);if(0!==a.container.length){if(1<a.container.length){var B=
[];a.container.each(function(){B.push(new t(this,x))});return B}a.container[0].swiper=a;a.container.data("swiper",a);a.classNames.push(a.params.containerModifierClass+a.params.direction);a.params.freeMode&&a.classNames.push(a.params.containerModifierClass+"free-mode");a.support.flexbox||(a.classNames.push(a.params.containerModifierClass+"no-flexbox"),a.params.slidesPerColumn=1);a.params.autoHeight&&a.classNames.push(a.params.containerModifierClass+"autoheight");if(a.params.parallax||a.params.watchSlidesVisibility)a.params.watchSlidesProgress=
!0;a.params.touchReleaseOnEdges&&(a.params.resistanceRatio=0);0<=["cube","coverflow","flip"].indexOf(a.params.effect)&&(a.support.transforms3d?(a.params.watchSlidesProgress=!0,a.classNames.push(a.params.containerModifierClass+"3d")):a.params.effect="slide");"slide"!==a.params.effect&&a.classNames.push(a.params.containerModifierClass+a.params.effect);"cube"===a.params.effect&&(a.params.resistanceRatio=0,a.params.slidesPerView=1,a.params.slidesPerColumn=1,a.params.slidesPerGroup=1,a.params.centeredSlides=
!1,a.params.spaceBetween=0,a.params.virtualTranslate=!0);if("fade"===a.params.effect||"flip"===a.params.effect)a.params.slidesPerView=1,a.params.slidesPerColumn=1,a.params.slidesPerGroup=1,a.params.watchSlidesProgress=!0,a.params.spaceBetween=0,"undefined"===typeof G&&(a.params.virtualTranslate=!0);a.params.grabCursor&&a.support.touch&&(a.params.grabCursor=!1);a.wrapper=a.container.children("."+a.params.wrapperClass);a.params.pagination&&(a.paginationContainer=W(a.params.pagination),a.params.uniqueNavElements&&
"string"===typeof a.params.pagination&&1<a.paginationContainer.length&&1===a.container.find(a.params.pagination).length&&(a.paginationContainer=a.container.find(a.params.pagination)),"bullets"===a.params.paginationType&&a.params.paginationClickable?a.paginationContainer.addClass(a.params.paginationModifierClass+"clickable"):a.params.paginationClickable=!1,a.paginationContainer.addClass(a.params.paginationModifierClass+a.params.paginationType));if(a.params.nextButton||a.params.prevButton)a.params.nextButton&&
(a.nextButton=W(a.params.nextButton),a.params.uniqueNavElements&&"string"===typeof a.params.nextButton&&1<a.nextButton.length&&1===a.container.find(a.params.nextButton).length&&(a.nextButton=a.container.find(a.params.nextButton))),a.params.prevButton&&(a.prevButton=W(a.params.prevButton),a.params.uniqueNavElements&&"string"===typeof a.params.prevButton&&1<a.prevButton.length&&1===a.container.find(a.params.prevButton).length&&(a.prevButton=a.container.find(a.params.prevButton)));a.isHorizontal=function(){return"horizontal"===
a.params.direction};a.rtl=a.isHorizontal()&&("rtl"===a.container[0].dir.toLowerCase()||"rtl"===a.container.css("direction"));a.rtl&&a.classNames.push(a.params.containerModifierClass+"rtl");a.rtl&&(a.wrongRTL="-webkit-box"===a.wrapper.css("display"));1<a.params.slidesPerColumn&&a.classNames.push(a.params.containerModifierClass+"multirow");a.device.android&&a.classNames.push(a.params.containerModifierClass+"android");a.container.addClass(a.classNames.join(" "));a.translate=0;a.progress=0;a.velocity=
0;a.lockSwipeToNext=function(){a.params.allowSwipeToNext=!1;!1===a.params.allowSwipeToPrev&&a.params.grabCursor&&a.unsetGrabCursor()};a.lockSwipeToPrev=function(){a.params.allowSwipeToPrev=!1;!1===a.params.allowSwipeToNext&&a.params.grabCursor&&a.unsetGrabCursor()};a.lockSwipes=function(){a.params.allowSwipeToNext=a.params.allowSwipeToPrev=!1;a.params.grabCursor&&a.unsetGrabCursor()};a.unlockSwipeToNext=function(){a.params.allowSwipeToNext=!0;!0===a.params.allowSwipeToPrev&&a.params.grabCursor&&a.setGrabCursor()};
a.unlockSwipeToPrev=function(){a.params.allowSwipeToPrev=!0;!0===a.params.allowSwipeToNext&&a.params.grabCursor&&a.setGrabCursor()};a.unlockSwipes=function(){a.params.allowSwipeToNext=a.params.allowSwipeToPrev=!0;a.params.grabCursor&&a.setGrabCursor()};a.setGrabCursor=function(b){a.container[0].style.cursor="move";a.container[0].style.cursor=b?"-webkit-grabbing":"-webkit-grab";a.container[0].style.cursor=b?"-moz-grabbin":"-moz-grab";a.container[0].style.cursor=b?"grabbing":"grab"};a.unsetGrabCursor=
function(){a.container[0].style.cursor=""};a.params.grabCursor&&a.setGrabCursor();a.imagesToLoad=[];a.imagesLoaded=0;a.loadImage=function(b,f,D,r,X,ba){function ra(){ba&&ba()}b.complete&&X?ra():f?(b=new window.Image,b.onload=ra,b.onerror=ra,r&&(b.sizes=r),D&&(b.srcset=D),f&&(b.src=f)):ra()};a.preloadImages=function(){function b(){"undefined"!==typeof a&&null!==a&&a&&(void 0!==a.imagesLoaded&&a.imagesLoaded++,a.imagesLoaded===a.imagesToLoad.length&&(a.params.updateOnImagesReady&&a.update(),a.emit("onImagesReady",
a)))}a.imagesToLoad=a.container.find("img");for(var f=0;f<a.imagesToLoad.length;f++)a.loadImage(a.imagesToLoad[f],a.imagesToLoad[f].currentSrc||a.imagesToLoad[f].getAttribute("src"),a.imagesToLoad[f].srcset||a.imagesToLoad[f].getAttribute("srcset"),a.imagesToLoad[f].sizes||a.imagesToLoad[f].getAttribute("sizes"),!0,b)};a.autoplayTimeoutId=void 0;a.autoplaying=!1;a.autoplayPaused=!1;a.startAutoplay=function(){if("undefined"!==typeof a.autoplayTimeoutId||!a.params.autoplay||a.autoplaying)return!1;a.autoplaying=
!0;a.emit("onAutoplayStart",a);d()};a.stopAutoplay=function(b){a.autoplayTimeoutId&&(a.autoplayTimeoutId&&clearTimeout(a.autoplayTimeoutId),a.autoplaying=!1,a.autoplayTimeoutId=void 0,a.emit("onAutoplayStop",a))};a.pauseAutoplay=function(b){a.autoplayPaused||(a.autoplayTimeoutId&&clearTimeout(a.autoplayTimeoutId),a.autoplayPaused=!0,0===b?(a.autoplayPaused=!1,d()):a.wrapper.transitionEnd(function(){a&&(a.autoplayPaused=!1,a.autoplaying?d():a.stopAutoplay())}))};a.minTranslate=function(){return-a.snapGrid[0]};
a.maxTranslate=function(){return-a.snapGrid[a.snapGrid.length-1]};a.updateAutoHeight=function(){var b=[],f=0,D;if("auto"!==a.params.slidesPerView&&1<a.params.slidesPerView)for(D=0;D<Math.ceil(a.params.slidesPerView);D++){var r=a.activeIndex+D;if(r>a.slides.length)break;b.push(a.slides.eq(r)[0])}else b.push(a.slides.eq(a.activeIndex)[0]);for(D=0;D<b.length;D++)"undefined"!==typeof b[D]&&(r=b[D].offsetHeight,f=r>f?r:f);f&&a.wrapper.css("height",f+"px")};a.updateContainerSize=function(){var b="undefined"!==
typeof a.params.width?a.params.width:a.container[0].clientWidth;var f="undefined"!==typeof a.params.height?a.params.height:a.container[0].clientHeight;0===b&&a.isHorizontal()||0===f&&!a.isHorizontal()||(b=b-parseInt(a.container.css("padding-left"),10)-parseInt(a.container.css("padding-right"),10),f=f-parseInt(a.container.css("padding-top"),10)-parseInt(a.container.css("padding-bottom"),10),a.width=b,a.height=f,a.size=a.isHorizontal()?a.width:a.height)};a.updateSlidesSize=function(){a.slides=a.wrapper.children("."+
a.params.slideClass);a.snapGrid=[];a.slidesGrid=[];a.slidesSizesGrid=[];var b=a.params.spaceBetween,f=-a.params.slidesOffsetBefore,D,r=0,X=0;if("undefined"!==typeof a.size){"string"===typeof b&&0<=b.indexOf("%")&&(b=parseFloat(b.replace("%",""))/100*a.size);a.virtualSize=-b;a.rtl?a.slides.css({marginLeft:"",marginTop:""}):a.slides.css({marginRight:"",marginBottom:""});if(1<a.params.slidesPerColumn){var ba=Math.floor(a.slides.length/a.params.slidesPerColumn)===a.slides.length/a.params.slidesPerColumn?
a.slides.length:Math.ceil(a.slides.length/a.params.slidesPerColumn)*a.params.slidesPerColumn;"auto"!==a.params.slidesPerView&&"row"===a.params.slidesPerColumnFill&&(ba=Math.max(ba,a.params.slidesPerView*a.params.slidesPerColumn))}var ra=a.params.slidesPerColumn,g=ba/ra,K=g-(a.params.slidesPerColumn*g-a.slides.length);for(D=0;D<a.slides.length;D++){var U=0;var Y=a.slides.eq(D);if(1<a.params.slidesPerColumn){if("column"===a.params.slidesPerColumnFill){var ia=Math.floor(D/ra);var va=D-ia*ra;(ia>K||ia===
K&&va===ra-1)&&++va>=ra&&(va=0,ia++);var m=ia+va*ba/ra;Y.css({"-webkit-box-ordinal-group":m,"-moz-box-ordinal-group":m,"-ms-flex-order":m,"-webkit-order":m,order:m})}else va=Math.floor(D/g),ia=D-va*g;Y.css("margin-"+(a.isHorizontal()?"top":"left"),0!==va&&a.params.spaceBetween&&a.params.spaceBetween+"px").attr("data-swiper-column",ia).attr("data-swiper-row",va)}"none"!==Y.css("display")&&("auto"===a.params.slidesPerView?(U=a.isHorizontal()?Y.outerWidth(!0):Y.outerHeight(!0),a.params.roundLengths&&
(U=Math.floor(U))):(U=(a.size-(a.params.slidesPerView-1)*b)/a.params.slidesPerView,a.params.roundLengths&&(U=Math.floor(U)),a.isHorizontal()?a.slides[D].style.width=U+"px":a.slides[D].style.height=U+"px"),a.slides[D].swiperSlideSize=U,a.slidesSizesGrid.push(U),a.params.centeredSlides?(f=f+U/2+r/2+b,0===r&&0!==D&&(f=f-a.size/2-b),0===D&&(f=f-a.size/2-b),.001>Math.abs(f)&&(f=0),0===X%a.params.slidesPerGroup&&a.snapGrid.push(f),a.slidesGrid.push(f)):(0===X%a.params.slidesPerGroup&&a.snapGrid.push(f),
a.slidesGrid.push(f),f=f+U+b),a.virtualSize+=U+b,r=U,X++)}a.virtualSize=Math.max(a.virtualSize,a.size)+a.params.slidesOffsetAfter;a.rtl&&a.wrongRTL&&("slide"===a.params.effect||"coverflow"===a.params.effect)&&a.wrapper.css({width:a.virtualSize+a.params.spaceBetween+"px"});if(!a.support.flexbox||a.params.setWrapperSize)a.isHorizontal()?a.wrapper.css({width:a.virtualSize+a.params.spaceBetween+"px"}):a.wrapper.css({height:a.virtualSize+a.params.spaceBetween+"px"});if(1<a.params.slidesPerColumn&&(a.virtualSize=
(U+a.params.spaceBetween)*ba,a.virtualSize=Math.ceil(a.virtualSize/a.params.slidesPerColumn)-a.params.spaceBetween,a.isHorizontal()?a.wrapper.css({width:a.virtualSize+a.params.spaceBetween+"px"}):a.wrapper.css({height:a.virtualSize+a.params.spaceBetween+"px"}),a.params.centeredSlides)){f=[];for(D=0;D<a.snapGrid.length;D++)a.snapGrid[D]<a.virtualSize+a.snapGrid[0]&&f.push(a.snapGrid[D]);a.snapGrid=f}if(!a.params.centeredSlides){f=[];for(D=0;D<a.snapGrid.length;D++)a.snapGrid[D]<=a.virtualSize-a.size&&
f.push(a.snapGrid[D]);a.snapGrid=f;1<Math.floor(a.virtualSize-a.size)-Math.floor(a.snapGrid[a.snapGrid.length-1])&&a.snapGrid.push(a.virtualSize-a.size)}0===a.snapGrid.length&&(a.snapGrid=[0]);0!==a.params.spaceBetween&&(a.isHorizontal()?a.rtl?a.slides.css({marginLeft:b+"px"}):a.slides.css({marginRight:b+"px"}):a.slides.css({marginBottom:b+"px"}));a.params.watchSlidesProgress&&a.updateSlidesOffset()}};a.updateSlidesOffset=function(){for(var b=0;b<a.slides.length;b++)a.slides[b].swiperSlideOffset=
a.isHorizontal()?a.slides[b].offsetLeft:a.slides[b].offsetTop};a.currentSlidesPerView=function(){var b=1,f;if(a.params.centeredSlides){var D=a.slides[a.activeIndex].swiperSlideSize,r;for(f=a.activeIndex+1;f<a.slides.length;f++)a.slides[f]&&!r&&(D+=a.slides[f].swiperSlideSize,b++,D>a.size&&(r=!0));for(f=a.activeIndex-1;0<=f;f--)a.slides[f]&&!r&&(D+=a.slides[f].swiperSlideSize,b++,D>a.size&&(r=!0))}else for(f=a.activeIndex+1;f<a.slides.length;f++)a.slidesGrid[f]-a.slidesGrid[a.activeIndex]<a.size&&
b++;return b};a.updateSlidesProgress=function(b){"undefined"===typeof b&&(b=a.translate||0);if(0!==a.slides.length){"undefined"===typeof a.slides[0].swiperSlideOffset&&a.updateSlidesOffset();var f=-b;a.rtl&&(f=b);a.slides.removeClass(a.params.slideVisibleClass);for(b=0;b<a.slides.length;b++){var D=a.slides[b],r=(f+(a.params.centeredSlides?a.minTranslate():0)-D.swiperSlideOffset)/(D.swiperSlideSize+a.params.spaceBetween);if(a.params.watchSlidesVisibility){var X=-(f-D.swiperSlideOffset),ba=X+a.slidesSizesGrid[b];
(0<=X&&X<a.size||0<ba&&ba<=a.size||0>=X&&ba>=a.size)&&a.slides.eq(b).addClass(a.params.slideVisibleClass)}D.progress=a.rtl?-r:r}}};a.updateProgress=function(b){"undefined"===typeof b&&(b=a.translate||0);var f=a.maxTranslate()-a.minTranslate(),D=a.isBeginning,r=a.isEnd;0===f?(a.progress=0,a.isBeginning=a.isEnd=!0):(a.progress=(b-a.minTranslate())/f,a.isBeginning=0>=a.progress,a.isEnd=1<=a.progress);a.isBeginning&&!D&&a.emit("onReachBeginning",a);a.isEnd&&!r&&a.emit("onReachEnd",a);a.params.watchSlidesProgress&&
a.updateSlidesProgress(b);a.emit("onProgress",a,a.progress)};a.updateActiveIndex=function(){var b=a.rtl?a.translate:-a.translate,f,D;for(D=0;D<a.slidesGrid.length;D++)"undefined"!==typeof a.slidesGrid[D+1]?b>=a.slidesGrid[D]&&b<a.slidesGrid[D+1]-(a.slidesGrid[D+1]-a.slidesGrid[D])/2?f=D:b>=a.slidesGrid[D]&&b<a.slidesGrid[D+1]&&(f=D+1):b>=a.slidesGrid[D]&&(f=D);a.params.normalizeSlideIndex&&(0>f||"undefined"===typeof f)&&(f=0);b=Math.floor(f/a.params.slidesPerGroup);b>=a.snapGrid.length&&(b=a.snapGrid.length-
1);f!==a.activeIndex&&(a.snapIndex=b,a.previousIndex=a.activeIndex,a.activeIndex=f,a.updateClasses(),a.updateRealIndex())};a.updateRealIndex=function(){a.realIndex=parseInt(a.slides.eq(a.activeIndex).attr("data-swiper-slide-index")||a.activeIndex,10)};a.updateClasses=function(){a.slides.removeClass(a.params.slideActiveClass+" "+a.params.slideNextClass+" "+a.params.slidePrevClass+" "+a.params.slideDuplicateActiveClass+" "+a.params.slideDuplicateNextClass+" "+a.params.slideDuplicatePrevClass);var b=
a.slides.eq(a.activeIndex);b.addClass(a.params.slideActiveClass);x.loop&&(b.hasClass(a.params.slideDuplicateClass)?a.wrapper.children("."+a.params.slideClass+":not(."+a.params.slideDuplicateClass+')[data-swiper-slide-index\x3d"'+a.realIndex+'"]').addClass(a.params.slideDuplicateActiveClass):a.wrapper.children("."+a.params.slideClass+"."+a.params.slideDuplicateClass+'[data-swiper-slide-index\x3d"'+a.realIndex+'"]').addClass(a.params.slideDuplicateActiveClass));var f=b.next("."+a.params.slideClass).addClass(a.params.slideNextClass);
a.params.loop&&0===f.length&&(f=a.slides.eq(0),f.addClass(a.params.slideNextClass));b=b.prev("."+a.params.slideClass).addClass(a.params.slidePrevClass);a.params.loop&&0===b.length&&(b=a.slides.eq(-1),b.addClass(a.params.slidePrevClass));x.loop&&(f.hasClass(a.params.slideDuplicateClass)?a.wrapper.children("."+a.params.slideClass+":not(."+a.params.slideDuplicateClass+')[data-swiper-slide-index\x3d"'+f.attr("data-swiper-slide-index")+'"]').addClass(a.params.slideDuplicateNextClass):a.wrapper.children("."+
a.params.slideClass+"."+a.params.slideDuplicateClass+'[data-swiper-slide-index\x3d"'+f.attr("data-swiper-slide-index")+'"]').addClass(a.params.slideDuplicateNextClass),b.hasClass(a.params.slideDuplicateClass)?a.wrapper.children("."+a.params.slideClass+":not(."+a.params.slideDuplicateClass+')[data-swiper-slide-index\x3d"'+b.attr("data-swiper-slide-index")+'"]').addClass(a.params.slideDuplicatePrevClass):a.wrapper.children("."+a.params.slideClass+"."+a.params.slideDuplicateClass+'[data-swiper-slide-index\x3d"'+
b.attr("data-swiper-slide-index")+'"]').addClass(a.params.slideDuplicatePrevClass));if(a.paginationContainer&&0<a.paginationContainer.length){f=a.params.loop?Math.ceil((a.slides.length-2*a.loopedSlides)/a.params.slidesPerGroup):a.snapGrid.length;if(a.params.loop){var D=Math.ceil((a.activeIndex-a.loopedSlides)/a.params.slidesPerGroup);D>a.slides.length-1-2*a.loopedSlides&&(D-=a.slides.length-2*a.loopedSlides);D>f-1&&(D-=f);0>D&&"bullets"!==a.params.paginationType&&(D=f+D)}else D="undefined"!==typeof a.snapIndex?
a.snapIndex:a.activeIndex||0;"bullets"===a.params.paginationType&&a.bullets&&0<a.bullets.length&&(a.bullets.removeClass(a.params.bulletActiveClass),1<a.paginationContainer.length?a.bullets.each(function(){W(this).index()===D&&W(this).addClass(a.params.bulletActiveClass)}):a.bullets.eq(D).addClass(a.params.bulletActiveClass));"fraction"===a.params.paginationType&&(a.paginationContainer.find("."+a.params.paginationCurrentClass).text(D+1),a.paginationContainer.find("."+a.params.paginationTotalClass).text(f));
if("progress"===a.params.paginationType){var r=b=(D+1)/f,X=1;a.isHorizontal()||(X=b,r=1);a.paginationContainer.find("."+a.params.paginationProgressbarClass).transform("translate3d(0,0,0) scaleX("+r+") scaleY("+X+")").transition(a.params.speed)}"custom"===a.params.paginationType&&a.params.paginationCustomRender&&(a.paginationContainer.html(a.params.paginationCustomRender(a,D+1,f)),a.emit("onPaginationRendered",a,a.paginationContainer[0]))}a.params.loop||(a.params.prevButton&&a.prevButton&&0<a.prevButton.length&&
(a.isBeginning?(a.prevButton.addClass(a.params.buttonDisabledClass),a.params.a11y&&a.a11y&&a.a11y.disable(a.prevButton)):(a.prevButton.removeClass(a.params.buttonDisabledClass),a.params.a11y&&a.a11y&&a.a11y.enable(a.prevButton))),a.params.nextButton&&a.nextButton&&0<a.nextButton.length&&(a.isEnd?(a.nextButton.addClass(a.params.buttonDisabledClass),a.params.a11y&&a.a11y&&a.a11y.disable(a.nextButton)):(a.nextButton.removeClass(a.params.buttonDisabledClass),a.params.a11y&&a.a11y&&a.a11y.enable(a.nextButton))))};
a.updatePagination=function(){if(a.params.pagination&&a.paginationContainer&&0<a.paginationContainer.length){var b="";if("bullets"===a.params.paginationType){for(var f=a.params.loop?Math.ceil((a.slides.length-2*a.loopedSlides)/a.params.slidesPerGroup):a.snapGrid.length,D=0;D<f;D++)b=a.params.paginationBulletRender?b+a.params.paginationBulletRender(a,D,a.params.bulletClass):b+("\x3c"+a.params.paginationElement+' class\x3d"'+a.params.bulletClass+'"\x3e\x3c/'+a.params.paginationElement+"\x3e");a.paginationContainer.html(b);
a.bullets=a.paginationContainer.find("."+a.params.bulletClass);a.params.paginationClickable&&a.params.a11y&&a.a11y&&a.a11y.initPagination()}"fraction"===a.params.paginationType&&(b=a.params.paginationFractionRender?a.params.paginationFractionRender(a,a.params.paginationCurrentClass,a.params.paginationTotalClass):'\x3cspan class\x3d"'+a.params.paginationCurrentClass+'"\x3e\x3c/span\x3e / \x3cspan class\x3d"'+a.params.paginationTotalClass+'"\x3e\x3c/span\x3e',a.paginationContainer.html(b));"progress"===
a.params.paginationType&&(b=a.params.paginationProgressRender?a.params.paginationProgressRender(a,a.params.paginationProgressbarClass):'\x3cspan class\x3d"'+a.params.paginationProgressbarClass+'"\x3e\x3c/span\x3e',a.paginationContainer.html(b));"custom"!==a.params.paginationType&&a.emit("onPaginationRendered",a,a.paginationContainer[0])}};a.update=function(b){function f(){D=Math.min(Math.max(a.translate,a.maxTranslate()),a.minTranslate());a.setWrapperTranslate(D);a.updateActiveIndex();a.updateClasses()}
if(a){a.updateContainerSize();a.updateSlidesSize();a.updateProgress();a.updatePagination();a.updateClasses();a.params.scrollbar&&a.scrollbar&&a.scrollbar.set();var D;b?(a.controller&&a.controller.spline&&(a.controller.spline=void 0),a.params.freeMode?(f(),a.params.autoHeight&&a.updateAutoHeight()):(b=("auto"===a.params.slidesPerView||1<a.params.slidesPerView)&&a.isEnd&&!a.params.centeredSlides?a.slideTo(a.slides.length-1,0,!1,!0):a.slideTo(a.activeIndex,0,!1,!0))||f()):a.params.autoHeight&&a.updateAutoHeight()}};
a.onResize=function(b){if(a.params.onBeforeResize)a.params.onBeforeResize(a);a.params.breakpoints&&a.setBreakpoint();var f=a.params.allowSwipeToPrev,D=a.params.allowSwipeToNext;a.params.allowSwipeToPrev=a.params.allowSwipeToNext=!0;a.updateContainerSize();a.updateSlidesSize();("auto"===a.params.slidesPerView||a.params.freeMode||b)&&a.updatePagination();a.params.scrollbar&&a.scrollbar&&a.scrollbar.set();a.controller&&a.controller.spline&&(a.controller.spline=void 0);b=!1;if(a.params.freeMode){var r=
Math.min(Math.max(a.translate,a.maxTranslate()),a.minTranslate());a.setWrapperTranslate(r);a.updateActiveIndex();a.updateClasses();a.params.autoHeight&&a.updateAutoHeight()}else a.updateClasses(),b=("auto"===a.params.slidesPerView||1<a.params.slidesPerView)&&a.isEnd&&!a.params.centeredSlides?a.slideTo(a.slides.length-1,0,!1,!0):a.slideTo(a.activeIndex,0,!1,!0);a.params.lazyLoading&&!b&&a.lazy&&a.lazy.load();a.params.allowSwipeToPrev=f;a.params.allowSwipeToNext=D;if(a.params.onAfterResize)a.params.onAfterResize(a)};
a.touchEventsDesktop={start:"mousedown",move:"mousemove",end:"mouseup"};window.navigator.pointerEnabled?a.touchEventsDesktop={start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled&&(a.touchEventsDesktop={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"});a.touchEvents={start:a.support.touch||!a.params.simulateTouch?"touchstart":a.touchEventsDesktop.start,move:a.support.touch||!a.params.simulateTouch?"touchmove":a.touchEventsDesktop.move,end:a.support.touch||
!a.params.simulateTouch?"touchend":a.touchEventsDesktop.end};(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&("container"===a.params.touchEventsTarget?a.container:a.wrapper).addClass("swiper-wp8-"+a.params.direction);a.initEvents=function(b){var f=b?"off":"on";b=b?"removeEventListener":"addEventListener";var D="container"===a.params.touchEventsTarget?a.container[0]:a.wrapper[0],r=a.support.touch?D:document,X=a.params.nested?!0:!1;if(a.browser.ie)D[b](a.touchEvents.start,a.onTouchStart,
!1),r[b](a.touchEvents.move,a.onTouchMove,X),r[b](a.touchEvents.end,a.onTouchEnd,!1);else if(a.support.touch&&(r="touchstart"===a.touchEvents.start&&a.support.passiveListener&&a.params.passiveListeners?{passive:!0,capture:!1}:!1,D[b](a.touchEvents.start,a.onTouchStart,r),D[b](a.touchEvents.move,a.onTouchMove,X),D[b](a.touchEvents.end,a.onTouchEnd,r)),x.simulateTouch&&!a.device.ios&&!a.device.android||x.simulateTouch&&!a.support.touch&&a.device.ios)D[b]("mousedown",a.onTouchStart,!1),document[b]("mousemove",
a.onTouchMove,X),document[b]("mouseup",a.onTouchEnd,!1);window[b]("resize",a.onResize);if(a.params.nextButton&&a.nextButton&&0<a.nextButton.length&&(a.nextButton[f]("click",a.onClickNext),a.params.a11y&&a.a11y))a.nextButton[f]("keydown",a.a11y.onEnterKey);if(a.params.prevButton&&a.prevButton&&0<a.prevButton.length&&(a.prevButton[f]("click",a.onClickPrev),a.params.a11y&&a.a11y))a.prevButton[f]("keydown",a.a11y.onEnterKey);if(a.params.pagination&&a.params.paginationClickable&&(a.paginationContainer[f]("click",
"."+a.params.bulletClass,a.onClickIndex),a.params.a11y&&a.a11y))a.paginationContainer[f]("keydown","."+a.params.bulletClass,a.a11y.onEnterKey);if(a.params.preventClicks||a.params.preventClicksPropagation)D[b]("click",a.preventClicks,!0)};a.attachEvents=function(){a.initEvents()};a.detachEvents=function(){a.initEvents(!0)};a.allowClick=!0;a.preventClicks=function(b){a.allowClick||(a.params.preventClicks&&b.preventDefault(),a.params.preventClicksPropagation&&a.animating&&(b.stopPropagation(),b.stopImmediatePropagation()))};
a.onClickNext=function(b){b.preventDefault();a.isEnd&&!a.params.loop||a.slideNext()};a.onClickPrev=function(b){b.preventDefault();a.isBeginning&&!a.params.loop||a.slidePrev()};a.onClickIndex=function(b){b.preventDefault();b=W(this).index()*a.params.slidesPerGroup;a.params.loop&&(b+=a.loopedSlides);a.slideTo(b)};a.updateClickedSlide=function(b){b=e(b,"."+a.params.slideClass);var f=!1;if(b)for(var D=0;D<a.slides.length;D++)a.slides[D]===b&&(f=!0);if(b&&f){if(a.clickedSlide=b,a.clickedIndex=W(b).index(),
a.params.slideToClickedSlide&&void 0!==a.clickedIndex&&a.clickedIndex!==a.activeIndex){var r=a.clickedIndex;f="auto"===a.params.slidesPerView?a.currentSlidesPerView():a.params.slidesPerView;a.params.loop?a.animating||(b=parseInt(W(a.clickedSlide).attr("data-swiper-slide-index"),10),a.params.centeredSlides?r<a.loopedSlides-f/2||r>a.slides.length-a.loopedSlides+f/2?(a.fixLoop(),r=a.wrapper.children("."+a.params.slideClass+'[data-swiper-slide-index\x3d"'+b+'"]:not(.'+a.params.slideDuplicateClass+")").eq(0).index(),
setTimeout(function(){a.slideTo(r)},0)):a.slideTo(r):r>a.slides.length-f?(a.fixLoop(),r=a.wrapper.children("."+a.params.slideClass+'[data-swiper-slide-index\x3d"'+b+'"]:not(.'+a.params.slideDuplicateClass+")").eq(0).index(),setTimeout(function(){a.slideTo(r)},0)):a.slideTo(r)):a.slideTo(r)}}else a.clickedSlide=void 0,a.clickedIndex=void 0};var da,la,ma,pa,N,oa,na,J,y=Date.now(),A,ea=[],ta;a.animating=!1;a.touches={startX:0,startY:0,currentX:0,currentY:0,diff:0};var qa,wa;a.onTouchStart=function(b){b.originalEvent&&
(b=b.originalEvent);if((qa="touchstart"===b.type)||!("which"in b)||3!==b.which)if(a.params.noSwiping&&e(b,"."+a.params.noSwipingClass))a.allowClick=!0;else if(!a.params.swipeHandler||e(b,a.params.swipeHandler)){var f=a.touches.currentX="touchstart"===b.type?b.targetTouches[0].pageX:b.pageX,D=a.touches.currentY="touchstart"===b.type?b.targetTouches[0].pageY:b.pageY;a.device.ios&&a.params.iOSEdgeSwipeDetection&&f<=a.params.iOSEdgeSwipeThreshold||(da=!0,la=!1,ma=!0,wa=N=void 0,a.touches.startX=f,a.touches.startY=
D,pa=Date.now(),a.allowClick=!0,a.updateContainerSize(),a.swipeDirection=void 0,0<a.params.threshold&&(J=!1),"touchstart"!==b.type&&(f=!0,W(b.target).is("input, select, textarea, button, video")&&(f=!1),document.activeElement&&W(document.activeElement).is("input, select, textarea, button, video")&&document.activeElement.blur(),f&&b.preventDefault()),a.emit("onTouchStart",a,b))}};a.onTouchMove=function(b){b.originalEvent&&(b=b.originalEvent);if(!qa||"mousemove"!==b.type)if(b.preventedByNestedSwiper)a.touches.startX=
"touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,a.touches.startY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY;else if(a.params.onlyExternal)a.allowClick=!1,da&&(a.touches.startX=a.touches.currentX="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,a.touches.startY=a.touches.currentY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY,pa=Date.now());else{if(qa&&a.params.touchReleaseOnEdges&&!a.params.loop)if(!a.isHorizontal()){if(a.touches.currentY<a.touches.startY&&a.translate<=
a.maxTranslate()||a.touches.currentY>a.touches.startY&&a.translate>=a.minTranslate())return}else if(a.touches.currentX<a.touches.startX&&a.translate<=a.maxTranslate()||a.touches.currentX>a.touches.startX&&a.translate>=a.minTranslate())return;if(qa&&document.activeElement&&b.target===document.activeElement&&W(b.target).is("input, select, textarea, button, video"))la=!0,a.allowClick=!1;else if(ma&&a.emit("onTouchMove",a,b),!(b.targetTouches&&1<b.targetTouches.length)){a.touches.currentX="touchmove"===
b.type?b.targetTouches[0].pageX:b.pageX;a.touches.currentY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY;if("undefined"===typeof N)if(a.isHorizontal()&&a.touches.currentY===a.touches.startY||!a.isHorizontal()&&a.touches.currentX===a.touches.startX)N=!1;else{var f=180*Math.atan2(Math.abs(a.touches.currentY-a.touches.startY),Math.abs(a.touches.currentX-a.touches.startX))/Math.PI;N=a.isHorizontal()?f>a.params.touchAngle:90-f>a.params.touchAngle}N&&a.emit("onTouchMoveOpposite",a,b);"undefined"!==
typeof wa||a.touches.currentX===a.touches.startX&&a.touches.currentY===a.touches.startY||(wa=!0);if(da)if(N)da=!1;else if(wa){a.allowClick=!1;a.emit("onSliderMove",a,b);b.preventDefault();a.params.touchMoveStopPropagation&&!a.params.nested&&b.stopPropagation();la||(x.loop&&a.fixLoop(),na=a.getWrapperTranslate(),a.setWrapperTransition(0),a.animating&&a.wrapper.trigger("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"),a.params.autoplay&&a.autoplaying&&(a.params.autoplayDisableOnInteraction?
a.stopAutoplay():a.pauseAutoplay()),ta=!1,!a.params.grabCursor||!0!==a.params.allowSwipeToNext&&!0!==a.params.allowSwipeToPrev||a.setGrabCursor(!0));la=!0;f=a.touches.diff=a.isHorizontal()?a.touches.currentX-a.touches.startX:a.touches.currentY-a.touches.startY;f*=a.params.touchRatio;a.rtl&&(f=-f);a.swipeDirection=0<f?"prev":"next";oa=f+na;var D=!0;0<f&&oa>a.minTranslate()?(D=!1,a.params.resistance&&(oa=a.minTranslate()-1+Math.pow(-a.minTranslate()+na+f,a.params.resistanceRatio))):0>f&&oa<a.maxTranslate()&&
(D=!1,a.params.resistance&&(oa=a.maxTranslate()+1-Math.pow(a.maxTranslate()-na-f,a.params.resistanceRatio)));D&&(b.preventedByNestedSwiper=!0);!a.params.allowSwipeToNext&&"next"===a.swipeDirection&&oa<na&&(oa=na);!a.params.allowSwipeToPrev&&"prev"===a.swipeDirection&&oa>na&&(oa=na);if(0<a.params.threshold)if(Math.abs(f)>a.params.threshold||J){if(!J){J=!0;a.touches.startX=a.touches.currentX;a.touches.startY=a.touches.currentY;oa=na;a.touches.diff=a.isHorizontal()?a.touches.currentX-a.touches.startX:
a.touches.currentY-a.touches.startY;return}}else{oa=na;return}a.params.followFinger&&((a.params.freeMode||a.params.watchSlidesProgress)&&a.updateActiveIndex(),a.params.freeMode&&(0===ea.length&&ea.push({position:a.touches[a.isHorizontal()?"startX":"startY"],time:pa}),ea.push({position:a.touches[a.isHorizontal()?"currentX":"currentY"],time:(new window.Date).getTime()})),a.updateProgress(oa),a.setWrapperTranslate(oa))}}}};a.onTouchEnd=function(b){b.originalEvent&&(b=b.originalEvent);ma&&a.emit("onTouchEnd",
a,b);ma=!1;if(da){a.params.grabCursor&&la&&da&&(!0===a.params.allowSwipeToNext||!0===a.params.allowSwipeToPrev)&&a.setGrabCursor(!1);var f=Date.now(),D=f-pa;a.allowClick&&(a.updateClickedSlide(b),a.emit("onTap",a,b),300>D&&300<f-y&&(A&&clearTimeout(A),A=setTimeout(function(){a&&(a.params.paginationHide&&0<a.paginationContainer.length&&!W(b.target).hasClass(a.params.bulletClass)&&a.paginationContainer.toggleClass(a.params.paginationHiddenClass),a.emit("onClick",a,b))},300)),300>D&&300>f-y&&(A&&clearTimeout(A),
a.emit("onDoubleTap",a,b)));y=Date.now();setTimeout(function(){a&&(a.allowClick=!0)},0);if(da&&la&&a.swipeDirection&&0!==a.touches.diff&&oa!==na)if(da=la=!1,f=a.params.followFinger?a.rtl?a.translate:-a.translate:-oa,a.params.freeMode)if(f<-a.minTranslate())a.slideTo(a.activeIndex);else if(f>-a.maxTranslate())a.slides.length<a.snapGrid.length?a.slideTo(a.snapGrid.length-1):a.slideTo(a.slides.length-1);else{if(a.params.freeModeMomentum){if(1<ea.length){f=ea.pop();var r=ea.pop(),X=f.time-r.time;a.velocity=
(f.position-r.position)/X;a.velocity/=2;Math.abs(a.velocity)<a.params.freeModeMinimumVelocity&&(a.velocity=0);if(150<X||300<(new window.Date).getTime()-f.time)a.velocity=0}else a.velocity=0;a.velocity*=a.params.freeModeMomentumVelocityRatio;ea.length=0;f=1E3*a.params.freeModeMomentumRatio;r=a.translate+a.velocity*f;a.rtl&&(r=-r);X=!1;var ba=20*Math.abs(a.velocity)*a.params.freeModeMomentumBounceRatio;if(r<a.maxTranslate())if(a.params.freeModeMomentumBounce){r+a.maxTranslate()<-ba&&(r=a.maxTranslate()-
ba);var ra=a.maxTranslate();ta=X=!0}else r=a.maxTranslate();else if(r>a.minTranslate())a.params.freeModeMomentumBounce?(r-a.minTranslate()>ba&&(r=a.minTranslate()+ba),ra=a.minTranslate(),ta=X=!0):r=a.minTranslate();else if(a.params.freeModeSticky){ba=0;for(ba=0;ba<a.snapGrid.length;ba+=1)if(a.snapGrid[ba]>-r){var g=ba;break}r=Math.abs(a.snapGrid[g]-r)<Math.abs(a.snapGrid[g-1]-r)||"next"===a.swipeDirection?a.snapGrid[g]:a.snapGrid[g-1];a.rtl||(r=-r)}if(0!==a.velocity)f=a.rtl?Math.abs((-r-a.translate)/
a.velocity):Math.abs((r-a.translate)/a.velocity);else if(a.params.freeModeSticky){a.slideReset();return}a.params.freeModeMomentumBounce&&X?(a.updateProgress(ra),a.setWrapperTransition(f),a.setWrapperTranslate(r),a.onTransitionStart(),a.animating=!0,a.wrapper.transitionEnd(function(){a&&ta&&(a.emit("onMomentumBounce",a),a.setWrapperTransition(a.params.speed),a.setWrapperTranslate(ra),a.wrapper.transitionEnd(function(){if(a)a.onTransitionEnd()}))})):a.velocity?(a.updateProgress(r),a.setWrapperTransition(f),
a.setWrapperTranslate(r),a.onTransitionStart(),a.animating||(a.animating=!0,a.wrapper.transitionEnd(function(){if(a)a.onTransitionEnd()}))):a.updateProgress(r);a.updateActiveIndex()}if(!a.params.freeModeMomentum||D>=a.params.longSwipesMs)a.updateProgress(),a.updateActiveIndex()}else{g=0;X=a.slidesSizesGrid[0];for(r=0;r<a.slidesGrid.length;r+=a.params.slidesPerGroup)"undefined"!==typeof a.slidesGrid[r+a.params.slidesPerGroup]?f>=a.slidesGrid[r]&&f<a.slidesGrid[r+a.params.slidesPerGroup]&&(g=r,X=a.slidesGrid[r+
a.params.slidesPerGroup]-a.slidesGrid[r]):f>=a.slidesGrid[r]&&(g=r,X=a.slidesGrid[a.slidesGrid.length-1]-a.slidesGrid[a.slidesGrid.length-2]);f=(f-a.slidesGrid[g])/X;D>a.params.longSwipesMs?a.params.longSwipes?("next"===a.swipeDirection&&(f>=a.params.longSwipesRatio?a.slideTo(g+a.params.slidesPerGroup):a.slideTo(g)),"prev"===a.swipeDirection&&(f>1-a.params.longSwipesRatio?a.slideTo(g+a.params.slidesPerGroup):a.slideTo(g))):a.slideTo(a.activeIndex):a.params.shortSwipes?("next"===a.swipeDirection&&
a.slideTo(g+a.params.slidesPerGroup),"prev"===a.swipeDirection&&a.slideTo(g)):a.slideTo(a.activeIndex)}else da=la=!1}};a._slideTo=function(b,f){return a.slideTo(b,f,!0,!0)};a.slideTo=function(b,f,D,r){"undefined"===typeof D&&(D=!0);"undefined"===typeof b&&(b=0);0>b&&(b=0);a.snapIndex=Math.floor(b/a.params.slidesPerGroup);a.snapIndex>=a.snapGrid.length&&(a.snapIndex=a.snapGrid.length-1);var X=-a.snapGrid[a.snapIndex];a.params.autoplay&&a.autoplaying&&(r||!a.params.autoplayDisableOnInteraction?a.pauseAutoplay(f):
a.stopAutoplay());a.updateProgress(X);if(a.params.normalizeSlideIndex)for(r=0;r<a.slidesGrid.length;r++)-Math.floor(100*X)>=Math.floor(100*a.slidesGrid[r])&&(b=r);if(!a.params.allowSwipeToNext&&X<a.translate&&X<a.minTranslate()||!a.params.allowSwipeToPrev&&X>a.translate&&X>a.maxTranslate()&&(a.activeIndex||0)!==b)return!1;"undefined"===typeof f&&(f=a.params.speed);a.previousIndex=a.activeIndex||0;a.activeIndex=b;a.updateRealIndex();if(a.rtl&&-X===a.translate||!a.rtl&&X===a.translate)return a.params.autoHeight&&
a.updateAutoHeight(),a.updateClasses(),"slide"!==a.params.effect&&a.setWrapperTranslate(X),!1;a.updateClasses();a.onTransitionStart(D);0===f||a.browser.lteIE9?(a.setWrapperTranslate(X),a.setWrapperTransition(0),a.onTransitionEnd(D)):(a.setWrapperTranslate(X),a.setWrapperTransition(f),a.animating||(a.animating=!0,a.wrapper.transitionEnd(function(){if(a)a.onTransitionEnd(D)})));return!0};a.onTransitionStart=function(b){"undefined"===typeof b&&(b=!0);a.params.autoHeight&&a.updateAutoHeight();if(a.lazy)a.lazy.onTransitionStart();
b&&(a.emit("onTransitionStart",a),a.activeIndex!==a.previousIndex&&(a.emit("onSlideChangeStart",a),a.activeIndex>a.previousIndex?a.emit("onSlideNextStart",a):a.emit("onSlidePrevStart",a)))};a.onTransitionEnd=function(b){a.animating=!1;a.setWrapperTransition(0);"undefined"===typeof b&&(b=!0);if(a.lazy)a.lazy.onTransitionEnd();b&&(a.emit("onTransitionEnd",a),a.activeIndex!==a.previousIndex&&(a.emit("onSlideChangeEnd",a),a.activeIndex>a.previousIndex?a.emit("onSlideNextEnd",a):a.emit("onSlidePrevEnd",
a)));a.params.history&&a.history&&a.history.setHistory(a.params.history,a.activeIndex);a.params.hashnav&&a.hashnav&&a.hashnav.setHash()};a.slideNext=function(b,f,D){if(a.params.loop){if(a.animating)return!1;a.fixLoop()}return a.slideTo(a.activeIndex+a.params.slidesPerGroup,f,b,D)};a._slideNext=function(b){return a.slideNext(!0,b,!0)};a.slidePrev=function(b,f,D){if(a.params.loop){if(a.animating)return!1;a.fixLoop()}return a.slideTo(a.activeIndex-1,f,b,D)};a._slidePrev=function(b){return a.slidePrev(!0,
b,!0)};a.slideReset=function(b,f,D){return a.slideTo(a.activeIndex,f,b)};a.disableTouchControl=function(){return a.params.onlyExternal=!0};a.enableTouchControl=function(){a.params.onlyExternal=!1;return!0};a.setWrapperTransition=function(b,f){a.wrapper.transition(b);"slide"!==a.params.effect&&a.effects[a.params.effect]&&a.effects[a.params.effect].setTransition(b);a.params.parallax&&a.parallax&&a.parallax.setTransition(b);a.params.scrollbar&&a.scrollbar&&a.scrollbar.setTransition(b);a.params.control&&
a.controller&&a.controller.setTransition(b,f);a.emit("onSetTransition",a,b)};a.setWrapperTranslate=function(b,f,D){var r=0,X=0;a.isHorizontal()?r=a.rtl?-b:b:X=b;a.params.roundLengths&&(r=Math.floor(r),X=Math.floor(X));a.params.virtualTranslate||(a.support.transforms3d?a.wrapper.transform("translate3d("+r+"px, "+X+"px, 0px)"):a.wrapper.transform("translate("+r+"px, "+X+"px)"));a.translate=a.isHorizontal()?r:X;r=a.maxTranslate()-a.minTranslate();(0===r?0:(b-a.minTranslate())/r)!==a.progress&&a.updateProgress(b);
f&&a.updateActiveIndex();"slide"!==a.params.effect&&a.effects[a.params.effect]&&a.effects[a.params.effect].setTranslate(a.translate);a.params.parallax&&a.parallax&&a.parallax.setTranslate(a.translate);a.params.scrollbar&&a.scrollbar&&a.scrollbar.setTranslate(a.translate);a.params.control&&a.controller&&a.controller.setTranslate(a.translate,D);a.emit("onSetTranslate",a,a.translate)};a.getTranslate=function(b,f){"undefined"===typeof f&&(f="x");if(a.params.virtualTranslate)return a.rtl?-a.translate:
a.translate;b=window.getComputedStyle(b,null);if(window.WebKitCSSMatrix){var D=b.transform||b.webkitTransform;6<D.split(",").length&&(D=D.split(", ").map(function(X){return X.replace(",",".")}).join(", "));b=new window.WebKitCSSMatrix("none"===D?"":D)}else{b=b.MozTransform||b.OTransform||b.MsTransform||b.msTransform||b.transform||b.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,");var r=b.toString().split(",")}"x"===f&&(D=window.WebKitCSSMatrix?b.m41:16===r.length?parseFloat(r[12]):
parseFloat(r[4]));"y"===f&&(D=window.WebKitCSSMatrix?b.m42:16===r.length?parseFloat(r[13]):parseFloat(r[5]));a.rtl&&D&&(D=-D);return D||0};a.getWrapperTranslate=function(b){"undefined"===typeof b&&(b=a.isHorizontal()?"x":"y");return a.getTranslate(a.wrapper[0],b)};a.observers=[];a.initObservers=function(){if(a.params.observeParents)for(var b=a.container.parents(),f=0;f<b.length;f++)l(b[f]);l(a.container[0],{childList:!1});l(a.wrapper[0],{attributes:!1})};a.disconnectObservers=function(){for(var b=
0;b<a.observers.length;b++)a.observers[b].disconnect();a.observers=[]};a.createLoop=function(){a.wrapper.children("."+a.params.slideClass+"."+a.params.slideDuplicateClass).remove();var b=a.wrapper.children("."+a.params.slideClass);"auto"!==a.params.slidesPerView||a.params.loopedSlides||(a.params.loopedSlides=b.length);a.loopedSlides=parseInt(a.params.loopedSlides||a.params.slidesPerView,10);a.loopedSlides+=a.params.loopAdditionalSlides;a.loopedSlides>b.length&&(a.loopedSlides=b.length);var f=[],D=
[],r;b.each(function(X,ba){var ra=W(this);X<a.loopedSlides&&D.push(ba);X<b.length&&X>=b.length-a.loopedSlides&&f.push(ba);ra.attr("data-swiper-slide-index",X)});for(r=0;r<D.length;r++)a.wrapper.append(W(D[r].cloneNode(!0)).addClass(a.params.slideDuplicateClass));for(r=f.length-1;0<=r;r--)a.wrapper.prepend(W(f[r].cloneNode(!0)).addClass(a.params.slideDuplicateClass))};a.destroyLoop=function(){a.wrapper.children("."+a.params.slideClass+"."+a.params.slideDuplicateClass).remove();a.slides.removeAttr("data-swiper-slide-index")};
a.reLoop=function(b){var f=a.activeIndex-a.loopedSlides;a.destroyLoop();a.createLoop();a.updateSlidesSize();b&&a.slideTo(f+a.loopedSlides,0,!1)};a.fixLoop=function(){if(a.activeIndex<a.loopedSlides){var b=a.slides.length-3*a.loopedSlides+a.activeIndex;b+=a.loopedSlides;a.slideTo(b,0,!1,!0)}else if("auto"===a.params.slidesPerView&&a.activeIndex>=2*a.loopedSlides||a.activeIndex>a.slides.length-2*a.params.slidesPerView)b=-a.slides.length+a.activeIndex+a.loopedSlides,b+=a.loopedSlides,a.slideTo(b,0,!1,
!0)};a.appendSlide=function(b){a.params.loop&&a.destroyLoop();if("object"===typeof b&&b.length)for(var f=0;f<b.length;f++)b[f]&&a.wrapper.append(b[f]);else a.wrapper.append(b);a.params.loop&&a.createLoop();a.params.observer&&a.support.observer||a.update(!0)};a.prependSlide=function(b){a.params.loop&&a.destroyLoop();var f=a.activeIndex+1;if("object"===typeof b&&b.length){for(f=0;f<b.length;f++)b[f]&&a.wrapper.prepend(b[f]);f=a.activeIndex+b.length}else a.wrapper.prepend(b);a.params.loop&&a.createLoop();
a.params.observer&&a.support.observer||a.update(!0);a.slideTo(f,0,!1)};a.removeSlide=function(b){a.params.loop&&(a.destroyLoop(),a.slides=a.wrapper.children("."+a.params.slideClass));var f=a.activeIndex;if("object"===typeof b&&b.length)for(var D=0;D<b.length;D++){var r=b[D];a.slides[r]&&a.slides.eq(r).remove();r<f&&f--}else r=b,a.slides[r]&&a.slides.eq(r).remove(),r<f&&f--;f=Math.max(f,0);a.params.loop&&a.createLoop();a.params.observer&&a.support.observer||a.update(!0);a.params.loop?a.slideTo(f+a.loopedSlides,
0,!1):a.slideTo(f,0,!1)};a.removeAllSlides=function(){for(var b=[],f=0;f<a.slides.length;f++)b.push(f);a.removeSlide(b)};a.effects={fade:{setTranslate:function(){for(var b=0;b<a.slides.length;b++){var f=a.slides.eq(b),D=-f[0].swiperSlideOffset;a.params.virtualTranslate||(D-=a.translate);var r=0;a.isHorizontal()||(r=D,D=0);f.css({opacity:a.params.fade.crossFade?Math.max(1-Math.abs(f[0].progress),0):1+Math.min(Math.max(f[0].progress,-1),0)}).transform("translate3d("+D+"px, "+r+"px, 0px)")}},setTransition:function(b){a.slides.transition(b);
if(a.params.virtualTranslate&&0!==b){var f=!1;a.slides.transitionEnd(function(){if(!f&&a){f=!0;a.animating=!1;for(var D=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],r=0;r<D.length;r++)a.wrapper.trigger(D[r])}})}}},flip:{setTranslate:function(){for(var b=0;b<a.slides.length;b++){var f=a.slides.eq(b),D=f[0].progress;a.params.flip.limitRotation&&(D=Math.max(Math.min(f[0].progress,1),-1));var r=-180*D,X=0,ba=-f[0].swiperSlideOffset,ra=0;a.isHorizontal()?
a.rtl&&(r=-r):(ra=ba,ba=0,X=-r,r=0);f[0].style.zIndex=-Math.abs(Math.round(D))+a.slides.length;if(a.params.flip.slideShadows){var g=a.isHorizontal()?f.find(".swiper-slide-shadow-left"):f.find(".swiper-slide-shadow-top"),K=a.isHorizontal()?f.find(".swiper-slide-shadow-right"):f.find(".swiper-slide-shadow-bottom");0===g.length&&(g=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?"left":"top")+'"\x3e\x3c/div\x3e'),f.append(g));0===K.length&&(K=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?
"right":"bottom")+'"\x3e\x3c/div\x3e'),f.append(K));g.length&&(g[0].style.opacity=Math.max(-D,0));K.length&&(K[0].style.opacity=Math.max(D,0))}f.transform("translate3d("+ba+"px, "+ra+"px, 0px) rotateX("+X+"deg) rotateY("+r+"deg)")}},setTransition:function(b){a.slides.transition(b).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(b);if(a.params.virtualTranslate&&0!==b){var f=!1;a.slides.eq(a.activeIndex).transitionEnd(function(){if(!f&&
a&&W(this).hasClass(a.params.slideActiveClass)){f=!0;a.animating=!1;for(var D=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],r=0;r<D.length;r++)a.wrapper.trigger(D[r])}})}}},cube:{setTranslate:function(){var b=0;if(a.params.cube.shadow)if(a.isHorizontal()){var f=a.wrapper.find(".swiper-cube-shadow");0===f.length&&(f=W('\x3cdiv class\x3d"swiper-cube-shadow"\x3e\x3c/div\x3e'),a.wrapper.append(f));f.css({height:a.width+"px"})}else f=a.container.find(".swiper-cube-shadow"),
0===f.length&&(f=W('\x3cdiv class\x3d"swiper-cube-shadow"\x3e\x3c/div\x3e'),a.container.append(f));for(var D=0;D<a.slides.length;D++){var r=a.slides.eq(D),X=90*D,ba=Math.floor(X/360);a.rtl&&(X=-X,ba=Math.floor(-X/360));var ra=Math.max(Math.min(r[0].progress,1),-1),g=0,K=0,U=0;0===D%4?(g=4*-ba*a.size,U=0):0===(D-1)%4?(g=0,U=4*-ba*a.size):0===(D-2)%4?(g=a.size+4*ba*a.size,U=a.size):0===(D-3)%4&&(g=-a.size,U=3*a.size+4*a.size*ba);a.rtl&&(g=-g);a.isHorizontal()||(K=g,g=0);X="rotateX("+(a.isHorizontal()?
0:-X)+"deg) rotateY("+(a.isHorizontal()?X:0)+"deg) translate3d("+g+"px, "+K+"px, "+U+"px)";1>=ra&&-1<ra&&(b=90*D+90*ra,a.rtl&&(b=90*-D-90*ra));r.transform(X);a.params.cube.slideShadows&&(X=a.isHorizontal()?r.find(".swiper-slide-shadow-left"):r.find(".swiper-slide-shadow-top"),ba=a.isHorizontal()?r.find(".swiper-slide-shadow-right"):r.find(".swiper-slide-shadow-bottom"),0===X.length&&(X=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?"left":"top")+'"\x3e\x3c/div\x3e'),r.append(X)),0===
ba.length&&(ba=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?"right":"bottom")+'"\x3e\x3c/div\x3e'),r.append(ba)),X.length&&(X[0].style.opacity=Math.max(-ra,0)),ba.length&&(ba[0].style.opacity=Math.max(ra,0)))}a.wrapper.css({"-webkit-transform-origin":"50% 50% -"+a.size/2+"px","-moz-transform-origin":"50% 50% -"+a.size/2+"px","-ms-transform-origin":"50% 50% -"+a.size/2+"px","transform-origin":"50% 50% -"+a.size/2+"px"});a.params.cube.shadow&&(a.isHorizontal()?f.transform("translate3d(0px, "+
(a.width/2+a.params.cube.shadowOffset)+"px, "+-a.width/2+"px) rotateX(90deg) rotateZ(0deg) scale("+a.params.cube.shadowScale+")"):(D=Math.abs(b)-90*Math.floor(Math.abs(b)/90),D=a.params.cube.shadowScale/(1.5-(Math.sin(2*D*Math.PI/360)/2+Math.cos(2*D*Math.PI/360)/2)),f.transform("scale3d("+a.params.cube.shadowScale+", 1, "+D+") translate3d(0px, "+(a.height/2+a.params.cube.shadowOffset)+"px, "+-a.height/2/D+"px) rotateX(-90deg)")));a.wrapper.transform("translate3d(0px,0,"+(a.isSafari||a.isUiWebView?
-a.size/2:0)+"px) rotateX("+(a.isHorizontal()?0:b)+"deg) rotateY("+(a.isHorizontal()?-b:0)+"deg)")},setTransition:function(b){a.slides.transition(b).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(b);a.params.cube.shadow&&!a.isHorizontal()&&a.container.find(".swiper-cube-shadow").transition(b)}},coverflow:{setTranslate:function(){var b=a.translate;b=a.isHorizontal()?-b+a.width/2:-b+a.height/2;for(var f=a.isHorizontal()?
a.params.coverflow.rotate:-a.params.coverflow.rotate,D=a.params.coverflow.depth,r=0,X=a.slides.length;r<X;r++){var ba=a.slides.eq(r),ra=a.slidesSizesGrid[r];ra=(b-ba[0].swiperSlideOffset-ra/2)/ra*a.params.coverflow.modifier;var g=a.isHorizontal()?f*ra:0,K=a.isHorizontal()?0:f*ra,U=-D*Math.abs(ra),Y=a.isHorizontal()?0:a.params.coverflow.stretch*ra,ia=a.isHorizontal()?a.params.coverflow.stretch*ra:0;.001>Math.abs(ia)&&(ia=0);.001>Math.abs(Y)&&(Y=0);.001>Math.abs(U)&&(U=0);.001>Math.abs(g)&&(g=0);.001>
Math.abs(K)&&(K=0);ba.transform("translate3d("+ia+"px,"+Y+"px,"+U+"px)  rotateX("+K+"deg) rotateY("+g+"deg)");ba[0].style.zIndex=-Math.abs(Math.round(ra))+1;a.params.coverflow.slideShadows&&(g=a.isHorizontal()?ba.find(".swiper-slide-shadow-left"):ba.find(".swiper-slide-shadow-top"),K=a.isHorizontal()?ba.find(".swiper-slide-shadow-right"):ba.find(".swiper-slide-shadow-bottom"),0===g.length&&(g=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?"left":"top")+'"\x3e\x3c/div\x3e'),ba.append(g)),
0===K.length&&(K=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?"right":"bottom")+'"\x3e\x3c/div\x3e'),ba.append(K)),g.length&&(g[0].style.opacity=0<ra?ra:0),K.length&&(K[0].style.opacity=0<-ra?-ra:0))}a.browser.ie&&(a.wrapper[0].style.perspectiveOrigin=b+"px 50%")},setTransition:function(b){a.slides.transition(b).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(b)}}};a.lazy={initialImageLoaded:!1,loadImageInSlide:function(b,
f){if("undefined"!==typeof b&&("undefined"===typeof f&&(f=!0),0!==a.slides.length)){var D=a.slides.eq(b);b=D.find("."+a.params.lazyLoadingClass+":not(."+a.params.lazyStatusLoadedClass+"):not(."+a.params.lazyStatusLoadingClass+")");!D.hasClass(a.params.lazyLoadingClass)||D.hasClass(a.params.lazyStatusLoadedClass)||D.hasClass(a.params.lazyStatusLoadingClass)||(b=b.add(D[0]));0!==b.length&&b.each(function(){var r=W(this);r.addClass(a.params.lazyStatusLoadingClass);var X=r.attr("data-background"),ba=
r.attr("data-src"),ra=r.attr("data-srcset"),g=r.attr("data-sizes");a.loadImage(r[0],ba||X,ra,g,!1,function(){if("undefined"!==typeof a&&null!==a&&a){X?(r.css("background-image",'url("'+X+'")'),r.removeAttr("data-background")):(ra&&(r.attr("srcset",ra),r.removeAttr("data-srcset")),g&&(r.attr("sizes",g),r.removeAttr("data-sizes")),ba&&(r.attr("src",ba),r.removeAttr("data-src")));r.addClass(a.params.lazyStatusLoadedClass).removeClass(a.params.lazyStatusLoadingClass);D.find("."+a.params.lazyPreloaderClass+
", ."+a.params.preloaderClass).remove();if(a.params.loop&&f){var K=D.attr("data-swiper-slide-index");D.hasClass(a.params.slideDuplicateClass)?(K=a.wrapper.children('[data-swiper-slide-index\x3d"'+K+'"]:not(.'+a.params.slideDuplicateClass+")"),a.lazy.loadImageInSlide(K.index(),!1)):(K=a.wrapper.children("."+a.params.slideDuplicateClass+'[data-swiper-slide-index\x3d"'+K+'"]'),a.lazy.loadImageInSlide(K.index(),!1))}a.emit("onLazyImageReady",a,D[0],r[0])}});a.emit("onLazyImageLoad",a,D[0],r[0])})}},load:function(){var b,
f=a.params.slidesPerView;"auto"===f&&(f=0);a.lazy.initialImageLoaded||(a.lazy.initialImageLoaded=!0);if(a.params.watchSlidesVisibility)a.wrapper.children("."+a.params.slideVisibleClass).each(function(){a.lazy.loadImageInSlide(W(this).index())});else if(1<f)for(b=a.activeIndex;b<a.activeIndex+f;b++)a.slides[b]&&a.lazy.loadImageInSlide(b);else a.lazy.loadImageInSlide(a.activeIndex);if(a.params.lazyLoadingInPrevNext)if(1<f||a.params.lazyLoadingInPrevNextAmount&&1<a.params.lazyLoadingInPrevNextAmount){b=
a.params.lazyLoadingInPrevNextAmount;var D=f,r=Math.min(a.activeIndex+D+Math.max(b,D),a.slides.length);D=Math.max(a.activeIndex-Math.max(D,b),0);for(b=a.activeIndex+f;b<r;b++)a.slides[b]&&a.lazy.loadImageInSlide(b);for(b=D;b<a.activeIndex;b++)a.slides[b]&&a.lazy.loadImageInSlide(b)}else f=a.wrapper.children("."+a.params.slideNextClass),0<f.length&&a.lazy.loadImageInSlide(f.index()),f=a.wrapper.children("."+a.params.slidePrevClass),0<f.length&&a.lazy.loadImageInSlide(f.index())},onTransitionStart:function(){a.params.lazyLoading&&
(a.params.lazyLoadingOnTransitionStart||!a.params.lazyLoadingOnTransitionStart&&!a.lazy.initialImageLoaded)&&a.lazy.load()},onTransitionEnd:function(){a.params.lazyLoading&&!a.params.lazyLoadingOnTransitionStart&&a.lazy.load()}};F=!1!==a.params.simulateTouch||a.support.touch?a.touchEvents:a.touchEventsDesktop;a.scrollbar={isTouched:!1,setDragPosition:function(b){var f=a.scrollbar;b=(a.isHorizontal()?"touchstart"===b.type||"touchmove"===b.type?b.targetTouches[0].pageX:b.pageX||b.clientX:"touchstart"===
b.type||"touchmove"===b.type?b.targetTouches[0].pageY:b.pageY||b.clientY)-f.track.offset()[a.isHorizontal()?"left":"top"]-f.dragSize/2;var D=-a.minTranslate()*f.moveDivider,r=-a.maxTranslate()*f.moveDivider;b<D?b=D:b>r&&(b=r);b=-b/f.moveDivider;a.updateProgress(b);a.setWrapperTranslate(b,!0)},dragStart:function(b){var f=a.scrollbar;f.isTouched=!0;b.preventDefault();b.stopPropagation();f.setDragPosition(b);clearTimeout(f.dragTimeout);f.track.transition(0);a.params.scrollbarHide&&f.track.css("opacity",
1);a.wrapper.transition(100);f.drag.transition(100);a.emit("onScrollbarDragStart",a)},dragMove:function(b){var f=a.scrollbar;f.isTouched&&(b.preventDefault?b.preventDefault():b.returnValue=!1,f.setDragPosition(b),a.wrapper.transition(0),f.track.transition(0),f.drag.transition(0),a.emit("onScrollbarDragMove",a))},dragEnd:function(b){var f=a.scrollbar;f.isTouched&&(f.isTouched=!1,a.params.scrollbarHide&&(clearTimeout(f.dragTimeout),f.dragTimeout=setTimeout(function(){f.track.css("opacity",0);f.track.transition(400)},
1E3)),a.emit("onScrollbarDragEnd",a),a.params.scrollbarSnapOnRelease&&a.slideReset())},draggableEvents:F,enableDraggable:function(){var b=a.scrollbar,f=a.support.touch?b.track:document;W(b.track).on(b.draggableEvents.start,b.dragStart);W(f).on(b.draggableEvents.move,b.dragMove);W(f).on(b.draggableEvents.end,b.dragEnd)},disableDraggable:function(){var b=a.scrollbar,f=a.support.touch?b.track:document;W(b.track).off(b.draggableEvents.start,b.dragStart);W(f).off(b.draggableEvents.move,b.dragMove);W(f).off(b.draggableEvents.end,
b.dragEnd)},set:function(){if(a.params.scrollbar){var b=a.scrollbar;b.track=W(a.params.scrollbar);a.params.uniqueNavElements&&"string"===typeof a.params.scrollbar&&1<b.track.length&&1===a.container.find(a.params.scrollbar).length&&(b.track=a.container.find(a.params.scrollbar));b.drag=b.track.find(".swiper-scrollbar-drag");0===b.drag.length&&(b.drag=W('\x3cdiv class\x3d"swiper-scrollbar-drag"\x3e\x3c/div\x3e'),b.track.append(b.drag));b.drag[0].style.width="";b.drag[0].style.height="";b.trackSize=a.isHorizontal()?
b.track[0].offsetWidth:b.track[0].offsetHeight;b.divider=a.size/a.virtualSize;b.moveDivider=b.trackSize/a.size*b.divider;b.dragSize=b.trackSize*b.divider;a.isHorizontal()?b.drag[0].style.width=b.dragSize+"px":b.drag[0].style.height=b.dragSize+"px";b.track[0].style.display=1<=b.divider?"none":"";a.params.scrollbarHide&&(b.track[0].style.opacity=0)}},setTranslate:function(){if(a.params.scrollbar){var b=a.scrollbar,f=b.dragSize;var D=(b.trackSize-b.dragSize)*a.progress;a.rtl&&a.isHorizontal()?(D=-D,
0<D?(f=b.dragSize-D,D=0):-D+b.dragSize>b.trackSize&&(f=b.trackSize+D)):0>D?(f=b.dragSize+D,D=0):D+b.dragSize>b.trackSize&&(f=b.trackSize-D);a.isHorizontal()?(a.support.transforms3d?b.drag.transform("translate3d("+D+"px, 0, 0)"):b.drag.transform("translateX("+D+"px)"),b.drag[0].style.width=f+"px"):(a.support.transforms3d?b.drag.transform("translate3d(0px, "+D+"px, 0)"):b.drag.transform("translateY("+D+"px)"),b.drag[0].style.height=f+"px");a.params.scrollbarHide&&(clearTimeout(b.timeout),b.track[0].style.opacity=
1,b.timeout=setTimeout(function(){b.track[0].style.opacity=0;b.track.transition(400)},1E3))}},setTransition:function(b){a.params.scrollbar&&a.scrollbar.drag.transition(b)}};a.controller={LinearSpline:function(b,f){var D=function(){var ba,ra,g;return function(K,U){ra=-1;for(ba=K.length;1<ba-ra;)K[g=ba+ra>>1]<=U?ra=g:ba=g;return ba}}();this.x=b;this.y=f;this.lastIndex=b.length-1;var r,X;this.interpolate=function(ba){if(!ba)return 0;X=D(this.x,ba);r=X-1;return(ba-this.x[r])*(this.y[X]-this.y[r])/(this.x[X]-
this.x[r])+this.y[r]}},getInterpolateFunction:function(b){a.controller.spline||(a.controller.spline=a.params.loop?new a.controller.LinearSpline(a.slidesGrid,b.slidesGrid):new a.controller.LinearSpline(a.snapGrid,b.snapGrid))},setTranslate:function(b,f){function D(g){b=g.rtl&&"horizontal"===g.params.direction?-a.translate:a.translate;"slide"===a.params.controlBy&&(a.controller.getInterpolateFunction(g),ba=-a.controller.spline.interpolate(-b));ba&&"container"!==a.params.controlBy||(X=(g.maxTranslate()-
g.minTranslate())/(a.maxTranslate()-a.minTranslate()),ba=(b-a.minTranslate())*X+g.minTranslate());a.params.controlInverse&&(ba=g.maxTranslate()-ba);g.updateProgress(ba);g.setWrapperTranslate(ba,!1,a);g.updateActiveIndex()}var r=a.params.control,X,ba;if(Array.isArray(r))for(var ra=0;ra<r.length;ra++)r[ra]!==f&&r[ra]instanceof t&&D(r[ra]);else r instanceof t&&f!==r&&D(r)},setTransition:function(b,f){function D(ba){ba.setWrapperTransition(b,a);0!==b&&(ba.onTransitionStart(),ba.wrapper.transitionEnd(function(){r&&
(ba.params.loop&&"slide"===a.params.controlBy&&ba.fixLoop(),ba.onTransitionEnd())}))}var r=a.params.control,X;if(Array.isArray(r))for(X=0;X<r.length;X++)r[X]!==f&&r[X]instanceof t&&D(r[X]);else r instanceof t&&f!==r&&D(r)}};a.hashnav={onHashCange:function(b,f){b=document.location.hash.replace("#","");f=a.slides.eq(a.activeIndex).attr("data-hash");b!==f&&a.slideTo(a.wrapper.children("."+a.params.slideClass+'[data-hash\x3d"'+b+'"]').index())},attachEvents:function(b){b=b?"off":"on";W(window)[b]("hashchange",
a.hashnav.onHashCange)},setHash:function(){if(a.hashnav.initialized&&a.params.hashnav)if(a.params.replaceState&&window.history&&window.history.replaceState)window.history.replaceState(null,null,"#"+a.slides.eq(a.activeIndex).attr("data-hash")||"");else{var b=a.slides.eq(a.activeIndex);b=b.attr("data-hash")||b.attr("data-history");document.location.hash=b||""}},init:function(){if(a.params.hashnav&&!a.params.history){a.hashnav.initialized=!0;var b=document.location.hash.replace("#","");if(b)for(var f=
0,D=a.slides.length;f<D;f++){var r=a.slides.eq(f);(r.attr("data-hash")||r.attr("data-history"))!==b||r.hasClass(a.params.slideDuplicateClass)||(r=r.index(),a.slideTo(r,0,a.params.runCallbacksOnInit,!0))}a.params.hashnavWatchState&&a.hashnav.attachEvents()}},destroy:function(){a.params.hashnavWatchState&&a.hashnav.attachEvents(!0)}};a.history={init:function(){if(a.params.history)if(window.history&&window.history.pushState){if(a.history.initialized=!0,this.paths=this.getPathValues(),this.paths.key||
this.paths.value)this.scrollToSlide(0,this.paths.value,a.params.runCallbacksOnInit),a.params.replaceState||window.addEventListener("popstate",this.setHistoryPopState)}else a.params.history=!1,a.params.hashnav=!0},setHistoryPopState:function(){a.history.paths=a.history.getPathValues();a.history.scrollToSlide(a.params.speed,a.history.paths.value,!1)},getPathValues:function(){var b=window.location.pathname.slice(1).split("/"),f=b.length;return{key:b[f-2],value:b[f-1]}},setHistory:function(b,f){a.history.initialized&&
a.params.history&&(f=a.slides.eq(f),f=this.slugify(f.attr("data-history")),window.location.pathname.includes(b)||(f=b+"/"+f),a.params.replaceState?window.history.replaceState(null,null,f):window.history.pushState(null,null,f))},slugify:function(b){return b.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},scrollToSlide:function(b,f,D){if(f)for(var r=0,X=a.slides.length;r<X;r++){var ba=a.slides.eq(r);this.slugify(ba.attr("data-history"))!==
f||ba.hasClass(a.params.slideDuplicateClass)||(ba=ba.index(),a.slideTo(ba,b,D))}else a.slideTo(0,b,D)}};a.disableKeyboardControl=function(){a.params.keyboardControl=!1;W(document).off("keydown",n)};a.enableKeyboardControl=function(){a.params.keyboardControl=!0;W(document).on("keydown",n)};a.mousewheel={event:!1,lastScrollTime:(new window.Date).getTime()};a.params.mousewheelControl&&(a.mousewheel.event=-1<navigator.userAgent.indexOf("firefox")?"DOMMouseScroll":q()?"wheel":"mousewheel");a.disableMousewheelControl=
function(){if(!a.mousewheel.event)return!1;var b=a.container;"container"!==a.params.mousewheelEventsTarged&&(b=W(a.params.mousewheelEventsTarged));b.off(a.mousewheel.event,w);a.params.mousewheelControl=!1;return!0};a.enableMousewheelControl=function(){if(!a.mousewheel.event)return!1;var b=a.container;"container"!==a.params.mousewheelEventsTarged&&(b=W(a.params.mousewheelEventsTarged));b.on(a.mousewheel.event,w);return a.params.mousewheelControl=!0};a.parallax={setTranslate:function(){a.container.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){I(this,
a.progress)});a.slides.each(function(){var b=W(this);b.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){I(this,Math.min(Math.max(b[0].progress,-1),1))})})},setTransition:function(b){"undefined"===typeof b&&(b=a.params.speed);a.container.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var f=W(this),D=parseInt(f.attr("data-swiper-parallax-duration"),10)||b;0===b&&(D=0);f.transition(D)})}};a.zoom={scale:1,
currentScale:1,isScaling:!1,gesture:{slide:void 0,slideWidth:void 0,slideHeight:void 0,image:void 0,imageWrap:void 0,zoomMax:a.params.zoomMax},image:{isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},velocity:{x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0},getDistanceBetweenTouches:function(b){return 2>b.targetTouches.length?
1:Math.sqrt(Math.pow(b.targetTouches[1].pageX-b.targetTouches[0].pageX,2)+Math.pow(b.targetTouches[1].pageY-b.targetTouches[0].pageY,2))},onGestureStart:function(b){var f=a.zoom;if(!a.support.gestures){if("touchstart"!==b.type||"touchstart"===b.type&&2>b.targetTouches.length)return;f.gesture.scaleStart=f.getDistanceBetweenTouches(b)}if(!f.gesture.slide||!f.gesture.slide.length)if(f.gesture.slide=W(this),0===f.gesture.slide.length&&(f.gesture.slide=a.slides.eq(a.activeIndex)),f.gesture.image=f.gesture.slide.find("img, svg, canvas"),
f.gesture.imageWrap=f.gesture.image.parent("."+a.params.zoomContainerClass),f.gesture.zoomMax=f.gesture.imageWrap.attr("data-swiper-zoom")||a.params.zoomMax,0===f.gesture.imageWrap.length){f.gesture.image=void 0;return}f.gesture.image.transition(0);f.isScaling=!0},onGestureChange:function(b){var f=a.zoom;if(!a.support.gestures){if("touchmove"!==b.type||"touchmove"===b.type&&2>b.targetTouches.length)return;f.gesture.scaleMove=f.getDistanceBetweenTouches(b)}f.gesture.image&&0!==f.gesture.image.length&&
(f.scale=a.support.gestures?b.scale*f.currentScale:f.gesture.scaleMove/f.gesture.scaleStart*f.currentScale,f.scale>f.gesture.zoomMax&&(f.scale=f.gesture.zoomMax-1+Math.pow(f.scale-f.gesture.zoomMax+1,.5)),f.scale<a.params.zoomMin&&(f.scale=a.params.zoomMin+1-Math.pow(a.params.zoomMin-f.scale+1,.5)),f.gesture.image.transform("translate3d(0,0,0) scale("+f.scale+")"))},onGestureEnd:function(b){var f=a.zoom;!a.support.gestures&&("touchend"!==b.type||"touchend"===b.type&&2>b.changedTouches.length)||!f.gesture.image||
0===f.gesture.image.length||(f.scale=Math.max(Math.min(f.scale,f.gesture.zoomMax),a.params.zoomMin),f.gesture.image.transition(a.params.speed).transform("translate3d(0,0,0) scale("+f.scale+")"),f.currentScale=f.scale,f.isScaling=!1,1===f.scale&&(f.gesture.slide=void 0))},onTouchStart:function(b,f){var D=b.zoom;D.gesture.image&&0!==D.gesture.image.length&&!D.image.isTouched&&("android"===b.device.os&&f.preventDefault(),D.image.isTouched=!0,D.image.touchesStart.x="touchstart"===f.type?f.targetTouches[0].pageX:
f.pageX,D.image.touchesStart.y="touchstart"===f.type?f.targetTouches[0].pageY:f.pageY)},onTouchMove:function(b){var f=a.zoom;if(f.gesture.image&&0!==f.gesture.image.length&&(a.allowClick=!1,f.image.isTouched&&f.gesture.slide)){f.image.isMoved||(f.image.width=f.gesture.image[0].offsetWidth,f.image.height=f.gesture.image[0].offsetHeight,f.image.startX=a.getTranslate(f.gesture.imageWrap[0],"x")||0,f.image.startY=a.getTranslate(f.gesture.imageWrap[0],"y")||0,f.gesture.slideWidth=f.gesture.slide[0].offsetWidth,
f.gesture.slideHeight=f.gesture.slide[0].offsetHeight,f.gesture.imageWrap.transition(0),a.rtl&&(f.image.startX=-f.image.startX),a.rtl&&(f.image.startY=-f.image.startY));var D=f.image.width*f.scale,r=f.image.height*f.scale;if(!(D<f.gesture.slideWidth&&r<f.gesture.slideHeight)){f.image.minX=Math.min(f.gesture.slideWidth/2-D/2,0);f.image.maxX=-f.image.minX;f.image.minY=Math.min(f.gesture.slideHeight/2-r/2,0);f.image.maxY=-f.image.minY;f.image.touchesCurrent.x="touchmove"===b.type?b.targetTouches[0].pageX:
b.pageX;f.image.touchesCurrent.y="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY;if(!f.image.isMoved&&!f.isScaling){if(a.isHorizontal()&&Math.floor(f.image.minX)===Math.floor(f.image.startX)&&f.image.touchesCurrent.x<f.image.touchesStart.x||Math.floor(f.image.maxX)===Math.floor(f.image.startX)&&f.image.touchesCurrent.x>f.image.touchesStart.x){f.image.isTouched=!1;return}if(!a.isHorizontal()&&Math.floor(f.image.minY)===Math.floor(f.image.startY)&&f.image.touchesCurrent.y<f.image.touchesStart.y||
Math.floor(f.image.maxY)===Math.floor(f.image.startY)&&f.image.touchesCurrent.y>f.image.touchesStart.y){f.image.isTouched=!1;return}}b.preventDefault();b.stopPropagation();f.image.isMoved=!0;f.image.currentX=f.image.touchesCurrent.x-f.image.touchesStart.x+f.image.startX;f.image.currentY=f.image.touchesCurrent.y-f.image.touchesStart.y+f.image.startY;f.image.currentX<f.image.minX&&(f.image.currentX=f.image.minX+1-Math.pow(f.image.minX-f.image.currentX+1,.8));f.image.currentX>f.image.maxX&&(f.image.currentX=
f.image.maxX-1+Math.pow(f.image.currentX-f.image.maxX+1,.8));f.image.currentY<f.image.minY&&(f.image.currentY=f.image.minY+1-Math.pow(f.image.minY-f.image.currentY+1,.8));f.image.currentY>f.image.maxY&&(f.image.currentY=f.image.maxY-1+Math.pow(f.image.currentY-f.image.maxY+1,.8));f.velocity.prevPositionX||(f.velocity.prevPositionX=f.image.touchesCurrent.x);f.velocity.prevPositionY||(f.velocity.prevPositionY=f.image.touchesCurrent.y);f.velocity.prevTime||(f.velocity.prevTime=Date.now());f.velocity.x=
(f.image.touchesCurrent.x-f.velocity.prevPositionX)/(Date.now()-f.velocity.prevTime)/2;f.velocity.y=(f.image.touchesCurrent.y-f.velocity.prevPositionY)/(Date.now()-f.velocity.prevTime)/2;2>Math.abs(f.image.touchesCurrent.x-f.velocity.prevPositionX)&&(f.velocity.x=0);2>Math.abs(f.image.touchesCurrent.y-f.velocity.prevPositionY)&&(f.velocity.y=0);f.velocity.prevPositionX=f.image.touchesCurrent.x;f.velocity.prevPositionY=f.image.touchesCurrent.y;f.velocity.prevTime=Date.now();f.gesture.imageWrap.transform("translate3d("+
f.image.currentX+"px, "+f.image.currentY+"px,0)")}}},onTouchEnd:function(b,f){b=b.zoom;if(b.gesture.image&&0!==b.gesture.image.length)if(b.image.isTouched&&b.image.isMoved){b.image.isTouched=!1;b.image.isMoved=!1;var D=300,r=300;f=b.image.currentX+b.velocity.x*D;var X=b.image.currentY+b.velocity.y*r;0!==b.velocity.x&&(D=Math.abs((f-b.image.currentX)/b.velocity.x));0!==b.velocity.y&&(r=Math.abs((X-b.image.currentY)/b.velocity.y));D=Math.max(D,r);b.image.currentX=f;b.image.currentY=X;f=b.image.height*
b.scale;b.image.minX=Math.min(b.gesture.slideWidth/2-b.image.width*b.scale/2,0);b.image.maxX=-b.image.minX;b.image.minY=Math.min(b.gesture.slideHeight/2-f/2,0);b.image.maxY=-b.image.minY;b.image.currentX=Math.max(Math.min(b.image.currentX,b.image.maxX),b.image.minX);b.image.currentY=Math.max(Math.min(b.image.currentY,b.image.maxY),b.image.minY);b.gesture.imageWrap.transition(D).transform("translate3d("+b.image.currentX+"px, "+b.image.currentY+"px,0)")}else b.image.isTouched=!1,b.image.isMoved=!1},
onTransitionEnd:function(b){var f=b.zoom;f.gesture.slide&&b.previousIndex!==b.activeIndex&&(f.gesture.image.transform("translate3d(0,0,0) scale(1)"),f.gesture.imageWrap.transform("translate3d(0,0,0)"),f.gesture.slide=f.gesture.image=f.gesture.imageWrap=void 0,f.scale=f.currentScale=1)},toggleZoom:function(b,f){var D=b.zoom;D.gesture.slide||(D.gesture.slide=b.clickedSlide?W(b.clickedSlide):b.slides.eq(b.activeIndex),D.gesture.image=D.gesture.slide.find("img, svg, canvas"),D.gesture.imageWrap=D.gesture.image.parent("."+
b.params.zoomContainerClass));if(D.gesture.image&&0!==D.gesture.image.length){if("undefined"===typeof D.image.touchesStart.x&&f){var r="touchend"===f.type?f.changedTouches[0].pageX:f.pageX;var X="touchend"===f.type?f.changedTouches[0].pageY:f.pageY}else r=D.image.touchesStart.x,X=D.image.touchesStart.y;if(D.scale&&1!==D.scale)D.scale=D.currentScale=1,D.gesture.imageWrap.transition(300).transform("translate3d(0,0,0)"),D.gesture.image.transition(300).transform("translate3d(0,0,0) scale(1)"),D.gesture.slide=
void 0;else{D.scale=D.currentScale=D.gesture.imageWrap.attr("data-swiper-zoom")||b.params.zoomMax;if(f){var ba=D.gesture.slide[0].offsetWidth;f=D.gesture.slide[0].offsetHeight;var ra=D.gesture.slide.offset().left;b=D.gesture.slide.offset().top;var g=D.gesture.image[0].offsetWidth;var K=D.gesture.image[0].offsetHeight;g*=D.scale;var U=K*D.scale;K=Math.min(ba/2-g/2,0);g=Math.min(f/2-U/2,0);U=-K;var Y=-g;r=(ra+ba/2-r)*D.scale;X=(b+f/2-X)*D.scale;r<K&&(r=K);r>U&&(r=U);X<g&&(X=g);X>Y&&(X=Y)}else X=r=0;
D.gesture.imageWrap.transition(300).transform("translate3d("+r+"px, "+X+"px,0)");D.gesture.image.transition(300).transform("translate3d(0,0,0) scale("+D.scale+")")}}},attachEvents:function(b){var f=b?"off":"on";if(a.params.zoom&&(b="touchstart"===a.touchEvents.start&&a.support.passiveListener&&a.params.passiveListeners?{passive:!0,capture:!1}:!1,a.support.gestures?(a.slides[f]("gesturestart",a.zoom.onGestureStart,b),a.slides[f]("gesturechange",a.zoom.onGestureChange,b),a.slides[f]("gestureend",a.zoom.onGestureEnd,
b)):"touchstart"===a.touchEvents.start&&(a.slides[f](a.touchEvents.start,a.zoom.onGestureStart,b),a.slides[f](a.touchEvents.move,a.zoom.onGestureChange,b),a.slides[f](a.touchEvents.end,a.zoom.onGestureEnd,b)),a[f]("touchStart",a.zoom.onTouchStart),a.slides.each(function(D,r){if(0<W(r).find("."+a.params.zoomContainerClass).length)W(r)[f](a.touchEvents.move,a.zoom.onTouchMove)}),a[f]("touchEnd",a.zoom.onTouchEnd),a[f]("transitionEnd",a.zoom.onTransitionEnd),a.params.zoomToggle))a.on("doubleTap",a.zoom.toggleZoom)},
init:function(){a.zoom.attachEvents()},destroy:function(){a.zoom.attachEvents(!0)}};a._plugins=[];for(var Ba in a.plugins)(F=a.plugins[Ba](a,a.params[Ba]))&&a._plugins.push(F);a.callPlugins=function(b,f,D,r,X,ba){for(var ra=0;ra<a._plugins.length;ra++)if(b in a._plugins[ra])a._plugins[ra][b](f,D,r,X,ba)};a.emitterEventListeners={};a.emit=function(b,f,D,r,X,ba){if(a.params[b])a.params[b](f,D,r,X,ba);var ra;if(a.emitterEventListeners[b])for(ra=0;ra<a.emitterEventListeners[b].length;ra++)a.emitterEventListeners[b][ra](f,
D,r,X,ba);a.callPlugins&&a.callPlugins(b,f,D,r,X,ba)};a.on=function(b,f){b=H(b);a.emitterEventListeners[b]||(a.emitterEventListeners[b]=[]);a.emitterEventListeners[b].push(f);return a};a.off=function(b,f){var D;b=H(b);if("undefined"===typeof f)return a.emitterEventListeners[b]=[],a;if(a.emitterEventListeners[b]&&0!==a.emitterEventListeners[b].length){for(D=0;D<a.emitterEventListeners[b].length;D++)a.emitterEventListeners[b][D]===f&&a.emitterEventListeners[b].splice(D,1);return a}};a.once=function(b,
f){b=H(b);var D=function(r,X,ba,ra,g){f(r,X,ba,ra,g);a.off(b,D)};a.on(b,D);return a};a.a11y={makeFocusable:function(b){b.attr("tabIndex","0");return b},addRole:function(b,f){b.attr("role",f);return b},addLabel:function(b,f){b.attr("aria-label",f);return b},disable:function(b){b.attr("aria-disabled",!0);return b},enable:function(b){b.attr("aria-disabled",!1);return b},onEnterKey:function(b){13===b.keyCode&&(W(b.target).is(a.params.nextButton)?(a.onClickNext(b),a.isEnd?a.a11y.notify(a.params.lastSlideMessage):
a.a11y.notify(a.params.nextSlideMessage)):W(b.target).is(a.params.prevButton)&&(a.onClickPrev(b),a.isBeginning?a.a11y.notify(a.params.firstSlideMessage):a.a11y.notify(a.params.prevSlideMessage)),W(b.target).is("."+a.params.bulletClass)&&W(b.target)[0].click())},liveRegion:W('\x3cspan class\x3d"'+a.params.notificationClass+'" aria-live\x3d"assertive" aria-atomic\x3d"true"\x3e\x3c/span\x3e'),notify:function(b){var f=a.a11y.liveRegion;0!==f.length&&(f.html(""),f.html(b))},init:function(){a.params.nextButton&&
a.nextButton&&0<a.nextButton.length&&(a.a11y.makeFocusable(a.nextButton),a.a11y.addRole(a.nextButton,"button"),a.a11y.addLabel(a.nextButton,a.params.nextSlideMessage));a.params.prevButton&&a.prevButton&&0<a.prevButton.length&&(a.a11y.makeFocusable(a.prevButton),a.a11y.addRole(a.prevButton,"button"),a.a11y.addLabel(a.prevButton,a.params.prevSlideMessage));W(a.container).append(a.a11y.liveRegion)},initPagination:function(){a.params.pagination&&a.params.paginationClickable&&a.bullets&&a.bullets.length&&
a.bullets.each(function(){var b=W(this);a.a11y.makeFocusable(b);a.a11y.addRole(b,"button");a.a11y.addLabel(b,a.params.paginationBulletMessage.replace(/{{index}}/,b.index()+1))})},destroy:function(){a.a11y.liveRegion&&0<a.a11y.liveRegion.length&&a.a11y.liveRegion.remove()}};a.init=function(){a.params.loop&&a.createLoop();a.updateContainerSize();a.updateSlidesSize();a.updatePagination();a.params.scrollbar&&a.scrollbar&&(a.scrollbar.set(),a.params.scrollbarDraggable&&a.scrollbar.enableDraggable());"slide"!==
a.params.effect&&a.effects[a.params.effect]&&(a.params.loop||a.updateProgress(),a.effects[a.params.effect].setTranslate());a.params.loop?a.slideTo(a.params.initialSlide+a.loopedSlides,0,a.params.runCallbacksOnInit):(a.slideTo(a.params.initialSlide,0,a.params.runCallbacksOnInit),0===a.params.initialSlide&&(a.parallax&&a.params.parallax&&a.parallax.setTranslate(),a.lazy&&a.params.lazyLoading&&(a.lazy.load(),a.lazy.initialImageLoaded=!0)));a.attachEvents();a.params.observer&&a.support.observer&&a.initObservers();
a.params.preloadImages&&!a.params.lazyLoading&&a.preloadImages();a.params.zoom&&a.zoom&&a.zoom.init();a.params.autoplay&&a.startAutoplay();a.params.keyboardControl&&a.enableKeyboardControl&&a.enableKeyboardControl();a.params.mousewheelControl&&a.enableMousewheelControl&&a.enableMousewheelControl();a.params.hashnavReplaceState&&(a.params.replaceState=a.params.hashnavReplaceState);a.params.history&&a.history&&a.history.init();a.params.hashnav&&a.hashnav&&a.hashnav.init();a.params.a11y&&a.a11y&&a.a11y.init();
a.emit("onInit",a)};a.cleanupStyles=function(){a.container.removeClass(a.classNames.join(" ")).removeAttr("style");a.wrapper.removeAttr("style");a.slides&&a.slides.length&&a.slides.removeClass([a.params.slideVisibleClass,a.params.slideActiveClass,a.params.slideNextClass,a.params.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-column").removeAttr("data-swiper-row");a.paginationContainer&&a.paginationContainer.length&&a.paginationContainer.removeClass(a.params.paginationHiddenClass);
a.bullets&&a.bullets.length&&a.bullets.removeClass(a.params.bulletActiveClass);a.params.prevButton&&W(a.params.prevButton).removeClass(a.params.buttonDisabledClass);a.params.nextButton&&W(a.params.nextButton).removeClass(a.params.buttonDisabledClass);a.params.scrollbar&&a.scrollbar&&(a.scrollbar.track&&a.scrollbar.track.length&&a.scrollbar.track.removeAttr("style"),a.scrollbar.drag&&a.scrollbar.drag.length&&a.scrollbar.drag.removeAttr("style"))};a.destroy=function(b,f){a.detachEvents();a.stopAutoplay();
a.params.scrollbar&&a.scrollbar&&a.params.scrollbarDraggable&&a.scrollbar.disableDraggable();a.params.loop&&a.destroyLoop();f&&a.cleanupStyles();a.disconnectObservers();a.params.zoom&&a.zoom&&a.zoom.destroy();a.params.keyboardControl&&a.disableKeyboardControl&&a.disableKeyboardControl();a.params.mousewheelControl&&a.disableMousewheelControl&&a.disableMousewheelControl();a.params.a11y&&a.a11y&&a.a11y.destroy();a.params.history&&!a.params.replaceState&&window.removeEventListener("popstate",a.history.setHistoryPopState);
a.params.hashnav&&a.hashnav&&a.hashnav.destroy();a.emit("onDestroy");!1!==b&&(a=null)};a.init();return a}};t.prototype={isSafari:function(){var F=window.navigator.userAgent.toLowerCase();return 0<=F.indexOf("safari")&&0>F.indexOf("chrome")&&0>F.indexOf("android")}(),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(window.navigator.userAgent),isArray:function(F){return"[object Array]"===Object.prototype.toString.apply(F)},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,
ieTouch:window.navigator.msPointerEnabled&&1<window.navigator.msMaxTouchPoints||window.navigator.pointerEnabled&&1<window.navigator.maxTouchPoints,lteIE9:function(){var F=document.createElement("div");F.innerHTML="\x3c!--[if lte IE 9]\x3e\x3ci\x3e\x3c/i\x3e\x3c![endif]--\x3e";return 1===F.getElementsByTagName("i").length}()},device:function(){var F=window.navigator.userAgent,x=F.match(/(Android);?[\s\/]+([\d.]+)?/),d=F.match(/(iPad).*OS\s([\d_]+)/),e=F.match(/(iPod)(.*OS\s([\d_]+))?/);F=!d&&F.match(/(iPhone\sOS|iOS)\s([\d_]+)/);
return{ios:d||F||e,android:x}}(),support:{touch:window.Modernizr&&!0===Modernizr.touch||!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch),transforms3d:window.Modernizr&&!0===Modernizr.csstransforms3d||function(){var F=document.createElement("div").style;return"webkitPerspective"in F||"MozPerspective"in F||"OPerspective"in F||"MsPerspective"in F||"perspective"in F}(),flexbox:function(){for(var F=document.createElement("div").style,x="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),
d=0;d<x.length;d++)if(x[d]in F)return!0}(),observer:"MutationObserver"in window||"WebkitMutationObserver"in window,passiveListener:function(){var F=!1;try{var x=Object.defineProperty({},"passive",{get:function(){F=!0}});window.addEventListener("testPassiveListener",null,x)}catch(d){}return F}(),gestures:"ongesturestart"in window},plugins:{}};var O=function(){var F=function(d){var e=0;for(e=0;e<d.length;e++)this[e]=d[e];this.length=d.length;return this},x=function(d,e){var l=[],n=0;if(d&&!e&&d instanceof
F)return d;if(d)if("string"===typeof d)if(n=d.trim(),0<=n.indexOf("\x3c")&&0<=n.indexOf("\x3e")){e="div";0===n.indexOf("\x3cli")&&(e="ul");0===n.indexOf("\x3ctr")&&(e="tbody");if(0===n.indexOf("\x3ctd")||0===n.indexOf("\x3cth"))e="tr";0===n.indexOf("\x3ctbody")&&(e="table");0===n.indexOf("\x3coption")&&(e="select");e=document.createElement(e);e.innerHTML=d;for(n=0;n<e.childNodes.length;n++)l.push(e.childNodes[n])}else for(d=e||"#"!==d[0]||d.match(/[ .<>:~]/)?(e||document).querySelectorAll(d):[document.getElementById(d.split("#")[1])],
n=0;n<d.length;n++)d[n]&&l.push(d[n]);else if(d.nodeType||d===window||d===document)l.push(d);else if(0<d.length&&d[0].nodeType)for(n=0;n<d.length;n++)l.push(d[n]);return new F(l)};F.prototype={addClass:function(d){if("undefined"===typeof d)return this;d=d.split(" ");for(var e=0;e<d.length;e++)for(var l=0;l<this.length;l++)this[l].classList.add(d[e]);return this},removeClass:function(d){d=d.split(" ");for(var e=0;e<d.length;e++)for(var l=0;l<this.length;l++)this[l].classList.remove(d[e]);return this},
hasClass:function(d){return this[0]?this[0].classList.contains(d):!1},toggleClass:function(d){d=d.split(" ");for(var e=0;e<d.length;e++)for(var l=0;l<this.length;l++)this[l].classList.toggle(d[e]);return this},attr:function(d,e){if(1===arguments.length&&"string"===typeof d){if(this[0])return this[0].getAttribute(d)}else{for(var l=0;l<this.length;l++)if(2===arguments.length)this[l].setAttribute(d,e);else for(var n in d)this[l][n]=d[n],this[l].setAttribute(n,d[n]);return this}},removeAttr:function(d){for(var e=
0;e<this.length;e++)this[e].removeAttribute(d);return this},data:function(d,e){if("undefined"===typeof e){if(this[0]){if(e=this[0].getAttribute("data-"+d))return e;if(this[0].dom7ElementDataStorage&&d in this[0].dom7ElementDataStorage)return this[0].dom7ElementDataStorage[d]}}else{for(var l=0;l<this.length;l++){var n=this[l];n.dom7ElementDataStorage||(n.dom7ElementDataStorage={});n.dom7ElementDataStorage[d]=e}return this}},transform:function(d){for(var e=0;e<this.length;e++){var l=this[e].style;l.webkitTransform=
l.MsTransform=l.msTransform=l.MozTransform=l.OTransform=l.transform=d}return this},transition:function(d){"string"!==typeof d&&(d+="ms");for(var e=0;e<this.length;e++){var l=this[e].style;l.webkitTransitionDuration=l.MsTransitionDuration=l.msTransitionDuration=l.MozTransitionDuration=l.OTransitionDuration=l.transitionDuration=d}return this},on:function(d,e,l,n){function q(I){var H=I.target;if(x(H).is(e))l.call(H,I);else{H=x(H).parents();for(var v=0;v<H.length;v++)x(H[v]).is(e)&&l.call(H[v],I)}}d=
d.split(" ");var k,w;for(k=0;k<this.length;k++)if("function"===typeof e||!1===e)for("function"===typeof e&&(n=(l=e)||!1),w=0;w<d.length;w++)this[k].addEventListener(d[w],l,n);else for(w=0;w<d.length;w++)this[k].dom7LiveListeners||(this[k].dom7LiveListeners=[]),this[k].dom7LiveListeners.push({listener:l,liveListener:q}),this[k].addEventListener(d[w],q,n);return this},off:function(d,e,l,n){d=d.split(" ");for(var q=0;q<d.length;q++)for(var k=0;k<this.length;k++)if("function"===typeof e||!1===e)"function"===
typeof e&&(n=(l=e)||!1),this[k].removeEventListener(d[q],l,n);else if(this[k].dom7LiveListeners)for(var w=0;w<this[k].dom7LiveListeners.length;w++)this[k].dom7LiveListeners[w].listener===l&&this[k].removeEventListener(d[q],this[k].dom7LiveListeners[w].liveListener,n);return this},once:function(d,e,l,n){function q(w){l(w);k.off(d,e,q,n)}var k=this;"function"===typeof e&&(n=l=e=!1);k.on(d,e,q,n)},trigger:function(d,e){for(var l=0;l<this.length;l++){try{var n=new window.CustomEvent(d,{detail:e,bubbles:!0,
cancelable:!0})}catch(q){n=document.createEvent("Event"),n.initEvent(d,!0,!0),n.detail=e}this[l].dispatchEvent(n)}return this},transitionEnd:function(d){function e(k){if(k.target===this)for(d.call(this,k),n=0;n<l.length;n++)q.off(l[n],e)}var l=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],n,q=this;if(d)for(n=0;n<l.length;n++)q.on(l[n],e);return this},width:function(){return this[0]===window?window.innerWidth:0<this.length?parseFloat(this.css("width")):
null},outerWidth:function(d){return 0<this.length?d?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null},height:function(){return this[0]===window?window.innerHeight:0<this.length?parseFloat(this.css("height")):null},outerHeight:function(d){return 0<this.length?d?this[0].offsetHeight+parseFloat(this.css("margin-top"))+parseFloat(this.css("margin-bottom")):this[0].offsetHeight:null},offset:function(){if(0<this.length){var d=this[0],
e=d.getBoundingClientRect(),l=document.body;return{top:e.top+(window.pageYOffset||d.scrollTop)-(d.clientTop||l.clientTop||0),left:e.left+(window.pageXOffset||d.scrollLeft)-(d.clientLeft||l.clientLeft||0)}}return null},css:function(d,e){var l;if(1===arguments.length)if("string"===typeof d){if(this[0])return window.getComputedStyle(this[0],null).getPropertyValue(d)}else{for(l=0;l<this.length;l++)for(var n in d)this[l].style[n]=d[n];return this}if(2===arguments.length&&"string"===typeof d)for(l=0;l<
this.length;l++)this[l].style[d]=e;return this},each:function(d){for(var e=0;e<this.length;e++)d.call(this[e],e,this[e]);return this},html:function(d){if("undefined"===typeof d)return this[0]?this[0].innerHTML:void 0;for(var e=0;e<this.length;e++)this[e].innerHTML=d;return this},text:function(d){if("undefined"===typeof d)return this[0]?this[0].textContent.trim():null;for(var e=0;e<this.length;e++)this[e].textContent=d;return this},is:function(d){if(!this[0])return!1;if("string"===typeof d){var e=
this[0];if(e===document)return d===document;if(e===window)return d===window;if(e.matches)return e.matches(d);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(d);if(e.mozMatchesSelector)return e.mozMatchesSelector(d);if(e.msMatchesSelector)return e.msMatchesSelector(d);d=x(d);for(e=0;e<d.length;e++)if(d[e]===this[0])return!0;return!1}if(d===document)return this[0]===document;if(d===window)return this[0]===window;if(d.nodeType||d instanceof F)for(d=d.nodeType?[d]:d,e=0;e<d.length;e++)if(d[e]===
this[0])return!0;return!1},index:function(){if(this[0]){for(var d=this[0],e=0;null!==(d=d.previousSibling);)1===d.nodeType&&e++;return e}},eq:function(d){if("undefined"===typeof d)return this;var e=this.length;return d>e-1?new F([]):0>d?(d=e+d,0>d?new F([]):new F([this[d]])):new F([this[d]])},append:function(d){var e;for(e=0;e<this.length;e++)if("string"===typeof d){var l=document.createElement("div");for(l.innerHTML=d;l.firstChild;)this[e].appendChild(l.firstChild)}else if(d instanceof F)for(l=0;l<
d.length;l++)this[e].appendChild(d[l]);else this[e].appendChild(d);return this},prepend:function(d){var e,l;for(e=0;e<this.length;e++)if("string"===typeof d){var n=document.createElement("div");n.innerHTML=d;for(l=n.childNodes.length-1;0<=l;l--)this[e].insertBefore(n.childNodes[l],this[e].childNodes[0])}else if(d instanceof F)for(l=0;l<d.length;l++)this[e].insertBefore(d[l],this[e].childNodes[0]);else this[e].insertBefore(d,this[e].childNodes[0]);return this},insertBefore:function(d){d=x(d);for(var e=
0;e<this.length;e++)if(1===d.length)d[0].parentNode.insertBefore(this[e],d[0]);else if(1<d.length)for(var l=0;l<d.length;l++)d[l].parentNode.insertBefore(this[e].cloneNode(!0),d[l])},insertAfter:function(d){d=x(d);for(var e=0;e<this.length;e++)if(1===d.length)d[0].parentNode.insertBefore(this[e],d[0].nextSibling);else if(1<d.length)for(var l=0;l<d.length;l++)d[l].parentNode.insertBefore(this[e].cloneNode(!0),d[l].nextSibling)},next:function(d){return 0<this.length?d?this[0].nextElementSibling&&x(this[0].nextElementSibling).is(d)?
new F([this[0].nextElementSibling]):new F([]):this[0].nextElementSibling?new F([this[0].nextElementSibling]):new F([]):new F([])},nextAll:function(d){var e=[],l=this[0];if(!l)return new F([]);for(;l.nextElementSibling;)l=l.nextElementSibling,d?x(l).is(d)&&e.push(l):e.push(l);return new F(e)},prev:function(d){return 0<this.length?d?this[0].previousElementSibling&&x(this[0].previousElementSibling).is(d)?new F([this[0].previousElementSibling]):new F([]):this[0].previousElementSibling?new F([this[0].previousElementSibling]):
new F([]):new F([])},prevAll:function(d){var e=[],l=this[0];if(!l)return new F([]);for(;l.previousElementSibling;)l=l.previousElementSibling,d?x(l).is(d)&&e.push(l):e.push(l);return new F(e)},parent:function(d){for(var e=[],l=0;l<this.length;l++)d?x(this[l].parentNode).is(d)&&e.push(this[l].parentNode):e.push(this[l].parentNode);return x(x.unique(e))},parents:function(d){for(var e=[],l=0;l<this.length;l++)for(var n=this[l].parentNode;n;)d?x(n).is(d)&&e.push(n):e.push(n),n=n.parentNode;return x(x.unique(e))},
find:function(d){for(var e=[],l=0;l<this.length;l++)for(var n=this[l].querySelectorAll(d),q=0;q<n.length;q++)e.push(n[q]);return new F(e)},children:function(d){for(var e=[],l=0;l<this.length;l++)for(var n=this[l].childNodes,q=0;q<n.length;q++)d?1===n[q].nodeType&&x(n[q]).is(d)&&e.push(n[q]):1===n[q].nodeType&&e.push(n[q]);return new F(x.unique(e))},remove:function(){for(var d=0;d<this.length;d++)this[d].parentNode&&this[d].parentNode.removeChild(this[d]);return this},add:function(){var d,e;for(d=
0;d<arguments.length;d++){var l=x(arguments[d]);for(e=0;e<l.length;e++)this[this.length]=l[e],this.length++}return this}};x.fn=F.prototype;x.unique=function(d){for(var e=[],l=0;l<d.length;l++)-1===e.indexOf(d[l])&&e.push(d[l]);return e};return x}(),Z=["jQuery","Zepto","Dom7"],P=0;for(;P<Z.length;P++)window[Z[P]]&&V(window[Z[P]]);if(Z="undefined"===typeof O?window.Dom7||window.Zepto||window.jQuery:O)"transitionEnd"in Z.fn||(Z.fn.transitionEnd=function(F){function x(n){if(n.target===this)for(F.call(this,
n),e=0;e<d.length;e++)l.off(d[e],x)}var d=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],e,l=this;if(F)for(e=0;e<d.length;e++)l.on(d[e],x);return this}),"transform"in Z.fn||(Z.fn.transform=function(F){for(var x=0;x<this.length;x++){var d=this[x].style;d.webkitTransform=d.MsTransform=d.msTransform=d.MozTransform=d.OTransform=d.transform=F}return this}),"transition"in Z.fn||(Z.fn.transition=function(F){"string"!==typeof F&&(F+="ms");for(var x=0;x<this.length;x++){var d=
this[x].style;d.webkitTransitionDuration=d.MsTransitionDuration=d.msTransitionDuration=d.MozTransitionDuration=d.OTransitionDuration=d.transitionDuration=F}return this}),"outerWidth"in Z.fn||(Z.fn.outerWidth=function(F){return 0<this.length?F?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null});window.Swiper=t})();"undefined"!==typeof module?module.exports=window.Swiper:"function"===typeof define&&define.amd&&define([],function(){return window.Swiper})},
"widgets/NearMe/filter-list":function(){define("dojo/_base/declare dojo/text!./filter-list.html dojo/_base/array dojo/_base/html dojo/_base/lang dojo/query dojo/on dojo/dom-attr dojo/keys dijit/_WidgetsInTemplateMixin dojo/dom-class jimu/utils jimu/BaseWidget jimu/filterUtils jimu/dijit/FilterParameters esri/symbols/jsonUtils jimu/symbolUtils jimu/LayerInfos/LayerInfos jimu/FilterManager esri/request dojo/Evented dojo/NodeList dojo/NodeList-dom".split(" "),function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,
H,v,G,Q,T){return V([q,e,T],{name:"NearMeFilter",templateString:W,lastFocusNode:null,baseClass:"jimu-widget-nearme-filter",_itemTemplate:'\x3cli aria-label\x3d"${layerTitle} ${filterNotAppliedLabel}" role\x3d"listitem" tabindex\x3d"0" class\x3d"filter-item" data-index\x3d"${index}"\x3e\x3cdiv class\x3d"header" \x3e\x3cspan role\x3d"button" aria-label\x3d"${toggleTip}" class\x3d"arrow jimu-float-leading jimu-trailing-margin05" title\x3d"${toggleTip}" \x3e\x3c/span\x3e\x3cspan class\x3d"icon"\x3e\x3cimg src\x3d"${icon}" /\x3e\x3c/span\x3e\x3cspan class\x3d"icon symbolIcon" style\x3d"display:none;"\x3e\x3c/span\x3e\x3cspan class\x3d"item-title"\x3e${title}\x3c/span\x3e\x3cspan class\x3d"cando jimu-float-trailing esriCTFliterListCheckbox"\x3e\x3c/span\x3e\x3cspan class\x3d"doing jimu-float-trailing esriCTFliterListCheckbox"\x3e\x3c/span\x3e\x3cspan class\x3d"done jimu-float-trailing esriCTFliterListCheckbox"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"body"\x3e\x3cdiv class\x3d"parameters"\x3e\x3c/div\x3e\x3cdiv tabindex\x3d"0" role\x3d"button" aria-label\x3d"${apply}" class\x3d"jimu-btn apply jimu-float-trailing jimu-trailing-margin25"\x3e${apply}\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e',
_layerTitleTemplate:'\x3cdiv class\x3d"esriCTGroupFilterLayerName"\x3e${layerTitle}\x3c/div\x3e',_store:null,totalAppliedFilters:0,postCreate:function(){this.inherited(arguments);this.totalAppliedFilters=0;this._updateClearAllButtonState();this.own(F(this.clearAllButton,"click",Z.hitch(this,this._clearAllFilters)));this.own(F(this.clearAllButton,"keydown",Z.hitch(this,function(a){a.keyCode!==d.ENTER&&a.keyCode!==d.SPACE||this._clearAllFilters()})));this._store={};this.layerInfosObj=v.getInstanceSync();
this.filterUtils=new k;this.filterManager=G.getInstance();var M=this.config.filters,R={},C=[];this.config.groupFiltersByLayer?(t.forEach(M,function(a,B){R[a.layerId]||(R[a.layerId]=[],C.push(a.layerId));a.index=B;R[a.layerId].push(a)}),t.forEach(C,Z.hitch(this,function(a){var B=this.layerInfosObj.getLayerInfoById(a);B=Z.replace(this._layerTitleTemplate,{layerTitle:B.layerObject.name||B.title},/\$\{([^\}]+)\}/ig);B=O.toDom(B);O.place(B,this.filterList);for(B=0;B<R[a].length;B++)this._addFilterInList(R[a][B],
R[a][B].index)}))):t.forEach(M,Z.hitch(this,function(a,B){this._addFilterInList(a,B)}))},getLastNode:function(){if(this.lastFocusNode)if(l.contains(this.lastFocusNode,"has-ask-for-value")){var M=n.getFocusNodesInDom(this.lastFocusNode);M=l.contains(this.lastFocusNode,"config-parameters")?M.reverse()[0]:P(".arrow",this.lastFocusNode)[0]}else M=this.lastFocusNode;return M},_addFilterInList:function(M,R){var C=this.filterUtils.isAskForValues(M.filter),a={icon:M.icon?n.processUrlInWidgetConfig(M.icon,
this.folderUrl):this.folderUrl+"/css/images/default_task_icon.png",index:R,title:M.name,layerTitle:M.layerTitle?M.layerTitle:M.name,toggleTip:this.nls.toggleTip,hasValue:C?window.appInfo.isRunInMobile?"block !important":"":"none",isAskForValue:C,apply:Z.getObject("jimuNls.common.apply",!1,window)||"Apply",filterNotAppliedLabel:this.nls.filterNotAppliedLabel};this._store[M.layerId]||(this._store[M.layerId]={mapFilterControls:{}});R=Z.replace(this._itemTemplate,a,/\$\{([^\}]+)\}/ig);var B=O.toDom(R);
this.lastFocusNode=B;O.place(B,this.filterList);if(M.symbol){R=P(".icon",B);O.setStyle(R[0],"display","none");O.setStyle(R[1],"display","inline-block");var da=I.fromJson(M.symbol),la=M.symbol.url||M.symbol.imageData;la?(da.setWidth(25),da.setHeight(25)):da.setSize(25);da=la?H.createSymbolNode(da):H.createSymbolNode(da,{width:26,height:26});O.place(da,R[1])}this.own(P(".header",B).on("click",Z.hitch(this,"enableFilter",B,M,a,!1)));C?(O.addClass(B,"has-ask-for-value"),x.set(B,"tabindex","-1")):(this.own(F(P(".header",
B)[0].parentElement,"keydown",Z.hitch(this,"enableFilter",B,M,a,!0))),O.addClass(B,"not-has-ask-for-value"));C=P(".apply",B);R=P(".arrow",B);"none"!==a.hasValue?(x.set(C[0],"type",""),x.set(R[0],"type",""),x.set(R[0],"tabindex","0"),this.own(R.on("click",Z.hitch(this,"configFilter",B,M))),this.own(R.on("keydown",Z.hitch(this,function(ma){if(ma.keyCode===d.ENTER||ma.keyCode===d.SPACE)this.configFilter(B,M),ma.stopPropagation()}))),this.own(C.on("click",Z.hitch(this,"applyFilterValues",B,M,!1))),this.own(C.on("keydown",
Z.hitch(this,"applyFilterValues",B,M,!0))),O.addClass(B,"requesting"),this.configFilter(B,M,null,Z.hitch(this,function(){this.config.collapse&&O.removeClass(B,"config-parameters");M.autoApplyWhenWidgetOpen&&this.enableFilter(B,M,a)}))):(x.set(C[0],"type","hidden"),x.set(R[0],"type","hidden"),M.autoApplyWhenWidgetOpen&&this.enableFilter(B,M,a))},startup:function(){this.inherited(arguments);this.resize()},_getPriorityOfMapFilter:function(M){M=Z.getObject(M+".mapFilterControls",!1,this._store);var R=
0,C;for(C in M){var a=M[C];a.priority>R&&(R=a.priority)}return R},_getMapFilterControl:function(M){M=Z.getObject(M+".mapFilterControls",!1,this._store);var R=!0,C;for(C in M){var a=M[C];0<a.priority&&(R=!!a.enable)}return R},_setItemFilter:function(M,R,C,a){this._store[M]["filter_item_"+R]=C;C=this._getPriorityOfMapFilter(M);Z.setObject(M+".mapFilterControls.filter_item_"+R,{enable:a,priority:C+1},this._store)},_removeItemFilter:function(M,R){delete this._store[M]["filter_item_"+R];delete this._store[M].mapFilterControls["filter_item_"+
R]},_getExpr:function(M){if(!this._store[M])return null;var R=[];M=this._store[M];for(var C in M){var a=M[C];a&&"mapFilterControls"!==C&&R.push("("+a+")")}return R.join(" AND ")},_bindMapUpdateEvents:function(M,R){F.once(this.map,"update-start",Z.hitch(this,function(){O.addClass(M,"applying");O.removeClass(M,"applied");x.set(M,"aria-label",M.innerText+this.nls.applyingFilterLabel)}));F.once(this.map,"update-end",Z.hitch(this,function(){R?(O.addClass(M,"applied"),x.set(M,"aria-label",M.innerText+this.nls.filterAppliedLabel)):
(O.removeClass(M,"applied"),x.set(M,"aria-label",M.innerText+this.nls.filterNotAppliedLabel));O.removeClass(M,"applying")}))},enableFilter:function(M,R,C,a,B){if(!a||B.keyCode===d.ENTER||B.keyCode===d.SPACE)if(!O.hasClass(M,"config-parameters")||M.filterParams&&M.filterParams.getFilterExpr())if(!C.isAskForValue||M.filterParams&&M.filterParams.getFilterExpr()){C=R.layerId;a=O.getAttr(M,"data-index");B=null;var da=this.layerInfosObj.getLayerInfoById(C);B=O.hasClass(M,"applied");da.isShowInMap()&&da.isInScale()?
this._bindMapUpdateEvents(M,B?!1:!0):B?O.removeClass(M,"applied"):O.addClass(M,"applied");da=null;B?(this._removeItemFilter(C,a),B=this._getExpr(C),da=this._getMapFilterControl(C),this.filterManager.applyWidgetFilter(C,this.id,B,da),this.totalAppliedFilters--):(M=this._getFilterExpr(M,R),this._setItemFilter(C,a,M,R.enableMapFilter),B=this._getExpr(C),da=this._getMapFilterControl(C),this.filterManager.applyWidgetFilter(C,this.id,B,da),this.totalAppliedFilters++);this.filtersUpdated=!0;this._updateClearAllButtonState()}else this.configFilter(M,
R)},configFilter:function(M,R,C,a){M.filterParams?(O.hasClass(M,"config-parameters")?(O.removeClass(M,"config-parameters"),this._changeItemTitleWidth(M,window.appInfo.isRunInMobile?60:45)):(O.addClass(M,"config-parameters"),this._changeItemTitleWidth(M,60)),a&&a(),this.emit("setLastFilterNode",this.getLastNode())):Q({url:R.url,content:{f:"json"},handleAs:"json",callbackPrams:"callback"}).then(Z.hitch(this,function(B){O.addClass(M,"config-parameters");O.removeClass(M,"requesting");var da=P(".parameters",
M)[0];M.handles=[];M.filterParams=new w;var la=Z.clone(R.filter),ma=null;R.enableMapFilter&&(ma=R.layerId);M.filterParams.build(R.url,B,la,ma,this.id);this.own(F(M.filterParams,"change",Z.hitch(this,function(pa){pa?(P(".apply",M).removeClass("disable-apply"),M.expr=pa):(delete M.expr,P(".apply",M).addClass("disable-apply"))})));M.expr=M.filterParams.getFilterExpr();M.expr?P(".apply",M).removeClass("disable-apply"):(delete M.expr,P(".apply",M).addClass("disable-apply"));M.filterParams.placeAt(da);
this._changeItemTitleWidth(M,60);a&&a()}));C&&C.target&&C.stopPropagation()},applyFilterValues:function(M,R,C,a){if(!C||a.keyCode===d.ENTER||a.keyCode===d.SPACE){var B=M.filterParams&&(M.expr||this._getFilterExpr(M,R)),da=!0;C=!1;l.contains(M,"applied")?(C=!0,this._getExpr(R.layerId)==="("+B+")"&&(da=!1)):da=!0;if(B&&da){M.expr=B;B=R.layerId;da=O.getAttr(M,"data-index");var la=this.layerInfosObj.getLayerInfoById(B);la.isShowInMap()&&la.isInScale()?this._bindMapUpdateEvents(M,!0):O.addClass(M,"applied");
this._setItemFilter(B,da,M.expr,R.enableMapFilter);M=this._getExpr(B);R=this._getMapFilterControl(B);this.filterManager.applyWidgetFilter(B,this.id,M,R);this.filtersUpdated=!0;C||this.totalAppliedFilters++;this._updateClearAllButtonState()}a.stopPropagation()}},_getFilterExpr:function(M,R){return M.filterParams?M.filterParams.getFilterExpr():this.filterUtils.hasVirtualDate(R.filter)?(this.filterUtils.isHosted=n.isHostedService(R.url),this.filterUtils.getExprByFilterObj(R.filter)):R.filter.expr},resize:function(){this.inherited(arguments);
this._changeItemTitleWidth(this.domNode,window.appInfo.isRunInMobile?60:45)},_changeItemTitleWidth:function(M,R){var C=P(".header",M)[0];C&&(R=O.getContentBox(C).w-R,0<R&&P(".header .item-title",M).style({maxWidth:R+"px"}))},destroy:function(){P(".filter-item",this.filterList).forEach(function(R){delete R.filterParams;delete R.expr});if(this._store)for(var M in this._store)M&&this.filterManager.applyWidgetFilter(M,this.id,"",null);this.inherited(arguments)},filterListShown:function(){this.filtersUpdated=
!1},_updateClearAllButtonState:function(){0<this.totalAppliedFilters?(l.add(this.clearAllButton,"esriCTClearAllFilterActive"),x.set(this.clearAllButton,"aria-disabled","false")):(l.remove(this.clearAllButton,"esriCTClearAllFilterActive"),x.set(this.clearAllButton,"aria-disabled","true"))},_clearAllFilters:function(){if(l.contains(this.clearAllButton,"esriCTClearAllFilterActive")&&this.filterList){var M=P(".applied",this.filterList);t.forEach(M,function(R){(R=P(".header",R))&&0<R.length&&R[0].click()});
this._updateClearAllButtonState();this.emit("clearAllFilters")}}})})},"dojo/NodeList":function(){define(["./query"],function(V){return V.NodeList})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(V,W,t,O,Z,P,F,x){V=V(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,
unit:null,unionResults:!1,geodesic:!1,toJson:function(){var d={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},e=this.distances,l=this.outSpatialReference,n=this.bufferSpatialReference,q=t.map(this.geometries,function(I){I="extent"===I.type?F.fromExtent(I):I;return I.toJson()},this),k=this.geometries;if(k&&0<k.length){var w="extent"===k[0].type?"esriGeometryPolygon":x.getJsonType(k[0]);d.geometries=O.toJson({geometryType:w,geometries:q});d.inSR=k[0].spatialReference.wkid?k[0].spatialReference.wkid:
O.toJson(k[0].spatialReference.toJson())}e&&(d.distances=e.join(","));l&&(d.outSR=l.wkid?l.wkid:O.toJson(l.toJson()));n&&(d.bufferSR=n.wkid?n.wkid:O.toJson(n.toJson()));return d}});Z("extend-esri")&&W.setObject("tasks.BufferParameters",V,P);return V})},"esri/dijit/LocateButton":function(){define("require dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/LocateButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-attr ../geometry/webMercatorUtils ../geometry/Point ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ../tasks/ProjectParameters".split(" "),
function(V,W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,H,v,G,Q,T,M,R){V=t("esri.dijit.LocateButton",[x,e,W],{templateString:q,options:{theme:"LocateButton",map:null,visible:!0,highlightLocation:!0,symbol:new M(V.toUrl("./images/sdk_gps_location.png"),28,28),infoTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(C,a){C=O.mixin({},this.options,C);this.domNode=
a;this._i18n=k;a=navigator.geolocation;var B=window.hasOwnProperty("isSecureContext");B=B&&window.isSecureContext||!B&&"https:"===window.location.protocol;B&&a||(C.visible=!1);a||console.log("LocateButton::navigator.geolocation unsupported.");B||console.log("LocateButton::navigator.geolocation requires a secure origin.");this.set("map",C.map);this.set("theme",C.theme);this.set("visible",C.visible);this.set("scale",C.scale);this.set("highlightLocation",C.highlightLocation);this.set("symbol",C.symbol);
this.set("infoTemplate",C.infoTemplate);this.set("geolocationOptions",C.geolocationOptions);this.set("useTracking",C.useTracking);this.set("setScale",C.setScale);this.set("centerAt",C.centerAt);this.set("timeout",C.timeout);this.set("graphicsLayer",C.graphicsLayer);this.set("clearOnTrackingStop",C.clearOnTrackingStop);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this.watch("tracking",this._locate);this.watch("useTracking",O.hitch(this,function(){this.get("tracking")&&
!this.get("useTracking")&&this._stopTracking();this._setTitle()}));this._css={container:"locateContainer",locate:"zoomLocateButton",loading:"loading",tracking:"tracking"}},postCreate:function(){this.inherited(arguments);this.own(l(this._locateNode,d,O.hitch(this,this.locate)))},startup:function(){this.inherited(arguments);this.get("map")||(this.set("visible",!1),console.log("LocateButton::map required"));if(this.get("map").loaded)this._init();else l.once(this.get("map"),"load",O.hitch(this,function(){this._init()}))},
destroy:function(){this.clear();this._graphicsEvent&&this._graphicsEvent.remove();this._removeWatchPosition();this.inherited(arguments)},clear:function(){var C=this.get("highlightGraphic"),a=this.get("graphicsLayer");C&&(a?a.remove(C):this.get("map").graphics.remove(C),this.set("highlightGraphic",null))},locate:function(){this.get("useTracking")&&this.set("tracking",!this.get("tracking"));return this._locate()},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_setTitle:function(){this.get("useTracking")?
this.get("tracking")?H.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.stopTracking):H.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.tracking):H.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.title)},_removeWatchPosition:function(){this.get("watchId")&&(navigator.geolocation.clearWatch(this.get("watchId")),this.set("watchId",null));this._removePrivateVars()},_stopTracking:function(){w.remove(this._locateNode,this._css.tracking);this._removeWatchPosition();
this.get("clearOnTrackingStop")&&this.clear();this._hideLoading()},_positionToObject:function(C){return C?{coords:O.mixin({},C.coords),timestamp:C.timestamp}:{}},_startTracking:function(){w.add(this._locateNode,this._css.tracking);this._removeWatchPosition();var C=navigator.geolocation.watchPosition(O.hitch(this,function(a){a=this._positionToObject(a);this._setPosition(a).then(O.hitch(this,function(B){this._locateEvent(B)}),O.hitch(this,function(B){B||(B=Error("LocateButton::Error setting the position."));
this._locateError(B)}))}),O.hitch(this,function(a){this.set("tracking",!1);a||(a=Error("LocateButton::Could not get tracking position."));this._locateError(a)}),this.get("geolocationOptions"));this.set("watchId",C)},_removePrivateVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var C=new n;this._removePrivateVars();var a=setTimeout(O.hitch(this,function(){clearTimeout(a);C.reject(Error("LocateButton::time expired for getting location."))}),this.get("timeout"));
navigator.geolocation.getCurrentPosition(O.hitch(this,function(B){B=this._positionToObject(B);clearTimeout(a);this._setPosition(B).then(O.hitch(this,function(da){C.resolve(da)}),O.hitch(this,function(da){da||(da=Error("LocateButton::Error setting map position."));C.reject(da)}))}),O.hitch(this,function(B){B||(B=Error("LocateButton::Could not get current position."));C.reject(B)}),this.get("geolocationOptions"));return C.promise},_locate:function(){var C=new n;this._showLoading();if(navigator.geolocation)this.get("useTracking")?
this.get("tracking")?(this._startTracking(),C.resolve({tracking:!0})):(this._stopTracking(),C.resolve({tracking:!1})):this._getCurrentPosition().then(O.hitch(this,function(B){this._locateEvent(B);C.resolve(B)}),O.hitch(this,function(B){B||(B=Error("LocateButton::Could not get current position."));this._locateError(B);C.reject(B)}));else{var a=Error("LocateButton::geolocation unsupported");this._locateError(a);C.reject(a)}this._setTitle();return C.promise},_projectPoint:function(C){var a=new n,B=this.get("map").spatialReference,
da=B.wkid;B.isWebMercator()?(C=v.geographicToWebMercator(C),a.resolve(C)):F.defaults.geometryService&&4326!==da?(da=new R,da.geometries=[C],da.outSR=B,F.defaults.geometryService.project(da).then(O.hitch(this,function(la){la&&la.length?a.resolve(la[0]):a.reject(Error("LocateButton::Point was not projected."))}),function(la){la||(la=Error("LocateButton::please specify a geometry service on esri/config to project."));a.reject(la)})):a.resolve(C);return a.promise},_getScale:function(C){var a=this.get("scale");
return C&&C.coords?a||C.coords.accuracy||5E4:a||5E4},_createPoint:function(C){var a;C&&C.coords&&(a=new G([C.coords.longitude,C.coords.latitude],new Q({wkid:4326})));return a},_setPosition:function(C){var a=new n,B,da;this._removePrivateVars();if((this._position=C)&&C.coords){if(B=this._createPoint(C))this._graphic=da=this._createGraphic(B,C);var la=this._getScale(C);this._scale=la;B?this._projectPoint(B).then(O.hitch(this,function(ma){this._graphic=da=this._createGraphic(ma,C);var pa={graphic:da,
scale:la,position:C};this.get("setScale")&&this.get("map").setScale(la);this.get("centerAt")?this.get("map").centerAt(ma).then(O.hitch(this,function(){a.resolve(pa)}),O.hitch(this,function(N){N||(N=Error("LocateButton::Could not center map."));a.reject(N)})):a.resolve(pa)}),O.hitch(this,function(ma){ma||(ma=Error("LocateButton::Error projecting point."));a.reject(ma)})):(B=Error("LocateButton::Invalid point"),a.reject(B))}else B=Error("LocateButton::Invalid position"),a.reject(B);return a.promise},
_createGraphic:function(C,a){if(C){a={position:a};var B=new T(C,this.get("symbol"),a,this.get("infoTemplate"))}return B},_locateEvent:function(C){if(C.graphic){var a=this.get("highlightGraphic"),B=this.get("graphicsLayer");a?(a.setGeometry(C.graphic.geometry),a.setAttributes(C.graphic.attributes),a.setInfoTemplate(C.graphic.infoTemplate),a.setSymbol(C.graphic.symbol)):(a=C.graphic,this.get("highlightLocation")&&(B?B.add(a):this.get("map").graphics.add(a)));this.set("highlightGraphic",a)}this._hideLoading();
this.emit("locate",C)},_locateError:function(C){C={graphic:this._graphic,scale:this._scale,position:this._position,error:C};this._hideLoading();this.emit("locate",C)},_showLoading:function(){this.get("useTracking")||w.add(this._locateNode,this._css.loading)},_hideLoading:function(){this.get("useTracking")||w.remove(this._locateNode,this._css.loading)},_init:function(){this._visible();this._setTitle();this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load",
{})},_updateThemeWatch:function(C,a,B){w.remove(this.domNode,a);w.add(this.domNode,B)},_visible:function(){this.get("visible")?I.set(this.domNode,"display","block"):I.set(this.domNode,"display","none")}});Z("extend-esri")&&O.setObject("dijit.LocateButton",V,P);return V})},"widgets/NearMe/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:esri/dijit/Search/templates/Search.html":'\x3cdiv role\x3d"presentation" class\x3d"${theme}"\x3e\r\n  \x3cdiv role\x3d"presentation" class\x3d"${css.searchGroup}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"expandNode" class\x3d"${css.searchExpandContainer}"\x3e\r\n      \x3cdiv class\x3d"${css.searchAnimateContainer}"\x3e\r\n        \x3cdiv role\x3d"button" title\x3d"${_i18n.widgets.Search.main.searchIn}" id\x3d"${id}_menu_button" class\x3d"${css.searchBtn} ${css.searchToggle}" tabindex\x3d"0" data-dojo-attach-point\x3d"sourcesBtnNode"\x3e\r\n          \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchToggleIcon}"\x3e\x3c/span\x3e\x3cspan class\x3d"${css.searchSourceName}" data-dojo-attach-point\x3d"sourceNameNode"\x3e\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"${css.searchInputGroup}"\x3e\r\n          \x3cform data-dojo-attach-point\x3d"formNode"\x3e\r\n            \x3cinput maxlength\x3d"${maxLength}" autocomplete\x3d"off" type\x3d"text" tabindex\x3d"0" class\x3d"${css.searchInput}" value\x3d"${value}" aria-haspopup\x3d"true" id\x3d"${id}_input" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n          \x3c/form\x3e\r\n          \x3cdiv role\x3d"button" class\x3d"${css.searchClear}" tabindex\x3d"0" data-dojo-attach-point\x3d"clearNode"\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchClearIcon}"\x3e\x3c/span\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchSpinner}"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"suggestionsNode" class\x3d"${css.searchMenu} ${css.suggestionsMenu}"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" title\x3d"${_i18n.widgets.Search.main.searchButtonTitle}" class\x3d"${css.searchBtn} ${css.searchSubmit}" tabindex\x3d"0" data-dojo-attach-point\x3d"submitNode"\x3e\r\n      \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchIcon}"\x3e\x3c/span\x3e\r\n      \x3cspan class\x3d"${css.searchButtonText}"\x3e${_i18n.widgets.Search.main.searchButtonTitle}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"sourcesNode" class\x3d"${css.searchMenu} ${css.sourcesMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"noResultsMenuNode" class\x3d"${css.searchMenu} ${css.searchNoResultsMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"${css.searchClearFloat}"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/NearMe/item-list.html":'\x3cdiv class\x3d"esriCTItemlList"\x3e\r\n    \x3cdiv class\x3d"esriCTBackButton"\x3e\r\n        \x3cdiv class\x3d"esriCTItemLeftArrow"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTItemRightArrow"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTItemCount esriCTLoadingIcon"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTItemName"\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/NearMe/swiperLayout.html":'\x3cdiv class\x3d"swiper-container"\x3e\r\n    \x3cdiv class\x3d"swiper-wrapper"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"swiper-button-prev"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"swiper-button-next"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"swiper-pagination"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"swiper-scrollbar"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/NearMe/filter-list.html":'\x3cdiv\x3e\r\n  \x3cul class\x3d"filter-list" data-dojo-attach-point\x3d"filterList"\x3e\x3c/ul\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/LocateButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_locateNode" role\x3d"button" class\x3d"${_css.locate}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.locateButton.locate.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:widgets/NearMe/Widget.html":'\x3cdiv\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"widgetMainNode" class\x3d"esriCTWidgetMainNode esriCTHidden"\x3e\r\n        \x3cdiv class\x3d"esriCTSearchOuterContainer" data-dojo-attach-point\x3d"searchOuterContainer"\x3e\r\n            \x3cdiv class\x3d"esriCTSearchHeader firstFocusNode" data-dojo-attach-point\x3d"searchHeaderTextNode" role\x3d"presentation" tabindex\x3d"0"\r\n                aria-label\x3d"${nls.searchHeaderText}"\x3e${nls.searchHeaderText}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTSearchContainer"\x3e\r\n                \x3cdiv class\x3d"esriCTSearchDiv"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"search"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTCurrentLocationDiv esriCTImgButtons esriCTCurrentLocation esriCTHidden"\r\n                    data-dojo-attach-point\x3d"currentLocationNode"\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv role\x3d"button" tabindex\x3d"0"\r\n                    class\x3d"esriCTSelectLocationDiv esriCTImgButtons esriCTSelectLocation esriCTHidden"\r\n                    data-dojo-attach-point\x3d"selectLocation" aria-label\x3d"${nls.selectLocationToolTip}"\r\n                    title\x3d"${nls.selectLocationToolTip}"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv style\x3d"clear: both"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTBufferOptionParentDiv esriCTHidden" data-dojo-attach-point\x3d"bufferOptionParentNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"bufferTextboxParentNode" class\x3d"esriCTBufferTextboxParent"\x3e\r\n                    \x3cdiv class\x3d"esriCTBufferTextboxText" data-dojo-attach-point\x3d"bufferTextboxText"\x3e\r\n                        ${nls.bufferTextboxLabel}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" aria-label\x3d"${nls.bufferTextboxLabel}" data-dojo-attach-point\x3d"bufferTextboxNode"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTSliderDiv" data-dojo-attach-point\x3d"sliderParentNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"silderText" class\x3d"esriCTSliderText" tabindex\x3d"0" role\x3d"presentation" \x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"horizantalSliderContainer"\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"esriCTSliderValuesDiv"\x3e\r\n                        \x3cdiv class\x3d"esriCTSliderMinValueDiv" data-dojo-attach-point\x3d"sliderMinValue"\x3e\r\n                        \x3c/div\x3e\r\n                        \x3cdiv class\x3d"esriCTSliderMaxValueDiv" data-dojo-attach-point\x3d"sliderMaxValue"\x3e\r\n                        \x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv data-dojo-attach-point\x3d"applyFilterNode" class\x3d"esriCTApplyFilterDiv"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"applyFilterArrowNodeParent" class\x3d"esriCTapplyFilterArrowNodeParent"  tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.filterTitle}"\x3e\r\n                    \x3cdiv class\x3d"esriCTFilterToApply" \x3e\r\n                        ${nls.filterTitle}\r\n                    \x3c/div\x3e\r\n                    \x3cdiv title\x3d"${nls.filterTitle}"\r\n                        data-dojo-attach-point\x3d"applyFilterArrowNode"\r\n                        class\x3d"esriCTApplyFilterArrowNode esriCTApplyFilterArrowDown"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.clearFilterButton}" title\x3d"${nls.clearFilterButton}"\r\n                    data-dojo-attach-point\x3d"clearAllFilterButton" aria-disabled\x3d"false"\r\n                    class\x3d"esriCTClearAllFilter esriCTClearAllFilterActive"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv style\x3d"clear: both"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"esriCTWidgetErrorNode" data-dojo-attach-point\x3d"widgetErrorNode"\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv data-dojo-attach-point\x3d"layerListOuterDiv" class\x3d"esriCTListOuterContainer"\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv data-dojo-attach-point\x3d"filterListOuterDiv" class\x3d"esriCTListOuterContainer esriCTHidden"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"filterListMainDiv" class\x3d"esriCTFilterListMainContainer"\x3e\r\n                \x3cdiv style\x3d"height: 100%;" data-dojo-attach-point\x3d"filterListNode"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/NearMe/css/style.css":".swiper-container {margin-left: auto; margin-right: auto; position: relative; overflow: hidden; z-index: 1;}.swiper-container-no-flexbox .swiper-slide {float: left;}.swiper-container-vertical \x3e .swiper-wrapper {-webkit-box-orient: vertical; -moz-box-orient: vertical; -ms-flex-direction: column; -webkit-flex-direction: column; flex-direction: column;}.swiper-wrapper {position: relative; width: 100%; height: 100%; z-index: 1; display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-transition-property: -webkit-transform; -moz-transition-property: -moz-transform; -o-transition-property: -o-transform; -ms-transition-property: -ms-transform; transition-property: transform; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box;}.swiper-container-android .swiper-slide,.swiper-wrapper {-webkit-transform: translate3d(0px, 0, 0); -moz-transform: translate3d(0px, 0, 0); -o-transform: translate(0px, 0px); -ms-transform: translate3d(0px, 0, 0); transform: translate3d(0px, 0, 0);}.swiper-container-multirow \x3e .swiper-wrapper {-webkit-box-lines: multiple; -moz-box-lines: multiple; -ms-flex-wrap: wrap; -webkit-flex-wrap: wrap; flex-wrap: wrap;}.swiper-container-free-mode \x3e .swiper-wrapper {-webkit-transition-timing-function: ease-out; -moz-transition-timing-function: ease-out; -ms-transition-timing-function: ease-out; -o-transition-timing-function: ease-out; transition-timing-function: ease-out; margin: 0 auto;}.swiper-slide {-webkit-flex-shrink: 0; -ms-flex: 0 0 auto; flex-shrink: 0; width: 100%; height: 100%; position: relative;}.swiper-container-autoheight,.swiper-container-autoheight .swiper-slide {height: auto;}.swiper-container-autoheight .swiper-wrapper {-webkit-box-align: start; -ms-flex-align: start; -webkit-align-items: flex-start; align-items: flex-start; -webkit-transition-property: -webkit-transform, height; -moz-transition-property: -moz-transform; -o-transition-property: -o-transform; -ms-transition-property: -ms-transform; transition-property: transform, height;}.swiper-container .swiper-notification {position: absolute; left: 0; top: 0; pointer-events: none; opacity: 0; z-index: -1000;}.swiper-wp8-horizontal {-ms-touch-action: pan-y; touch-action: pan-y;}.swiper-wp8-vertical {-ms-touch-action: pan-x; touch-action: pan-x;}.swiper-button-prev,.swiper-button-next {position: absolute; top: 50%; width: 27px; height: 44px; margin-top: -22px; z-index: 10; cursor: pointer; -moz-background-size: 27px 44px; -webkit-background-size: 27px 44px; background-size: 27px 44px; background-position: center; background-repeat: no-repeat;}.swiper-button-prev.swiper-button-disabled,.swiper-button-next.swiper-button-disabled {opacity: 0.35; cursor: auto; pointer-events: none;}.swiper-button-prev,.swiper-container-rtl .swiper-button-next {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M0%2C22L22%2C0l2.1%2C2.1L4.2%2C22l19.9%2C19.9L22%2C44L0%2C22L0%2C22L0%2C22z'%20fill%3D'%23007aff'%2F%3E%3C%2Fsvg%3E\"); left: 10px; right: auto;}.swiper-button-prev.swiper-button-black,.swiper-container-rtl .swiper-button-next.swiper-button-black {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M0%2C22L22%2C0l2.1%2C2.1L4.2%2C22l19.9%2C19.9L22%2C44L0%2C22L0%2C22L0%2C22z'%20fill%3D'%23000000'%2F%3E%3C%2Fsvg%3E\");}.swiper-button-prev.swiper-button-white,.swiper-container-rtl .swiper-button-next.swiper-button-white {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M0%2C22L22%2C0l2.1%2C2.1L4.2%2C22l19.9%2C19.9L22%2C44L0%2C22L0%2C22L0%2C22z'%20fill%3D'%23ffffff'%2F%3E%3C%2Fsvg%3E\");}.swiper-button-next,.swiper-container-rtl .swiper-button-prev {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M27%2C22L27%2C22L5%2C44l-2.1-2.1L22.8%2C22L2.9%2C2.1L5%2C0L27%2C22L27%2C22z'%20fill%3D'%23007aff'%2F%3E%3C%2Fsvg%3E\"); right: 10px; left: auto;}.swiper-button-next.swiper-button-black,.swiper-container-rtl .swiper-button-prev.swiper-button-black {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M27%2C22L27%2C22L5%2C44l-2.1-2.1L22.8%2C22L2.9%2C2.1L5%2C0L27%2C22L27%2C22z'%20fill%3D'%23000000'%2F%3E%3C%2Fsvg%3E\");}.swiper-button-next.swiper-button-white,.swiper-container-rtl .swiper-button-prev.swiper-button-white {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M27%2C22L27%2C22L5%2C44l-2.1-2.1L22.8%2C22L2.9%2C2.1L5%2C0L27%2C22L27%2C22z'%20fill%3D'%23ffffff'%2F%3E%3C%2Fsvg%3E\");}.swiper-pagination {position: absolute; text-align: center; -webkit-transition: 300ms; -moz-transition: 300ms; -o-transition: 300ms; transition: 300ms; -webkit-transform: translate3d(0, 0, 0); -ms-transform: translate3d(0, 0, 0); -o-transform: translate3d(0, 0, 0); transform: translate3d(0, 0, 0); z-index: 10;}.swiper-pagination.swiper-pagination-hidden {opacity: 0;}.swiper-pagination-fraction,.swiper-pagination-custom,.swiper-container-horizontal \x3e .swiper-pagination-bullets {bottom: 10px; left: 0; width: 100%;}.swiper-pagination-bullet {width: 8px; height: 8px; display: inline-block; border-radius: 100%; background: #000; opacity: 0.2;}button.swiper-pagination-bullet {border: none; margin: 0; padding: 0; box-shadow: none; -moz-appearance: none; -ms-appearance: none; -webkit-appearance: none; appearance: none;}.swiper-pagination-clickable .swiper-pagination-bullet {cursor: pointer;}.swiper-pagination-white .swiper-pagination-bullet {background: #fff;}.swiper-pagination-bullet-active {opacity: 1; background: #007aff;}.swiper-pagination-white .swiper-pagination-bullet-active {background: #fff;}.swiper-pagination-black .swiper-pagination-bullet-active {background: #000;}.swiper-container-vertical \x3e .swiper-pagination-bullets {right: 10px; top: 50%; -webkit-transform: translate3d(0px, -50%, 0); -moz-transform: translate3d(0px, -50%, 0); -o-transform: translate(0px, -50%); -ms-transform: translate3d(0px, -50%, 0); transform: translate3d(0px, -50%, 0);}.swiper-container-vertical \x3e .swiper-pagination-bullets .swiper-pagination-bullet {margin: 5px 0; display: block;}.swiper-container-horizontal \x3e .swiper-pagination-bullets .swiper-pagination-bullet {margin: 0 5px;}.swiper-pagination-progress {background: rgba(0, 0, 0, 0.25); position: absolute;}.swiper-pagination-progress .swiper-pagination-progressbar {background: #007aff; position: absolute; left: 0; top: 0; width: 100%; height: 100%; -webkit-transform: scale(0); -ms-transform: scale(0); -o-transform: scale(0); transform: scale(0); -webkit-transform-origin: left top; -moz-transform-origin: left top; -ms-transform-origin: left top; -o-transform-origin: left top; transform-origin: left top;}.swiper-container-rtl .swiper-pagination-progress .swiper-pagination-progressbar {-webkit-transform-origin: right top; -moz-transform-origin: right top; -ms-transform-origin: right top; -o-transform-origin: right top; transform-origin: right top;}.swiper-container-horizontal \x3e .swiper-pagination-progress {width: 100%; height: 4px; left: 0; top: 0;}.swiper-container-vertical \x3e .swiper-pagination-progress {width: 4px; height: 100%; left: 0; top: 0;}.swiper-pagination-progress.swiper-pagination-white {background: rgba(255, 255, 255, 0.5);}.swiper-pagination-progress.swiper-pagination-white .swiper-pagination-progressbar {background: #fff;}.swiper-pagination-progress.swiper-pagination-black .swiper-pagination-progressbar {background: #000;}.swiper-container-3d {-webkit-perspective: 1200px; -moz-perspective: 1200px; -o-perspective: 1200px; perspective: 1200px;}.swiper-container-3d .swiper-wrapper,.swiper-container-3d .swiper-slide,.swiper-container-3d .swiper-slide-shadow-left,.swiper-container-3d .swiper-slide-shadow-right,.swiper-container-3d .swiper-slide-shadow-top,.swiper-container-3d .swiper-slide-shadow-bottom,.swiper-container-3d .swiper-cube-shadow {-webkit-transform-style: preserve-3d; -moz-transform-style: preserve-3d; -ms-transform-style: preserve-3d; transform-style: preserve-3d;}.swiper-container-3d .swiper-slide-shadow-left,.swiper-container-3d .swiper-slide-shadow-right,.swiper-container-3d .swiper-slide-shadow-top,.swiper-container-3d .swiper-slide-shadow-bottom {position: absolute; left: 0; top: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10;}.swiper-container-3d .swiper-slide-shadow-left {background-image: -webkit-gradient(linear, left top, right top, from(rgba(0, 0, 0, 0.5)), to(rgba(0, 0, 0, 0))); background-image: -webkit-linear-gradient(right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -moz-linear-gradient(right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -o-linear-gradient(right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: linear-gradient(to left, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));}.swiper-container-3d .swiper-slide-shadow-right {background-image: -webkit-gradient(linear, right top, left top, from(rgba(0, 0, 0, 0.5)), to(rgba(0, 0, 0, 0))); background-image: -webkit-linear-gradient(left, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -moz-linear-gradient(left, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -o-linear-gradient(left, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: linear-gradient(to right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));}.swiper-container-3d .swiper-slide-shadow-top {background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, 0.5)), to(rgba(0, 0, 0, 0))); background-image: -webkit-linear-gradient(bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -moz-linear-gradient(bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -o-linear-gradient(bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: linear-gradient(to top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));}.swiper-container-3d .swiper-slide-shadow-bottom {background-image: -webkit-gradient(linear, left bottom, left top, from(rgba(0, 0, 0, 0.5)), to(rgba(0, 0, 0, 0))); background-image: -webkit-linear-gradient(top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -moz-linear-gradient(top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -o-linear-gradient(top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));}.swiper-container-coverflow .swiper-wrapper,.swiper-container-flip .swiper-wrapper {-ms-perspective: 1200px;}.swiper-container-cube,.swiper-container-flip {overflow: visible;}.swiper-container-cube .swiper-slide,.swiper-container-flip .swiper-slide {pointer-events: none; -webkit-backface-visibility: hidden; -moz-backface-visibility: hidden; -ms-backface-visibility: hidden; backface-visibility: hidden; z-index: 1;}.swiper-container-cube .swiper-slide .swiper-slide,.swiper-container-flip .swiper-slide .swiper-slide {pointer-events: none;}.swiper-container-cube .swiper-slide-active,.swiper-container-flip .swiper-slide-active,.swiper-container-cube .swiper-slide-active .swiper-slide-active,.swiper-container-flip .swiper-slide-active .swiper-slide-active {pointer-events: auto;}.swiper-container-cube .swiper-slide-shadow-top,.swiper-container-flip .swiper-slide-shadow-top,.swiper-container-cube .swiper-slide-shadow-bottom,.swiper-container-flip .swiper-slide-shadow-bottom,.swiper-container-cube .swiper-slide-shadow-left,.swiper-container-flip .swiper-slide-shadow-left,.swiper-container-cube .swiper-slide-shadow-right,.swiper-container-flip .swiper-slide-shadow-right {z-index: 0; -webkit-backface-visibility: hidden; -moz-backface-visibility: hidden; -ms-backface-visibility: hidden; backface-visibility: hidden;}.swiper-container-cube .swiper-slide {visibility: hidden; -webkit-transform-origin: 0 0; -moz-transform-origin: 0 0; -ms-transform-origin: 0 0; transform-origin: 0 0; width: 100%; height: 100%;}.swiper-container-cube.swiper-container-rtl .swiper-slide {-webkit-transform-origin: 100% 0; -moz-transform-origin: 100% 0; -ms-transform-origin: 100% 0; transform-origin: 100% 0;}.swiper-container-cube .swiper-slide-active,.swiper-container-cube .swiper-slide-next,.swiper-container-cube .swiper-slide-prev,.swiper-container-cube .swiper-slide-next + .swiper-slide {pointer-events: auto; visibility: visible;}.swiper-container-cube .swiper-cube-shadow {position: absolute; left: 0; bottom: 0px; width: 100%; height: 100%; background: #000; opacity: 0.6; -webkit-filter: blur(50px); filter: blur(50px); z-index: 0;}.swiper-container-fade.swiper-container-free-mode .swiper-slide {-webkit-transition-timing-function: ease-out; -moz-transition-timing-function: ease-out; -ms-transition-timing-function: ease-out; -o-transition-timing-function: ease-out; transition-timing-function: ease-out;}.swiper-container-fade .swiper-slide {pointer-events: none; -webkit-transition-property: opacity; -moz-transition-property: opacity; -o-transition-property: opacity; transition-property: opacity;}.swiper-container-fade .swiper-slide .swiper-slide {pointer-events: none;}.swiper-container-fade .swiper-slide-active,.swiper-container-fade .swiper-slide-active .swiper-slide-active {pointer-events: auto;}.swiper-zoom-container {width: 100%; height: 100%; display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-box-pack: center; -moz-box-pack: center; -ms-flex-pack: center; -webkit-justify-content: center; justify-content: center; -webkit-box-align: center; -moz-box-align: center; -ms-flex-align: center; -webkit-align-items: center; align-items: center; text-align: center;}.swiper-zoom-container \x3e img,.swiper-zoom-container \x3e svg,.swiper-zoom-container \x3e canvas {max-width: 100%; max-height: 100%; object-fit: contain;}.swiper-scrollbar {border-radius: 10px; position: relative; -ms-touch-action: none; background: rgba(0, 0, 0, 0.1);}.swiper-container-horizontal \x3e .swiper-scrollbar {position: absolute; left: 1%; bottom: 3px; z-index: 50; height: 5px; width: 98%;}.swiper-container-vertical \x3e .swiper-scrollbar {position: absolute; right: 3px; top: 1%; z-index: 50; width: 5px; height: 98%;}.swiper-scrollbar-drag {height: 100%; width: 100%; position: relative; background: rgba(0, 0, 0, 0.5); border-radius: 10px; left: 0; top: 0;}.swiper-scrollbar-cursor-drag {cursor: move;}.swiper-lazy-preloader {width: 42px; height: 42px; position: absolute; left: 50%; top: 50%; margin-left: -21px; margin-top: -21px; z-index: 10; -webkit-transform-origin: 50%; -moz-transform-origin: 50%; transform-origin: 50%; -webkit-animation: swiper-preloader-spin 1s steps(12, end) infinite; -moz-animation: swiper-preloader-spin 1s steps(12, end) infinite; animation: swiper-preloader-spin 1s steps(12, end) infinite;}.swiper-lazy-preloader:after {display: block; content: \"\"; width: 100%; height: 100%; background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20viewBox%3D'0%200%20120%20120'%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20xmlns%3Axlink%3D'http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink'%3E%3Cdefs%3E%3Cline%20id%3D'l'%20x1%3D'60'%20x2%3D'60'%20y1%3D'7'%20y2%3D'27'%20stroke%3D'%236c6c6c'%20stroke-width%3D'11'%20stroke-linecap%3D'round'%2F%3E%3C%2Fdefs%3E%3Cg%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(30%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(60%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(90%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(120%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(150%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.37'%20transform%3D'rotate(180%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.46'%20transform%3D'rotate(210%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.56'%20transform%3D'rotate(240%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.66'%20transform%3D'rotate(270%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.75'%20transform%3D'rotate(300%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.85'%20transform%3D'rotate(330%2060%2C60)'%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\"); background-position: 50%; -webkit-background-size: 100%; background-size: 100%; background-repeat: no-repeat;}.swiper-lazy-preloader-white:after {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20viewBox%3D'0%200%20120%20120'%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20xmlns%3Axlink%3D'http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink'%3E%3Cdefs%3E%3Cline%20id%3D'l'%20x1%3D'60'%20x2%3D'60'%20y1%3D'7'%20y2%3D'27'%20stroke%3D'%23fff'%20stroke-width%3D'11'%20stroke-linecap%3D'round'%2F%3E%3C%2Fdefs%3E%3Cg%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(30%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(60%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(90%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(120%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(150%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.37'%20transform%3D'rotate(180%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.46'%20transform%3D'rotate(210%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.56'%20transform%3D'rotate(240%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.66'%20transform%3D'rotate(270%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.75'%20transform%3D'rotate(300%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.85'%20transform%3D'rotate(330%2060%2C60)'%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\");}@-webkit-keyframes swiper-preloader-spin {100% {-webkit-transform: rotate(360deg);}}@keyframes swiper-preloader-spin {100% {transform: rotate(360deg);}}.jimu-widget-nearme-filter {width: 100%; height: 100%; position: relative;}.jimu-widget-nearme-filter .filter-list{height: 100%; overflow: auto; border-top: 1px solid #d7d7d7;} .jimu-widget-nearme-filter .filter-list,.jimu-widget-nearme-filter .filter-list li {margin: 0; padding: 0;}.jimu-widget-nearme-filter .filter-list li {list-style: none;}.jimu-widget-nearme-filter .filter-list .filter-item{border-bottom: 1px solid #d7d7d7; font-size: 12px; overflow: hidden; outline-offset: -2px;}.jimu-widget-nearme-filter .filter-list .filter-item .header{vertical-align: middle; padding-top: 12px; padding-bottom: 12px; min-height: 40px; cursor: pointer; position: relative;}.jimu-widget-nearme-filter .filter-list .filter-item .header:hover{background-color: #eee;}.jimu-widget-nearme-filter .filter-list .filter-item.config-parameters .header .item-title{font-family: 'Avenir Medium', Verdana, Geneva, sans-serif;}.jimu-widget-nearme-filter .filter-list .filter-item .body{display: none;}.jimu-widget-nearme-filter .filter-list .filter-item.config-parameters .body{display: block;}.jimu-widget-nearme-filter .filter-list .filter-item .header\x3e*{line-height: 25px; display: inline-block; vertical-align: middle; word-break: break-word;}.jimu-widget-nearme-filter .filter-list .filter-item .header\x3e.icon{vertical-align: top;}.jimu-widget-nearme-filter .filter-list .filter-item .header:after{content: \"\"; height: 100%; min-height: 16px; vertical-align: top; display: inline-block;}.jimu-widget-nearme-filter .filter-list .filter-item .header .icon{width: 25px; height: 25px; margin-right: 5px;}.jimu-rtl .jimu-widget-nearme-filter .filter-list .filter-item .header .icon{margin-right: 0; margin-left: 5px;}.jimu-widget-nearme-filter .filter-list .filter-item .header .icon img{width: 100%; height: 100%;}.jimu-widget-nearme-filter .filter-list .filter-item .header .cando{display: block; position: absolute; top: 14px; right: 0; width: 16px; height: 16px; content: ''; border-radius: 50%; text-indent: -9999em; background: none; border: 2px solid #d6d6d6;}.jimu-rtl .jimu-widget-nearme-filter .filter-list .filter-item .header .cando{left: 0; right: auto;}.jimu-widget-nearme-filter .filter-list .filter-item .header .doing{display: none; position: absolute; top: 14px; right: 0; width: 16px; height: 16px; border-radius: 50%; text-indent: -9999em; background: none; border: 2px solid #d6d6d6; border-left-color: #4A4A4A; -webkit-animation: load8 1.1s infinite linear; -moz-animation: load8 1.1s infinite linear; -ms-animation: load8 1.1s infinite linear; -o-animation: load8 1.1s infinite linear; animation: load8 1.1s infinite linear; -webkit-transform: translateZ(0); -moz-transform: translateZ(0); -ms-transform: translateZ(0); -o-transform: translateZ(0); transform: translateZ(0);}.jimu-rtl .jimu-widget-nearme-filter .filter-list .filter-item .header .doing{left: 0; right: auto;}.jimu-widget-nearme-filter .filter-list .filter-item .header .done{display: none; position: absolute; top: 14px; right: 0; width: 16px; height: 16px; border-radius: 50%; text-indent: -9999em; background: url(\"images/done.svg\") no-repeat center;}.jimu-rtl .jimu-widget-nearme-filter .filter-list .filter-item .header .done{left: 0; right: auto;}.jimu-widget-nearme-filter .filter-list .filter-item.requesting .header .cando,.jimu-widget-nearme-filter .filter-list .filter-item.applying .header .cando{display: none;}.jimu-widget-nearme-filter .filter-list .filter-item.requesting .header .doing,.jimu-widget-nearme-filter .filter-list .filter-item.applying .header .doing{display: block;}.jimu-widget-nearme-filter .filter-list .filter-item.requesting .header .done,.jimu-widget-nearme-filter .filter-list .filter-item.applying .header .done{display: none;}.jimu-widget-nearme-filter .filter-list .filter-item.applied .header .cando{display: none;}.jimu-widget-nearme-filter .filter-list .filter-item.applied .header .doing{display: none;}.jimu-widget-nearme-filter .filter-list .filter-item.applied .header .done{display: block;}.jimu-widget-nearme-filter .filter-list .filter-item .header .arrow{content: ''; border-radius: 50%; width: 16px; height: 25px; top: 12px; text-indent: -9999em; background: url(\"images/arrow_normal.svg\") no-repeat center; z-index: 10;}.jimu-widget-nearme-filter .filter-list .filter-item .header .arrow:hover{background: url(\"images/arrow_hover.svg\") no-repeat center;}.jimu-widget-nearme-filter .filter-list .filter-item.config-parameters .header .arrow{transform: rotate(90deg);}.jimu-widget-nearme-filter .filter-list .filter-item.not-has-ask-for-value .header .arrow{background: transparent !important;}.jimu-widget-nearme-filter .filter-list .filter-item .body .parameters{margin: 0 30px;}.jimu-widget-nearme-filter .filter-list .filter-item .body .jimu-btn{background: #fff; border-radius: 0; width: 82px; border: 1px solid #c7c7c7; color: #000; font-size: 12px; margin-bottom: 15px;}.jimu-widget-nearme-filter .filter-list .filter-item .body .jimu-btn:hover{border: 1px solid #000;}.jimu-widget-nearme-filter .jimu-loading-shelter .loading-container{width: auto;}.jimu-widget-nearme-filter .esriCTGroupFilterLayerName{vertical-align: middle; min-height: 40px; font-weight: bold; font-size: 14px; padding: 12px; border-bottom: 1px solid #d7d7d7;}@-webkit-keyframes load8 {0% {-webkit-transform: rotate(0deg); transform: rotate(0deg);} 100% {-webkit-transform: rotate(360deg); transform: rotate(360deg);}}@-moz-keyframes load8 {0% {-moz-transform: rotate(0deg); transform: rotate(0deg);} 100% {-moz-transform: rotate(360deg); transform: rotate(360deg);}}@-ms-keyframes load8 {0% {-ms-transform: rotate(0deg); transform: rotate(0deg);} 100% {-ms-transform: rotate(360deg); transform: rotate(360deg);}}@keyframes load8 {0% {-webkit-transform: rotate(0deg); -ms-transform: rotate(0deg); -moz-transform: rotate(0deg); transform: rotate(0deg);} 100% {-webkit-transform: rotate(360deg); -ms-transform: rotate(360deg); -moz-transform: rotate(360deg); transform: rotate(360deg);}}.jimu-widget-nearme .swiper-container {width: 100%; height: 250px;}.jimu-widget-nearme .swiper-slide {text-align: center; font-size: 18px; background: #fff; display: -webkit-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-box-pack: center; -ms-flex-pack: center; -webkit-justify-content: center; justify-content: center; -webkit-box-align: center; -ms-flex-align: center; -webkit-align-items: center; align-items: center;}.jimu-widget-nearme .swiper-slide img {max-width: 100%; height: auto;}.jimu-widget-nearme .swiper-slide .chart {width: 200px; height: 200px;}.jimu-widget-nearme .swiper-pagination-bullet:focus {opacity: 1 !important;}.esriCTNearMeContentPanel{padding: 15px 0px !important; overflow-y: hidden !important;}.esriCTContentPanelNoPadding{padding: 0 0 !important;}.jimu-widget-nearme{min-width: 222px; height: 100%; overflow-x: hidden;}.jimu-widget-nearme .esriCTHidden{display: none;}.jimu-widget-nearme .esriCTWidgetMainNode{min-height: 200px;}.jimu-widget-nearme .esriCTWidgetErrorNode{padding: 0px 14px;}.jimu-widget-nearme .mediaSection{padding-bottom: 10px; clear: both;}.jimu-widget-nearme .esriCTDistanceToLocation{line-height: 25px; margin-top: 10px; background-color: #d9dde0; text-align: center;}.jimu-widget-nearme .simpleDirections .esriSearchSourceContainer{display: none;}.jimu-widget-nearme .simpleDirections .esriStopsContainer{height: 0px; margin: 0px;}.jimu-widget-nearme .getDirectionsBtnContainer{display: none;}.jimu-widget-nearme .esriStopsTableContainer{display: none;}.jimu-widget-nearme .esriStopsButtons{display: none;}.jimu-widget-nearme .simpleDirections{margin-top: 20px;}.jimu-widget-nearme .simpleDirections .savePrintBtnContainer{position: relative; top: 15px; left: 90%; margin: 0px; z-index: 1;}.jimu-launchpad-panel .jimu-widget-nearme .simpleDirections .savePrintBtnContainer{top: 10px;}.jimu-launchpad-panel .jimu-widget-nearme .simpleDirections .esriStopsGetDirectionsContainer{padding-top: 0; margin: 0px 10px;}.jimu-widget-nearme .simpleDirections .esriResultsSummary{padding: 0 40px;}.jimu-widget-nearme .simpleDirections .esriResultsLoading .esriResultsContainer{display: none;}.jimu-widget-nearme .esriCTSliderDiv{height: 60px; padding-top: 10px; clear: both;}.jimu-widget-nearme .esriCTOverrideSliderDiv{padding-top: 2px;}.jimu-widget-nearme .esriCTSliderText{font-size: 12px; color: #000000; font-weight: normal;}.jimu-widget-nearme .esriCTHorizantalSlider{width: 100%; margin-top: 15px;}.jimu-widget-nearme .esriCTSliderValuesDiv{width: 100%; margin-top: 8px;}.jimu-widget-nearme .esriCTSliderMinValueDiv{float: left; margin-left: 2px;}.jimu-widget-nearme .esriCTSliderMaxValueDiv{float: right; margin-right: 2px;}.claro .jimu-widget-nearme .dijitSlider {background: transparent; border: 0 none; -webkit-border-radius: 3px; border-radius: 3px; padding: 0;}.claro .jimu-widget-nearme .dijitSliderBar {border-style: solid; outline: 1px;}.claro .jimu-widget-nearme .dijitRuleLabelsContainer {color: #2b2e34;}.claro .jimu-widget-nearme .dijitSliderDisabled {opacity: 0.65; -ms-filter: \"progid:DXImageTransform.Microsoft.Alpha(Opacity\x3d65)\"; filter: alpha(opacity\x3d65);}.claro .jimu-widget-nearme .dijitRuleLabelsContainerH {padding: 8px 0 !important; color: #878787 !important;}.claro .jimu-widget-nearme .dijitSliderBarH,.claro .jimu-widget-nearme .dijitSliderBumperH {height: 4px;}.claro .jimu-widget-nearme .dijitSlider .dijitSliderLeftBumper {-webkit-border-radius: 2px 0 0 2px; border-radius: 2px 0 0 2px; border-width: 1px 0 1px 1px; margin-left: 4px;}.claro .jimu-widget-nearme .dijitSlider .dijitSliderRightBumper {-webkit-border-radius: 0 2px 2px 0; border-radius: 0 2px 2px 0; border-width: 1px 1px 1px 0; margin-left: -2px; margin-right: 4px;}.claro .jimu-widget-nearme .dijitSlider .dijitSliderProgressBarH {border-color: #878787; background-color: #878787; background-image: none; -webkit-box-shadow: none; box-shadow: none;}.claro .jimu-widget-nearme .dijitSlider .dijitSliderLeftBumper {border-color: #878787; background-color: #878787; background-image: none; -webkit-box-shadow: none; box-shadow: none; -webkit-border-radius: 2px 0 0 2px; border-radius: 2px 0 0 2px;}.claro .jimu-widget-nearme .dijitSlider .dijitSliderRemainingBarH,.claro .jimu-widget-nearme .dijitSlider .dijitSliderRightBumper {border-color: #ebebeb; background-color: #ebebeb; -webkit-border-radius: 2px; border-radius: 2px;}.claro .jimu-widget-nearme .dijitSliderHover .dijitSliderProgressBarH,.claro .jimu-widget-nearme .dijitSliderHover .dijitSliderLeftBumper {border-color: #6e6e6e; background-color: #6e6e6e; background-image: none; -webkit-box-shadow: none; box-shadow: none;}.claro .jimu-widget-nearme .dijitSliderFocused .dijitSliderProgressBarH,.claro .jimu-widget-nearme .dijitSliderFocused .dijitSliderLeftBumper {border-color: #878787;}.claro .jimu-widget-nearme .dijitSliderFocused .dijitSliderRemainingBarH,.claro .jimu-widget-nearme .dijitSliderFocused .dijitSliderRightBumper {border-color: #ebebeb; background-color: #ebebeb; -webkit-box-shadow: none; box-shadow: none;}.claro .jimu-widget-nearme .dijitSliderRtl .dijitSliderLeftBumper,.claro .jimu-widget-nearme .dijitSliderRtl .dijitSliderRightBumper{display: none;}.claro .jimu-widget-nearme .dijitSliderImageHandle {background: #878787; -webkit-border-radius: 50%; border-radius: 50%; border: 0 none; width: 16px; height: 16px; margin-top: -2px; position: absolute;}.claro .jimu-widget-nearme .dijitSliderImageHandle:after {content: \"\"; display: block; background: #ffffff; -webkit-border-radius: 50%; border-radius: 50%; height: 8px; width: 8px; left: 4px; top: 4px; position: absolute;}.claro .jimu-widget-nearme .dijitSliderDisabled.dijitSliderFocused .dijitSliderImageHandle:after {display: none; outline: none;}.claro .jimu-widget-nearme .dijitSliderDecrementIconH,.claro .jimu-widget-nearme .dijitSliderIncrementIconH,.claro .jimu-widget-nearme .jimu-widget-nearme .dijitSliderDecrementIconH:hover,.claro .jimu-widget-nearme .dijitSliderIncrementIconH:hover{padding: 0; height: 20px; width: 20px; background-color: transparent; border: 0 none;}.jimu-widget-nearme .esriCTSearchDiv{float: left;}.jimu-widget-nearme .esriCTSearchDiv .arcgisSearch{float: left; width: 100% !important;}.jimu-widget-nearme .esriCTSearchContainer{width: 100%; height: 35px; float: left; clear: both;}.jimu-widget-nearme .arcgisSearch .searchGroup .searchInput{width: 170px;}.jimu-widget-nearme .arcgisSearch .searchBtn{padding: 6px;}.jimu-widget-search .arcgisSearch .searchGroup .searchInputGroup .searchInput{width: auto;}.jimu-widget-nearme .esriCTSearchOuterContainer{width: calc(100% - 40px); margin: 0 auto;}.jimu-widget-nearme .esriCTSearchHeader{padding: 2px 2px 10px 2px; font-size: 12px; color: #000000; font-weight: normal; outline-offset: -2px;}.jimu-widget-nearme .arcgisSearch .searchToggle:focus{outline: 2px solid #18acc2;}.jimu-launchpad-panel .jimu-widget-nearme .arcgisSearch .searchClose, .arcgisSearch .searchSpinner{height: 28px;}.jimu-widget-nearme .arcgisSearch .searchMenu{max-height: 250px;}.jimu-widget-nearme .esriCTSelectLocationDiv{margin: 0px 0px 0px 12px; float: right;}.jimu-widget-nearme .esriCTSelectLocation{background-image: url(\"../images/select-location.png\");}.jimu-widget-nearme .esriCTSelectLocationActive{background-image: url(\"../images/select-location-active.png\"); background-color: #57585A;}.jimu-widget-nearme .esriCTImgButtons{cursor: pointer; width: 32px; height: 34px; border: 1px solid #57585A; border-radius: 4px; background-size: 20px; background-position: center center; background-repeat: no-repeat;}.jimu-widget-nearme .esriCTCurrentLocationDiv{margin: 0px 0px 0px 12px; float: left;}.jimu-widget-nearme .esriCTCurrentLocation .LocateButton .zoomLocateButton{background-image: url(\"../images/current-location.png\"); background-color: transparent; background-size: 20px; background-position: center center; background-repeat: no-repeat;}.esriRtl .jimu-widget-nearme .esriCTCurrentLocationDiv{margin: 0px 12px 12px 0px;float: right;}.jimu-widget-nearme .jimu-loading-indicator{z-index: 100;}.jimu-widget-nearme .esriCTListOuterContainer{margin-top: 10px;}.jimu-widget-nearme .esriCTItemListMainContainer{width: 100%; right: 0px; min-height: 80px; left: 0px; height: calc(100% - 188px); position: absolute; padding-top: 5px;}.jimu-widget-nearme .esriCTFilterListMainContainer{width: 100%; right: 0px; min-height: 80px; left: 0px; height: calc(100% - 188px); position: absolute;}.jimu-widget-nearme .esriCTItemListOverrideMainContainer{height: calc(100% - 80px);}.jimu-widget-nearme .esriCTItemListOverrideMainContainerForBothBufferOptions{height: calc(100% - 160px);}.jimu-widget-nearme .esriCTItemlList{width: 100%; border-bottom: 1px solid #DDDDDD; min-height: 36px; cursor: pointer; outline-offset: -1px;}.jimu-widget-nearme .esriCTItemlList:focus{font-weight: bolder; outline: 2px solid #18acc2;}.jimu-widget-nearme .esriCTItemName{white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 35px; padding: 0px 10px 0px 20px;}.jimu-widget-nearme .esriCTPanelHeader .esriCTItemName{padding: 0px 20px 0px 0px; font-size: 12px; color: #3e3e3e;}.jimu-widget-nearme .esriCTItemRightArrow, .jimu-widget-nearme .esriCTItemLeftArrow{width: 10px; height: 20px; background-repeat: no-repeat; background-color: #3e3e3e; background-position: center center;}.jimu-widget-nearme .esriCTItemRightArrow{margin: 7px 20px 0px 0px;}.jimu-widget-nearme .esriCTItemLeftArrow{margin: 7px 10px 0px 0px;}.jimu-widget-nearme .esriCTItemCount{float: right; margin: 0px 20px 0px 0px; line-height: 35px; height: 35px; text-align: right; overflow: hidden; max-width: 100px;}.jimu-widget-nearme .esriCTLoadingIcon{background-image: url('../images/loading-icon.gif'); background-position: center center; background-repeat: no-repeat; height: 20px; width: 20px; margin-top: 7px;}.jimu-widget-nearme .esriCTItemRightArrow{background-image: url('../images/right-arrow.png'); float: right;}.jimu-widget-nearme .esriCTItemLeftArrow{background-image: url('../images/left-arrow.png'); float: left;}.esriCTDisabled{cursor: default !important;}.esriCTDisabled .esriCTItemRightArrow{background-color: #d8d8d8;}.jimu-widget-nearme .esriCTBackButtonText{float: left; height: 35px; line-height: 35px; text-overflow: ellipsis; white-space: nowrap; max-width: 100px; overflow: hidden;}.jimu-widget-nearme .esriCTBackButton{float: left;}.jimu-widget-nearme .esriCTPanelHeader{font-weight: bold; padding-left: 20px; padding-right: 20px;}.esriCTDirectionInfoPanel .esriCTItemlList{border-bottom: none;}.esriCTFeatureList .esriCTItemRightArrow, .esriCTLayerList .esriCTItemLeftArrow, .esriCTDirectionInfoPanel .esriCTItemRightArrow, .esriCTDirectionInfoPanel .esriCTItemCount{display: none;}.esriCTFeatureListItem .esriCTItemCount{display: block;}.esriCTFeatureListItem .esriCTItemLeftArrow, .esriCTFeatureListItem .esriCTBackButtonText{display: none;}.jimu-widget-nearme .esriCTLayerList, .jimu-widget-nearme .esriCTFeatureList, .jimu-widget-nearme .esriCTDirectionInfoPanel{border-top: 1px solid #464646; position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; display: none;}.jimu-widget-nearme .esriCTNoFeatureFound{height: 32px; margin: 5px 16px; line-height: 30px;}.jimu-widget-nearme .esriCTFeatureListContent{height: calc(100% - 30px); overflow: auto;}.jimu-widget-nearme .esriCTLayerList{overflow: auto;}.jimu-widget-nearme .esriCTAttributeSymbolWrapper{margin: 5px; display: inline-block;}.jimu-widget-nearme .esriCTAttributeSymbolContainer{float: left; margin-right : 5px;}.jimu-widget-nearme .esriCTItemListMainContainer .editSummarySection{display: none;}.jimu-widget-nearme .jimu-tab \x3e .jimu-viewstack{position: relative; top: 0px; height: 100%;}.jimu-widget-nearme .dijitContentPane{overflow: auto; padding: 0px 20px; -webkit-overflow-scrolling: auto;}.jimu-widget-nearme .esriCTPopupInfo{padding: 20px 0px !important; width: 100% !important; height: auto !important;}.jimu-widget-nearme .jimu-tab{height: calc(100% - 56px); min-height: 80px; margin-top: 2px;}.jimu-widget-nearme .esriCTOverrideHeight{height: calc(100% - 46px);}.jimu-widget-nearme .esriCTFeatureInfo{height: calc(100% - 35px); min-height: 80px;}.jimu-widget-nearme .esriCTFeatureInfo:focus,.jimu-widget-nearme .esriCTInfoPanelFocus:focus{outline: 2px solid #18acc2;}.jimu-widget-nearme .esriCTBorderBottom{border-bottom: 1px solid #464646;}.jimu-widget-nearme .esriCTTopBorder{border-top: 1px solid #464646;}.jimu-widget-nearme .esriCTThumbnailContainer{margin: 2px;}.jimu-widget-nearme .esriCTAttachmentImg{cursor: pointer; position: absolute; margin: auto; top: 0; bottom: 0; right: 0; left: 0;}.jimu-widget-nearme .esriCTNonImageAttachmentImg{cursor: pointer; float: left;}.jimu-widget-nearme .esriCTImageFormatDiv{height: 18px; width: 50px; float: left; background-color: #C4BD97; text-align: center; line-height: 18px; color: #fff;}.jimu-widget-nearme .esriCTNonImageAttachmentContainer{height: 58px; width: 50px; float: left; margin: 0 10px 10px 2px; cursor: pointer;}.jimu-widget-nearme .esriCTImageLoader{cursor: default; display: block; background-position: center center; background-image: url(../images/image-loader.gif); background-repeat: no-repeat; width: 90px; height: 60px;}.jimu-widget-nearme .esriCTAutoHeight{height: auto;}.jimu-widget-nearme .esriViewPopup .break{display: none;}.esriRtl .jimu-widget-nearme .esriCTNonImageAttachmentImg{float: right;}.esriRtl .jimu-widget-nearme .esriCTImageFormatDiv{float: right;}.esriRtl .jimu-widget-nearme .esriCTNonImageAttachmentContainer{margin: 0 2px 10px 10px; float: right;}.esriRtl .jimu-widget-nearme .esriCTSliderMinValueDiv{float: right; margin-right: 2px;}.esriRtl .jimu-widget-nearme .esriCTSliderMaxValueDiv{float: left; margin-left: 2px;}.esriRtl .jimu-widget-nearme .esriCTItemName{padding: 0px 20px 0px 10px;}.esriRtl .jimu-widget-nearme .esriCTPanelHeader .esriCTItemName{padding: 0px 0px 0px 20px;}.esriRtl .jimu-widget-nearme .esriCTItemCount{float: left; margin: 0px 0px 0px 20px;}.esriRtl .jimu-widget-nearme .esriCTItemRightArrow{background-image: url('../images/left-arrow.png'); float: left; margin: 7px 0 0 20px;}.esriRtl .jimu-widget-nearme .esriCTBackButton{float: right;}.esriRtl .jimu-widget-nearme .esriCTItemLeftArrow{background-image: url('../images/right-arrow.png'); margin: 7px 0px 0px 10px;}.esriRtl .jimu-widget-nearme .simpleDirections .savePrintBtnContainer{left: 0px; right: 90%;}.esriRtl .jimu-widget-nearme .esriCTSearchDiv, .esriRtl .jimu-widget-nearme .esriCTAttributeSymbolContainer{float: right;}.esriRtl .jimu-widget-nearme .esriCTSelectLocationDiv{margin: 0px 0px 10px 0px; float: left;}.jimu-widget-nearme .esriCTProximityParent {position: relative; right: 65px; float: right; bottom: -20px;}.esriRtl .jimu-widget-nearme .esriCTProximityParent {right: inherit; left: 65px; float: left;}.jimu-widget-nearme .esriCTProximityIconContainer {position: absolute; height: 40px; width: 40px; background: #fffdfd; border-radius: 25px; box-shadow: 0px 0px 2px 2px #d4d4d4; cursor: pointer; z-index: 1; bottom: 0;}.jimu-widget-nearme .esriCTProximityIcon {background-image: url(../images/proximity.png); background-repeat: no-repeat; background-position: center center; background-color: gray; height: 24px; width: 24px; background-size: 24px 24px; margin: 8px;}.jimu-widget-nearme .esriCTFilterIconContainer {position: absolute; right: 25px; height: 40px; width: 40px; background: #fffdfd; border-radius: 25px; box-shadow: 0px 0px 2px 2px #d4d4d4; cursor: pointer; z-index: 1; bottom: 0;}.esriRtl .jimu-widget-nearme .esriCTFilterIconContainer {right: inherit; left: 25px;}.jimu-widget-nearme .esriCTFilterIcon {background-image: url(../images/filter.png); background-repeat: no-repeat; background-position: center center; background-color: gray; height: 25px; width: 25px; background-size: 25px 25px; margin: 8px;}.esriCTMapTooltip{width: 100px; word-wrap: break-word; border: 1px solid #7EABCD; background-color: white; padding: 5px; font-size: 9pt; z-index: 9999; -o-border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; border-radius: 4px;}.jimu-widget-nearme .esriCTClearAllFilter {background-image: url(../images/clear-all-filter.png); background-repeat: no-repeat; background-position: center center; background-color: #d6d6d6; height: 20px; width: 20px; background-size: 20px 20px; cursor: default; float: right;}.esriRtl .jimu-widget-nearme .esriCTClearAllFilter {float: left;}.jimu-widget-nearme .esriCTClearAllFilterActive {background-color: #18acc2; cursor: pointer;}.jimu-widget-nearme .esriCTFilterBackDiv {width: calc(100% - 30px); float: left;}.esriRtl .jimu-widget-nearme .esriCTFilterBackDiv {float: right;}.dart-panel .jimu-widget-nearme .esriCTDistanceToLocation {background-color: rgba(0, 0, 0, 0.2) !important;}.dart-panel .jimu-widget-nearme .esriCTImgButtons {background-color: darkgray;}.dart-panel .arcgisSearch .searchGroup .searchInput {padding: 6px 24px 6px 12px !important;}.esriRtl .dart-panel .jimu-widget-nearme .arcgisSearch .searchGroup .searchInput {padding: 6px 12px 6px 24px !important;}.dart-panel .jimu-widget-nearme .arcgisSearch .searchMenu{background-color: #373737 !important;}.dart-panel .jimu-widget-nearme .arcgisSearch .searchMenu li:hover, .dart-panel .jimu-widget-nearme .arcgisSearch .searchMenu li:focus {background-color: #232323 !important;}.dart-panel .jimu-widget-nearme .simpleDirections .esriResultsSummary {background-color: darkgray !important;} .dart-panel .jimu-widget-nearme .simpleDirections .esriRouteLength {background: darkgray !important;}.jimu-widget-nearme .esriCTBufferTextboxParent{width: 100%; height: 40px; margin-top: 12px;}.jimu-widget-nearme .esriCTBufferTextboxText {white-space: nowrap; overflow: hidden; text-overflow: ellipsis; float: left; line-height: 30px;}.esriRtl .jimu-widget-nearme .esriCTBufferTextboxText{float: right;}.jimu-widget-nearme .esriCTBufferTextbox{width: 30%; float: left; margin-left: 8px;}.esriRtl .jimu-widget-nearme .esriCTBufferTextbox{float: right; margin-right: 8px;}.jimu-widget-nearme .esriCTapplyFilterArrowNodeParent{outline-offset: 2px; height: 15px; width: 80%; display: inline-block;}.jimu-widget-nearme .esriCTFliterListCheckbox{margin: 0px 22px;}.DashboardTheme .jimu-widget-nearme .esriCTItemName {color: white;}.DashboardTheme .jimu-widget-nearme .esriCTItemCount{color: white;}.DashboardTheme .jimu-widget-nearme .esriCTDistanceToLocation{color: #000000;}.DashboardTheme.light .jimu-widget-nearme .esriCTItemName{color: #000000;}.DashboardTheme.light .jimu-widget-nearme .esriCTItemCount{color: #000000;}.DashboardTheme .jimu-widget-nearme .esriCTClearAllFilter{background-image: url(../images/clear-all-filter-dark.png);}.DashboardTheme.light .jimu-widget-nearme .esriCTClearAllFilter{background-image: url(../images/clear-all-filter.png);}.DashboardTheme .jimu-widget-nearme .esriCTApplyFilterArrowNode{background-image: url(../images/filter-arrow-dark.png); background-color: #fff;}.DashboardTheme .jimu-widget-nearme .esriCTApplyFilterArrowUp{background-image: url(../images/filter-arrow-dark-up.png); background-color: #fff;}.DashboardTheme.light .jimu-widget-nearme .esriCTApplyFilterArrowNode{background-image: url(../images/filter-arrow.png); background-color: #3e3e3e;}.DashboardTheme.light .jimu-widget-nearme .esriCTApplyFilterArrowUp{background-image: url(../images/filter-arrow-up.png); background-color: #3e3e3e;}.DashboardTheme .jimu-widget-nearme-filter .filter-list .filter-item .header:hover{color: #222;}.jimu-widget-nearme .esriCTApplyFilterDiv{width: 100%; clear: both;}.jimu-widget-nearme .esriCTApplyFilterDivSpacing{margin-top: 15px;}.jimu-widget-nearme .esriCTFilterToApply{max-width: calc(100% - 40px); float: left; cursor: pointer;}.esriRtl .jimu-widget-nearme .esriCTFilterToApply{float: right;}.jimu-widget-nearme .esriCTApplyFilterArrowNode{background-image: url('../images/filter-arrow.png'); width: 18px; height: 18px; background-repeat: no-repeat; background-color: #3e3e3e; background-position: center center; float: left; margin: 0 5px; cursor: pointer;}.esriRtl .jimu-widget-nearme .esriCTApplyFilterArrowNode{float: right; margin: 3px 5px;}.jimu-widget-nearme .esriCTApplyFilterArrowUp{background-image: url('../images/filter-arrow-up.png');}",
"*now":function(V){V(['dojo/i18n!*preload*widgets/NearMe/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidget dojo/on dojo/dom-construct dojo/dom-class dojo/query dojo/keys dojo/_base/lang dojo/_base/array ./utils ./search ./item-list ./filter-list jimu/portalUtils esri/layers/GraphicsLayer esri/graphic esri/tasks/GeometryService esri/tasks/BufferParameters dijit/form/HorizontalSlider dojo/dom-attr dojo/string dojo/dom-geometry dojo/dom-style esri/symbols/jsonUtils esri/tasks/locator esri/geometry/webMercatorUtils esri/InfoTemplate jimu/dijit/Message jimu/dijit/LoadingIndicator dijit/registry dojo/Deferred dojo/promise/all esri/tasks/query esri/tasks/QueryTask esri/request esri/geometry/scaleUtils esri/geometry/Extent jimu/dijit/EditorXssFilter esri/SpatialReference esri/dijit/LocateButton jimu/utils dijit/focus dijit/form/NumberTextBox".split(" "),function(V,
W,t,O,Z,P,F,x,d,e,l,n,q,k,w,I,H,v,G,Q,T,M,R,C,a,B,da,la,ma,pa,N,oa,na,J,y,A,ea,ta,qa,wa,Ba,b,f,D){return V([t,W],{baseClass:"jimu-widget-nearme",_highlightGraphicsLayer:null,_loading:null,_windowResizeTimer:null,_sliderChangeTimer:null,_mapTooltip:null,_searchContainerNodeElement:null,_locatorInstance:null,_searchedLocation:null,_slider:null,_bufferParams:null,_mapClickHandler:null,_mapMoveHandler:null,_itemListObject:null,_isValidConfig:null,appUtils:null,_hasMulitpleSourcesInSearch:!0,_searchInstance:null,
_attributeSearchLayers:[],_doAttributeSearchOn:[],selectedThemeColor:"#000",_geocoderSpatialRef:null,_lastFocusNodes:{mainScreen:null,layerList:null,featureList:null,featureInfo:null,filterList:null},postCreate:function(){this.config.hasOwnProperty("showImageGallery")||(this.config.showImageGallery=!0);this.config.hasOwnProperty("showFeaturesCount")||(this.config.showFeaturesCount=!0);this.config.hasOwnProperty("bufferInputOption")||(this.config.bufferInputOption="slider");this.editorXssFilter=qa.getInstance();
this._bufferParams=null;this.selectedThemeColor="#000";this.openAtStartAysn=!0;this._getSelectedThemeColor();this.config.hasOwnProperty("enableDirection")||(this.config.enableDirection=this.map.webMapResponse.itemInfo.itemData&&this.map.webMapResponse.itemInfo.itemData.applicationProperties&&this.map.webMapResponse.itemInfo.itemData.applicationProperties.viewing&&this.map.webMapResponse.itemInfo.itemData.applicationProperties.viewing.routing&&this.map.webMapResponse.itemInfo.itemData.applicationProperties.viewing.routing.enabled?
!0:!1);this.config.routeService&&(this.config.routeService=this._replaceRouteTaskUrlWithAppProxy(this.config.routeService));this._attributeSearchLayers=[];this._doAttributeSearchOn=[];(!this.config.filterSettings||!this.config.filterSettings.filters||0>=this.config.filterSettings.filters.length)&&P.add(this.applyFilterNode,"esriCTHidden")},_setTheme:function(){var r;if("LaunchpadTheme"===this.appConfig.theme.name)b.loadStyleLink(this.baseClass+"launchpadOverrideCSS",this.folderUrl+"/css/launchpadTheme.css",
null);else if(r=document.getElementById(this.baseClass+"launchpadOverrideCSS"))r.disabled=!0},startup:function(){P.add(this.domNode.parentElement,"esriCTNearMeContentPanel");this.appConfig.portalUrl&&""!==d.trim(this.appConfig.portalUrl)?w.getPortalSelfInfo(this.appConfig.portalUrl).then(d.hitch(this,function(r){this.config.helperServices=r&&r.helperServices;this.config.helperServices&&this.config.helperServices.geometry?(this._isValidConfig=this._validateConfig())?(this._setTheme(),this.appUtils=
new l({map:this.map}),this._updateConfig(),P.remove(this.widgetMainNode,"esriCTHidden"),P.add(this.widgetErrorNode,"esriCTHidden"),this._initWidgetComponents(),this.config.showLocationTool?P.remove(this.selectLocation,"esriCTHidden"):this._mapClickHandler||this._connectMapEventHandler(),this._onWindowResize()):(P.add(this.widgetMainNode,"esriCTHidden"),P.remove(this.widgetErrorNode,"esriCTHidden")):this._displayWidgetError(this.nls.geometryServicesNotFound)}),d.hitch(this,function(){this._displayWidgetError(this.nls.geometryServicesNotFound)})):
this._displayWidgetError(this.nls.geometryServicesNotFound)},_replaceRouteTaskUrlWithAppProxy:function(r){var X=r;!window.isBuilder&&!this.appConfig.mode&&this.appConfig.appProxies&&0<this.appConfig.appProxies.length&&e.some(this.appConfig.appProxies,function(ba){if(r===ba.sourceUrl)return X=ba.proxyUrl,!0});return X},_displayWidgetError:function(r){this.widgetErrorNode&&T.set(this.widgetErrorNode,"innerHTML",r);this._showMessage(r)},_storeLayersVisibility:function(){if(this.config&&this.config.searchLayers)for(var r=
0;r<this.config.searchLayers.length;r++){var X=this.config.searchLayers[r].id,ba=null;0<X.indexOf("_")&&(ba=X.substring(0,X.lastIndexOf("_")));this.map._layers[X]?this.config.searchLayers[r].visibility=this.map._layers[X].visible:ba&&this.map._layers[ba]&&this.map._layers[ba].visibleLayers&&(X=this.config.searchLayers[r].url.split("/"),X=X[X.length-1],ba=e.indexOf(this.map._layers[ba].visibleLayers,parseInt(X,10)),this.config.searchLayers[r].visibility=-1===ba?!1:!0)}},onOpen:function(){this._isValidConfig&&
(this._storeLayersVisibility(),this._onWindowResize(),this.config.showLocationTool||this._connectMapEventHandler(),this._slider&&this._slider.set("value",this.config.defaultBufferDistance),b.isAutoFocusFirstNodeWidget(this)&&b.focusFirstFocusNode(this.domNode))},resize:function(){this._onWindowResize()},destroy:function(){this._destroyWidgetData();this.inherited(arguments)},onClose:function(){this._isValidConfig&&(this._disconnectMapEventHandler(),this._searchInstance&&this._searchInstance.clearSearchText(),
this._searchedLocation&&this._itemListObject&&(this._itemListObject.resetAllFilters(),this._clearResults()))},onDeActive:function(){this._isValidConfig&&this.config.showLocationTool&&this._disconnectMapEventHandler()},onActive:function(){this._isValidConfig&&this.config.selectedSearchLayerOnly&&this._storeLayersVisibility()},_destroyWidgetData:function(){this._itemListObject&&(this._itemListObject.removeGraphicsLayer(),this._itemListObject.resetAllFilters(),this._itemListObject.destroy(),this._itemListObject=
null);this._clearResults()},_validateConfig:function(){if(!this.config.searchLayers||!this.config.searchLayers.length)return this._displayWidgetError(this.nls.invalidSearchLayerMsg),!1;this.config.symbols.polygonSymbol||(this.config.symbols.polygonSymbol={color:[255,189,1,0],outline:{color:[255,189,1,255],width:2.25,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"});this.config.symbols.polylineSymbol||(this.config.symbols.polylineSymbol={color:[21,99,184,255],width:3.75,type:"esriSLS",
style:"esriSLSSolid"});return!0},_updateConfig:function(){var r;for(r=0;r<this.config.searchLayers.length;r++)d.mixin(this.config.searchLayers[r],this.appUtils.getLayerDetailsFromMap(this.config.searchLayers[r].baseURL,this.config.searchLayers[r].layerId,this.config.searchLayers[r].id))},_showMessage:function(r){(new ma({message:r})).message=r},_initWidgetComponents:function(){this.config.editorDescription&&(this.searchHeaderTextNode.innerHTML=this.editorXssFilter.sanitize(this.config.editorDescription),
T.set(this.searchHeaderTextNode,"aria-label",b.stripHTML(this.config.editorDescription)));this._bufferGraphicLayer=new I;this.map.addLayer(this._bufferGraphicLayer);this._highlightGraphicsLayer=new I;this.map.addLayer(this._highlightGraphicsLayer);this._createSearchInstance();this._createCurrentLocationInstance();this._createSlider();this._initLoading();this._initLayerList();this._displayBufferInputOptions();this._setBufferSliderVisiblity();this.config.showLocationTool&&this._connectSelectLocationHandler();
this._mapTooltip=Z.create("div",{"class":"esriCTMapTooltip",innerHTML:this.nls.selectLocationToolTip},this.map.container);C.set(this._mapTooltip,"position","fixed");C.set(this._mapTooltip,"display","none");this.own(O(window,"resize",d.hitch(this,this._onWindowResize)));this._createFilterList()},_hideFilterListBeforeInitWorkflow:function(){P.contains(this.applyFilterNode,"esriCTHidden")||P.contains(this.filterListOuterDiv,"esriCTHidden")||(P.toggle(this.applyFilterArrowNode,"esriCTApplyFilterArrowUp"),
P.remove(this.layerListOuterDiv,"esriCTHidden"),P.add(this.filterListOuterDiv,"esriCTHidden"))},_showHideFilterList:function(){P.toggle(this.applyFilterArrowNode,"esriCTApplyFilterArrowUp");P.contains(this.applyFilterArrowNode,"esriCTApplyFilterArrowUp")?(P.add(this.layerListOuterDiv,"esriCTHidden"),P.remove(this.filterListOuterDiv,"esriCTHidden"),b.initLastFocusNode(this.domNode,this._filterList.getLastNode()),this._filterList.filterListShown()):(P.remove(this.layerListOuterDiv,"esriCTHidden"),P.add(this.filterListOuterDiv,
"esriCTHidden"),this._searchedLocation?this._itemListObject.emit("setLastNode",this._itemListObject._currentPanelName):this._getMainScreenLastNode(),this._searchedLocation&&this._filterList.filtersUpdated&&this._prevFeature&&this._initWorkflow(this._prevFeature,this._prevAttributeSearchResult))},_createFilterList:function(){this.config.filterSettings&&this.config.filterSettings.filters&&0<this.config.filterSettings.filters.length&&(this._filterList=new k({map:this.map,config:this.config.filterSettings,
nls:this.nls,folderUrl:this.folderUrl,clearAllButton:this.clearAllFilterButton},Z.create("div",{},this.filterListNode)),this.own(O(this._filterList,"setLastFilterNode",d.hitch(this,function(r){b.initLastFocusNode(this.domNode,r)}))),this.own(O(this._filterList,"clearAllFilters",d.hitch(this,function(r){this._searchedLocation&&this._filterList.filtersUpdated&&this._prevFeature&&this._initWorkflow(this._prevFeature,this._prevAttributeSearchResult)}))),this._filterList.startup(),this.own(O(this.applyFilterArrowNodeParent,
"click",d.hitch(this,function(r){this._showHideFilterList()}))),this.own(O(this.applyFilterArrowNodeParent,"keydown",d.hitch(this,function(r){r.keyCode!==x.ENTER&&r.keyCode!==x.SPACE||this._showHideFilterList()}))),this.config.filterSettings.expandFiltersOnLoad&&this._showHideFilterList())},_setLayersForAttributeSearch:function(r){var X=[];this._attributeSearchLayers=[];r&&0<r.length&&(e.forEach(this.config.searchLayers,d.hitch(this,function(ba){X.push(ba.id)})),e.forEach(r,d.hitch(this,function(ba){ba._featureLayerId&&
-1<X.indexOf(ba._featureLayerId)&&this._attributeSearchLayers.push(ba)})))},_performAttributeSearch:function(r){var X=[],ba=[];var ra=new oa;e.forEach(r,d.hitch(this,function(g){var K=this._searchInstance.getSearchText();K=this._searchInstance.search._whereClause(K,g.featureLayer,g.searchFields,g.exactMatch);g.featureLayer.getDefinitionExpression()&&(K=g.featureLayer.getDefinitionExpression()+" and "+K);X.push(this._queryForIds(g.featureLayer,K));ba.push(g._featureLayerId)}));na(X).then(d.hitch(this,
function(g){for(var K,U=0;U<g.length;U++){var Y=[];0<g[U].length&&(K||(K={}),K.hasOwnProperty(ba[U])&&(Y=K[ba[U]]),Y=this._addOIDsInList(Y,g[U]),K[ba[U]]=Y)}ra.resolve(K)}));return ra.promise},_addOIDsInList:function(r,X){for(var ba=0;ba<X.length;ba++)0>r.indexOf(X[ba])&&r.push(X[ba]);return r},_queryForIds:function(r,X){var ba=new oa;var ra=new y(r.url);var g=new J;g.returnGeometry=!1;g.where=X?X:"1\x3d1";ra.executeForIds(g).then(d.hitch(this,function(K){K&&0<K.length?(K.length>r.maxRecordCount&&
(K=K.slice(0,r.maxRecordCount)),ba.resolve(K)):ba.resolve([])}),d.hitch(this,function(){ba.resolve([])}));return ba.promise},_createSearchInstance:function(){this.config.response=this.map.webMapResponse;this._searchInstance=new n({searchOptions:{addLayersFromMap:!1,autoNavigate:!1,autoComplete:!0,minCharacters:0,maxLocations:5,searchDelay:100,enableHighlight:!1},config:this.config,appConfig:this.appConfig,nls:this.nls,map:this.map},Z.create("div",{},this.search));this.own(this._searchInstance.on("init-attribute-search",
d.hitch(this,function(){var r,X=[];this._doAttributeSearchOn=[];0<this._attributeSearchLayers.length&&((r=this._searchInstance.getActiveSource())?r._featureLayerId&&(X=e.filter(this._attributeSearchLayers,d.hitch(this,function(ba){return ba._featureLayerId===r._featureLayerId})),0<X.length&&this._doAttributeSearchOn.push(r)):this._doAttributeSearchOn=this._attributeSearchLayers)})));this.own(this._searchInstance.on("select-result",d.hitch(this,function(r){r.isFeatureFromMapClick=!1;if(0<this._doAttributeSearchOn.length)this._performAttributeSearch(this._doAttributeSearchOn).then(d.hitch(this,
function(g){var K=!0;if(g)for(var U in g)0<g[U].length?K=!1:delete g[U];K?this._initWorkflow(r):this._initWorkflow(null,g)}));else{var X=!0;if(r&&r.source&&r.source._featureLayerId&&r.source.featureLayer){var ba=e.filter(this._attributeSearchLayers,d.hitch(this,function(g){return g._featureLayerId===r.source._featureLayerId}));if(0<ba.length&&r.source.featureLayer.objectIdField&&r.result.feature.attributes){X=!1;ba=r.source.featureLayer.objectIdField;var ra={};ra[r.source._featureLayerId]=[r.result.feature.attributes[ba]]}}X?
this._initWorkflow(r):this._initWorkflow(null,ra)}})));this.own(this._searchInstance.on("clear-search",d.hitch(this,function(){this._itemListObject&&(this.config.selectedSearchLayerOnly&&this._itemListObject.showAllLayers(!0),this._itemListObject.resetAllFilters());this._clearResults();this._getMainScreenLastNode()})));this.own(this._searchInstance.on("search-results",d.hitch(this,function(){this._clearResults(!0)})));this.own(this._searchInstance.on("search-loaded",d.hitch(this,function(){setTimeout(d.hitch(this,
function(){this._getMainScreenLastNode();this._initReverseGeocoder();this._searchContainerNodeElement=F(".arcgisSearch .searchGroup .searchInput",this.domNode)[0];2>this._searchInstance.search.sources.length&&(this._hasMulitpleSourcesInSearch=!1);this._setLayersForAttributeSearch(this._searchInstance.search.sources);this._onWindowResize()}),1E3)})));this._searchInstance.startup()},_getMainScreenLastNode:function(){var r=this._searchInstance.search.submitNode;this.config.showCurrentLocationTool&&(r=
this.currentLocationNode);this.config.showLocationTool&&(r=this.selectLocation);if(!P.contains(this.bufferOptionParentNode,"esriCTHidden")){this._bufferTextbox&&!P.contains(this.bufferTextboxParentNode,"esriCTHidden")&&(r=this._bufferTextbox.domNode);var X=F(".esriCTSliderDiv",this.widgetMainNode);X&&!P.contains(X[0],"esriCTHidden")&&(r=this._slider.sliderHandle)}P.contains(this.applyFilterNode,"esriCTHidden")||(this.applyFilterArrowNodeParent&&(r=this.applyFilterArrowNodeParent),this.clearAllFilterButton&&
(r=this.clearAllFilterButton),P.contains(this.filterListOuterDiv,"esriCTHidden")||(r=this._filterList.getLastNode()));this._itemListObject&&this._itemListObject.filterButton&&"block"===C.get(this._itemListObject.filterButton.parentElement,"display")&&(r=this._itemListObject.filterButton,this._lastFocusNodes.layerList=r,this._lastFocusNodes.featureList=r);this._lastFocusNodes.mainScreen=r;b.initLastFocusNode(this.domNode,r)},_createCurrentLocationInstance:function(){this.isNeedHttpsButNot=b.isNeedHttpsButNot();
b.isNeedHttpsButNot()&&(this.config.showCurrentLocationTool=!1);this.config.showCurrentLocationTool&&(P.remove(this.currentLocationNode,"esriCTHidden"),this._geoLocateInstance=new Ba({highlightLocation:!1,map:this.map},Z.create("div",{},this.currentLocationNode)),this.own(O(this._geoLocateInstance,"locate",d.hitch(this,function(r){r&&r.graphic&&r.graphic.geometry?this._initWorkflow({feature:new H(r.graphic.geometry),isFeatureFromMapClick:!0}):r.error&&r.error.message&&this._showMessage(r.error.message)}))),
this._geoLocateInstance._locateNode&&T.set(this._geoLocateInstance._locateNode,"aria-label",this.nls.selectLocationToolTip))},_initReverseGeocoder:function(){var r;this.config.searchSourceSettings&&this.config.searchSourceSettings.sources&&(e.some(this.config.searchSourceSettings.sources,d.hitch(this,function(X){if(X&&X.url&&"locator"===X.type)return r=X.url,!0})),r&&(this._loading.show(),A({url:r,content:{f:"json"},handleAs:"json",callbackPrams:"callback"}).then(d.hitch(this,function(X){this._loading.hide();
this._geocoderSpatialRef=new wa(X.spatialReference);this._locatorInstance=new B(r);this.own(this._locatorInstance.on("location-to-address-complete",d.hitch(this,this._onLocationToAddressComplete)))}))))},_onLocationToAddressComplete:function(r){var X;if(r.address&&r.address.address){if(r.address.address.Match_addr)var ba=r.address.address.Match_addr;else{ba="";for(var ra in r.address.address)"Loc_name"!==ra&&r.address.address[ra]&&(ba+=r.address.address[ra]+" ");ba=d.trim(ba)}this._searchInstance&&
this._searchInstance.setSearchText(ba);if(this.config.searchSourceSettings.showInfoWindowOnSelect){r=new la;r.setContent("${Match_addr}");r.setTitle(this.nls.searchLocationTitle);ba={Match_addr:ba};var g=new H(this._searchedLocation.geometry,null,ba,r);this.map.infoWindow.clearFeatures();this.map.infoWindow.setFeatures([g]);setTimeout(d.hitch(this,function(){X=this.map.toScreen(g.geometry);this.map.infoWindow.show(X,this.map.getInfoWindowAnchor(X));this.map.infoWindow.isShowing=!0}),500)}}},_connectSelectLocationHandler:function(){O(this.selectLocation,
"click",d.hitch(this,function(){this._selectLocationButtonClicked()}));O(this.selectLocation,"keydown",d.hitch(this,function(r){r.keyCode!==x.ENTER&&r.keyCode!==x.SPACE||this._selectLocationButtonClicked()}))},_selectLocationButtonClicked:function(){P.contains(this.selectLocation,"esriCTSelectLocationActive")?this._disconnectMapEventHandler():(P.replace(this.selectLocation,"esriCTSelectLocationActive","esriCTSelectLocation"),this._connectMapEventHandler())},_initWorkflow:function(r,X){this._hideFilterListBeforeInitWorkflow();
this._clearResults(!X);this._doAttributeSearchOn=[];var ba=this._getSelectedFeatureFromResult(r);this._prevAttributeSearchResult=d.clone(X);this._prevFeature={feature:ba,isFeatureFromMapClick:ba?r.isFeatureFromMapClick:!1};this._searchedLocation=ba;r&&r.source&&r.source.zoomScale&&(this._prevFeature.zoomScale=r.source.zoomScale);r&&this._locatorInstance&&r.isFeatureFromMapClick&&this._searchedLocation&&this._searchedLocation.geometry&&this.showReverseGeocodedAddress();ba&&ba.geometry?this._itemListObject.hasValidLayers()?
(this._highlightSelectedLocation(ba),P.contains(this.bufferOptionParentNode,"esriCTHidden")?this.zoomToFeature().then(d.hitch(this,function(){this._itemListObject.displayLayerList(this._searchedLocation,null)})):this._createBuffer(ba.geometry)):this._showMessage(this.nls.allPopupsDisabledMsg):X&&(this._itemListObject.hasValidLayers()?this._itemListObject.displayLayerList(null,null,X):this._showMessage(this.nls.allPopupsDisabledMsg))},_clearResults:function(r){this._highlightGraphicsLayer&&this._highlightGraphicsLayer.clear();
this._searchedLocation=null;this._itemListObject&&this._itemListObject.clearResultPanel();this._bufferGraphicLayer&&this._bufferGraphicLayer.clear();r||this.map.infoWindow.hide()},_connectMapEventHandler:function(){this._mapClickHandler||(this._disableWebMapPopup(),this._mapClickHandler=this.own(this.map.on("click",d.hitch(this,this._onMapClick)))[0],"ontouchstart"in document.documentElement?C.set(this._mapTooltip,"display","none"):(this._mapMoveHandler=this.own(this.map.on("mouse-move",d.hitch(this,
this._onMapMouseMove)))[0],this.own(this.map.on("mouse-out",d.hitch(this,function(){C.set(this._mapTooltip,"display","none")})))))},_onMapClick:function(r){this.config.showLocationTool&&this._disconnectMapEventHandler();this.map.infoWindow.hide();this._searchInstance&&this._searchInstance.clearSearchText();this._initWorkflow({feature:new H(r.mapPoint),isFeatureFromMapClick:!0})},_onMapMouseMove:function(r){if(r.clientX||r.pageY){var X=r.clientX;r=r.clientY}else X=r.clientX+document.body.scrollLeft-
document.body.clientLeft,r=r.clientY+document.body.scrollTop-document.body.clientTop;C.set(this._mapTooltip,"display","none");C.set(this._mapTooltip,{left:X+15+"px",top:r+"px"});C.set(this._mapTooltip,"display","")},_disconnectMapEventHandler:function(){this._enableWebMapPopup();P.replace(this.selectLocation,"esriCTSelectLocation","esriCTSelectLocationActive");this._mapClickHandler&&(this._mapClickHandler.remove(),this._mapClickHandler=null);this._mapMoveHandler&&(this._mapMoveHandler.remove(),this._mapMoveHandler=
null,this._mapTooltip.style.display="none")},_enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},_disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},_createSlider:function(){this._slider=new Q({name:"slider",showButtons:!1,discreteValues:this.config.maxBufferDistance+1,minimum:0,maximum:this.config.maxBufferDistance,value:this.config.defaultBufferDistance,intermediateChanges:!0,"class":"esriCTHorizantalSlider","aria-label":this.nls.bufferDistanceLabel},
this.horizantalSliderContainer);this._bufferParams={BufferDistance:this._slider.value.toString(),BufferUnit:this.nls.units[this.config.bufferDistanceUnit.value].displayText};this._bufferTextbox=new D({constraints:{min:0,max:this.config.maxBufferDistance},required:!0,value:this.config.defaultBufferDistance,"class":"esriCTBufferTextbox","aria-label":M.substitute(this.nls.bufferSliderText,this._bufferParams)},this.bufferTextboxNode);var r=d.clone(this._bufferParams);r.BufferDistance=b.localizeNumber(r.BufferDistance);
T.set(this.silderText,"innerHTML",M.substitute(this.nls.bufferSliderText,r));T.set(this.silderText,"aria-label",M.substitute(this.nls.bufferSliderText,r));T.set(this.bufferTextboxText,"innerHTML",M.substitute(this.nls.bufferTextboxLabel,this._bufferParams));this.own(O(this._bufferTextbox,"keydown",d.hitch(this,function(X){X.keyCode===x.ENTER&&this._bufferTextboxChange()})));this.own(O(this._bufferTextbox,"blur",d.hitch(this,function(){this._bufferTextboxChange()})));this.own(this._slider.on("change",
d.hitch(this,this._sliderChange)));this.sliderMinValue.innerHTML=this._slider.minimum.toString();this.sliderMaxValue.innerHTML=this._slider.maximum.toString()},_bufferTextboxChange:function(){if(this._bufferTextbox.isValid()){var r=this._bufferTextbox.getValue();this._slider.set("value",r)}else this._showMessage(this.nls.invalidBufferDistance)},_sliderChange:function(r){r=parseFloat(r,10);if(!isNaN(r)){this._bufferParams.BufferDistance=r;var X=M.substitute(this.nls.bufferSliderText,this._bufferParams);
T.set(this.silderText,"innerHTML",X);T.set(this.silderText,"aria-label",X);this._bufferTextbox.set("value",r);this._bufferTextbox&&this._bufferTextbox.focusNode&&T.set(this._bufferTextbox.focusNode,"aria-label",X);this._sliderChangeTimer&&clearTimeout(this._sliderChangeTimer);this._searchedLocation&&(this._loading.show(),this._sliderChangeTimer=setTimeout(d.hitch(this,this._createBuffer),700))}},showReverseGeocodedAddress:function(){this._geocoderSpatialRef&&this._locatorInstance&&this.getProjectedGeometry(this._searchedLocation.geometry,
this._geocoderSpatialRef).then(d.hitch(this,function(r){this._locatorInstance.locationToAddress(r,100)}))},getProjectedGeometry:function(r,X){var ba=new v(this.config.helperServices.geometry.url);var ra=new oa;if(da.canProject(r,X)){var g=da.project(r,X);ra.resolve(g)}else ba.project([r],X,function(K){g=K[0];ra.resolve(g)});return ra.promise},_createBuffer:function(){var r=new v(this.config.helperServices.geometry.url);if(0<this._bufferParams.BufferDistance){this._loading.show();var X=new G;X.distances=
[this._bufferParams.BufferDistance];X.unit=v[this.config.bufferDistanceUnit.bufferUnit];X.bufferSpatialReference=this.map.spatialReference;X.outSpatialReference=this.map.spatialReference;X.geometries=[this._searchedLocation.geometry];if(this.config.isGeodesic||4326===this.map.spatialReference.wkid)this.config.isGeodesic=!0,X.geodesic=!0;r.buffer(X,d.hitch(this,function(ba){this._showBuffer(ba);this.map.setExtent(ba[0].getExtent().expand(1.5));this._loading.hide();this._itemListObject.displayLayerList(this._searchedLocation,
ba[0])}),d.hitch(this,function(){this._showMessage(this.nls.unableToCreateBuffer);this._loading.hide()}))}else this._bufferGraphicLayer.clear(),this._prevFeature.isFeatureFromMapClick?(this._itemListObject.displayLayerList(this._searchedLocation,null),this._loading.hide()):this.zoomToFeature().then(d.hitch(this,function(){this._itemListObject.displayLayerList(this._searchedLocation,null);this._loading.hide()}))},zoomToFeature:function(){var r=new oa;var X=this._prevFeature.feature.geometry;if("point"===
X.type){if(this._prevFeature.hasOwnProperty("zoomScale"))var ba=this._prevFeature.zoomScale;ba&&this.map.getScale()>ba?ba=ea.getExtentForScale(this.map,this._prevFeature.zoomScale).centerAt(X):(ba=this.map.extent.centerAt(X))||(ba=this.pointToExtent(this.map,X,20))}else ba=X.getExtent().expand(1.5);ba?this.map.setExtent(ba).then(d.hitch(this,function(){r.resolve()})):r.resolve();return r},pointToExtent:function(r,X,ba){var ra=r.extent.getWidth()/r.width;ba*=ra;return new ta(X.x-ba,X.y-ba,X.x+ba,X.y+
ba,r.spatialReference)},_showBuffer:function(r){if(this.config.bufferInfo&&this.config.bufferInfo.isVisible&&(this._bufferGraphicLayer.clear(),this.config&&this.config.symbols&&this.config.symbols.bufferSymbol)){var X=a.fromJson(this.config.symbols.bufferSymbol);e.forEach(r,d.hitch(this,function(ba){ba=new H(ba,X);this._bufferGraphicLayer.add(ba)}))}},_getSelectedFeatureFromResult:function(r){if(r)if(r.feature)var X=r.feature;else r.result&&r.result.feature&&(X=r.result.feature);return X},_highlightSelectedLocation:function(r){if(r){this._highlightGraphicsLayer.clear();
var X="polygon"===r.geometry.type?a.fromJson(this.config.symbols.polygonSymbol):"polyline"===r.geometry.type?a.fromJson(this.config.symbols.polylineSymbol):a.fromJson(this.config.symbols.graphicLocationSymbol);this._highlightGraphicsLayer.add(new H(r.geometry,X))}},_onWindowResize:function(){this._windowResizeTimer&&clearTimeout(this._windowResizeTimer);this._windowResizeTimer=setTimeout(d.hitch(this,this._resetComponents),500)},_resetComponents:function(){var r,X=[];var ba=F(".arcgisSearch .searchGroup",
this.domNode)[0];this._searchContainerNodeElement||(this._searchContainerNodeElement=F(".arcgisSearch .searchGroup .searchInput",this.domNode)[0]);X=F(".dijitContentPane",this.domNode);X.push(this.domNode);e.forEach(X,d.hitch(this,function(ra){C.set(ra,"-webkit-overflow-scrolling","auto")}));this.widgetMainNode&&this._searchContainerNodeElement&&(r=R.position(this.widgetMainNode))&&r.w&&(r=r.w-144,this._hasMulitpleSourcesInSearch||(r+=32),0<r&&(this.config.showLocationTool&&(r-=45),this.config.showCurrentLocationTool&&
(r-=45),this._searchContainerNodeElement.style.setProperty("width",r+"px","important"),ba&&ba.style.setProperty("max-width","100%","important")));0<X.length&&setTimeout(d.hitch(this,function(){e.forEach(X,d.hitch(this,function(ra){C.set(ra,"-webkit-overflow-scrolling","touch")}))}),500);this._itemListObject&&this._itemListObject.resetGallery()},_initLayerList:function(){this._itemListObject=new q({map:this.map,config:this.config,nls:this.nls,loading:this._loading,parentDivId:this.id,folderUrl:this.folderUrl,
outerContainer:this.layerListOuterDiv,searchOuterContainer:this.searchOuterContainer,selectedThemeColor:this.selectedThemeColor,domNodeObj:this.domNode,applyFilterNode:this.applyFilterNode,filterListMainDiv:this.filterListMainDiv});this.own(O(this._itemListObject,"init-proximity",d.hitch(this,function(r){var X={isFeatureFromMapClick:!1};X.feature=r;this._initWorkflow(X)})));this.own(O(this._itemListObject,"setLastNode",d.hitch(this,function(r){"layerListPanel"===r?(this._itemListObject.filterButton&&
"block"===C.get(this._itemListObject.filterButton.parentElement,"display")?this._lastFocusNodes.layerList=this._itemListObject.filterButton:this._lastFocusNodes.layerList=F(".esriCTLastLayerFocusNode")[0],this._lastFocusNodes.layerList&&b.initLastFocusNode(this.domNode,this._lastFocusNodes.layerList)):"featureListPanel"===r&&(this._itemListObject.filterButton&&"block"===C.get(this._itemListObject.filterButton.parentElement,"display")||(this._lastFocusNodes.featureList=F(".esriCTLastFeatureFocusNode")[0]),
b.initLastFocusNode(this.domNode,this._lastFocusNodes.featureList))})));this.own(O(this._itemListObject,"setLastNodeInFeatureInfo",d.hitch(this,function(r){b.initLastFocusNode(this.domNode,r)})));this.own(O(this._itemListObject,"noFeatureFound",d.hitch(this,function(){this._getMainScreenLastNode();b.focusFirstFocusNode(this.domNode)})));this.own(O(this._itemListObject,"setFocusOnFirstFocusableNode",d.hitch(this,function(){1===this._searchInstance.search.sources.length?f.focus(this._searchInstance.search.inputNode):
f.focus(this._searchInstance.search.sourcesBtnNode)})));this.id&&N.byId(this.id)&&N.byId(this.id).resize&&N.byId(this.id).resize()},_initLoading:function(){this._loading=new pa({hidden:!0});this._loading.placeAt(this.domNode);this._loading.startup()},_displayBufferInputOptions:function(){"slider"===this.config.bufferInputOption?(P.add(this.bufferTextboxParentNode,"esriCTHidden"),P.add(this.applyFilterNode,"esriCTApplyFilterDivSpacing")):"textbox"===this.config.bufferInputOption?P.add(this.sliderParentNode,
"esriCTHidden"):"sliderAndTextbox"===this.config.bufferInputOption&&(P.add(this.silderText,"esriCTHidden"),P.add(this.sliderParentNode,"esriCTOverrideSliderDiv"));P.remove(this.bufferOptionParentNode,"esriCTHidden")},_setBufferSliderVisiblity:function(){var r=!0,X;this.config.searchLayers&&0<this.config.searchLayers.length&&(e.some(this.config.searchLayers,d.hitch(this,function(ba){if("esriGeometryPolygon"!==ba.geometryType)return r=!1})),this.config.intersectSearchedLocation&&r?(P.add(this.bufferOptionParentNode,
"esriCTHidden"),(X=F(".esriCTItemListMainContainer",this.domNode))&&("slider"===this.config.bufferInputOption||"textbox"===this.config.bufferInputOption?P.add(X[0],"esriCTItemListOverrideMainContainer"):P.add(X[0],"esriCTItemListOverrideMainContainerForBothBufferOptions"))):(P.remove(this.bufferOptionParentNode,"esriCTHidden"),"textbox"===this.config.bufferInputOption?b.initLastFocusNode(this.domNode,this._bufferTextbox.domNode):b.initLastFocusNode(this.domNode,this.horizantalSliderContainer)),this._itemListObject&&
this._itemListObject.updateListHeight())},_getSelectedThemeColor:function(r,X){var ba=this.appConfig.theme.name;X&&(ba=r);var ra=this.appConfig&&this.appConfig.theme&&this.appConfig.theme.styles?this.appConfig.theme.styles[0]:"default";X&&(ra=X);this.appConfig&&this.appConfig.theme&&this.appConfig.theme.customStyles&&this.appConfig.theme.customStyles.mainBackgroundColor&&!X?this.selectedThemeColor=this.appConfig.theme.customStyles.mainBackgroundColor:A({url:"./themes/"+ba+"/manifest.json",content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}).then(d.hitch(this,function(g){var K;if(g&&g.styles&&0<g.styles.length)for(K=0;K<g.styles.length;K++){var U=g.styles[K];if(U.name===ra){this.selectedThemeColor=U.styleColor;break}}this.selectedThemeColor||(this.selectedThemeColor="#000000");X&&(this._itemListObject.selectedThemeColor=this.selectedThemeColor,this._itemListObject.resetIconColors())}),d.hitch(this,function(){this.selectedThemeColor="#000000"}))},onAppConfigChanged:function(r,X,ba){"styleChange"===
X&&(r&&r.theme&&r.theme.customStyles&&r.theme.customStyles.mainBackgroundColor?(this._itemListObject.selectedThemeColor=r.theme.customStyles.mainBackgroundColor,this._itemListObject.resetIconColors()):(r=r.theme.name,this._getSelectedThemeColor(r,ba)))}})});